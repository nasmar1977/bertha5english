<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÆ Vokabel-Abenteuer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', 'Chalkboard SE', 'Arial Rounded MT Bold', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
        }

        .game-container {
            background: white;
            border-radius: 30px;
            padding: 20px;
            max-width: 800px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        @media (min-width: 768px) {
            .game-container {
                padding: 40px;
            }

            body {
                padding: 20px;
            }
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #667eea;
            font-size: 1.8em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        @media (min-width: 768px) {
            .header h1 {
                font-size: 2.5em;
            }
        }

        .current-set {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 6px 15px;
            border-radius: 15px;
            font-size: 0.75em;
            margin-top: 10px;
            display: inline-block;
        }

        @media (min-width: 768px) {
            .current-set {
                padding: 8px 20px;
                border-radius: 20px;
                font-size: 0.9em;
            }
        }

        .set-selection {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin: 20px 0;
        }

        @media (min-width: 768px) {
            .set-selection {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 20px;
                margin: 30px 0;
            }
        }

        .set-card {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border-radius: 20px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            border: 3px solid transparent;
        }

        @media (min-width: 768px) {
            .set-card {
                padding: 30px;
            }
        }

        .set-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            border-color: #667eea;
        }

        .set-card-all {
            background: linear-gradient(135deg, #f9d423 0%, #ff4e50 100%);
        }

        @media (min-width: 768px) {
            .set-card-all {
                grid-column: 1 / -1;
            }
        }

        .set-icon {
            font-size: 3em;
            margin-bottom: 10px;
        }

        @media (min-width: 768px) {
            .set-icon {
                font-size: 4em;
                margin-bottom: 15px;
            }
        }

        .set-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
        }

        @media (min-width: 768px) {
            .set-title {
                font-size: 1.5em;
                margin-bottom: 10px;
            }
        }

        .set-info {
            font-size: 1em;
            color: #666;
            margin-bottom: 8px;
        }

        @media (min-width: 768px) {
            .set-info {
                font-size: 1.2em;
                margin-bottom: 10px;
            }
        }

        .set-topics {
            font-size: 0.8em;
            color: #888;
            font-style: italic;
        }

        @media (min-width: 768px) {
            .set-topics {
                font-size: 0.9em;
            }
        }

        .taler-display {
            background: linear-gradient(135deg, #f9d423 0%, #ff4e50 100%);
            padding: 15px;
            border-radius: 15px;
            text-align: center;
            color: white;
            font-size: 1em;
            margin-top: 20px;
        }

        @media (min-width: 768px) {
            .taler-display {
                padding: 20px;
                font-size: 1.2em;
                margin-top: 30px;
            }
        }

        .score-board {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            margin-bottom: 20px;
            padding: 10px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border-radius: 15px;
            color: white;
            gap: 10px;
        }

        @media (min-width: 768px) {
            .score-board {
                margin-bottom: 30px;
                padding: 15px;
            }
        }

        .score-item {
            text-align: center;
            flex: 1;
            min-width: 80px;
        }

        .score-item .label {
            font-size: 0.75em;
            opacity: 0.9;
        }

        @media (min-width: 768px) {
            .score-item .label {
                font-size: 0.9em;
            }
        }

        .score-item .value {
            font-size: 1.5em;
            font-weight: bold;
        }

        @media (min-width: 768px) {
            .score-item .value {
                font-size: 2em;
            }
        }

        .taler-item {
            background: linear-gradient(135deg, #f9d423 0%, #ff4e50 100%);
            padding: 8px 12px;
            border-radius: 10px;
            animation: shine 2s infinite;
            flex-basis: 100%;
            margin-top: 5px;
        }

        @media (min-width: 768px) {
            .taler-item {
                padding: 10px 15px;
                flex-basis: auto;
                margin-top: 0;
            }
        }

        @keyframes shine {
            0%, 100% { box-shadow: 0 0 10px rgba(249, 212, 35, 0.5); }
            50% { box-shadow: 0 0 20px rgba(249, 212, 35, 0.8); }
        }

        .taler-item .value {
            font-size: 1.5em;
        }

        @media (min-width: 768px) {
            .taler-item .value {
                font-size: 1.8em;
            }
        }

        .word-card {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }

        @media (min-width: 768px) {
            .word-card {
                padding: 30px;
                margin-bottom: 30px;
            }
        }

        .word-image {
            font-size: 60px;
            margin-bottom: 10px;
            animation: bounce 2s infinite;
        }

        @media (min-width: 768px) {
            .word-image {
                font-size: 100px;
                margin-bottom: 15px;
            }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .word-german {
            font-size: 1.3em;
            color: #333;
            margin-bottom: 8px;
            font-weight: bold;
        }

        @media (min-width: 768px) {
            .word-german {
                font-size: 1.8em;
                margin-bottom: 10px;
            }
        }

        .word-hint {
            font-size: 0.9em;
            color: #666;
            font-style: italic;
        }

        @media (min-width: 768px) {
            .word-hint {
                font-size: 1em;
            }
        }

        .auto-hint {
            margin-top: 10px;
            font-size: 1em;
            color: #667eea;
            font-weight: bold;
            min-height: 25px;
            animation: fadeIn 0.5s;
        }

        @media (min-width: 768px) {
            .auto-hint {
                margin-top: 15px;
                font-size: 1.3em;
                min-height: 30px;
            }
        }

        .auto-hint.show {
            color: #f5576c;
        }

        .answer-area {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin-bottom: 20px;
            min-height: 60px;
            flex-wrap: wrap;
        }

        @media (min-width: 768px) {
            .answer-area {
                gap: 8px;
                margin-bottom: 30px;
                min-height: 80px;
            }
        }

        .letter-slot {
            width: 45px;
            height: 55px;
            border: 3px dashed #667eea;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
            background: #f0f4ff;
            transition: all 0.3s;
        }

        @media (min-width: 768px) {
            .letter-slot {
                width: 60px;
                height: 70px;
                font-size: 2em;
            }
        }

        .letter-slot.filled {
            background: #667eea;
            color: white;
            border-style: solid;
            transform: scale(1.05);
        }

        .letter-slot.correct {
            background: #10b981;
            border-color: #10b981;
            animation: celebrate 0.5s;
        }

        .letter-slot.wrong {
            background: #ef4444;
            border-color: #ef4444;
            animation: shake 0.5s;
        }

        @keyframes celebrate {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2) rotate(10deg); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .letters-pool {
            display: flex;
            justify-content: center;
            gap: 6px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        @media (min-width: 768px) {
            .letters-pool {
                gap: 10px;
                margin-bottom: 30px;
            }
        }

        .letter-tile {
            width: 45px;
            height: 55px;
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            font-weight: bold;
            color: white;
            cursor: grab;
            user-select: none;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        @media (min-width: 768px) {
            .letter-tile {
                width: 60px;
                height: 70px;
                font-size: 2em;
            }
        }

        .letter-tile:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.2);
        }

        .letter-tile:active {
            cursor: grabbing;
        }

        .letter-tile.used {
            opacity: 0.3;
            pointer-events: none;
        }

        .buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        @media (min-width: 768px) {
            .buttons {
                gap: 15px;
            }
        }

        .btn {
            padding: 12px 20px;
            font-size: 1em;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            color: white;
        }

        @media (min-width: 768px) {
            .btn {
                padding: 15px 30px;
                font-size: 1.2em;
            }
        }

        .btn small {
            font-size: 0.7em;
            opacity: 0.8;
            font-weight: normal;
            display: none;
        }

        @media (min-width: 768px) {
            .btn small {
                display: inline;
            }
        }

        .btn-check {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .btn-skip {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .btn-continue {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .btn-clear {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .feedback {
            text-align: center;
            margin-top: 15px;
            font-size: 1.2em;
            font-weight: bold;
            min-height: 35px;
        }

        @media (min-width: 768px) {
            .feedback {
                margin-top: 20px;
                font-size: 1.5em;
                min-height: 40px;
            }
        }

        .feedback.correct {
            color: #10b981;
            animation: fadeIn 0.5s;
        }

        .feedback.wrong {
            color: #ef4444;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .celebration {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 30px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            z-index: 1000;
            max-width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        @media (min-width: 768px) {
            .celebration {
                padding: 50px;
                max-width: 600px;
            }
        }

        .celebration.show {
            display: block;
            animation: popIn 0.5s;
        }

        @keyframes popIn {
            from { transform: translate(-50%, -50%) scale(0); }
            to { transform: translate(-50%, -50%) scale(1); }
        }

        .celebration h2 {
            font-size: 2em;
            color: #667eea;
            margin-bottom: 15px;
        }

        @media (min-width: 768px) {
            .celebration h2 {
                font-size: 3em;
                margin-bottom: 20px;
            }
        }

        .celebration .final-score {
            font-size: 1em;
            color: #333;
            margin-bottom: 20px;
        }

        @media (min-width: 768px) {
            .celebration .final-score {
                font-size: 1.2em;
                margin-bottom: 30px;
            }
        }

        /* Multiple Choice Styles */
        .mc-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        @media (min-width: 768px) {
            .mc-options {
                gap: 12px;
                margin-bottom: 30px;
            }
        }

        .mc-option {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            border: 3px solid #e0e0e0;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            background: #f8f9ff;
            font-size: 1em;
            text-align: left;
            user-select: none;
        }

        @media (min-width: 768px) {
            .mc-option {
                padding: 15px 20px;
                font-size: 1.15em;
            }
        }

        .mc-option:hover {
            border-color: #667eea;
            background: #eef0ff;
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .mc-option .mc-key {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 8px;
            font-weight: bold;
            font-size: 0.9em;
            margin-right: 12px;
            flex-shrink: 0;
        }

        .mc-option .mc-text {
            flex: 1;
        }

        .mc-option.selected {
            border-color: #667eea;
            background: #dde1ff;
            transform: translateX(5px);
        }

        .mc-option.mc-correct {
            border-color: #10b981;
            background: #d1fae5;
            animation: celebrate 0.5s;
        }

        .mc-option.mc-correct .mc-key {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .mc-option.mc-wrong {
            border-color: #ef4444;
            background: #fee2e2;
            animation: shake 0.5s;
        }

        .mc-option.mc-wrong .mc-key {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        .mc-option.mc-disabled {
            pointer-events: none;
            opacity: 0.7;
        }

        .mc-option.mc-disabled.mc-correct {
            opacity: 1;
        }

        .mode-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.7em;
            font-weight: bold;
            color: white;
            margin-top: 8px;
        }

        .mode-badge.spelling {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }

        .mode-badge.multiple-choice {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        /* Language Selection */
        .lang-card {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border-radius: 20px;
            padding: 30px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            border: 3px solid transparent;
        }
        .lang-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            border-color: #667eea;
        }
        .lang-card.latin {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
        }
        .lang-icon { font-size: 3em; margin-bottom: 10px; }
        .lang-title { font-size: 1.3em; font-weight: bold; color: #333; margin-bottom: 8px; }
        .lang-info { font-size: 1em; color: #666; }

        .back-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 15px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.95em;
            margin-bottom: 15px;
            transition: all 0.3s;
        }
        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .module-card {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            border-radius: 20px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            border: 3px solid transparent;
        }
        .module-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            border-color: #667eea;
        }
        .module-card.mixed {
            background: linear-gradient(135deg, #f9d423 0%, #ff4e50 100%);
        }
        .module-icon { font-size: 2.5em; margin-bottom: 8px; }
        .module-title { font-size: 1.1em; font-weight: bold; color: #333; margin-bottom: 5px; }
        .module-info { font-size: 0.9em; color: #666; }

        /* Sentence fill-in */
        .sentence-card {
            background: linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }
        .sentence-latin {
            font-size: 1.2em; font-style: italic; color: #444; margin-bottom: 12px;
        }
        .sentence-template {
            font-size: 1.3em; font-weight: bold; color: #333;
        }
        @media (min-width: 768px) {
            .sentence-latin { font-size: 1.4em; }
            .sentence-template { font-size: 1.5em; }
        }

        /* Emoji Curtain */
        .word-image-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }
        .curtain {
            display: none;
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            z-index: 2;
        }
        .curtain.active {
            display: flex;
        }
        .curtain-left, .curtain-right {
            width: 50%;
            height: 100%;
            background: repeating-linear-gradient(
                90deg,
                #8b1a1a 0px, #a52a2a 6px, #8b1a1a 12px, #701414 18px
            );
            box-shadow: inset 0 0 20px rgba(0,0,0,0.3);
        }
        .curtain-left {
            border-right: 2px solid #5a0e0e;
        }
        .curtain-right {
            border-left: 2px solid #5a0e0e;
        }
        .curtain-left::after, .curtain-right::after {
            content: '';
            display: block;
            width: 8px;
            height: 20px;
            background: #d4a017;
            border-radius: 0 0 4px 4px;
            margin-top: 4px;
        }
        .curtain-left::after {
            margin-left: auto;
            margin-right: 4px;
        }
        .curtain-right::after {
            margin-left: 4px;
        }
        .curtain.reveal .curtain-left {
            transform: translateX(-100%);
            transition: transform 0.6s ease-in-out;
        }
        .curtain.reveal .curtain-right {
            transform: translateX(100%);
            transition: transform 0.6s ease-in-out;
        }
        /* Terminal Table Training */
        .terminal-container {
            background: #0d1117;
            border-radius: 12px;
            overflow: hidden;
            font-family: 'Courier New', Monaco, monospace;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            margin: 0 auto 15px;
        }
        .terminal-header {
            background: #161b22;
            padding: 10px 14px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .terminal-dot { width: 12px; height: 12px; border-radius: 50%; display: inline-block; }
        .terminal-dot.red { background: #ff5f56; }
        .terminal-dot.yellow { background: #ffbd2e; }
        .terminal-dot.green { background: #27c93f; }
        .terminal-title { color: #8b949e; font-size: 0.85em; margin-left: 10px; }
        .terminal-body { padding: 12px; overflow-x: auto; }
        .terminal-tbl { border-collapse: collapse; color: #c9d1d9; font-size: 0.82em; white-space: nowrap; }
        .terminal-tbl th {
            color: #58a6ff; border-bottom: 2px solid #30363d;
            padding: 5px 8px; text-align: left; position: sticky; top: 0; background: #0d1117;
        }
        .terminal-tbl td { padding: 5px 8px; border-bottom: 1px solid #21262d; }
        .terminal-tbl .row-label { color: #d2a8ff; font-weight: bold; }
        .terminal-tbl .cell-blank {
            background: #161b22; border: 1px solid #39ff14; border-radius: 3px;
        }
        .terminal-tbl .cell-blank input {
            background: transparent; color: #39ff14; border: none;
            font-family: inherit; font-size: inherit; width: 100%; min-width: 80px;
            outline: none; caret-color: #39ff14; padding: 2px;
        }
        .terminal-tbl .cell-correct-flash { color: #39ff14; background: rgba(57,255,20,0.15); }
        .terminal-tbl .cell-wrong-flash { color: #ff4444; background: rgba(255,68,68,0.15); }
        .terminal-prompt {
            padding: 10px 14px; border-top: 1px solid #21262d;
            display: flex; align-items: center; gap: 8px; flex-wrap: wrap;
        }
        .terminal-prompt .prompt-symbol { color: #39ff14; font-weight: bold; }
        .terminal-prompt .prompt-hint { color: #8b949e; font-size: 0.9em; }
        .terminal-prompt .prompt-error { color: #ff4444; font-size: 0.9em; }
        #tableArea { display: none; }
        #tableCheckBtn {
            background: #161b22; color: #39ff14; border: 2px solid #39ff14;
            padding: 10px 25px; border-radius: 8px; font-family: 'Courier New', monospace;
            font-size: 1em; cursor: pointer; margin-top: 10px;
        }
        #tableCheckBtn:hover { background: #39ff14; color: #0d1117; }
        #tableSkipBtn { margin-left: 10px; margin-top: 10px; }

        /* Konjugationsschlange */
        .snake-card {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e063 50%, #f7dc6f 100%) !important;
        }
        .snake-card .module-title { color: #1a3a0a !important; }
        .snake-card .module-info { color: #2d5a1a !important; }
        #snakeArea { display: none; }
        .snake-chain {
            display: flex; align-items: center; gap: 0;
            overflow-x: auto; padding: 20px 5px 20px 28px;
            -webkit-overflow-scrolling: touch;
        }
        .snake-head {
            position: relative;
            background: linear-gradient(180deg, #7cc947 0%, #56ab2f 35%, #3d8c1f 75%, #4a9928 100%);
            border-radius: 45% 12px 12px 35%;
            padding: 10px 16px 10px 32px;
            display: flex; align-items: center; gap: 8px;
            color: #1a3a0a; font-weight: bold; font-size: 0.9em;
            white-space: nowrap; flex-shrink: 0;
            box-shadow: 0 3px 12px rgba(86,171,47,0.5),
                inset 0 2px 0 rgba(255,255,255,0.15),
                inset 0 -2px 0 rgba(0,0,0,0.1);
            min-height: 48px;
        }
        /* Nostril */
        .snake-head::before {
            content: '';
            position: absolute;
            left: 6px; top: 38%;
            width: 3px; height: 3px;
            background: rgba(26,58,10,0.6);
            border-radius: 50%;
            transform: translateY(-50%);
            z-index: 2;
        }
        /* Mouth slit */
        .snake-head::after {
            content: '';
            position: absolute;
            left: -1px; top: 50%;
            transform: translateY(-50%);
            width: 5px; height: 3px;
            background: #2d1a0a;
            border-radius: 1px;
            z-index: 1;
        }
        /* Reptile eye with vertical slit pupil */
        .snake-eye {
            position: absolute;
            left: 12px; top: 7px;
            width: 14px; height: 14px;
            background: radial-gradient(circle at 40% 40%, #fff 15%, #ffeb3b 30%, #f9a825 55%, #333 60%);
            border-radius: 50%;
            border: 1.5px solid #1a3a0a;
            z-index: 2;
        }
        .snake-eye::after {
            content: '';
            position: absolute;
            left: 50%; top: 10%;
            width: 3px; height: 80%;
            background: #000;
            border-radius: 1.5px;
            transform: translateX(-50%);
        }
        /* Forked tongue ‚Äì exits from the mouth slit */
        .snake-tongue {
            position: absolute;
            right: calc(100% - 4px); top: 50%;
            transform: translateY(-50%);
            height: 2px;
            background: #e53935;
            z-index: 3;
            width: 0;
        }
        .snake-tongue::before,
        .snake-tongue::after {
            content: '';
            position: absolute;
            left: 0;
            width: 7px; height: 2px;
            background: #e53935;
            border-radius: 1px;
        }
        .snake-tongue::before {
            top: -3px;
            transform: rotate(25deg);
            transform-origin: right center;
        }
        .snake-tongue::after {
            top: 3px;
            transform: rotate(-25deg);
            transform-origin: right center;
        }
        /* Subtle idle tongue flick every 5s */
        .snake-tongue.idle {
            animation: tongue-idle 5s ease-in-out infinite;
            animation-delay: 2s;
        }
        @keyframes tongue-idle {
            0%, 92%, 100% { width: 0; }
            94%, 98% { width: 22px; }
            96% { width: 29px; }
        }
        /* Fast celebration tongue flick */
        .snake-tongue.flick {
            animation: tongue-flick 0.4s ease-in-out infinite;
        }
        @keyframes tongue-flick {
            0%, 100% { width: 0; }
            30%, 70% { width: 32px; }
        }
        .snake-head-text { display: flex; flex-direction: column; line-height: 1.2; }
        .snake-head-inf { font-size: 1em; }
        .snake-head-de { font-size: 0.75em; font-weight: normal; opacity: 0.8; }
        .snake-connector {
            width: 20px; height: 3px; background: #a8e063; flex-shrink: 0;
        }
        .snake-segment {
            border-radius: 12px; padding: 8px 12px; text-align: center;
            min-width: 70px; flex-shrink: 0; transition: all 0.4s;
            border: 2px solid #ddd; background: #f8f8f8; color: #999;
        }
        .snake-segment-label { font-size: 0.7em; font-weight: bold; text-transform: uppercase; }
        .snake-segment-form { font-size: 1em; margin-top: 2px; min-height: 1.2em; }
        .snake-segment.completed {
            background: linear-gradient(135deg, #4caf50, #66bb6a);
            border-color: #388e3c; color: white;
        }
        .snake-segment.completed .snake-segment-label { color: rgba(255,255,255,0.85); }
        .snake-segment.current {
            border-color: #ff9800; background: #fff8e1; color: #e65100;
            animation: snake-pulse 1.5s ease-in-out infinite;
        }
        .snake-segment.current .snake-segment-form { color: #e65100; font-weight: bold; }
        @keyframes snake-pulse {
            0%, 100% { box-shadow: 0 0 5px rgba(255,152,0,0.3); }
            50% { box-shadow: 0 0 20px rgba(255,152,0,0.6); }
        }
        .snake-celebrate {
            animation: snake-exit 4s ease-in-out forwards;
        }
        @keyframes snake-wave {
            0%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
            70% { transform: translateY(10px); }
        }
        @keyframes snake-exit {
            0% { transform: translateX(0); opacity: 1; }
            70% { opacity: 1; }
            100% { transform: translateX(-120%); opacity: 0; }
        }
        .snake-praise {
            text-align: center; font-size: 1.4em; font-weight: bold;
            color: #4caf50; margin: 12px 0; animation: praise-pop 1s ease-out;
        }
        @keyframes praise-pop {
            0% { transform: scale(0.5); opacity: 0; }
            50% { transform: scale(1.15); }
            100% { transform: scale(1); opacity: 1; }
        }
        .snake-segment.wrong {
            border-color: #f44336; background: #ffebee; color: #c62828;
        }
        .snake-grid-container {
            margin: 40px auto 12px; max-width: 320px; opacity: 0.6;
        }
        .snake-grid {
            display: grid; grid-template-columns: auto 1fr 1fr;
            gap: 3px; font-size: 0.85em;
        }
        .snake-grid-header {
            text-align: center; font-weight: bold; color: #666;
            padding: 4px 8px; font-size: 0.85em;
        }
        .snake-grid-label {
            text-align: right; padding: 6px 8px; font-weight: bold; color: #555;
            display: flex; align-items: center; justify-content: flex-end;
        }
        .snake-grid-cell {
            text-align: center; padding: 6px 10px; border-radius: 8px;
            border: 2px solid #e0e0e0; background: #f5f5f5; color: #bbb;
            transition: all 0.3s; font-size: 0.95em;
        }
        .snake-grid-cell.visited {
            background: linear-gradient(135deg, #4caf50, #66bb6a);
            border-color: #388e3c; color: white; font-weight: bold;
        }
        .snake-grid-cell.current {
            background: #fff8e1; border-color: #ff9800; color: #e65100;
            font-weight: bold; animation: snake-pulse 1.5s ease-in-out infinite;
        }
        .snake-grid-cell.imp-row { border-style: dashed; }
        .snake-example {
            text-align: center; margin: 12px 0; padding: 10px 15px;
            background: linear-gradient(135deg, #e8f5e9, #f1f8e9);
            border-radius: 12px; border-left: 4px solid #4caf50;
        }
        .snake-example-lat { color: #2e7d32; font-size: 1.1em; font-weight: bold; }
        .snake-example-de { color: #555; font-size: 0.95em; margin-top: 2px; }
        .snake-instruction {
            text-align: center; font-size: 1.15em; font-weight: bold;
            color: #e65100; margin: 12px 0 8px; padding: 8px;
        }
        .snake-stem { font-weight: bold; }
        .snake-ending-input {
            font-size: inherit; font-weight: bold; color: #bf360c;
            font-family: inherit;
            border: none; border-bottom: 2px solid #ff9800;
            background: transparent; outline: none;
            min-width: 40px; max-width: 100px; padding: 0 2px;
        }
        .snake-ending-input:focus { border-bottom-color: #e65100; }
        .snake-ending-input.correct { color: #4caf50; border-bottom-color: #4caf50; }
        .snake-ending-input.wrong { color: #f44336; border-bottom-color: #f44336; }
        .snake-check-btn {
            display: block; margin: 10px auto 0; padding: 8px 24px;
            background: linear-gradient(135deg, #56ab2f, #a8e063);
            color: white; border: none; border-radius: 12px;
            font-size: 1em; font-weight: bold; cursor: pointer;
            box-shadow: 0 3px 10px rgba(86,171,47,0.3);
        }
        .snake-check-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(86,171,47,0.4); }
        .snake-target {
            text-align: center; margin: 8px 0; padding: 12px 15px;
            background: #fff8e1; border-radius: 12px; border-left: 4px solid #ff9800;
        }
        .snake-target-lat { color: #bf360c; font-size: 1.1em; font-weight: bold; }
        .snake-target-de { color: #555; font-size: 0.95em; margin-top: 4px; }
    </style>
</head>
<body>
    <!-- CHANGELOG SPLASH (shown once per version) -->
    <div class="game-container" id="changelogSplash" style="display: none;">
        <div class="header">
            <h1>üéÆ Was ist neu?</h1>
            <p style="color: #666; margin-top: 10px;">Vokabel-Abenteuer ‚Äì Updates</p>
        </div>
        <div id="changelogContent" style="text-align: left; padding: 10px 20px; max-height: 55vh; overflow-y: auto;">
        </div>
        <button class="btn btn-check" onclick="dismissChangelog()" style="margin-top: 18px; font-size: 1.15em;">Los geht's! ‚ûú</button>
    </div>

    <!-- LANGUAGE SELECTION (Top Level) -->
    <div class="game-container" id="languageSelection">
        <div class="header">
            <h1>üéÆ Vokabel-Abenteuer</h1>
            <p style="color: #666; margin-top: 10px;">W√§hle deine Sprache:</p>
        </div>
        <div class="set-selection">
            <div class="lang-card" onclick="selectLanguage('english')">
                <div class="lang-icon">üá¨üáß</div>
                <div class="lang-title">English</div>
                <div class="lang-info">Spelling &amp; Multiple Choice</div>
            </div>
            <div class="lang-card latin" onclick="selectLanguage('latin')">
                <div class="lang-icon">üèõÔ∏è</div>
                <div class="lang-title">Latein</div>
                <div class="lang-info">Vokabeln, Verben &amp; S√§tze</div>
            </div>
        </div>
        <div class="taler-display">
            <div style="font-size: 2em;">ü™ô</div>
            <div>Deine Taler: <strong><span id="displayTalersMain">0</span>/50</strong></div>
            <button class="btn btn-clear" onclick="resetTalersFromMenu()" style="margin-top: 10px; font-size: 0.9em;">Taler zur√ºcksetzen</button>
            <button class="btn btn-skip" onclick="resetProgress()" style="margin-top: 10px; font-size: 0.9em;">Lernfortschritt zur√ºcksetzen</button>
        </div>
    </div>

    <!-- ENGLISH SET SELECTION -->
    <div class="game-container" id="setSelection" style="display: none;">
        <button class="back-btn" onclick="backToLanguage()">‚Üê Zur√ºck</button>
        <div class="header">
            <h1>üéÆ English Spelling Adventure</h1>
            <p style="color: #666; margin-top: 10px;">W√§hle dein Vokabel-Set:</p>
        </div>

        <div class="set-selection">
            <div class="set-card" onclick="startGame('theme2')">
                <div class="set-icon">üè´</div>
                <div class="set-title">Theme 2: At School</div>
                <div class="set-info">77 Vokabeln</div>
                <div class="set-topics">Schulf√§cher ‚Ä¢ Essen ‚Ä¢ Wochentage ‚Ä¢ Schule</div>
            </div>

            <div class="set-card" onclick="startGame('theme3')">
                <div class="set-icon">üé≠</div>
                <div class="set-title">Theme 3: Hobbies and Activities</div>
                <div class="set-info">98 Vokabeln</div>
                <div class="set-topics">Hobbys ‚Ä¢ Gef√ºhle ‚Ä¢ Aktivit√§ten ‚Ä¢ Zeit</div>
            </div>

            <div class="set-card set-card-all" onclick="startGame('all')">
                <div class="set-icon">üåü</div>
                <div class="set-title">Alle Vokabeln</div>
                <div class="set-info">175 Vokabeln</div>
                <div class="set-topics">Theme 2 + Theme 3 gemischt</div>
            </div>
        </div>

    </div>

    <!-- LATIN CHAPTER SELECTION -->
    <div class="game-container" id="latinChapterSelection" style="display: none;">
        <button class="back-btn" onclick="backToLanguage()">‚Üê Zur√ºck</button>
        <div class="header">
            <h1>üèõÔ∏è Latein-Abenteuer</h1>
            <p style="color: #666; margin-top: 10px;">W√§hle deine Lektion:</p>
        </div>
        <div class="set-selection">
            <div class="set-card latin" onclick="selectLatinChapter('chapter3')">
                <div class="set-icon">üìú</div>
                <div class="set-title">Lektion 3</div>
                <div class="set-info">42 Vokabeln</div>
                <div class="set-topics">Circus Maximus ‚Ä¢ Vokabeln ‚Ä¢ Verben ‚Ä¢ S√§tze</div>
            </div>
            <div class="set-card latin" onclick="selectLatinChapter('chapter4')">
                <div class="set-icon">üèõÔ∏è</div>
                <div class="set-title">Lektion 4</div>
                <div class="set-info">43 Vokabeln</div>
                <div class="set-topics">Diana ‚Ä¢ Verwandlung ‚Ä¢ Vokabeln ‚Ä¢ Verben ‚Ä¢ S√§tze</div>
            </div>
        </div>
    </div>

    <!-- LATIN MODULE SELECTION -->
    <div class="game-container" id="latinModuleSelection" style="display: none;">
        <button class="back-btn" onclick="backToLatinChapters()">‚Üê Zur√ºck</button>
        <div class="header">
            <h1>üèõÔ∏è Latein-Abenteuer</h1>
            <div class="current-set" id="latinChapterName"></div>
            <p style="color: #666; margin-top: 10px;">W√§hle dein Modul:</p>
        </div>
        <div class="set-selection">
            <div class="module-card" onclick="startLatinModule('vocab')">
                <div class="module-icon">üìñ</div>
                <div class="module-title">Vokabeln</div>
                <div class="module-info">Spelling &amp; Multiple Choice</div>
            </div>
            <div class="module-card" onclick="startLatinModule('verbs')">
                <div class="module-icon">‚úçÔ∏è</div>
                <div class="module-title">Verb-Formen</div>
                <div class="module-info">Infinitiv, Pr√§sens &amp; Imperativ</div>
            </div>
            <div class="module-card" onclick="startLatinModule('nouns')">
                <div class="module-icon">üìê</div>
                <div class="module-title">Substantive</div>
                <div class="module-info">Deklinieren: Nom/Gen/Dat/Akk/Abl</div>
            </div>
            <div class="module-card" onclick="startLatinModule('tables')" style="background: linear-gradient(135deg, #0d1117 0%, #161b22 100%);">
                <div class="module-icon">üíª</div>
                <div class="module-title" style="color: #39ff14;">Tabellentraining</div>
                <div class="module-info" style="color: #8b949e;">Konjugieren &amp; Deklinieren<br><small>‚ö†Ô∏è Nur Desktop / Tablet</small></div>
            </div>
            <div class="module-card snake-card" onclick="startLatinModule('snake')">
                <div class="module-icon">üêç</div>
                <div class="module-title">Konjug.- & Deklinationsssschlange</div>
                <div class="module-info">Verb- & Nomen-Endungen √ºben</div>
            </div>
            <div class="module-card" onclick="startLatinModule('sentences')">
                <div class="module-icon">üìù</div>
                <div class="module-title">Beispiels√§tze</div>
                <div class="module-info">L√ºckentext Latein ‚Üí Deutsch</div>
            </div>
            <div class="module-card mixed" onclick="startLatinModule('mixed')">
                <div class="module-icon">üåü</div>
                <div class="module-title">Alles gemischt</div>
                <div class="module-info">Vokabeln + Verben + Substantive + S√§tze</div>
            </div>
        </div>
    </div>

    <div class="game-container" id="gameContainer" style="display: none;">
        <button class="back-btn" id="gameBackBtn" onclick="backFromGame()">‚Üê Zur√ºck</button>
        <div class="header">
            <h1 id="gameTitle">üéÆ English Spelling Adventure</h1>
            <div class="current-set" id="currentSetName"></div>
        </div>

        <div class="score-board">
            <div class="score-item">
                <div class="label">Punkte</div>
                <div class="value" id="score">0</div>
            </div>
            <div class="score-item">
                <div class="label">Wort</div>
                <div class="value"><span id="current">1</span>/<span id="total">10</span></div>
            </div>
            <div class="score-item">
                <div class="label">Richtig</div>
                <div class="value" id="correct">0</div>
            </div>
            <div class="score-item">
                <div class="label">üîÑ Wiederh.</div>
                <div class="value" id="repeats">0</div>
            </div>
            <div class="score-item taler-item">
                <div class="label">ü™ô Taler</div>
                <div class="value"><span id="totalTalers">0</span>/50</div>
            </div>
        </div>

        <div class="word-card">
            <div class="word-image-wrapper" id="wordImageWrapper">
                <div class="word-image" id="wordImage">üê±</div>
                <div class="curtain" id="emojiCurtain">
                    <div class="curtain-left"></div>
                    <div class="curtain-right"></div>
                </div>
            </div>
            <div class="word-german" id="wordGerman">Katze</div>
            <div class="word-hint" id="wordHint">Ein Haustier mit vier Beinen</div>
            <div class="auto-hint" id="autoHint"></div>
        </div>

        <div id="spellingArea">
            <div class="answer-area" id="answerArea"></div>
            <div class="letters-pool" id="lettersPool"></div>
        </div>

        <div id="mcArea" style="display: none;">
            <div class="mc-options" id="mcOptions"></div>
            <div style="text-align: center;">
                <button class="btn btn-continue" id="mcContinueBtn" style="display: none;" onclick="mcContinue()">‚ñ∂Ô∏è Weiter</button>
            </div>
        </div>

        <!-- Sentence fill-in area (Latin) -->
        <div id="sentenceArea" style="display: none;">
            <div class="sentence-card">
                <div class="sentence-latin" id="sentenceLatin"></div>
                <div class="sentence-template" id="sentenceTemplate"></div>
            </div>
            <div id="sentenceSpellingArea">
                <div class="answer-area" id="sentenceAnswerArea"></div>
                <div class="letters-pool" id="sentenceLettersPool"></div>
            </div>
        </div>

        <!-- MODE 4: TABLE TRAINING (Desktop only) -->
        <div id="tableArea" style="display: none;">
            <div id="tableInstruction" style="text-align: center; margin-bottom: 10px; font-size: 1.05em; color: #666; font-weight: 500;"></div>
            <div id="terminalContainer" class="terminal-container"></div>
            <div style="text-align: center;">
                <button id="tableCheckBtn" onclick="checkTableAnswer()">‚úì Pr√ºfen (Enter)</button>
                <button class="btn btn-skip" id="tableSkipBtn" onclick="skipTableAnswer()">‚Üí √úberspringen</button>
            </div>
        </div>

        <!-- MODE 5: KONJUGATIONSSCHLANGE -->
        <div id="snakeArea" style="display: none;">
            <div class="snake-chain" id="snakeChain"></div>
            <div class="snake-example" id="snakeExample"></div>
            <div class="snake-instruction" id="snakeInstruction"></div>
            <div class="snake-target" id="snakeTarget" style="display: none;"></div>
            <div style="text-align: center; margin-top: 8px;">
                <button class="snake-check-btn" id="snakeCheckBtn" style="display: none;" onclick="checkSnakeAnswer()">‚úì Pr√ºfen</button>
                <button class="btn btn-continue" id="snakeContinueBtn" style="display: none;" onclick="snakeContinue()">‚ñ∂Ô∏è Weiter</button>
            </div>
            <div class="snake-praise" id="snakePraise" style="display: none;"></div>
            <div class="snake-grid-container">
                <div class="snake-grid" id="snakeGrid"></div>
            </div>
        </div>

        <div class="buttons" id="spellingButtons">
            <button class="btn btn-clear" id="clearBtn">üîÑ L√∂schen <small>(ESC)</small></button>
            <button class="btn btn-check" id="checkBtn">‚úì Pr√ºfen <small>(ENTER)</small></button>
            <button class="btn btn-skip" id="skipBtn">‚Üí √úberspringen</button>
            <button class="btn btn-continue" id="continueBtn" style="display: none;">‚ñ∂Ô∏è Weiter</button>
        </div>

        <div class="feedback" id="feedback"></div>

        <div id="tipText" style="text-align: center; margin-top: 20px; color: #666; font-size: 0.9em;">
            üí° <strong>Tipp:</strong> Du kannst die Buchstaben auch mit der Tastatur eingeben!
            <br>Backspace = letzten Buchstaben l√∂schen | ESC = alles l√∂schen | Enter = pr√ºfen
        </div>
    </div>

    <div class="celebration" id="celebration">
        <h2>üéâ Super gemacht! üéâ</h2>
        <div class="final-score" id="finalScore"></div>
        <button class="btn btn-check" onclick="location.reload()">Nochmal spielen</button>
        <button class="btn btn-clear" onclick="resetTalers()" style="margin-top: 10px;">üîÑ Taler zur√ºcksetzen</button>
    </div>

    <script>
        // ===================================================================
        // LATIN VOCABULARY DATA ‚Äì Lektion 3
        // ===================================================================

        const latinData = {
            chapter3: {
                name: 'Lektion 3',
                vocabulary: [
                    // Section 1
                    { latin: 'narrƒÅre', german: 'erz√§hlen', image: 'üìñ', hint: 'Eine Geschichte ...',
                      distractors: ['antworten', 'rufen', 'melden', 'pr√ºfen'] },
                    { latin: 'puella', german: 'das M√§dchen', image: 'üëß', hint: 'Ein junges Kind (weiblich)',
                      distractors: ['der Junge', 'die Frau', 'die Schwester', 'die Freundin'] },
                    { latin: 'statim', german: 'sofort', image: '‚ö°', hint: 'Ohne zu warten',
                      distractors: ['sp√§ter', 'langsam', 'manchmal', 'gestern'] },
                    { latin: 'parƒÅre', german: '(vor)bereiten, vorhaben, erwerben', image: 'üîß', hint: 'Etwas vorbereiten',
                      distractors: ['zerst√∂ren', 'verlieren', 'vergessen', 'verbieten'] },
                    { latin: 'ini≈´ria', german: 'das Unrecht, die Beleidigung', image: '‚öñÔ∏è', hint: 'Etwas Unfaires',
                      distractors: ['das Recht', 'die Hilfe', 'der Frieden', 'die Freude'] },
                    { latin: 'sustinƒìre', german: 'ertragen, standhalten', image: 'üí™', hint: 'Etwas aushalten',
                      distractors: ['aufgeben', 'weglaufen', 'vergessen', 'zerst√∂ren'] },
                    // Section 2
                    { latin: 'prohibƒìre', german: 'abhalten, hindern, verhindern', image: 'üö´', hint: 'Jemanden stoppen',
                      distractors: ['erlauben', 'helfen', 'einladen', 'loben'] },
                    { latin: 'paulum', german: 'ein wenig', image: 'ü§è', hint: 'Nur ein bisschen',
                      distractors: ['sehr viel', 'immer', 'nichts', 'alles'] },
                    { latin: 'respondƒìre', german: 'antworten', image: 'üí¨', hint: 'Auf eine Frage reagieren',
                      distractors: ['fragen', 'schweigen', 'rufen', 'erz√§hlen'] },
                    { latin: 'certƒì', german: 'gewiss, sicherlich', image: '‚úÖ', hint: 'Ganz bestimmt',
                      distractors: ['vielleicht', 'niemals', 'selten', 'kaum'] },
                    { latin: 'indicƒÅre', german: 'anzeigen, melden', image: 'üëÜ', hint: 'Auf etwas hinweisen',
                      distractors: ['verstecken', 'leugnen', 'vergessen', 'schweigen'] },
                    { latin: 'negƒÅre', german: 'leugnen, verneinen, verweigern', image: 'üôÖ', hint: 'Nein sagen',
                      distractors: ['zustimmen', 'best√§tigen', 'erlauben', 'loben'] },
                    { latin: 'culpa', german: 'die Schuld', image: 'üòî', hint: 'Wer hat es getan?',
                      distractors: ['die Strafe', 'der Dank', 'die Hilfe', 'die Freude'] },
                    { latin: 'probƒÅre', german: 'pr√ºfen, beweisen, f√ºr gut befinden', image: 'üîç', hint: 'Etwas √ºberpr√ºfen',
                      distractors: ['zerst√∂ren', 'verstecken', 'vergessen', 'verbieten'] },
                    // Section 3
                    { latin: 'bene', german: 'gut', image: 'üëç', hint: 'Das Gegenteil von schlecht',
                      distractors: ['schlecht', 'schnell', 'sch√∂n', 'gro√ü'] },
                    { latin: '≈´nƒÅ', german: 'zusammen, zugleich', image: 'ü§ù', hint: 'Gemeinsam',
                      distractors: ['allein', 'getrennt', 'nachher', 'niemals'] },
                    { latin: 'pr≈çvidƒìre', german: 'sorgen f√ºr', image: 'üõ°Ô∏è', hint: 'Sich um jemanden k√ºmmern',
                      distractors: ['vergessen', 'zerst√∂ren', 'verlieren', 'verbieten'] },
                    { latin: 'socius', german: 'der Gef√§hrte, der Verb√ºndete', image: 'ü§ú', hint: 'Ein Freund und Helfer',
                      distractors: ['der Feind', 'der Fremde', 'der Richter', 'der Herr'] },
                    { latin: 'vocƒÅre', german: 'rufen, nennen', image: 'üì£', hint: 'Jemanden herbeirufen',
                      distractors: ['schweigen', 'h√∂ren', 'sehen', 'schreiben'] },
                    { latin: 'iterum', german: 'wieder(um), zum zweiten Mal', image: 'üîÑ', hint: 'Noch einmal',
                      distractors: ['niemals', 'einmal', 'sofort', 'gestern'] },
                    { latin: 'superƒÅre', german: 'besiegen, √ºberwinden, √ºbertreffen', image: 'üèÜ', hint: 'St√§rker sein als andere',
                      distractors: ['verlieren', 'aufgeben', 'fliehen', 'gehorchen'] },
                    { latin: 'dum', german: 'w√§hrend, solange, bis', image: '‚è≥', hint: 'In der gleichen Zeit',
                      distractors: ['nachdem', 'bevor', 'weil', 'obwohl'] },
                    // Section 4
                    { latin: 'temptƒÅre', german: 'versuchen, pr√ºfen, angreifen', image: 'üéØ', hint: 'Etwas probieren',
                      distractors: ['aufgeben', 'vergessen', 'schlafen', 'warten'] },
                    { latin: 'cavƒìre', german: 'vorsichtig sein, sich h√ºten (vor)', image: '‚ö†Ô∏è', hint: 'Aufpassen!',
                      distractors: ['mutig sein', 'angreifen', 'vergessen', 'schlafen'] },
                    { latin: 'sententia', german: 'die Meinung, der Satz, der Sinn', image: 'üí≠', hint: 'Was man denkt',
                      distractors: ['die Frage', 'die Antwort', 'der Streit', 'das Wort'] },
                    { latin: 'placƒìre', german: 'gefallen', image: 'üòä', hint: 'Wenn etwas sch√∂n ist',
                      distractors: ['missfallen', 'hassen', 'f√ºrchten', 'vergessen'] },
                    { latin: 'pƒÅrƒìre', german: 'gehorchen', image: 'ü´°', hint: 'Tun, was man soll',
                      distractors: ['widersprechen', 'fliehen', 'k√§mpfen', 'l√ºgen'] },
                    { latin: 'paul≈ç', german: '(um) ein wenig', image: 'ü§è', hint: 'Nur ein kleines bisschen',
                      distractors: ['sehr viel', 'immer', 'nichts', 'alles'] },
                    { latin: 'gladius', german: 'das Schwert', image: '‚öîÔ∏è', hint: 'Eine Waffe der R√∂mer',
                      distractors: ['der Schild', 'der Helm', 'der Speer', 'der Bogen'] },
                    // Section 5
                    { latin: 'animus', german: 'der Geist, der Mut, die Gesinnung', image: 'üß†', hint: 'Was im Kopf steckt',
                      distractors: ['der K√∂rper', 'die Hand', 'das Herz', 'der Fu√ü'] },
                    { latin: 'deesse', german: 'fehlen, abwesend sein, nicht da sein', image: '‚ùå', hint: 'Nicht vorhanden',
                      distractors: ['da sein', 'kommen', 'bleiben', 'helfen'] },
                    { latin: 'mandƒÅre', german: '√ºbergeben, einen Auftrag geben', image: 'üìã', hint: 'Jemandem etwas auftragen',
                      distractors: ['wegnehmen', 'verstecken', 'vergessen', 'zerst√∂ren'] },
                    { latin: 'poena', german: 'die Strafe', image: '‚öñÔ∏è', hint: 'Wenn man etwas Falsches getan hat',
                      distractors: ['die Belohnung', 'der Dank', 'das Lob', 'die Freude'] },
                    { latin: 'ƒ´nstƒÅre', german: 'bevorstehen, bedr√§ngen, drohen', image: '‚è∞', hint: 'Etwas kommt bald',
                      distractors: ['verschwinden', 'vergessen', 'weglaufen', 'aufh√∂ren'] },
                    { latin: 'grƒÅtia', german: 'der Dank', image: 'üôè', hint: 'Wenn man dankbar ist',
                      distractors: ['der Zorn', 'die Schuld', 'die Strafe', 'der Hass'] },
                ],
                multiWord: [
                    { latin: 'Salvƒì! Salvƒìte!', german: 'Sei gegr√º√üt! Seid gegr√º√üt!',
                      germanDistractors: ['Auf Wiedersehen!', 'Guten Morgen!', 'Gute Nacht!', 'Tsch√ºss!'],
                      latinDistractors: ['Valƒì!', 'Avƒì!', 'Abƒ´!', 'Venƒ´!'] },
                    { latin: 'quemadmodum', german: 'wie, auf welche Weise',
                      germanDistractors: ['warum', 'wann', 'wohin', 'wer'],
                      latinDistractors: ['c≈´r', 'quand≈ç', 'ubi', 'quis'] },
                    { latin: 'Circus Maximus', german: 'der Circus Maximus (Rennbahn f√ºr Wagenrennen in Rom)',
                      germanDistractors: ['das Kolosseum', 'das Forum Romanum', 'die Thermen', 'der Senat'],
                      latinDistractors: ['Colosseum', 'Forum R≈çmƒÅnum', 'Thermae', 'SenƒÅtus'] },
                    { latin: 'n≈çn dƒìbƒìre', german: 'nicht d√ºrfen, nicht m√ºssen',
                      germanDistractors: ['m√ºssen', 'k√∂nnen', 'wollen', 'sollen'],
                      latinDistractors: ['dƒìbƒìre', 'posse', 'velle', 'audƒìre'] },
                    { latin: 'et ... et', german: 'sowohl ... als auch',
                      germanDistractors: ['weder ... noch', 'entweder ... oder', 'nicht nur ... sondern', 'zwar ... aber'],
                      latinDistractors: ['neque ... neque', 'aut ... aut', 'n≈çn s≈çlum ... sed', 'cum ... tum'] },
                    { latin: 'paul≈ç post', german: 'wenig sp√§ter, kurz darauf',
                      germanDistractors: ['viel fr√ºher', 'gleichzeitig', 'am n√§chsten Tag', 'lange vorher'],
                      latinDistractors: ['mult≈ç ante', 'simul', 'postrƒ´diƒì', '≈çlim'] },
                    { latin: 'grƒÅtiam dƒìbƒìre', german: 'Dank schulden',
                      germanDistractors: ['Strafe verdienen', 'Schuld haben', 'Hilfe brauchen', 'Lob verdienen'],
                      latinDistractors: ['poenam dare', 'culpam habƒìre', 'auxilium petere', 'laudem merƒìre'] },
                ],
                verbForms: [
                    { infinitive: 'narrƒÅre', firstPerson: 'narr≈ç', german: 'erz√§hlen',
                      present: { sg2: 'narrƒÅs', sg3: 'narrat', pl1: 'narrƒÅmus', pl2: 'narrƒÅtis', pl3: 'narrant' },
                      imperative: { sg: 'narrƒÅ', pl: 'narrƒÅte' } },
                    { infinitive: 'parƒÅre', firstPerson: 'par≈ç', german: '(vor)bereiten',
                      present: { sg2: 'parƒÅs', sg3: 'parat', pl1: 'parƒÅmus', pl2: 'parƒÅtis', pl3: 'parant' },
                      imperative: { sg: 'parƒÅ', pl: 'parƒÅte' } },
                    { infinitive: 'sustinƒìre', firstPerson: 'sustine≈ç', german: 'ertragen',
                      present: { sg2: 'sustinƒìs', sg3: 'sustinet', pl1: 'sustinƒìmus', pl2: 'sustinƒìtis', pl3: 'sustinent' },
                      imperative: { sg: 'sustinƒì', pl: 'sustinƒìte' } },
                    { infinitive: 'prohibƒìre', firstPerson: 'prohibe≈ç', german: 'abhalten',
                      present: { sg2: 'prohibƒìs', sg3: 'prohibet', pl1: 'prohibƒìmus', pl2: 'prohibƒìtis', pl3: 'prohibent' },
                      imperative: { sg: 'prohibƒì', pl: 'prohibƒìte' } },
                    { infinitive: 'respondƒìre', firstPerson: 'responde≈ç', german: 'antworten',
                      present: { sg2: 'respondƒìs', sg3: 'respondet', pl1: 'respondƒìmus', pl2: 'respondƒìtis', pl3: 'respondent' },
                      imperative: { sg: 'respondƒì', pl: 'respondƒìte' } },
                    { infinitive: 'indicƒÅre', firstPerson: 'indic≈ç', german: 'anzeigen',
                      present: { sg2: 'indicƒÅs', sg3: 'indicat', pl1: 'indicƒÅmus', pl2: 'indicƒÅtis', pl3: 'indicant' },
                      imperative: { sg: 'indicƒÅ', pl: 'indicƒÅte' } },
                    { infinitive: 'negƒÅre', firstPerson: 'neg≈ç', german: 'leugnen',
                      present: { sg2: 'negƒÅs', sg3: 'negat', pl1: 'negƒÅmus', pl2: 'negƒÅtis', pl3: 'negant' },
                      imperative: { sg: 'negƒÅ', pl: 'negƒÅte' } },
                    { infinitive: 'probƒÅre', firstPerson: 'prob≈ç', german: 'pr√ºfen',
                      present: { sg2: 'probƒÅs', sg3: 'probat', pl1: 'probƒÅmus', pl2: 'probƒÅtis', pl3: 'probant' },
                      imperative: { sg: 'probƒÅ', pl: 'probƒÅte' } },
                    { infinitive: 'pr≈çvidƒìre', firstPerson: 'pr≈çvide≈ç', german: 'sorgen f√ºr',
                      present: { sg2: 'pr≈çvidƒìs', sg3: 'pr≈çvidet', pl1: 'pr≈çvidƒìmus', pl2: 'pr≈çvidƒìtis', pl3: 'pr≈çvident' },
                      imperative: { sg: 'pr≈çvidƒì', pl: 'pr≈çvidƒìte' } },
                    { infinitive: 'vocƒÅre', firstPerson: 'voc≈ç', german: 'rufen',
                      present: { sg2: 'vocƒÅs', sg3: 'vocat', pl1: 'vocƒÅmus', pl2: 'vocƒÅtis', pl3: 'vocant' },
                      imperative: { sg: 'vocƒÅ', pl: 'vocƒÅte' } },
                    { infinitive: 'superƒÅre', firstPerson: 'super≈ç', german: 'besiegen',
                      present: { sg2: 'superƒÅs', sg3: 'superat', pl1: 'superƒÅmus', pl2: 'superƒÅtis', pl3: 'superant' },
                      imperative: { sg: 'superƒÅ', pl: 'superƒÅte' } },
                    { infinitive: 'temptƒÅre', firstPerson: 'tempt≈ç', german: 'versuchen',
                      present: { sg2: 'temptƒÅs', sg3: 'temptat', pl1: 'temptƒÅmus', pl2: 'temptƒÅtis', pl3: 'temptant' },
                      imperative: { sg: 'temptƒÅ', pl: 'temptƒÅte' } },
                    { infinitive: 'cavƒìre', firstPerson: 'cave≈ç', german: 'sich h√ºten',
                      present: { sg2: 'cavƒìs', sg3: 'cavet', pl1: 'cavƒìmus', pl2: 'cavƒìtis', pl3: 'cavent' },
                      imperative: { sg: 'cavƒì', pl: 'cavƒìte' } },
                    { infinitive: 'placƒìre', firstPerson: 'place≈ç', german: 'gefallen',
                      present: { sg2: 'placƒìs', sg3: 'placet', pl1: 'placƒìmus', pl2: 'placƒìtis', pl3: 'placent' },
                      imperative: { sg: 'placƒì', pl: 'placƒìte' } },
                    { infinitive: 'pƒÅrƒìre', firstPerson: 'pƒÅre≈ç', german: 'gehorchen',
                      present: { sg2: 'pƒÅrƒìs', sg3: 'pƒÅret', pl1: 'pƒÅrƒìmus', pl2: 'pƒÅrƒìtis', pl3: 'pƒÅrent' },
                      imperative: { sg: 'pƒÅrƒì', pl: 'pƒÅrƒìte' } },
                    { infinitive: 'deesse', firstPerson: 'dƒìsum', german: 'fehlen',
                      present: { sg2: 'dƒìes', sg3: 'dƒìest', pl1: 'dƒìsumus', pl2: 'dƒìestis', pl3: 'dƒìsunt' },
                      imperative: null },
                    { infinitive: 'mandƒÅre', firstPerson: 'mand≈ç', german: '√ºbergeben',
                      present: { sg2: 'mandƒÅs', sg3: 'mandat', pl1: 'mandƒÅmus', pl2: 'mandƒÅtis', pl3: 'mandant' },
                      imperative: { sg: 'mandƒÅ', pl: 'mandƒÅte' } },
                    { infinitive: 'ƒ´nstƒÅre', firstPerson: 'ƒ´nst≈ç', german: 'bevorstehen',
                      present: { sg2: 'ƒ´nstƒÅs', sg3: 'ƒ´nstat', pl1: 'ƒ´nstƒÅmus', pl2: 'ƒ´nstƒÅtis', pl3: 'ƒ´nstant' },
                      imperative: null },
                ],
                sentences: [
                    { latin: 'Crassus equum parat.', germanTemplate: 'Crassus ___ ein Pferd.', answer: 'erwirbt', image: 'üê¥',
                      hint: 'parƒÅre = (vor)bereiten, erwerben' },
                    { latin: 'Vict≈çriam parat.', germanTemplate: 'Er ___ den Sieg vor.', answer: 'bereitet', image: 'üèÜ',
                      hint: 'parƒÅre = vorbereiten' },
                    { latin: 'DƒÅvus equum servƒÅre parat.', germanTemplate: 'Davus ___ vor, das Pferd zu retten.', answer: 'hat', image: 'üêé',
                      hint: 'parƒÅre = vorhaben' },
                    { latin: 'Ini≈´riam n≈çn sustine≈ç.', germanTemplate: 'Ich ___ das Unrecht nicht.', answer: 'ertrage', image: 'üò§',
                      hint: 'sustinƒìre = ertragen' },
                    { latin: 'Scorpus equum probat.', germanTemplate: 'Scorpus ___ das Pferd.', answer: 'pr√ºft', image: 'üîç',
                      hint: 'probƒÅre = pr√ºfen' },
                    { latin: 'DƒÅvus ini≈´riam probat.', germanTemplate: 'Davus ___ das Unrecht.', answer: 'beweist', image: '‚öñÔ∏è',
                      hint: 'probƒÅre = beweisen' },
                    { latin: 'DƒÅvus IncitƒÅt≈ç pr≈çvidet.', germanTemplate: 'Davus ___ f√ºr Incitatus.', answer: 'sorgt', image: 'üõ°Ô∏è',
                      hint: 'pr≈çvidƒìre = sorgen f√ºr' },
                    { latin: 'DƒÅvus IncitƒÅtum servƒÅre temptat.', germanTemplate: 'Davus ___ Incitatus zu retten.', answer: 'versucht', image: 'üéØ',
                      hint: 'temptƒÅre = versuchen' },
                    { latin: 'Symmachus IncitƒÅtum temptat.', germanTemplate: 'Symmachus ___ Incitatus an.', answer: 'greift', image: '‚öîÔ∏è',
                      hint: 'temptƒÅre = angreifen' },
                    { latin: 'Symmachum cavƒì!', germanTemplate: '___ dich vor Symmachus!', answer: 'H√ºte', image: '‚ö†Ô∏è',
                      hint: 'cavƒìre = sich h√ºten (vor)' },
                    { latin: 'Symmach≈ç animus deest.', germanTemplate: 'Symmachus ___ der Mut.', answer: 'fehlt', image: 'üò∞',
                      hint: 'deesse = fehlen' },
                    { latin: 'Symmach≈ç poena ƒ´nstat.', germanTemplate: 'Symmachus ___ eine Strafe.', answer: 'droht', image: '‚öñÔ∏è',
                      hint: 'ƒ´nstƒÅre = drohen, bevorstehen' },
                ],
                nouns: [
                    // a-Deklination
                    { nom_sg: 'puella', gen_sg: 'puellae', dat_sg: 'puellae', akk_sg: 'puellam', abl_sg: 'puellƒÅ',
                      nom_pl: 'puellae', gen_pl: 'puellƒÅrum', dat_pl: 'puellƒ´s', akk_pl: 'puellƒÅs', abl_pl: 'puellƒ´s',
                      german: 'das M√§dchen', germanPl: 'M√§dchen', image: 'üëß', declension: 'a-Deklination' },
                    { nom_sg: 'ini≈´ria', gen_sg: 'ini≈´riae', dat_sg: 'ini≈´riae', akk_sg: 'ini≈´riam', abl_sg: 'ini≈´riƒÅ',
                      nom_pl: 'ini≈´riae', gen_pl: 'ini≈´riƒÅrum', dat_pl: 'ini≈´riƒ´s', akk_pl: 'ini≈´riƒÅs', abl_pl: 'ini≈´riƒ´s',
                      german: 'das Unrecht', germanPl: 'Unrechte', image: '‚öñÔ∏è', declension: 'a-Deklination' },
                    { nom_sg: 'culpa', gen_sg: 'culpae', dat_sg: 'culpae', akk_sg: 'culpam', abl_sg: 'culpƒÅ',
                      nom_pl: 'culpae', gen_pl: 'culpƒÅrum', dat_pl: 'culpƒ´s', akk_pl: 'culpƒÅs', abl_pl: 'culpƒ´s',
                      german: 'die Schuld', germanPl: 'Schulden', image: 'üòî', declension: 'a-Deklination' },
                    { nom_sg: 'sententia', gen_sg: 'sententiae', dat_sg: 'sententiae', akk_sg: 'sententiam', abl_sg: 'sententiƒÅ',
                      nom_pl: 'sententiae', gen_pl: 'sententiƒÅrum', dat_pl: 'sententiƒ´s', akk_pl: 'sententiƒÅs', abl_pl: 'sententiƒ´s',
                      german: 'die Meinung', germanPl: 'Meinungen', image: 'üí≠', declension: 'a-Deklination' },
                    { nom_sg: 'poena', gen_sg: 'poenae', dat_sg: 'poenae', akk_sg: 'poenam', abl_sg: 'poenƒÅ',
                      nom_pl: 'poenae', gen_pl: 'poenƒÅrum', dat_pl: 'poenƒ´s', akk_pl: 'poenƒÅs', abl_pl: 'poenƒ´s',
                      german: 'die Strafe', germanPl: 'Strafen', image: '‚öñÔ∏è', declension: 'a-Deklination' },
                    { nom_sg: 'grƒÅtia', gen_sg: 'grƒÅtiae', dat_sg: 'grƒÅtiae', akk_sg: 'grƒÅtiam', abl_sg: 'grƒÅtiƒÅ',
                      nom_pl: 'grƒÅtiae', gen_pl: 'grƒÅtiƒÅrum', dat_pl: 'grƒÅtiƒ´s', akk_pl: 'grƒÅtiƒÅs', abl_pl: 'grƒÅtiƒ´s',
                      german: 'der Dank', germanPl: 'Danksagungen', image: 'üôè', declension: 'a-Deklination' },
                    // o-Deklination
                    { nom_sg: 'socius', gen_sg: 'sociƒ´', dat_sg: 'soci≈ç', akk_sg: 'socium', abl_sg: 'soci≈ç',
                      nom_pl: 'sociƒ´', gen_pl: 'soci≈çrum', dat_pl: 'sociƒ´s', akk_pl: 'soci≈çs', abl_pl: 'sociƒ´s',
                      german: 'der Gef√§hrte', germanPl: 'Gef√§hrten', image: 'ü§ú', declension: 'o-Deklination' },
                    { nom_sg: 'gladius', gen_sg: 'gladiƒ´', dat_sg: 'gladi≈ç', akk_sg: 'gladium', abl_sg: 'gladi≈ç',
                      nom_pl: 'gladiƒ´', gen_pl: 'gladi≈çrum', dat_pl: 'gladiƒ´s', akk_pl: 'gladi≈çs', abl_pl: 'gladiƒ´s',
                      german: 'das Schwert', germanPl: 'Schwerter', image: '‚öîÔ∏è', declension: 'o-Deklination' },
                    { nom_sg: 'animus', gen_sg: 'animƒ´', dat_sg: 'anim≈ç', akk_sg: 'animum', abl_sg: 'anim≈ç',
                      nom_pl: 'animƒ´', gen_pl: 'anim≈çrum', dat_pl: 'animƒ´s', akk_pl: 'anim≈çs', abl_pl: 'animƒ´s',
                      german: 'der Geist', germanPl: 'Geister', image: 'üß†', declension: 'o-Deklination' },
                ]
            },

            chapter4: {
                name: 'Lektion 4',
                vocabulary: [
                    // Section 1
                    { latin: 'dƒì', german: '√ºber; von, von ... her', image: '‚¨áÔ∏è', hint: 'Pr√§position mit Ablativ ‚Äì Richtung weg',
                      distractors: ['unter', 'neben', 'mit', 'ohne'] },
                    { latin: 'atque', german: 'und, und auch', image: '‚ûï', hint: 'Verbindet zwei Dinge',
                      distractors: ['oder', 'aber', 'weder', 'sondern'] },
                    { latin: 'movƒìre', german: 'bewegen, beeindrucken', image: 'üí´', hint: 'Etwas in Bewegung bringen',
                      distractors: ['stoppen', 'zerst√∂ren', 'vergessen', 'schlafen'] },
                    { latin: 'memoria', german: 'die Erinnerung, das Ged√§chtnis', image: 'üß†', hint: 'Was man sich merkt',
                      distractors: ['der Traum', 'die Meinung', 'die Hoffnung', 'die Angst'] },
                    { latin: 'n≈çlle', german: 'nicht wollen', image: 'üôÖ', hint: 'Das Gegenteil von wollen',
                      distractors: ['wollen', 'k√∂nnen', 'm√ºssen', 'd√ºrfen'] },
                    { latin: 'procul', german: 'von fern, weit weg', image: 'üåÑ', hint: 'Nicht in der N√§he',
                      distractors: ['nahe', 'hier', 'sofort', 'innen'] },
                    { latin: 'DiƒÅna', german: 'Diana (G√∂ttin der Jagd)', image: 'üèπ', hint: 'R√∂mische G√∂ttin mit Bogen',
                      distractors: ['Venus', 'Minerva', 'Juno', 'Ceres'] },
                    { latin: 'dea', german: 'die G√∂ttin', image: 'üëë', hint: 'Weibliche Gottheit',
                      distractors: ['der Gott', 'die K√∂nigin', 'die Priesterin', 'die Heldin'] },
                    // Section 2
                    { latin: 'cum', german: 'mit, zusammen mit', image: 'ü§ù', hint: 'Pr√§position ‚Äì gemeinsam',
                      distractors: ['ohne', 'gegen', 'neben', 'vor'] },
                    { latin: 'amƒ´ca', german: 'die Freundin', image: 'üë©', hint: 'Eine weibliche Vertraute',
                      distractors: ['der Freund', 'die Feindin', 'die Schwester', 'die Herrin'] },
                    { latin: 'nƒìscƒ´re', german: 'nicht wissen, nicht kennen', image: '‚ùì', hint: 'Keine Ahnung haben',
                      distractors: ['wissen', 'kennen', 'verstehen', 'erkennen'] },
                    { latin: 'amƒÅre', german: 'lieben', image: '‚ù§Ô∏è', hint: 'Ein starkes Gef√ºhl',
                      distractors: ['hassen', 'f√ºrchten', 'vergessen', 'verlieren'] },
                    { latin: 'timƒìre', german: 'f√ºrchten, Angst haben (vor)', image: 'üò®', hint: 'Wenn man Angst hat',
                      distractors: ['lieben', 'hoffen', 'wollen', 'freuen'] },
                    { latin: 'in', german: 'in, an, auf, bei (wo?)', image: 'üìç', hint: 'Pr√§p. m. Abl. ‚Äì Wo? Ortsangabe',
                      distractors: ['wohin?', 'woher?', 'wann?', 'warum?'] },
                    // Section 3
                    { latin: 'campus', german: 'das Feld, der freie Platz', image: 'üèüÔ∏è', hint: 'Eine offene Fl√§che',
                      distractors: ['der Wald', 'die Stadt', 'das Haus', 'der Berg'] },
                    { latin: 'ƒ´ra', german: 'der Zorn, die Wut', image: 'üò°', hint: 'Starke Ver√§rgerung',
                      distractors: ['die Freude', 'die Trauer', 'die Liebe', 'die Angst'] },
                    { latin: 'sentƒ´re', german: 'f√ºhlen, meinen, wahrnehmen', image: 'üñêÔ∏è', hint: 'Etwas sp√ºren',
                      distractors: ['sehen', 'h√∂ren', 'sprechen', 'schlafen'] },
                    { latin: 'ƒÅrdƒìre', german: 'brennen', image: 'üî•', hint: 'Feuer und Flamme',
                      distractors: ['l√∂schen', 'frieren', 'regnen', 'scheinen'] },
                    { latin: 'appellƒÅre', german: 'rufen, anrufen, nennen', image: 'üì£', hint: 'Jemanden beim Namen rufen',
                      distractors: ['schweigen', 'fl√ºstern', 'h√∂ren', 'vergessen'] },
                    { latin: 'velle', german: 'wollen', image: 'üí™', hint: 'Einen Wunsch haben',
                      distractors: ['nicht wollen', 'm√ºssen', 'k√∂nnen', 'd√ºrfen'] },
                    { latin: 'propter', german: 'wegen', image: 'üîó', hint: 'Aus welchem Grund?',
                      distractors: ['trotz', 'ohne', 'gegen', 'neben'] },
                    { latin: 'tibi', german: 'dir, f√ºr dich', image: 'üëâ', hint: 'Dativ von ‚Äûdu"',
                      distractors: ['mir', 'ihm', 'uns', 'euch'] },
                    // Section 4
                    { latin: 'agitƒÅre', german: 'treiben, betreiben, √ºberlegen', image: 'üèÉ', hint: 'In Bewegung bringen',
                      distractors: ['stoppen', 'schlafen', 'warten', 'ruhen'] },
                    { latin: 'n≈çnne?', german: '(etwa) nicht?', image: 'ü§®', hint: 'Fragepartikel ‚Äì erwartet ‚Äûja"',
                      distractors: ['warum?', 'wann?', 'wo?', 'wer?'] },
                    { latin: 'terrƒìre', german: 'erschrecken', image: 'üëª', hint: 'Jemandem Angst machen',
                      distractors: ['beruhigen', 'tr√∂sten', 'helfen', 'loben'] },
                    { latin: 'fuga', german: 'die Flucht', image: 'üèÉ‚Äç‚ôÇÔ∏è', hint: 'Schnell weglaufen',
                      distractors: ['der Kampf', 'der Sieg', 'die Ankunft', 'die Ruhe'] },
                    { latin: 'in', german: 'in (... hinein), nach (wohin?); gegen', image: '‚û°Ô∏è', hint: 'Pr√§p. m. Akk. ‚Äì Wohin? Richtungsangabe',
                      distractors: ['wo?', 'woher?', 'wann?', 'warum?'] },
                    { latin: 'silva', german: 'der Wald', image: 'üå≤', hint: 'Viele B√§ume',
                      distractors: ['das Feld', 'der Fluss', 'der Berg', 'die Wiese'] },
                    { latin: 'oculus', german: 'das Auge', image: 'üëÅÔ∏è', hint: 'Damit sieht man',
                      distractors: ['das Ohr', 'die Nase', 'der Mund', 'die Hand'] },
                    { latin: 'tamen', german: 'dennoch, jedoch', image: '‚Ü©Ô∏è', hint: 'Trotzdem',
                      distractors: ['deshalb', 'also', 'denn', 'weil'] },
                    // Section 5
                    { latin: 'enim', german: 'denn, n√§mlich', image: 'üí°', hint: 'Begr√ºndung (nachgestellt)',
                      distractors: ['aber', 'oder', 'trotzdem', 'also'] },
                    { latin: 'vƒ´tƒÅre', german: 'meiden, vermeiden', image: 'üö´', hint: 'Etwas umgehen',
                      distractors: ['suchen', 'finden', 'treffen', 'einladen'] },
                    { latin: 'profect≈ç', german: 'sicherlich, tats√§chlich', image: '‚úÖ', hint: 'Ganz bestimmt',
                      distractors: ['vielleicht', 'niemals', 'selten', 'kaum'] },
                    { latin: 'm≈´tƒÅre', german: '√§ndern, ver√§ndern, verwandeln', image: 'üîÑ', hint: 'Etwas anders machen',
                      distractors: ['behalten', 'bewahren', 'sch√ºtzen', 'festhalten'] },
                    { latin: 'ƒì/ex', german: 'aus, von ... her', image: 'üö™', hint: 'Heraus aus etwas',
                      distractors: ['in', 'auf', 'neben', 'unter'] },
                    { latin: 'at', german: 'aber, jedoch', image: '‚ö°', hint: 'Gegensatz',
                      distractors: ['und', 'auch', 'denn', 'also'] },
                    { latin: 'circumvenƒ´re', german: 'umringen, umzingeln', image: '‚≠ï', hint: 'Von allen Seiten einschlie√üen',
                      distractors: ['befreien', 'fliehen', 'verlassen', '√∂ffnen'] },
                    { latin: 'prope', german: 'nahe, in der N√§he; beinahe', image: 'üìå', hint: 'Nicht weit entfernt',
                      distractors: ['fern', 'weit weg', 'niemals', 'selten'] },
                    { latin: '-que', german: 'und (angeh√§ngt)', image: 'üîó', hint: 'Wird ans Wort angeh√§ngt',
                      distractors: ['oder', 'aber', 'nicht', 'auch'] },
                ],
                multiWord: [
                    { latin: 'c≈çgitƒÅre dƒì', german: 'denken an, nachdenken √ºber',
                      germanDistractors: ['vergessen', 'weglaufen von', 'k√§mpfen gegen', 'warten auf'],
                      latinDistractors: ['fugere ab', 'pugnƒÅre contrƒÅ', 'exspectƒÅre', 'vidƒìre'] },
                    { latin: 'n≈çn nƒìscƒ´re', german: 'genau wissen, genau kennen',
                      germanDistractors: ['nicht wissen', 'vergessen', 'nicht verstehen', 'bezweifeln'],
                      latinDistractors: ['nƒìscƒ´re', 'oblƒ´vƒ´scƒ´', 'dubitƒÅre', 'ign≈çrƒÅre'] },
                    { latin: 'memoriƒÅ tenƒìre', german: 'im Ged√§chtnis behalten',
                      germanDistractors: ['vergessen', 'aufschreiben', 'erz√§hlen', 'verlieren'],
                      latinDistractors: ['oblƒ´vƒ´scƒ´', 'scrƒ´bere', 'narrƒÅre', 'ƒÅmittere'] },
                    { latin: 'DƒÅvus Syrusque', german: 'Davus und Syrus (-que = und)',
                      germanDistractors: ['Davus oder Syrus', 'Davus ohne Syrus', 'Davus gegen Syrus', 'Davus vor Syrus'],
                      latinDistractors: ['DƒÅvus aut Syrus', 'DƒÅvus sine Syr≈ç', 'DƒÅvus contrƒÅ Syrum', 'DƒÅvus ante Syrum'] },
                ],
                verbForms: [
                    { infinitive: 'movƒìre', firstPerson: 'move≈ç', german: 'bewegen',
                      present: { sg2: 'movƒìs', sg3: 'movet', pl1: 'movƒìmus', pl2: 'movƒìtis', pl3: 'movent' },
                      imperative: { sg: 'movƒì', pl: 'movƒìte' } },
                    { infinitive: 'n≈çlle', firstPerson: 'n≈çl≈ç', german: 'nicht wollen',
                      present: { sg2: 'n≈çn vƒ´s', sg3: 'n≈çn vult', pl1: 'n≈çlumus', pl2: 'n≈çn vultis', pl3: 'n≈çlunt' },
                      imperative: { sg: 'n≈çlƒ´', pl: 'n≈çlƒ´te' } },
                    { infinitive: 'nƒìscƒ´re', firstPerson: 'nƒìsci≈ç', german: 'nicht wissen',
                      present: { sg2: 'nƒìscƒ´s', sg3: 'nƒìscit', pl1: 'nƒìscƒ´mus', pl2: 'nƒìscƒ´tis', pl3: 'nƒìsciunt' },
                      imperative: { sg: 'nƒìscƒ´', pl: 'nƒìscƒ´te' } },
                    { infinitive: 'amƒÅre', firstPerson: 'am≈ç', german: 'lieben',
                      present: { sg2: 'amƒÅs', sg3: 'amat', pl1: 'amƒÅmus', pl2: 'amƒÅtis', pl3: 'amant' },
                      imperative: { sg: 'amƒÅ', pl: 'amƒÅte' } },
                    { infinitive: 'timƒìre', firstPerson: 'time≈ç', german: 'f√ºrchten',
                      present: { sg2: 'timƒìs', sg3: 'timet', pl1: 'timƒìmus', pl2: 'timƒìtis', pl3: 'timent' },
                      imperative: { sg: 'timƒì', pl: 'timƒìte' } },
                    { infinitive: 'sentƒ´re', firstPerson: 'senti≈ç', german: 'f√ºhlen',
                      present: { sg2: 'sentƒ´s', sg3: 'sentit', pl1: 'sentƒ´mus', pl2: 'sentƒ´tis', pl3: 'sentiunt' },
                      imperative: { sg: 'sentƒ´', pl: 'sentƒ´te' } },
                    { infinitive: 'ƒÅrdƒìre', firstPerson: 'ƒÅrde≈ç', german: 'brennen',
                      present: { sg2: 'ƒÅrdƒìs', sg3: 'ƒÅrdet', pl1: 'ƒÅrdƒìmus', pl2: 'ƒÅrdƒìtis', pl3: 'ƒÅrdent' },
                      imperative: { sg: 'ƒÅrdƒì', pl: 'ƒÅrdƒìte' } },
                    { infinitive: 'appellƒÅre', firstPerson: 'appell≈ç', german: 'rufen',
                      present: { sg2: 'appellƒÅs', sg3: 'appellat', pl1: 'appellƒÅmus', pl2: 'appellƒÅtis', pl3: 'appellant' },
                      imperative: { sg: 'appellƒÅ', pl: 'appellƒÅte' } },
                    { infinitive: 'velle', firstPerson: 'vol≈ç', german: 'wollen',
                      present: { sg2: 'vƒ´s', sg3: 'vult', pl1: 'volumus', pl2: 'vultis', pl3: 'volunt' },
                      imperative: null },
                    { infinitive: 'agitƒÅre', firstPerson: 'agit≈ç', german: 'treiben',
                      present: { sg2: 'agitƒÅs', sg3: 'agitat', pl1: 'agitƒÅmus', pl2: 'agitƒÅtis', pl3: 'agitant' },
                      imperative: { sg: 'agitƒÅ', pl: 'agitƒÅte' } },
                    { infinitive: 'terrƒìre', firstPerson: 'terre≈ç', german: 'erschrecken',
                      present: { sg2: 'terrƒìs', sg3: 'terret', pl1: 'terrƒìmus', pl2: 'terrƒìtis', pl3: 'terrent' },
                      imperative: { sg: 'terrƒì', pl: 'terrƒìte' } },
                    { infinitive: 'vƒ´tƒÅre', firstPerson: 'vƒ´t≈ç', german: 'meiden',
                      present: { sg2: 'vƒ´tƒÅs', sg3: 'vƒ´tat', pl1: 'vƒ´tƒÅmus', pl2: 'vƒ´tƒÅtis', pl3: 'vƒ´tant' },
                      imperative: { sg: 'vƒ´tƒÅ', pl: 'vƒ´tƒÅte' } },
                    { infinitive: 'm≈´tƒÅre', firstPerson: 'm≈´t≈ç', german: '√§ndern',
                      present: { sg2: 'm≈´tƒÅs', sg3: 'm≈´tat', pl1: 'm≈´tƒÅmus', pl2: 'm≈´tƒÅtis', pl3: 'm≈´tant' },
                      imperative: { sg: 'm≈´tƒÅ', pl: 'm≈´tƒÅte' } },
                    { infinitive: 'circumvenƒ´re', firstPerson: 'circumveni≈ç', german: 'umringen',
                      present: { sg2: 'circumvenƒ´s', sg3: 'circumvenit', pl1: 'circumvenƒ´mus', pl2: 'circumvenƒ´tis', pl3: 'circumveniunt' },
                      imperative: { sg: 'circumvenƒ´', pl: 'circumvenƒ´te' } },
                ],
                sentences: [
                    { latin: 'Dea Symmachum in equum m≈´tat.', germanTemplate: 'Die G√∂ttin ___ Symmachus in ein Pferd.', answer: 'verwandelt', image: 'üê¥',
                      hint: 'm≈´tƒÅre = √§ndern, verwandeln' },
                    { latin: 'Symmachus ƒì tabernƒÅ venit.', germanTemplate: 'Symmachus kommt ___ dem Gasthaus.', answer: 'aus', image: 'üö™',
                      hint: 'ƒì/ex = aus, von ... her' },
                    { latin: 'DƒÅvus cum ƒÄfrƒÅ venit.', germanTemplate: 'Davus kommt zusammen ___ Afra.', answer: 'mit', image: 'ü§ù',
                      hint: 'cum = mit, zusammen mit' },
                    { latin: 'DiƒÅna ƒ´rƒÅ ƒÅrdet.', germanTemplate: 'Diana ___ vor Wut.', answer: 'brennt', image: 'üî•',
                      hint: 'ƒÅrdƒìre = brennen' },
                    { latin: 'DiƒÅna propter ini≈´riam dƒì poenƒÅ c≈çgitat.', germanTemplate: 'Diana denkt ___ des Unrechts √ºber eine Strafe nach.', answer: 'wegen', image: '‚öñÔ∏è',
                      hint: 'propter = wegen' },
                    { latin: 'Symmachus in tabernƒÅ sedet.', germanTemplate: 'Symmachus sitzt ___ Gasthaus.', answer: 'im', image: 'üè†',
                      hint: 'in m. Abl. = in (wo?)' },
                    { latin: 'DƒÅvus in viƒÅ stat.', germanTemplate: 'Davus steht ___ der Stra√üe.', answer: 'auf', image: 'üõ§Ô∏è',
                      hint: 'in m. Abl. = auf (wo?)' },
                    { latin: 'Symmachus in tabernam properat.', germanTemplate: 'Symmachus eilt ___ das Gasthaus.', answer: 'in', image: 'üèÉ',
                      hint: 'in m. Akk. = in ... hinein (wohin?)' },
                    { latin: 'DƒÅvus Syrusque adsunt.', germanTemplate: 'Davus ___ Syrus sind da.', answer: 'und', image: 'üë•',
                      hint: '-que = und (angeh√§ngt)' },
                ],
                nouns: [
                    // a-Deklination
                    { nom_sg: 'memoria', gen_sg: 'memoriae', dat_sg: 'memoriae', akk_sg: 'memoriam', abl_sg: 'memoriƒÅ',
                      nom_pl: 'memoriae', gen_pl: 'memoriƒÅrum', dat_pl: 'memoriƒ´s', akk_pl: 'memoriƒÅs', abl_pl: 'memoriƒ´s',
                      german: 'die Erinnerung', germanPl: 'Erinnerungen', image: 'üß†', declension: 'a-Deklination' },
                    { nom_sg: 'dea', gen_sg: 'deae', dat_sg: 'deae', akk_sg: 'deam', abl_sg: 'deƒÅ',
                      nom_pl: 'deae', gen_pl: 'deƒÅrum', dat_pl: 'deƒÅbus', akk_pl: 'deƒÅs', abl_pl: 'deƒÅbus',
                      german: 'die G√∂ttin', germanPl: 'G√∂ttinnen', image: 'üëë', declension: 'a-Deklination' },
                    { nom_sg: 'amƒ´ca', gen_sg: 'amƒ´cae', dat_sg: 'amƒ´cae', akk_sg: 'amƒ´cam', abl_sg: 'amƒ´cƒÅ',
                      nom_pl: 'amƒ´cae', gen_pl: 'amƒ´cƒÅrum', dat_pl: 'amƒ´cƒ´s', akk_pl: 'amƒ´cƒÅs', abl_pl: 'amƒ´cƒ´s',
                      german: 'die Freundin', germanPl: 'Freundinnen', image: 'üë©', declension: 'a-Deklination' },
                    { nom_sg: 'ƒ´ra', gen_sg: 'ƒ´rae', dat_sg: 'ƒ´rae', akk_sg: 'ƒ´ram', abl_sg: 'ƒ´rƒÅ',
                      nom_pl: 'ƒ´rae', gen_pl: 'ƒ´rƒÅrum', dat_pl: 'ƒ´rƒ´s', akk_pl: 'ƒ´rƒÅs', abl_pl: 'ƒ´rƒ´s',
                      german: 'der Zorn', germanPl: 'Zornausbr√ºche', image: 'üò°', declension: 'a-Deklination' },
                    { nom_sg: 'fuga', gen_sg: 'fugae', dat_sg: 'fugae', akk_sg: 'fugam', abl_sg: 'fugƒÅ',
                      nom_pl: 'fugae', gen_pl: 'fugƒÅrum', dat_pl: 'fugƒ´s', akk_pl: 'fugƒÅs', abl_pl: 'fugƒ´s',
                      german: 'die Flucht', germanPl: 'Fluchten', image: 'üèÉ‚Äç‚ôÇÔ∏è', declension: 'a-Deklination' },
                    { nom_sg: 'silva', gen_sg: 'silvae', dat_sg: 'silvae', akk_sg: 'silvam', abl_sg: 'silvƒÅ',
                      nom_pl: 'silvae', gen_pl: 'silvƒÅrum', dat_pl: 'silvƒ´s', akk_pl: 'silvƒÅs', abl_pl: 'silvƒ´s',
                      german: 'der Wald', germanPl: 'W√§lder', image: 'üå≤', declension: 'a-Deklination' },
                    // o-Deklination
                    { nom_sg: 'campus', gen_sg: 'campƒ´', dat_sg: 'camp≈ç', akk_sg: 'campum', abl_sg: 'camp≈ç',
                      nom_pl: 'campƒ´', gen_pl: 'camp≈çrum', dat_pl: 'campƒ´s', akk_pl: 'camp≈çs', abl_pl: 'campƒ´s',
                      german: 'das Feld', germanPl: 'Felder', image: 'üèüÔ∏è', declension: 'o-Deklination' },
                    { nom_sg: 'oculus', gen_sg: 'oculƒ´', dat_sg: 'ocul≈ç', akk_sg: 'oculum', abl_sg: 'ocul≈ç',
                      nom_pl: 'oculƒ´', gen_pl: 'ocul≈çrum', dat_pl: 'oculƒ´s', akk_pl: 'ocul≈çs', abl_pl: 'oculƒ´s',
                      german: 'das Auge', germanPl: 'Augen', image: 'üëÅÔ∏è', declension: 'o-Deklination' },
                    // Eigenname (nur Singular)
                    { nom_sg: 'DiƒÅna', gen_sg: 'DiƒÅnae', dat_sg: 'DiƒÅnae', akk_sg: 'DiƒÅnam', abl_sg: 'DiƒÅnƒÅ',
                      nom_pl: null, gen_pl: null, dat_pl: null, akk_pl: null, abl_pl: null,
                      german: 'Diana', image: 'üèπ', declension: 'a-Deklination (Eigenname)' },
                ]
            }
        };

        // ===================================================================
        // ENGLISH VOCABULARY DATA
        // Each word has: english, german, image, hint, distractors (4 pitfall wrong DE translations)
        // Distractors are curated near-misses for 5th grade level
        // ===================================================================

        const vocabularyTheme2 = [
            // Theme 2: At school - Page 1
            { english: 'idea', german: 'Idee, Einfall', image: 'üí°', hint: 'Ein guter Gedanke',
              distractors: ['Ideal', 'Meinung', 'Traum', 'Wunsch'] },
            { english: 'next', german: 'n√§chste(r, s)', image: '‚û°Ô∏è', hint: 'Was kommt danach?',
              distractors: ['letzte(r, s)', 'neue(r, s)', 'beste(r, s)', 'andere(r, s)'] },
            { english: 'outside', german: 'drau√üen', image: 'üå≥', hint: 'Nicht drinnen',
              distractors: ['drinnen', 'daneben', 'oben', 'hinten'] },
            { english: 'quite', german: 'ziemlich, ganz', image: '‚ú®', hint: 'Sehr, aber nicht ganz',
              distractors: ['ruhig', 'leise', 'schnell', 'still'] },
            { english: 'sure', german: 'sicher', image: '‚úì', hint: 'Ohne Zweifel',
              distractors: ['unsicher', 'streng', 'vielleicht', '√ºberrascht'] },
            { english: 'thanks', german: 'Danke', image: 'üôè', hint: 'H√∂flich sein',
              distractors: ['Bitte', 'Entschuldigung', 'Hallo', 'Tsch√ºss'] },
            { english: 'diary', german: 'Tagebuch', image: 'üìî', hint: 'Pers√∂nliche Notizen',
              distractors: ['W√∂rterbuch', 'Kalender', 'Notizbuch', 'Molkerei'] },
            { english: 'music', german: 'Musik', image: 'üéµ', hint: 'Klingt gut',
              distractors: ['Museum', 'Musical', 'Muskel', 'Muster'] },
            { english: 'lunch', german: 'Mittagessen', image: 'üçΩÔ∏è', hint: 'Mahlzeit am Mittag',
              distractors: ['Fr√ºhst√ºck', 'Abendessen', 'Snack', 'Pause'] },
            { english: 'meet', german: 'treffen', image: 'üë•', hint: 'Jemanden sehen',
              distractors: ['Fleisch', 'essen', 'gr√º√üen', 'kennen'] },
            { english: 'after', german: 'nach', image: '‚è∞', hint: 'Danach',
              distractors: ['vor', 'w√§hrend', 'Nachmittag', 'sp√§ter'] },
            { english: 'real', german: 'wirklich, echt', image: 'üíØ', hint: 'Nicht falsch',
              distractors: ['falsch', 'lesen', 'k√∂niglich', 'selten'] },
            { english: 'both', german: 'beide(s)', image: 'üë•', hint: 'Zwei zusammen',
              distractors: ['alle', 'jeder', 'einige', 'keiner'] },
            { english: 'french', german: 'Franz√∂sisch', image: 'üá´üá∑', hint: 'Sprache aus Frankreich',
              distractors: ['Englisch', 'Spanisch', 'Frankreich', 'frisch'] },
            { english: 'make', german: 'machen, erstellen', image: 'üî®', hint: 'Etwas herstellen',
              distractors: ['nehmen', 'backen', 'm√∂gen', 'Marke'] },
            { english: 'think', german: 'denken, glauben, meinen', image: 'ü§î', hint: 'Im Kopf √ºberlegen',
              distractors: ['trinken', 'danken', 'Ding', 'd√ºnn'] },
            { english: 'stupid', german: 'dumm, bl√∂d', image: 'üòµ', hint: 'Nicht schlau',
              distractors: ['schlau', 'langsam', 'Student', 'seltsam'] },
            { english: 'pet', german: 'Haustier', image: 'üêï', hint: 'Tier zu Hause',
              distractors: ['Pfanne', 'Stift', 'Topf', 'Wildtier'] },
            { english: 'art', german: 'Kunst(unterricht)', image: 'üé®', hint: 'Kreatives Fach',
              distractors: ['Musik', 'Sport', 'Art und Weise', 'Herz'] },
            { english: 'library', german: 'Bibliothek, B√ºcherei', image: 'üìö', hint: 'Viele B√ºcher zum Ausleihen',
              distractors: ['Buchhandlung', 'Labor', 'Freiheit', 'B√ºro'] },
            { english: 'science', german: 'Naturwissenschaft', image: 'üî¨', hint: 'Biologie, Chemie, Physik',
              distractors: ['Stille', 'Kunst', 'Sozialkunde', 'Informatik'] },
            { english: 'number', german: 'Zahl, Ziffer, Nummer', image: 'üî¢', hint: '1, 2, 3...',
              distractors: ['Buchstabe', 'Name', 'taub', 'Menge'] },
            { english: 'drama', german: 'Drama, Theater', image: 'üé≠', hint: 'Schauspiel',
              distractors: ['Traum', 'Musik', 'Film', 'Kino'] },
            { english: 'english', german: 'Englisch', image: 'üá¨üáß', hint: 'Diese Sprache!',
              distractors: ['England', 'Franz√∂sisch', 'Deutsch', 'Spanisch'] },
            { english: 'geography', german: 'Erdkunde, Geografie', image: 'üó∫Ô∏è', hint: 'L√§nder und St√§dte',
              distractors: ['Geschichte', 'Geometrie', 'Geologie', 'Biologie'] },
            { english: 'history', german: 'Geschichte', image: 'üìú', hint: 'Die Vergangenheit',
              distractors: ['Erz√§hlung', 'Erdkunde', 'Geheimnis', 'Wissenschaft'] },
            { english: 'maths', german: 'Mathe', image: '‚ûó', hint: 'Rechnen',
              distractors: ['Physik', 'Streichh√∂lzer', 'Karten', 'Kunst'] },
            { english: 'face', german: 'Gesicht', image: 'üòä', hint: 'Augen, Nase, Mund',
              distractors: ['Fest', 'Tatsache', 'Platz', 'Kopf'] },
            { english: 'seat', german: 'Sitzplatz', image: 'üí∫', hint: 'Zum Hinsetzen',
              distractors: ['Meer', 'Hitze', 'Stra√üe', 'Schwei√ü'] },
            { english: 'lunchbox', german: 'Lunchbox, Brotdose', image: 'ü•™', hint: 'Essen f√ºr die Pause',
              distractors: ['Schultasche', 'Mittagessen', 'Brotkorb', 'K√ºhlschrank'] },
            { english: 'grumpy', german: 'm√ºrrisch, schlecht gelaunt', image: 'üò†', hint: 'Schlechte Laune',
              distractors: ['lustig', 'hungrig', 'm√ºde', 'traurig'] },
            { english: 'first', german: 'zuerst, als Erstes', image: 'ü•á', hint: 'Nummer eins',
              distractors: ['letzte(r)', 'schnell', 'Faust', 'beste(r)'] },

            // Theme 2: At school - Page 2
            { english: 'timetable', german: 'Stundenplan', image: 'üìÖ', hint: 'Wann welches Fach?',
              distractors: ['Zeugnis', 'Zeitzone', 'Kalender', 'Tabelle'] },
            { english: 'today', german: 'heute', image: 'üìÜ', hint: 'Dieser Tag',
              distractors: ['morgen', 'gestern', 'jetzt', 'immer'] },
            { english: 'before', german: 'vor', image: '‚è™', hint: 'Vorher',
              distractors: ['nach', 'w√§hrend', 'hinter', 'neben'] },
            { english: 'morning', german: 'Morgen, Vormittag', image: 'üåÖ', hint: 'Fr√ºh am Tag',
              distractors: ['Abend', 'Nachmittag', 'Nacht', 'Mittag'] },
            { english: 'break', german: 'Pause', image: '‚è∏Ô∏è', hint: 'Kurze Unterbrechung',
              distractors: ['Br√ºcke', 'Fr√ºhst√ºck', 'kaputt', 'Bremse'] },
            { english: 'sir', german: 'Herr', image: 'üë®‚Äçüè´', hint: 'H√∂fliche Anrede m√§nnlich',
              distractors: ['Frau', 'Schwester', 'K√∂nig', 'Ritter'] },
            { english: 'afternoon', german: 'Nachmittag', image: 'üå§Ô∏è', hint: 'Nach dem Mittag',
              distractors: ['Vormittag', 'Abend', 'Mittag', 'Morgen'] },
            { english: 'when', german: 'wann', image: '‚è∞', hint: 'Zu welcher Zeit?',
              distractors: ['wo', 'wer', 'was', 'wie'] },
            { english: 'what', german: 'welche(r, s)', image: '‚ùì', hint: 'Welches?',
              distractors: ['wann', 'wo', 'wer', 'wie'] },
            { english: 'puzzle', german: 'R√§tsel, Fragespiel', image: 'üß©', hint: 'Knifflige Aufgabe',
              distractors: ['Pudding', 'Spiel', 'Problem', 'Muskel'] },
            { english: 'understand', german: 'verstehen', image: 'üí≠', hint: 'Begreifen',
              distractors: ['unter stehen', 'missverstehen', 'erkl√§ren', 'wissen'] },
            { english: 'weird', german: 'merkw√ºrdig, seltsam, komisch', image: 'ü§®', hint: 'Nicht normal',
              distractors: ['m√ºde', 'wild', 'weit', 'breit'] },
            { english: 'crown', german: 'Krone', image: 'üëë', hint: 'K√∂nig tr√§gt das',
              distractors: ['Clown', 'braun', 'Kr√§he', 'Menge'] },
            { english: 'flag', german: 'Fahne, Flagge', image: 'üö©', hint: 'Symbol eines Landes',
              distractors: ['flach', 'Fliege', 'Flamme', 'Wohnung'] },
            { english: 'try', german: 'versuchen, probieren', image: 'üí™', hint: 'Es versuchen',
              distractors: ['weinen', 'trocknen', 'Tablett', 'trainieren'] },
            { english: 'monday', german: 'Montag', image: 'üìÖ', hint: 'Erster Wochentag',
              distractors: ['Dienstag', 'Sonntag', 'Geld', 'Mond'] },
            { english: 'tuesday', german: 'Dienstag', image: 'üìÖ', hint: 'Zweiter Wochentag',
              distractors: ['Donnerstag', 'Montag', 'Mittwoch', 'zwei'] },
            { english: 'wednesday', german: 'Mittwoch', image: 'üìÖ', hint: 'Mitte der Woche',
              distractors: ['Montag', 'Donnerstag', 'Freitag', 'Wochenende'] },
            { english: 'thursday', german: 'Donnerstag', image: 'üìÖ', hint: 'Vierter Wochentag',
              distractors: ['Dienstag', 'Freitag', 'Durst', 'drei√üig'] },
            { english: 'friday', german: 'Freitag', image: 'üìÖ', hint: 'Letzter Schultag',
              distractors: ['Samstag', 'Donnerstag', 'Freund', 'frei'] },
            { english: 'saturday', german: 'Samstag', image: 'üìÖ', hint: 'Wochenende beginnt',
              distractors: ['Sonntag', 'Freitag', 'Saturn', 'traurig'] },
            { english: 'sunday', german: 'Sonntag', image: 'üìÖ', hint: 'Letzter Tag der Woche',
              distractors: ['Samstag', 'Montag', 'Sonne', 'sonnig'] },
            { english: 'sit', german: 'sitzen', image: 'ü™ë', hint: 'Auf einem Stuhl',
              distractors: ['stehen', 'setzen', 'sechs', 'passen'] },
            { english: 'pupil', german: 'Sch√ºler/in', image: 'üë®‚Äçüéì', hint: 'Lernt in der Schule',
              distractors: ['Lehrer/in', 'Welpe', 'Puppe', 'Schule'] },
            { english: 'menu', german: 'Speisekarte', image: 'üìã', hint: 'Liste mit Essen',
              distractors: ['Messer', 'Liste', 'Karte', 'Rechnung'] },
            { english: 'meal', german: 'Mahlzeit, Essen', image: 'üçΩÔ∏è', hint: 'Fr√ºhst√ºck, Mittag, Abend',
              distractors: ['Mehl', 'Fleisch', 'Rezept', 'Gericht'] },
            { english: 'salad', german: 'Salat', image: 'ü•ó', hint: 'Gesund und gr√ºn',
              distractors: ['Suppe', 'So√üe', 'Salz', 'Gem√ºse'] },
            { english: 'other', german: 'andere(r, s)', image: '‚ÜîÔ∏è', hint: 'Nicht dieser',
              distractors: ['oder', '√§u√üere(r)', '√ºber', 'jede(r)'] },
            { english: 'language', german: 'Sprache', image: 'üí¨', hint: 'Deutsch, Englisch...',
              distractors: ['Land', 'Buchstabe', 'Rede', 'Lied'] },
            { english: 'vegetarian', german: 'Vegetarier/in, vegetarisch', image: 'ü•ï', hint: 'Ohne Fleisch',
              distractors: ['vegan', 'Gem√ºse', 'Tierarzt', 'gesund'] },
            { english: 'dessert', german: 'Nachtisch', image: 'üç∞', hint: 'S√º√ües nach dem Essen',
              distractors: ['W√ºste', 'Kuchen', 'Vorspeise', 'S√º√üigkeit'] },
            { english: 'fresh', german: 'neu, ungebraucht, frisch', image: '‚ú®', hint: 'Nicht alt',
              distractors: ['Franz√∂sisch', 'frei', 'Fleisch', 'k√ºhl'] },
            { english: 'fruit', german: 'Frucht, Obst', image: 'üçé', hint: 'Apfel, Banane...',
              distractors: ['Gem√ºse', 'Essen', 'Wurzel', 'Fr√ºhst√ºck'] },
            { english: 'chicken', german: 'Huhn, H√§hnchen', image: 'üçó', hint: 'Gefl√ºgel',
              distractors: ['K√ºche', 'K√ºken', 'Schinken', 'Truthahn'] },
            { english: 'rice', german: 'Reis', image: 'üçö', hint: 'Wei√ües Korn aus Asien',
              distractors: ['Nudeln', 'Preis', 'Eis', 'nett'] },
            { english: 'cheese', german: 'K√§se', image: 'üßÄ', hint: 'Aus Milch gemacht',
              distractors: ['Kuchen', 'Kirsche', 'Kiste', 'Brust'] },
            { english: 'tomato', german: 'Tomate', image: 'üçÖ', hint: 'Rot und rund',
              distractors: ['Kartoffel', 'Karotte', 'Paprika', 'Tornado'] },
            { english: 'apple', german: 'Apfel', image: 'üçé', hint: 'Rote Frucht',
              distractors: ['Birne', 'Orange', 'Ananas', 'Ahorn'] },
            { english: 'sauce', german: 'So√üe, Sauce', image: 'ü•´', hint: 'Fl√ºssige Beilage',
              distractors: ['Wurst', 'Suppe', 'Saft', 'Salz'] },
            { english: 'banana', german: 'Banane', image: 'üçå', hint: 'Gelb und krumm',
              distractors: ['Ananas', 'Bohne', 'Birne', 'Beere'] },
            { english: 'lamb', german: 'Lamm(fleisch)', image: 'üêë', hint: 'Fleisch vom Schaf',
              distractors: ['Lampe', 'Schinken', 'Rindfleisch', 'Land'] },
            { english: 'potato', german: 'Kartoffel', image: 'ü•î', hint: 'Pommes frites daraus',
              distractors: ['Tomate', 'Papaya', 'Foto', 'Karotte'] },
            { english: 'chips', german: 'Pommes frites', image: 'üçü', hint: 'Frittiert und salzig',
              distractors: ['Kartoffelchips', 'Kekse', 'Schokolade', 'N√ºsse'] },
            { english: 'food', german: 'Essen, Nahrung, Futter', image: 'üçî', hint: 'Was man isst',
              distractors: ['Fu√ü', 'Stimmung', 'Flut', 'Getr√§nk'] },
            { english: 'nice', german: 'sch√∂n, angenehm, nett, freundlich', image: 'üòä', hint: 'Gut und freundlich',
              distractors: ['Nichte', 'neu', 'nah', 'Nacht'] }
        ];

        const vocabularyTheme3 = [
            // Theme 3: Hobbies and activities - Page 218 (p. 54)
            { english: 'hour', german: 'Stunde', image: '‚è∞', hint: 'Zeiteinheit',
              distractors: ['unser', 'Haus', 'Minute', 'Uhr'] },
            { english: 'later', german: 'Sp√§ter', image: '‚è±Ô∏è', hint: 'Nicht jetzt',
              distractors: ['fr√ºher', 'letzter', 'Brief', 'seitlich'] },
            { english: 'dance', german: 'Tanz', image: 'üíÉ', hint: 'Bewegung zur Musik',
              distractors: ['Chance', 'Lied', 'Musik', 'Sprung'] },
            { english: 'class', german: 'Schulklasse, Kurs', image: 'üë®‚Äçüè´', hint: 'Unterricht',
              distractors: ['Glas', 'Klasse (toll)', 'Klassiker', 'Gruppe'] },
            { english: 'charity', german: 'Barmherzigkeit, Wohlt√§tigkeit', image: '‚ù§Ô∏è', hint: 'Gutes tun',
              distractors: ['Kirsche', 'Freiheit', 'Fr√∂hlichkeit', 'Spende'] },
            { english: 'gym', german: 'Turnen', image: 'ü§∏', hint: 'Sport in der Halle',
              distractors: ['Spielplatz', 'Edelstein', 'Kaugummi', 'Spiel'] },
            { english: 'minute', german: 'Minute', image: '‚è±Ô∏è', hint: '60 Sekunden',
              distractors: ['winzig', 'Stunde', 'Sekunde', 'Moment'] },
            { english: 'biscuit', german: 'Keks, Biskuit', image: 'üç™', hint: 'S√º√ües Geb√§ck',
              distractors: ['Br√∂tchen', 'Kuchen', 'Brot', 'Toast'] },
            { english: 'prize', german: 'Preis, Gewinn', image: 'üèÜ', hint: 'Wenn man gewinnt',
              distractors: ['Stolz', '√úberraschung', 'Lob', 'Medaille'] },
            { english: 'money', german: 'Geld', image: 'üí∞', hint: 'Zum Kaufen',
              distractors: ['Honig', 'Affe', 'Monat', 'M√ºnze'] },
            { english: 'german', german: 'Deutsche/r, deutsch', image: 'üá©üá™', hint: 'Unsere Sprache',
              distractors: ['Deutschland', 'Franz√∂sisch', 'Keim', 'Bruder'] },
            { english: 'example', german: 'Beispiel', image: 'üìå', hint: 'Zum Erkl√§ren',
              distractors: ['Pr√ºfung', 'Ausnahme', '√úbung', 'Erkl√§rung'] },
            { english: 'win', german: 'gewinnen', image: 'üèÜ', hint: 'Erster sein',
              distractors: ['verlieren', 'Wind', 'Fl√ºgel', 'w√ºnschen'] },
            { english: 'cake', german: 'Kuchen', image: 'üéÇ', hint: 'S√º√ü und lecker',
              distractors: ['Keks', 'Kiste', 'Pflege', 'kochen'] },
            { english: 'special', german: 'besondere(r, s)', image: '‚≠ê', hint: 'Nicht normal',
              distractors: ['sportlich', 'normal', 'Brille', 'schnell'] },
            { english: 'recipe', german: 'Rezept', image: 'üìù', hint: 'Zum Kochen',
              distractors: ['Quittung', 'Empfang', 'Beleg', 'Rechnung'] },
            { english: 'into', german: 'in', image: '‚û°Ô∏è', hint: 'Hinein',
              distractors: ['aus', 'auf', 'auch', 'unter'] },
            { english: 'want', german: 'w√ºnschen, wollen', image: 'üôè', hint: 'Etwas m√∂chten',
              distractors: ['brauchen', 'warten', 'wandern', 'warnen'] },
            { english: 'difficult', german: 'schwierig, schwer', image: 'üò∞', hint: 'Nicht leicht',
              distractors: ['verschieden', 'anders', 'leicht', 'unm√∂glich'] },
            { english: 'tomorrow', german: 'morgen', image: 'üìÖ', hint: 'Der n√§chste Tag',
              distractors: ['heute', 'gestern', 'Morgen (fr√ºh)', '√ºbermorgen'] },
            { english: 'horrible', german: 'schrecklich', image: 'üò±', hint: 'Sehr schlecht',
              distractors: ['wunderbar', 'Krankenhaus', 'ehrlich', 'hungrig'] },
            { english: 'bad', german: 'schlecht, schlimm, b√∂se', image: 'üëé', hint: 'Nicht gut',
              distractors: ['Bett', 'Tasche', 'traurig', 'gut'] },
            { english: 'must', german: 'm√ºssen', image: '‚ùó', hint: 'Ich muss das tun',
              distractors: ['sollen', 'd√ºrfen', 'm√∂gen', 'Senf'] },
            { english: 'give', german: 'geben', image: 'üéÅ', hint: 'Schenken',
              distractors: ['leben', 'nehmen', 'f√ºnf', 'bekommen'] },
            { english: 'baker', german: 'B√§cker/in', image: 'üë®‚Äçüç≥', hint: 'Macht Brot',
              distractors: ['Koch/K√∂chin', 'Metzger/in', 'Korb', 'R√ºcken'] },
            { english: 'sound', german: 'klingen', image: 'üîä', hint: 'Wie etwas klingt',
              distractors: ['gesund', 'finden', 'rund', 'Boden'] },
            { english: 'this', german: 'diese(r, s), das', image: 'üëâ', hint: 'Dieses hier',
              distractors: ['jene(r, s)', 'd√ºnn', 'Ding', 'Gedanke'] },
            { english: 'everyone', german: 'alle(s)', image: 'üë•', hint: 'Jede Person',
              distractors: ['jemand', 'niemand', '√ºberall', 'irgendwo'] },
            { english: 'all', german: 'alle(s)', image: 'üíØ', hint: 'Alles zusammen',
              distractors: ['alt', 'auch', 'schon', 'nichts'] },

            // Theme 3: Hobbies and activities - Page 219 (p. 56-58)
            { english: 'competition', german: 'Wettbewerb', image: 'üèÅ', hint: 'Wer ist der Beste?',
              distractors: ['Zusammenarbeit', 'Sammlung', 'Mannschaft', 'Auff√ºhrung'] },
            { english: 'describe', german: 'beschreiben', image: '‚úçÔ∏è', hint: 'Mit Worten erkl√§ren',
              distractors: ['entdecken', 'zerst√∂ren', 'verdienen', 'entscheiden'] },
            { english: 'much', german: 'viel', image: 'üìä', hint: 'Eine gro√üe Menge',
              distractors: ['solch', 'ber√ºhren', 'sehr', 'Matsch'] },
            { english: 'anything', german: 'etwas, irgendwas', image: '‚ùì', hint: 'Irgendetwas',
              distractors: ['alles', 'nichts', 'jemand', '√ºberall'] },
            { english: 'reading', german: 'Lesen', image: 'üìñ', hint: 'Ein Buch lesen',
              distractors: ['Schreiben', 'bereit', 'rot', 'Grund'] },
            { english: 'dancing', german: 'Tanzen', image: 'üíÉ', hint: 'Zur Musik bewegen',
              distractors: ['Singen', 'Gefahr', 'Springen', 'Laufen'] },
            { english: 'wear', german: 'tragen, anhaben', image: 'üëï', hint: 'Kleidung tragen',
              distractors: ['wo', 'waren', 'Wetter', 'Birne'] },
            { english: 'beautiful', german: 'sch√∂n', image: 'üòç', hint: 'Sehr h√ºbsch',
              distractors: ['h√§sslich', 'wunderbar', 'dankbar', 'vorsichtig'] },
            { english: 'costume', german: 'Kost√ºm', image: 'üé≠', hint: 'Verkleidung',
              distractors: ['Kunde', 'Brauch', 'Kleid', 'Uniform'] },
            { english: 'than', german: 'als', image: '‚ÜîÔ∏è', hint: 'Beim Vergleichen',
              distractors: ['dann', 'd√ºnn', 'danke', 'Gedanke'] },
            { english: 'circus', german: 'Zirkus', image: 'üé™', hint: 'Mit Clowns und Akrobaten',
              distractors: ['Kreis', 'Kirche', 'Kino', 'Theater'] },
            { english: 'just', german: 'nur, blo√ü, einfach', image: '1Ô∏è‚É£', hint: 'Nur das',
              distractors: ['Saft', 'Scherz', 'Sprung', 'Jacke'] },
            { english: 'pretty', german: 'h√ºbsch, nett', image: 'üå∏', hint: 'Sch√∂n anzusehen',
              distractors: ['fertig', 'vorgeben', 'putzig', 'drucken'] },
            { english: 'nervous', german: 'nerv√∂s', image: 'üò∞', hint: 'Aufgeregt und √§ngstlich',
              distractors: ['mutig', 'Nerv', 'neugierig', 'ver√§rgert'] },
            { english: 'stage', german: 'B√ºhne', image: 'üé¨', hint: 'Wo man auftritt',
              distractors: ['Stall', 'Seite', 'Stern', 'Szene'] },
            { english: 'angry', german: 'ver√§rgert, zornig, w√ºtend', image: 'üò†', hint: 'Sehr b√∂se',
              distractors: ['hungrig', '√§ngstlich', 'traurig', 'Engel'] },
            { english: 'agree', german: 'zustimmen', image: 'üëç', hint: 'Derselben Meinung sein',
              distractors: ['ablehnen', 'begr√º√üen', 'Alter', 'streiten'] },
            { english: 'disagree', german: 'nicht √ºbereinstimmen', image: 'üëé', hint: 'Anderer Meinung',
              distractors: ['zustimmen', 'verschwinden', 'entdecken', 'm√∂gen'] },
            { english: 'suggestion', german: 'Vorschlag', image: 'üí°', hint: 'Eine Idee vorschlagen',
              distractors: ['Frage', 'Zucker', 'Vermutung', '√úberraschung'] },
            { english: 'act', german: 'Show, Akt', image: 'üé≠', hint: 'Teil einer Show',
              distractors: ['Kunst', 'Aktion', 'Tatsache', 'Szene'] },
            { english: 'imagine', german: 'sich vorstellen', image: 'üí≠', hint: 'In Gedanken sehen',
              distractors: ['Bild', 'Magie', 'nachahmen', 'verbessern'] },
            { english: 'disappointed', german: 'entt√§uscht', image: 'üòû', hint: 'Traurig, weil es anders kam',
              distractors: ['begeistert', 'verschwunden', '√ºberrascht', 'gelangweilt'] },
            { english: 'glad', german: 'gl√ºcklich, dankbar, froh', image: 'üòä', hint: 'Sehr zufrieden',
              distractors: ['traurig', 'Glas', 'Freude', 'Blick'] },
            { english: 'reason', german: 'Grund', image: 'ü§î', hint: 'Warum etwas so ist',
              distractors: ['Jahreszeit', 'lesen', 'Ergebnis', 'Rosine'] },
            { english: 'exciting', german: 'aufregend, spannend', image: 'üé¢', hint: 'Sehr interessant',
              distractors: ['langweilig', 'ausgezeichnet', 'bestehend', 'anstrengend'] },
            { english: 'evening', german: 'Abend', image: 'üåÜ', hint: 'Nach dem Tag',
              distractors: ['Morgen', 'gleichm√§√üig', 'Veranstaltung', 'Nacht'] },
            { english: 'surprise', german: '√ºberraschen', image: 'üéÅ', hint: 'Unerwartet',
              distractors: ['Sonnenaufgang', '√ºberleben', 'vermuten', 'umgeben'] },
            { english: 'brilliant', german: 'brilliant, strahlend, klasse', image: '‚ú®', hint: 'Fantastisch',
              distractors: ['langweilig', 'hell', 'bringen', 'kurz'] },
            { english: 'clap', german: 'klatschen', image: 'üëè', hint: 'Mit den H√§nden',
              distractors: ['Klappe', 'fangen', 'Klasse', 'klopfen'] },
            { english: 'support', german: 'unterst√ºtzen', image: 'ü§ù', hint: 'Jemandem helfen',
              distractors: ['Abendessen', 'vermuten', 'versorgen', 'liefern'] },
            { english: 'laugh', german: 'lachen', image: 'üòÇ', hint: 'Wenn etwas lustig ist',
              distractors: ['Blatt', 'lernen', 'laut', 'Lamm'] },
            { english: 'hear', german: 'h√∂ren', image: 'üëÇ', hint: 'Mit den Ohren',
              distractors: ['hier', 'Herz', 'Haar', 'Hitze'] },

            // Theme 3: Hobbies and activities - Page 220 (p. 58-59)
            { english: 'job', german: 'Stelle, Job, Arbeit', image: 'üíº', hint: 'Was man arbeitet',
              distractors: ['Hobby', 'joggen', 'Witz', 'Freude'] },
            { english: 'true', german: 'wahr', image: '‚úÖ', hint: 'Nicht falsch',
              distractors: ['falsch', 'Baum', 'blau', 'versuchen'] },
            { english: 'empty', german: 'entleeren, ausr√§umen', image: 'üì≠', hint: 'Leer machen',
              distractors: ['voll', 'Eimer', 'f√ºllen', 'eingeben'] },
            { english: 'load', german: 'aufladen, einr√§umen', image: 'üì•', hint: 'Voll machen',
              distractors: ['Brot', 'Stra√üe', 'Laub', 'laut'] },
            { english: 'always', german: 'immer', image: 'üîÑ', hint: 'Jedes Mal',
              distractors: ['nie', 'manchmal', 'fast', 'auch'] },
            { english: 'never', german: 'nie(mals)', image: 'üö´', hint: 'Kein einziges Mal',
              distractors: ['immer', 'selten', 'manchmal', 'oft'] },
            { english: 'often', german: 'oft', image: 'üìä', hint: 'Viele Male',
              distractors: ['selten', 'manchmal', 'offen', 'immer'] },
            { english: 'sometimes', german: 'manchmal', image: 'üé≤', hint: 'Ab und zu',
              distractors: ['immer', 'nie', 'oft', 'etwas'] },
            { english: 'usually', german: 'gew√∂hnlich, normalerweise', image: 'üìÖ', hint: 'Meistens',
              distractors: ['ungew√∂hnlich', 'n√ºtzlich', 'selten', 'benutzen'] },
            { english: 'supermarket', german: 'Supermarkt', image: 'üõí', hint: 'Zum Einkaufen',
              distractors: ['Markt', 'Kaufhaus', 'Marktplatz', 'Gesch√§ft'] },
            { english: 'when', german: 'als, wenn', image: '‚è∞', hint: 'Zu welcher Zeit',
              distractors: ['wo', 'wer', 'was', 'wie'] },
            { english: 'buy', german: 'kaufen', image: 'üí≥', hint: 'Mit Geld bekommen',
              distractors: ['bei', 'verkaufen', 'Junge', 'tsch√ºss'] },
            { english: 'delicious', german: 'k√∂stlich, lecker', image: 'üòã', hint: 'Sehr gut schmeckend',
              distractors: ['eklig', 'zart', 'empfindlich', 'fr√∂hlich'] },
            { english: 'decoration', german: 'Dekoration, Verzierung', image: 'üé®', hint: 'Zum Schm√ºcken',
              distractors: ['Erkl√§rung', 'Entscheidung', 'Richtung', 'Sammlung'] },
            { english: 'decorate', german: 'dekorieren, verzieren', image: 'üéÑ', hint: 'Sch√∂n machen',
              distractors: ['zerst√∂ren', 'entdecken', 'entscheiden', 'erkl√§ren'] },
            { english: 'need', german: 'm√ºssen, brauchen', image: '‚ùó', hint: 'Etwas ist n√∂tig',
              distractors: ['Nadel', 'wollen', 'knien', 'stricken'] },
            { english: 'bake', german: 'backen', image: 'üßÅ', hint: 'Im Ofen machen',
              distractors: ['R√ºcken', 'kochen', 'zur√ºck', 'See'] },
            { english: 'every', german: 'jede(r, s)', image: 'üíØ', hint: 'Alle ohne Ausnahme',
              distractors: ['nie', 'sogar', 'Abend', 'einige'] },
            { english: 'eat', german: 'essen, fressen', image: 'üçΩÔ∏è', hint: 'Nahrung zu sich nehmen',
              distractors: ['trinken', 'Osten', 'Ohr', 'Auge'] },
            { english: 'night', german: 'Nacht, Abend', image: 'üåô', hint: 'Wenn es dunkel ist',
              distractors: ['Ritter', 'nett', 'Licht', 'richtig'] },
            { english: 'perfect', german: 'perfekt', image: 'üíØ', hint: 'Ohne Fehler',
              distractors: ['vielleicht', 'Person', 'erlauben', '√ºben'] },
            { english: 'story', german: 'Geschichte, Erz√§hlung', image: 'üìö', hint: 'Eine Geschichte erz√§hlen',
              distractors: ['Storch', 'Sturm', 'Laden', 'Studie'] },
            { english: 'back', german: 'zur√ºck', image: '‚Ü©Ô∏è', hint: 'Wieder da',
              distractors: ['backen', 'Tasche', 'schlecht', 'schwarz'] },
            { english: 'message', german: 'Nachricht, Botschaft', image: 'üí¨', hint: 'Mitteilung',
              distractors: ['Massage', 'Chaos', 'Unordnung', 'Bote'] },
            { english: 'help', german: 'Hilfe', image: 'üÜò', hint: 'Unterst√ºtzung',
              distractors: ['Helm', 'halten', 'H√§lfte', 'Held'] },
            { english: 'smile', german: 'l√§cheln', image: 'üòä', hint: 'Freundlich schauen',
              distractors: ['riechen', 'Meile', 'Schleim', 'still'] },
            { english: 'taste', german: 'schmecken', image: 'üëÖ', hint: 'Mit der Zunge probieren',
              distractors: ['Verschwendung', 'Test', 'ber√ºhren', 'riechen'] },
            { english: 'nothing', german: 'nichts', image: '‚≠ï', hint: 'Gar nichts',
              distractors: ['etwas', 'alles', 'Norden', 'bemerken'] },
            { english: 'begin', german: 'anfangen, beginnen', image: '‚ñ∂Ô∏è', hint: 'Starten',
              distractors: ['beenden', 'betteln', 'hinter', 'gewinnen'] },
            { english: 'suddenly', german: 'pl√∂tzlich', image: '‚ö°', hint: 'Unerwartet schnell',
              distractors: ['langsam', 'traurig', 'sonnig', 'Sonntag'] },
            { english: 'doorbell', german: 'T√ºrklingel', image: 'üîî', hint: 'An der T√ºr',
              distractors: ['T√ºrgriff', 'Glocke', 'T√ºrklopfer', 'Klingel'] },
            { english: 'shout', german: 'anschreien', image: 'üì¢', hint: 'Laut rufen',
              distractors: ['fl√ºstern', 'kurz', 'zeigen', 'Dusche'] },
            { english: 'hide', german: 'sich verstecken', image: 'üôà', hint: 'Nicht gefunden werden',
              distractors: ['hoch', 'reiten', 'breit', 'suchen'] },
            { english: 'explain', german: 'erkl√§ren', image: 'üë®‚Äçüè´', hint: 'Verst√§ndlich machen',
              distractors: ['beschweren', 'Flugzeug', 'erforschen', 'Beispiel'] },
            { english: 'surprised', german: '√ºberrascht, erstaunt', image: 'üò≤', hint: 'Nicht erwartet',
              distractors: ['entt√§uscht', 'umgeben', '√ºberleben', 'gelangweilt'] },
            { english: 'happen', german: 'geschehen, passieren', image: '‚ùì', hint: 'Sich ereignen',
              distractors: ['gl√ºcklich', 'fangen', 'vielleicht', 'helfen'] },
            { english: 'winner', german: 'Gewinner/in, Sieger/in', image: 'ü•á', hint: 'Wer gewinnt',
              distractors: ['Verlierer/in', 'Winter', 'Abendessen', 'Anf√§nger/in'] }
        ];

        // ===================================================================
        // GAME STATE
        // ===================================================================

        let currentWordIndex = 0;
        let score = 0;
        let correctCount = 0;
        let currentWord = '';
        let selectedLetters = [];
        let shuffledVocabulary = [];
        let wordStats = {};
        let currentWordStartTime = 0;
        let attemptCount = 0;
        let wordsToRepeat = [];
        let isRepeatPhase = false;
        let hintTimeout = null;
        let correctFirstTryCount = 0;
        let talersEarned = 0;
        let totalTalers = 0;
        let currentVocabularySet = '';
        let vocabulary = [];
        let currentMode = 'spelling'; // 'spelling' or 'mc' or 'sentence'
        let mcAnswered = false; // Prevent double-clicks in MC mode
        let roundModes = []; // Pre-assigned mode per word in the round

        // Latin-specific state
        let currentLanguage = ''; // 'english' or 'latin'
        let currentLatinChapter = null;
        let currentLatinModule = ''; // 'vocab', 'verbs', 'sentences', 'mixed'
        let latinRoundItems = []; // Pre-built round items for Latin
        let currentLatinItem = null; // Current round item being played

        // ===================================================================
        // MACRON / SPECIAL CHAR UTILITIES
        // ===================================================================

        const macronMap = { 'ƒÅ':'a', 'ƒì':'e', 'ƒ´':'i', '≈ç':'o', '≈´':'u' };
        const reverseMacronMap = { 'a':'ƒÅ', 'e':'ƒì', 'i':'ƒ´', 'o':'≈ç', 'u':'≈´' };

        function baseChar(ch) {
            return macronMap[ch.toLowerCase()] || ch.toLowerCase();
        }

        function stripMacrons(str) {
            return str.split('').map(ch => macronMap[ch.toLowerCase()] || ch).join('');
        }

        // ===================================================================
        // UTILITY FUNCTIONS
        // ===================================================================

        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        // ===================================================================
        // LEARNING PROGRESS (localStorage)
        // ===================================================================

        function loadProgress() {
            try {
                const data = localStorage.getItem('vocabProgress');
                return data ? JSON.parse(data) : {};
            } catch (e) {
                return {};
            }
        }

        function saveProgress(progress) {
            localStorage.setItem('vocabProgress', JSON.stringify(progress));
        }

        function getWordKey(item, mode) {
            // English vocabulary: direction-specific key
            if (item.english) {
                const dir = mode === 'mc' ? 'en>de' : 'de>en';
                return 'en:' + dir + ':' + item.english.toLowerCase();
            }
            // Latin vocab items: direction depends on mode
            if (item.id && item.type === 'vocab') {
                const m = mode !== undefined ? mode : item.mode;
                const dir = m === 'mc' ? 'la>de' : 'de>la';
                return 'la:' + dir + ':' + item.id;
            }
            // Latin verbs/sentences/multiword: direction already encoded in item.id
            if (item.id) {
                return 'la:' + item.id;
            }
            return null;
        }

        // Returns all possible direction keys for weighted sampling
        function getAllWordKeys(item) {
            if (item.english) {
                return [
                    'en:de>en:' + item.english.toLowerCase(),
                    'en:en>de:' + item.english.toLowerCase()
                ];
            }
            if (item.id && item.type === 'vocab') {
                return [
                    'la:de>la:' + item.id,
                    'la:la>de:' + item.id
                ];
            }
            if (item.id) {
                return ['la:' + item.id];
            }
            return [];
        }

        function recordAnswer(key, isCorrect) {
            if (!key) return;
            const progress = loadProgress();
            if (!progress[key]) {
                progress[key] = { correct: 0, wrong: 0, lastSeen: Date.now() };
            }
            if (isCorrect) {
                progress[key].correct++;
            } else {
                progress[key].wrong++;
            }
            progress[key].lastSeen = Date.now();
            saveProgress(progress);
        }

        function weightedSample(pool, n, progressData) {
            if (pool.length <= n) return shuffleArray(pool);

            const weights = pool.map(item => {
                const keys = getAllWordKeys(item);
                let totalCorrect = 0, totalWrong = 0, seen = false;
                keys.forEach(key => {
                    const prog = progressData[key];
                    if (prog) {
                        totalCorrect += prog.correct;
                        totalWrong += prog.wrong;
                        seen = true;
                    }
                });
                if (!seen) return 2.0; // Never seen ‚Üí slightly elevated
                let w = 1.0 + (totalWrong * 2.0) - (totalCorrect * 0.3);
                return Math.max(0.2, w); // Minimum 0.2
            });

            const selected = [];
            const used = new Set();

            for (let i = 0; i < n; i++) {
                // Recalculate total weight excluding used indices
                let totalWeight = 0;
                for (let j = 0; j < pool.length; j++) {
                    if (!used.has(j)) totalWeight += weights[j];
                }

                let r = Math.random() * totalWeight;
                for (let j = 0; j < pool.length; j++) {
                    if (used.has(j)) continue;
                    r -= weights[j];
                    if (r <= 0) {
                        selected.push(pool[j]);
                        used.add(j);
                        break;
                    }
                }
            }

            return shuffleArray(selected);
        }

        function resetProgress() {
            if (confirm('Lernfortschritt zur√ºcksetzen? Alle Vokabel-Statistiken werden gel√∂scht.')) {
                localStorage.removeItem('vocabProgress');
                alert('Lernfortschritt zur√ºckgesetzt!');
            }
        }

        // ===================================================================
        // NAVIGATION FUNCTIONS
        // ===================================================================

        // ===================================================================
        // CHANGELOG SPLASH ‚Äì shown once per version
        // ===================================================================

        const APP_VERSION = '2.7.0';

        const changelogEntries = [
            {
                version: '2.7.0',
                date: '27.02.2026',
                items: [
                    'üêç <b>Substantiv-Schlange</b> ‚Äì Nomen deklinieren durch Kasus√óNumerus-Grid',
                    'üé≤ <b>Gemischte Auswahl</b> ‚Äì Verben und Nomen zuf√§llig gemischt',
                    'üìê Nomen-Grid: 5√ó2 (Nom/Gen/Dat/Akk/Abl √ó Sg/Pl)',
                    'üá©üá™ Deutsche Kasusformen (der/des/dem/den) bei jedem Schritt',
                ]
            },
            {
                version: '2.6.0',
                date: '27.02.2026',
                items: [
                    'üêç <b>Neues Modul: Konjugationsschlange</b> ‚Äì Verb-Endungen spielerisch √ºben',
                    'üéØ Schlange w√§chst durchs Personen√óNumerus-Grid ‚Äì nur Endung tippen!',
                    'üìñ Beispiels√§tze zeigen Latein + Deutsch bei jedem Schritt',
                    'üèÅ Jede Schlange endet mit dem Imperativ',
                ]
            },
            {
                version: '2.5.0',
                date: '27.02.2026',
                items: [
                    'üìñ <b>Deutsche Spalte</b> im Tabellentraining ‚Äì auch Infinitiv & Deutsch als L√ºcke',
                    'üéì <b>Getrennte Tabellen</b> nach Konjugation (ƒÅ/ƒì/ƒ´/unregelm.) & Deklination (a/o)',
                    'üìà <b>Progression</b>: Erst einzelne Typen √ºben, bei 60% Trefferquote ‚Üí kombinierte Tabelle',
                ]
            },
            {
                version: '2.4.0',
                date: '27.02.2026',
                items: [
                    'üíª <b>Tabellentraining</b> ‚Äì Konjugations- & Deklinationstabellen im Terminal-Stil',
                    'üìä Komplette Kapitel-√úbersichtstabellen mit zuf√§lligen L√ºcken',
                    'üéØ Abwechselnd Verben- und Nomen-Tabellen (3-5 Felder pro Tabelle)',
                ]
            },
            {
                version: '2.3.0',
                date: '27.02.2026',
                items: [
                    '‚úçÔ∏è <b>Verb-Formen erweitert</b> ‚Äì Pr√§sens Indikativ Aktiv (alle 6 Personen) + Imperativ (Sg/Pl)',
                    'üìê <b>Neues Modul: Substantive</b> ‚Äì Nomen deklinieren (Nom/Gen/Dat/Akk/Abl √ó Sg/Pl)',
                    'üìä 18 Nomen + 32 Verben mit vollst√§ndigen Formen',
                ]
            },
            {
                version: '2.2.0',
                date: '25.02.2026',
                items: [
                    'üß† <b>Lernhorizont</b> ‚Äì schw√§chere Vokabeln kommen h√§ufiger dran',
                    'üé≠ <b>Emoji-Vorhang</b> ‚Äì bereits gekonnte W√∂rter werden verh√ºllt, Vorhang √∂ffnet sich bei Antwort',
                    'üìä Fortschritt pro √úbersetzungsrichtung (DE‚ÜíEN separat von EN‚ÜíDE)',
                    'üìà Lernstatistik pro Kapitel auf der Ergebnis-Seite (3√ó richtig = gelernt)',
                ]
            },
            {
                version: '2.1.0',
                date: '25.02.2026',
                items: [
                    'üèõÔ∏è <b>Latein Lektion 4</b> ‚Äì 42 neue Vokabeln (Diana & Verwandlung)',
                    '‚úçÔ∏è 14 Verb-Formen + 9 Beispiels√§tze f√ºr Lektion 4',
                    'üìã Changelog-Vorschaltseite (wird einmalig pro Version angezeigt)',
                ]
            },
            {
                version: '2.0.0',
                date: '25.02.2026',
                items: [
                    'üèõÔ∏è <b>Latein</b> als zweite Sprache (Lektion 3)',
                    'üî§ Makron-Support (ƒÅ, ƒì, ƒ´, ≈ç, ≈´)',
                    'üìù Vier Module: Vokabeln, Verb-Formen, Beispiels√§tze, Gemischt',
                ]
            },
        ];

        function showChangelogIfNew() {
            const seen = localStorage.getItem('changelog_seen_version');
            if (seen === APP_VERSION) return;
            document.getElementById('languageSelection').style.display = 'none';
            const container = document.getElementById('changelogContent');
            container.innerHTML = changelogEntries.map(e =>
                `<div style="margin-bottom: 16px;">
                    <div style="font-weight: bold; font-size: 1.05em; color: #4a90d9;">v${e.version} <span style="font-weight: normal; color: #999; font-size: 0.9em;">(${e.date})</span></div>
                    <ul style="margin: 6px 0 0 0; padding-left: 20px;">${e.items.map(i => `<li style="margin: 4px 0; line-height: 1.4;">${i}</li>`).join('')}</ul>
                </div>`
            ).join('');
            document.getElementById('changelogSplash').style.display = 'block';
        }

        function dismissChangelog() {
            localStorage.setItem('changelog_seen_version', APP_VERSION);
            document.getElementById('changelogSplash').style.display = 'none';
            document.getElementById('languageSelection').style.display = 'block';
        }

        // Show changelog on page load
        document.addEventListener('DOMContentLoaded', showChangelogIfNew);

        function hideAllScreens() {
            ['changelogSplash','languageSelection','setSelection','latinChapterSelection','latinModuleSelection','gameContainer'].forEach(id => {
                document.getElementById(id).style.display = 'none';
            });
        }

        function selectLanguage(lang) {
            currentLanguage = lang;
            hideAllScreens();
            if (lang === 'english') {
                document.getElementById('setSelection').style.display = 'block';
            } else if (lang === 'latin') {
                document.getElementById('latinChapterSelection').style.display = 'block';
            }
        }

        function backToLanguage() {
            hideAllScreens();
            document.getElementById('languageSelection').style.display = 'block';
        }

        function backToLatinChapters() {
            hideAllScreens();
            document.getElementById('latinChapterSelection').style.display = 'block';
        }

        function backToLatinModules() {
            hideAllScreens();
            document.getElementById('latinModuleSelection').style.display = 'block';
        }

        function backFromGame() {
            // Reset game state
            if (hintTimeout) clearTimeout(hintTimeout);
            document.getElementById('celebration').classList.remove('show');
            currentWordIndex = 0;
            score = 0;
            correctCount = 0;
            wordsToRepeat = [];
            isRepeatPhase = false;

            hideAllScreens();
            if (currentLanguage === 'english') {
                document.getElementById('setSelection').style.display = 'block';
            } else {
                document.getElementById('latinModuleSelection').style.display = 'block';
            }
        }

        function selectLatinChapter(chapter) {
            currentLatinChapter = latinData[chapter];
            hideAllScreens();
            document.getElementById('latinChapterName').textContent = currentLatinChapter.name;
            document.getElementById('latinModuleSelection').style.display = 'block';
        }

        // ===================================================================
        // GAME INITIALIZATION
        // ===================================================================

        function startGame(setChoice) {
            currentLanguage = 'english';
            if (setChoice === 'theme2') {
                vocabulary = vocabularyTheme2;
                currentVocabularySet = 'Theme 2: At School';
            } else if (setChoice === 'theme3') {
                vocabulary = vocabularyTheme3;
                currentVocabularySet = 'Theme 3: Hobbies and Activities';
            } else if (setChoice === 'all') {
                vocabulary = [...vocabularyTheme2, ...vocabularyTheme3];
                currentVocabularySet = 'Alle Vokabeln (Theme 2 + 3)';
            }

            hideAllScreens();
            document.getElementById('gameContainer').style.display = 'block';
            document.getElementById('gameTitle').textContent = 'üéÆ English Spelling Adventure';
            document.getElementById('currentSetName').textContent = currentVocabularySet;

            initGame();
        }

        // ===================================================================
        // LATIN MODULE START
        // ===================================================================

        function startLatinModule(module) {
            currentLanguage = 'latin';
            currentLatinModule = module;

            hideAllScreens();
            document.getElementById('gameContainer').style.display = 'block';
            document.getElementById('gameTitle').textContent = 'üèõÔ∏è Latein-Abenteuer';

            const ch = currentLatinChapter;
            let moduleName = '';
            if (module === 'vocab') moduleName = 'Vokabeln';
            else if (module === 'verbs') moduleName = 'Verb-Formen';
            else if (module === 'nouns') moduleName = 'Substantive';
            else if (module === 'tables') moduleName = 'Tabellentraining';
            else if (module === 'snake') moduleName = 'Konjug.- & Deklinationsssschlange';
            else if (module === 'sentences') moduleName = 'Beispiels√§tze';
            else moduleName = 'Alles gemischt';
            document.getElementById('currentSetName').textContent = ch.name + ' ‚Äì ' + moduleName;

            // Build round items for Latin
            latinRoundItems = buildLatinRoundItems(ch, module);
            if (module !== 'tables' && module !== 'snake') {
                const progress = loadProgress();
                latinRoundItems = weightedSample(latinRoundItems, Math.min(15, latinRoundItems.length), progress);
            }

            initLatinGame();
        }

        function buildLatinRoundItems(ch, module) {
            let items = [];

            if (module === 'vocab' || module === 'mixed') {
                // Single-word vocab: 70% LA‚ÜíDE, 30% DE‚ÜíLA
                ch.vocabulary.forEach(v => {
                    if (Math.random() < 0.7) {
                        // LA‚ÜíDE: MC (oder Spelling f√ºr einfache deutsche W√∂rter)
                        const isSimpleGerman = !v.german.includes(';') && !v.german.includes(',') && !v.german.includes('(') && v.german.length <= 12;
                        const mode = isSimpleGerman && Math.random() < 0.5 ? 'spelling' : 'mc';
                        items.push({
                            type: 'vocab', mode: mode,
                            prompt: v.latin, answer: v.german.toLowerCase(),
                            displayAnswer: v.german,
                            image: v.image, hint: v.hint,
                            question: 'Was bedeutet das auf Deutsch?',
                            distractors: v.distractors,
                            mcCorrect: v.german,
                            mcPrompt: v.latin,
                            mcQuestion: 'Was bedeutet dieses Wort auf Deutsch?',
                            id: 'v_' + v.latin
                        });
                    } else {
                        // DE‚ÜíLA: Spelling (deutsches Wort sehen, Latein tippen)
                        items.push({
                            type: 'vocab', mode: 'spelling',
                            prompt: v.german, answer: v.latin.toLowerCase(),
                            displayAnswer: v.latin,
                            image: v.image, hint: v.hint,
                            question: 'Wie hei√üt das auf Latein?',
                            distractors: v.distractors,
                            mcCorrect: v.german,
                            mcPrompt: v.latin,
                            mcQuestion: 'Was bedeutet dieses Wort auf Deutsch?',
                            id: 'v_' + v.latin
                        });
                    }
                });

                // Multi-word: 70% LA‚ÜíDE, 30% DE‚ÜíLA (MC)
                ch.multiWord.forEach(mw => {
                    if (Math.random() < 0.7) {
                        items.push({
                            type: 'multiword', mode: 'mc',
                            mcPrompt: mw.latin, mcCorrect: mw.german,
                            mcQuestion: 'Was bedeutet das auf Deutsch?',
                            image: 'üèõÔ∏è', hint: '',
                            distractors: mw.germanDistractors,
                            id: 'mw_lg_' + mw.latin
                        });
                    } else {
                        items.push({
                            type: 'multiword', mode: 'mc',
                            mcPrompt: mw.german, mcCorrect: mw.latin,
                            mcQuestion: 'Wie hei√üt das auf Latein?',
                            image: 'üèõÔ∏è', hint: '',
                            distractors: mw.latinDistractors,
                            id: 'mw_gl_' + mw.latin
                        });
                    }
                });
            }

            if (module === 'verbs' || module === 'mixed') {
                ch.verbForms.forEach(vf => {
                    // Random direction: infinitive‚Üí1st person or vice versa
                    const dir = Math.random() < 0.5;
                    if (dir) {
                        // Given infinitive, spell 1st person
                        items.push({
                            type: 'verb', mode: 'spelling',
                            prompt: vf.infinitive + ' (' + vf.german + ')',
                            answer: vf.firstPerson.toLowerCase(),
                            displayAnswer: vf.firstPerson,
                            image: '‚úçÔ∏è', hint: 'Bilde die 1. Person Singular',
                            question: '1. Person Singular?',
                            id: 'vf_i2f_' + vf.infinitive
                        });
                    } else {
                        // Given 1st person, spell infinitive
                        items.push({
                            type: 'verb', mode: 'spelling',
                            prompt: vf.firstPerson + ' (' + vf.german + ')',
                            answer: vf.infinitive.toLowerCase(),
                            displayAnswer: vf.infinitive,
                            image: '‚úçÔ∏è', hint: 'Bilde den Infinitiv',
                            question: 'Infinitiv?',
                            id: 'vf_f2i_' + vf.infinitive
                        });
                    }

                    // Pr√§sens Indikativ Aktiv: random person (sg2-pl3)
                    if (vf.present) {
                        const persons = [
                            { key: 'sg2', label: '2. Pers. Sg.' },
                            { key: 'sg3', label: '3. Pers. Sg.' },
                            { key: 'pl1', label: '1. Pers. Pl.' },
                            { key: 'pl2', label: '2. Pers. Pl.' },
                            { key: 'pl3', label: '3. Pers. Pl.' }
                        ];
                        const p = persons[Math.floor(Math.random() * persons.length)];
                        items.push({
                            type: 'verb', mode: 'spelling',
                            prompt: vf.infinitive + ' (' + vf.german + ')',
                            answer: vf.present[p.key].toLowerCase(),
                            displayAnswer: vf.present[p.key],
                            image: 'üìù', hint: 'Bilde die ' + p.label,
                            question: p.label + '?',
                            id: 'vf_pres_' + p.key + '_' + vf.infinitive
                        });
                    }

                    // Imperativ: random Sg/Pl
                    if (vf.imperative) {
                        const isPlural = Math.random() < 0.5;
                        const form = isPlural ? vf.imperative.pl : vf.imperative.sg;
                        const label = isPlural ? 'Imperativ Plural' : 'Imperativ Singular';
                        items.push({
                            type: 'verb', mode: 'spelling',
                            prompt: vf.infinitive + ' (' + vf.german + ')',
                            answer: form.toLowerCase(),
                            displayAnswer: form,
                            image: 'üì¢', hint: 'Bilde den ' + label,
                            question: label + '?',
                            id: 'vf_imp_' + (isPlural ? 'pl' : 'sg') + '_' + vf.infinitive
                        });
                    }
                });
            }

            if (module === 'nouns' || module === 'mixed') {
                if (ch.nouns) {
                    ch.nouns.forEach(n => {
                        const cases = [
                            { key: 'gen_sg', label: 'Genitiv Singular' },
                            { key: 'dat_sg', label: 'Dativ Singular' },
                            { key: 'akk_sg', label: 'Akkusativ Singular' },
                            { key: 'abl_sg', label: 'Ablativ Singular' },
                            { key: 'nom_pl', label: 'Nominativ Plural' },
                            { key: 'gen_pl', label: 'Genitiv Plural' },
                            { key: 'dat_pl', label: 'Dativ Plural' },
                            { key: 'akk_pl', label: 'Akkusativ Plural' },
                            { key: 'abl_pl', label: 'Ablativ Plural' }
                        ];
                        // Filter out null values (e.g. DiƒÅna has no plural)
                        const available = cases.filter(c => n[c.key]);
                        const c = available[Math.floor(Math.random() * available.length)];
                        items.push({
                            type: 'noun', mode: 'spelling',
                            prompt: n.nom_sg + ' (' + n.german + ')',
                            answer: n[c.key].toLowerCase(),
                            displayAnswer: n[c.key],
                            image: n.image, hint: 'Bilde den ' + c.label,
                            question: c.label + '?',
                            id: 'noun_' + c.key + '_' + n.nom_sg
                        });
                    });
                }
            }

            if (module === 'sentences' || module === 'mixed') {
                ch.sentences.forEach(s => {
                    items.push({
                        type: 'sentence', mode: 'sentence',
                        latinSentence: s.latin,
                        germanTemplate: s.germanTemplate,
                        answer: s.answer.toLowerCase(),
                        displayAnswer: s.answer,
                        image: s.image, hint: s.hint,
                        question: 'F√ºlle die L√ºcke aus!',
                        id: 'sent_' + s.answer
                    });
                });
            }

            if (module === 'tables') {
                const progress = loadProgress();

                // Helper: Konjugationsklasse aus Infinitiv ableiten
                function getConjugation(inf) {
                    if (inf.endsWith('ƒÅre')) return 'ƒÅ-Konjugation';
                    if (inf.endsWith('ƒìre')) return 'ƒì-Konjugation';
                    if (inf.endsWith('ƒ´re')) return 'ƒ´-Konjugation';
                    return 'unregelm√§√üig';
                }

                // Helper: Pr√ºft ob eine Sub-Tabelle gemeistert ist (>=60% Zellen mit correct>=2)
                function isTableGroupMastered(rows, tblType) {
                    let total = 0, mastered = 0;
                    rows.forEach(row => {
                        Object.keys(row).forEach(key => {
                            if (!row[key]) return;
                            total++;
                            const progKey = 'la:tbl_' + tblType.charAt(0) + '_' + key + '_' + row.label;
                            const p = progress[progKey];
                            if (p && p.correct >= 2) mastered++;
                        });
                    });
                    return total > 0 && (mastered / total) >= 0.6;
                }

                // --- Verben nach Konjugation gruppieren ---
                const conjGroups = {};
                ch.verbForms.forEach(vf => {
                    if (!vf.present) return;
                    const conj = getConjugation(vf.infinitive);
                    if (!conjGroups[conj]) conjGroups[conj] = [];
                    const row = {
                        label: vf.infinitive, german: vf.german,
                        sg1: vf.firstPerson,
                        sg2: vf.present.sg2, sg3: vf.present.sg3,
                        pl1: vf.present.pl1, pl2: vf.present.pl2, pl3: vf.present.pl3
                    };
                    if (vf.imperative) {
                        row.imp_sg = vf.imperative.sg;
                        row.imp_pl = vf.imperative.pl;
                    }
                    conjGroups[conj].push(row);
                });
                const verbSubTables = Object.keys(conjGroups).map(conj => ({
                    tableType: 'verb', conjugation: conj, rows: conjGroups[conj]
                }));

                // --- Nomen nach Deklination gruppieren ---
                const nounSubTables = [];
                if (ch.nouns) {
                    const declGroups = {};
                    ch.nouns.forEach(n => {
                        const decl = n.declension.replace(/\s*\(.*\)/, '');
                        if (!declGroups[decl]) declGroups[decl] = [];
                        const row = { label: n.nom_sg, german: n.german };
                        ['nom_sg','gen_sg','dat_sg','akk_sg','abl_sg',
                         'nom_pl','gen_pl','dat_pl','akk_pl','abl_pl'].forEach(k => {
                            row[k] = n[k] || null;
                        });
                        declGroups[decl].push(row);
                    });
                    Object.keys(declGroups).forEach(decl => {
                        if (declGroups[decl].length > 0) {
                            nounSubTables.push({ tableType: 'noun', declension: decl, rows: declGroups[decl] });
                        }
                    });
                }

                // --- Progression: einzelne oder kombinierte Tabellen ---
                const tableTypes = [];

                const allVerbsMastered = verbSubTables.length > 0 && verbSubTables.every(t => isTableGroupMastered(t.rows, 'verb'));
                if (allVerbsMastered) {
                    const allVerbRows = verbSubTables.flatMap(t => t.rows);
                    tableTypes.push({ tableType: 'verb', conjugation: 'alle Konjugationen', rows: allVerbRows });
                } else {
                    verbSubTables.filter(t => !isTableGroupMastered(t.rows, 'verb')).forEach(t => tableTypes.push(t));
                }

                const allNounsMastered = nounSubTables.length > 0 && nounSubTables.every(t => isTableGroupMastered(t.rows, 'noun'));
                if (allNounsMastered) {
                    const allNounRows = nounSubTables.flatMap(t => t.rows);
                    tableTypes.push({ tableType: 'noun', declension: 'alle Deklinationen', rows: allNounRows });
                } else {
                    nounSubTables.filter(t => !isTableGroupMastered(t.rows, 'noun')).forEach(t => tableTypes.push(t));
                }

                // --- Abwechselnd Verben/Nomen, 3-5 Felder pro Tabelle, max 15 ---
                const verbTables = shuffleArray(tableTypes.filter(t => t.tableType === 'verb'));
                const nounTables = shuffleArray(tableTypes.filter(t => t.tableType === 'noun'));
                let vIdx = 0, nIdx = 0;
                let pickVerb = Math.random() < 0.5;

                while (items.length < 15 && (verbTables.length > 0 || nounTables.length > 0)) {
                    let tbl;
                    if (pickVerb && verbTables.length > 0) {
                        tbl = verbTables[vIdx % verbTables.length]; vIdx++;
                    } else if (nounTables.length > 0) {
                        tbl = nounTables[nIdx % nounTables.length]; nIdx++;
                    } else {
                        tbl = verbTables[vIdx % verbTables.length]; vIdx++;
                    }
                    pickVerb = !pickVerb;
                    const blanksCount = 3 + Math.floor(Math.random() * 3);

                    const allCells = [];
                    tbl.rows.forEach((row, rowIdx) => {
                        Object.keys(row).forEach(key => {
                            if (!row[key]) return;
                            allCells.push({ rowIdx, key, value: row[key], rowLabel: row.label });
                        });
                    });

                    const selected = shuffleArray([...allCells]).slice(0, blanksCount);
                    selected.forEach(cell => {
                        if (items.length >= 15) return;
                        let question;
                        if (cell.key === 'label') {
                            question = tbl.rows[cell.rowIdx].german + ': ' + getTableCellLabel(cell.key) + '?';
                        } else {
                            question = cell.rowLabel + ': ' + getTableCellLabel(cell.key) + '?';
                        }
                        items.push({
                            type: 'table', mode: 'table',
                            tableType: tbl.tableType,
                            conjugation: tbl.conjugation || null,
                            declension: tbl.declension || null,
                            tableRows: tbl.rows,
                            blankRowIdx: cell.rowIdx,
                            blankKey: cell.key,
                            answer: cell.value.toLowerCase(),
                            displayAnswer: cell.value,
                            image: tbl.tableType === 'verb' ? '‚úçÔ∏è' : 'üìê',
                            hint: getTableCellLabel(cell.key),
                            question: question,
                            id: 'tbl_' + tbl.tableType.charAt(0) + '_' + cell.key + '_' + cell.rowLabel
                        });
                    });
                }
            }

            if (module === 'snake') {
                // --- KONJUGATIONS- & DEKLINATIONSSCHLANGE ---
                // Eligible verbs: present + imperative, no spaces
                const snakeVerbs = ch.verbForms.filter(vf => {
                    if (!vf.present || !vf.imperative) return false;
                    const forms = [vf.firstPerson, vf.present.sg2, vf.present.sg3, vf.present.pl1, vf.present.pl2, vf.present.pl3, vf.imperative.sg, vf.imperative.pl];
                    return forms.every(f => f && !f.includes(' '));
                });
                // Eligible nouns: all 10 case forms non-null (filters DiƒÅna)
                const snakeNouns = (ch.nouns || []).filter(n => {
                    const nounKeys = ['nom_sg','gen_sg','dat_sg','akk_sg','abl_sg','nom_pl','gen_pl','dat_pl','akk_pl','abl_pl'];
                    return nounKeys.every(k => n[k]);
                });
                // Mixed pool ‚Äì guarantee at least 1 verb + 1 noun, shuffle order
                let selected;
                if (snakeVerbs.length > 0 && snakeNouns.length > 0) {
                    const pickVerb = shuffleArray(snakeVerbs)[0];
                    const pickNoun = shuffleArray(snakeNouns)[0];
                    const rest = shuffleArray([
                        ...snakeVerbs.filter(v => v !== pickVerb).map(v => ({ ptype: 'verb', data: v })),
                        ...snakeNouns.filter(n => n !== pickNoun).map(n => ({ ptype: 'noun', data: n }))
                    ]);
                    selected = shuffleArray([
                        { ptype: 'verb', data: pickVerb },
                        { ptype: 'noun', data: pickNoun },
                        rest[0]
                    ]);
                } else {
                    const pool = [
                        ...snakeVerbs.map(vf => ({ ptype: 'verb', data: vf })),
                        ...snakeNouns.map(n => ({ ptype: 'noun', data: n }))
                    ];
                    selected = shuffleArray(pool).slice(0, 3);
                }

                selected.forEach((entry, snakeIdx) => {
                    const snakeId = 'snake_' + snakeIdx;

                    if (entry.ptype === 'verb') {
                        const verb = entry.data;
                        const path = generateSnakePath();
                        const stem = getLatinStem(verb.infinitive);
                        const ctx = getSnakeContext(verb.infinitive);
                        const previousSteps = [];

                        path.forEach((step, stepIdx) => {
                            const form = getVerbForm(verb, step.key);
                            const ending = getEnding(form, stem);
                            const sentence = makeSnakeSentence(verb, step.key, form, ctx);
                            const target = makeSnakeTarget(verb, step.key, stem, ctx);

                            let prevSentence = null;
                            if (previousSteps.length > 0) {
                                const ps = previousSteps[previousSteps.length - 1];
                                prevSentence = makeSnakeSentence(verb, ps.key, ps.form, ctx);
                            }

                            const item = {
                                type: 'snake', mode: 'snake_conjugate',
                                snakeType: 'verb',
                                snakeId: snakeId, stepIndex: stepIdx, totalSteps: path.length,
                                verb: verb, stem: stem,
                                headLabel: verb.infinitive, headDe: verb.german,
                                currentKey: step.key, fullForm: form,
                                previousSteps: JSON.parse(JSON.stringify(previousSteps)),
                                sentenceLat: sentence.lat, sentenceDe: sentence.de,
                                targetLat: target.lat, targetDe: target.de,
                                prevLat: prevSentence ? prevSentence.lat : (verb.infinitive + ' = ' + verb.german),
                                prevDe: prevSentence ? prevSentence.de : '',
                                answer: ending.toLowerCase(), displayAnswer: form,
                                image: 'üêç', hint: '',
                                id: 'snake_' + verb.infinitive + '_' + step.key
                            };

                            if (stepIdx === 0) {
                                item.instruction = 'Bilde die ' + getSnakeKeyLabel(step.key) + '!';
                            } else if (step.type === 'imperative') {
                                item.instruction = 'Bilde den Imperativ ' + (step.key === 'imp_sg' ? 'Singular' : 'Plural') + '!';
                            } else {
                                item.instruction = getSnakeInstruction(path[stepIdx - 1].key, step.key);
                            }

                            previousSteps.push({ key: step.key, form: form });
                            items.push(item);
                        });
                    } else {
                        // Noun snake
                        const noun = entry.data;
                        const path = generateNounSnakePath();
                        const stem = getNounStem(noun);
                        const previousSteps = [];

                        path.forEach((step, stepIdx) => {
                            const form = noun[step.key];
                            const ending = getEnding(form, stem);
                            const sentence = makeNounSnakeSentence(noun, step.key, form);
                            const target = makeNounSnakeTarget(noun, step.key, stem);

                            let prevSentence = null;
                            if (previousSteps.length > 0) {
                                const ps = previousSteps[previousSteps.length - 1];
                                prevSentence = makeNounSnakeSentence(noun, ps.key, ps.form);
                            }

                            const item = {
                                type: 'snake', mode: 'snake_conjugate',
                                snakeType: 'noun',
                                snakeId: snakeId, stepIndex: stepIdx, totalSteps: path.length,
                                noun: noun, stem: stem,
                                headLabel: noun.nom_sg, headDe: noun.german,
                                currentKey: step.key, fullForm: form,
                                previousSteps: JSON.parse(JSON.stringify(previousSteps)),
                                targetLat: target.lat, targetDe: target.de,
                                prevLat: prevSentence ? prevSentence.lat : (noun.nom_sg + ' = ' + noun.german),
                                prevDe: prevSentence ? prevSentence.de : '',
                                answer: ending.toLowerCase(), displayAnswer: form,
                                image: 'üêç', hint: '',
                                id: 'snake_noun_' + noun.nom_sg + '_' + step.key
                            };

                            if (stepIdx === 0) {
                                item.instruction = 'Bilde den ' + getSnakeKeyLabel(step.key) + '!';
                            } else {
                                item.instruction = getSnakeInstruction(path[stepIdx - 1].key, step.key);
                            }

                            previousSteps.push({ key: step.key, form: form });
                            items.push(item);
                        });
                    }
                });
            }

            return items;
        }

        // --- Snake Helper Functions ---

        function getLatinStem(infinitive) {
            if (infinitive.match(/[ƒÅƒìƒ´]re$/)) return infinitive.slice(0, -3);
            if (infinitive.endsWith('re')) return infinitive.slice(0, -2);
            return infinitive;
        }

        function getVerbForm(verb, key) {
            if (key === 'sg1') return verb.firstPerson;
            if (key === 'imp_sg') return verb.imperative.sg;
            if (key === 'imp_pl') return verb.imperative.pl;
            return verb.present[key];
        }

        function getEnding(form, stem) {
            const formStripped = stripMacrons(form.toLowerCase());
            const stemStripped = stripMacrons(stem.toLowerCase());
            let matchLen = 0;
            for (let i = 0; i < stemStripped.length && i < formStripped.length; i++) {
                if (formStripped[i] === stemStripped[i]) matchLen = i + 1;
                else break;
            }
            return form.slice(matchLen);
        }

        function generateSnakePath() {
            const allKeys = ['sg1','sg2','sg3','pl1','pl2','pl3'];
            const steps = [];
            let currentKey = allKeys[Math.floor(Math.random() * allKeys.length)];
            steps.push({ key: currentKey, type: 'conjugate' });

            let prevKey = null;
            const numSteps = 3 + Math.floor(Math.random() * 2);
            for (let i = 0; i < numSteps; i++) {
                const person = parseInt(currentKey.slice(2));
                const numerus = currentKey.slice(0, 2);
                let newKey;
                let attempts = 0;
                do {
                    if (Math.random() < 0.5) {
                        const others = [1,2,3].filter(p => p !== person);
                        newKey = numerus + others[Math.floor(Math.random() * others.length)];
                    } else {
                        newKey = (numerus === 'sg' ? 'pl' : 'sg') + person;
                    }
                    attempts++;
                } while ((newKey === currentKey || newKey === prevKey) && attempts < 20);
                prevKey = currentKey;
                currentKey = newKey;
                steps.push({ key: currentKey, type: 'conjugate' });
            }

            steps.push({ key: Math.random() < 0.5 ? 'imp_sg' : 'imp_pl', type: 'imperative' });
            return steps;
        }

        function generateNounSnakePath() {
            const cases = ['nom', 'gen', 'dat', 'akk', 'abl'];
            const numeri = ['sg', 'pl'];
            let currentCase = cases[Math.floor(Math.random() * cases.length)];
            let currentNum = numeri[Math.floor(Math.random() * numeri.length)];
            let currentKey = currentCase + '_' + currentNum;
            const steps = [{ key: currentKey, type: 'decline' }];
            let prevKey = null;
            const numSteps = 4 + Math.floor(Math.random() * 2); // 5-6 total
            for (let i = 0; i < numSteps; i++) {
                let newKey;
                let attempts = 0;
                do {
                    if (Math.random() < 0.5) {
                        const otherCases = cases.filter(c => c !== currentCase);
                        const newCase = otherCases[Math.floor(Math.random() * otherCases.length)];
                        newKey = newCase + '_' + currentNum;
                    } else {
                        const newNum = currentNum === 'sg' ? 'pl' : 'sg';
                        newKey = currentCase + '_' + newNum;
                    }
                    attempts++;
                } while ((newKey === currentKey || newKey === prevKey) && attempts < 20);
                prevKey = currentKey;
                currentKey = newKey;
                currentCase = newKey.split('_')[0];
                currentNum = newKey.split('_')[1];
                steps.push({ key: currentKey, type: 'decline' });
            }
            return steps;
        }

        function getNounStem(noun) {
            const keys = ['nom_sg','gen_sg','dat_sg','akk_sg','abl_sg','nom_pl','gen_pl','dat_pl','akk_pl','abl_pl'];
            const forms = keys.map(k => noun[k]).filter(f => f);
            if (forms.length === 0) return '';
            const stripped = forms.map(f => stripMacrons(f.toLowerCase()));
            let prefixLen = stripped[0].length;
            for (let i = 1; i < stripped.length; i++) {
                let match = 0;
                for (let j = 0; j < prefixLen && j < stripped[i].length; j++) {
                    if (stripped[0][j] === stripped[i][j]) match = j + 1;
                    else break;
                }
                prefixLen = match;
            }
            return forms[0].slice(0, prefixLen);
        }

        function getGermanCaseForm(noun, key) {
            const germanNom = noun.german;
            const parts = germanNom.trim().split(/\s+/);
            const article = parts[0].toLowerCase();
            const nounSg = parts.slice(1).join(' ');
            const nounPl = noun.germanPl || nounSg;
            if (!['der', 'die', 'das'].includes(article)) {
                return germanNom; // proper names unchanged
            }
            const genus = article === 'der' ? 'm' : article === 'die' ? 'f' : 'n';
            const articlesSg = {
                m: { nom: 'der', gen: 'des', dat: 'dem', akk: 'den', abl: 'dem' },
                f: { nom: 'die', gen: 'der', dat: 'der', akk: 'die', abl: 'der' },
                n: { nom: 'das', gen: 'des', dat: 'dem', akk: 'das', abl: 'dem' }
            };
            const articlesPl = { nom: 'die', gen: 'der', dat: 'den', akk: 'die', abl: 'den' };
            const caseName = key.split('_')[0];
            const num = key.split('_')[1];
            let nounForm = num === 'pl' ? nounPl : nounSg;
            // Genitive singular: add -s for masculine/neuter
            if (caseName === 'gen' && num === 'sg' && (genus === 'm' || genus === 'n')) {
                if (genus === 'm' && nounSg.endsWith('e')) {
                    nounForm = nounSg + 'n'; // weak masculine: der Gef√§hrte ‚Üí des Gef√§hrten
                } else if (!nounSg.endsWith('s') && !nounSg.endsWith('√ü')) {
                    nounForm = nounSg + 's';
                }
            }
            // Dative/ablative plural: add -n if not already ending in -n/-s
            if ((caseName === 'dat' || caseName === 'abl') && num === 'pl') {
                if (!nounForm.endsWith('n') && !nounForm.endsWith('s')) {
                    nounForm = nounForm + 'n';
                }
            }
            const newArticle = num === 'pl' ? articlesPl[caseName] : articlesSg[genus][caseName];
            return newArticle + ' ' + nounForm;
        }

        function makeNounSnakeSentence(noun, key, form) {
            const caseName = key.split('_')[0];
            const germanCase = getGermanCaseForm(noun, key);
            switch (caseName) {
                case 'nom':
                    return { lat: 'Ecce ' + form + '!', de: 'Sieh, ' + germanCase + '!' };
                case 'gen':
                    return { lat: 'Dominus ' + form + ' venit.', de: 'Der Herr ' + germanCase + ' kommt.' };
                case 'dat':
                    return { lat: form + ' grƒÅtiƒÅs ag≈ç.', de: 'Ich danke ' + germanCase + '.' };
                case 'akk':
                    return { lat: form + ' vide≈ç.', de: 'Ich sehe ' + germanCase + '.' };
                case 'abl':
                    return { lat: 'Cum ' + form + ' veni≈ç.', de: 'Ich komme mit ' + germanCase + '.' };
                default:
                    return { lat: form, de: germanCase };
            }
        }

        function makeNounSnakeTarget(noun, key, stem) {
            const caseName = key.split('_')[0];
            const blankStem = stem + '___';
            const form = noun[key];
            const full = makeNounSnakeSentence(noun, key, form);
            let lat;
            switch (caseName) {
                case 'nom': lat = 'Ecce ' + blankStem + '!'; break;
                case 'gen': lat = 'Dominus ' + blankStem + ' venit.'; break;
                case 'dat': lat = blankStem + ' grƒÅtiƒÅs ag≈ç.'; break;
                case 'akk': lat = blankStem + ' vide≈ç.'; break;
                case 'abl': lat = 'Cum ' + blankStem + ' veni≈ç.'; break;
                default: lat = blankStem;
            }
            return { lat: lat, de: full.de };
        }

        function getSnakeKeyLabel(key) {
            const labels = {
                sg1: '1. Person Singular', sg2: '2. Person Singular', sg3: '3. Person Singular',
                pl1: '1. Person Plural', pl2: '2. Person Plural', pl3: '3. Person Plural',
                imp_sg: 'Imperativ Singular', imp_pl: 'Imperativ Plural',
                nom_sg: 'Nominativ Singular', nom_pl: 'Nominativ Plural',
                gen_sg: 'Genitiv Singular', gen_pl: 'Genitiv Plural',
                dat_sg: 'Dativ Singular', dat_pl: 'Dativ Plural',
                akk_sg: 'Akkusativ Singular', akk_pl: 'Akkusativ Plural',
                abl_sg: 'Ablativ Singular', abl_pl: 'Ablativ Plural'
            };
            return labels[key] || key;
        }

        function getSnakeKeyShort(key) {
            const labels = {
                sg1: '1.Sg.', sg2: '2.Sg.', sg3: '3.Sg.',
                pl1: '1.Pl.', pl2: '2.Pl.', pl3: '3.Pl.',
                imp_sg: 'Imp.Sg.', imp_pl: 'Imp.Pl.',
                nom_sg: 'Nom.Sg.', nom_pl: 'Nom.Pl.',
                gen_sg: 'Gen.Sg.', gen_pl: 'Gen.Pl.',
                dat_sg: 'Dat.Sg.', dat_pl: 'Dat.Pl.',
                akk_sg: 'Akk.Sg.', akk_pl: 'Akk.Pl.',
                abl_sg: 'Abl.Sg.', abl_pl: 'Abl.Pl.'
            };
            return labels[key] || key;
        }

        function getSnakeInstruction(fromKey, toKey) {
            if (toKey.startsWith('imp')) {
                return 'Bilde den Imperativ ' + (toKey === 'imp_sg' ? 'Singular' : 'Plural') + '!';
            }
            // Noun keys (contain '_' and not imp)
            if (toKey.includes('_')) {
                const fromParts = fromKey.split('_');
                const toParts = toKey.split('_');
                const caseNames = { nom: 'Nominativ', gen: 'Genitiv', dat: 'Dativ', akk: 'Akkusativ', abl: 'Ablativ' };
                if (fromParts[1] !== toParts[1]) {
                    return 'Jetzt wechsle in den ' + (toParts[1] === 'sg' ? 'Singular' : 'Plural') + '!';
                }
                return 'Jetzt wechsle in den ' + caseNames[toParts[0]] + '!';
            }
            // Verb keys
            const fromN = fromKey.slice(0, 2);
            const toP = parseInt(toKey.slice(2));
            const toN = toKey.slice(0, 2);
            const personNames = {1:'1. Person', 2:'2. Person', 3:'3. Person'};
            if (fromN !== toN) {
                return 'Jetzt wechsle in den ' + (toN === 'sg' ? 'Singular' : 'Plural') + '!';
            }
            return 'Jetzt wechsle in die ' + personNames[toP] + '!';
        }

        // Satz-Kontexte f√ºr jedes Verb (Latein-Objekt + deutsches Objekt)
        function getSnakeContext(infinitive) {
            const contexts = {
                // Lektion 3
                'narrƒÅre': { latObj: 'FƒÅbulam', deObj: 'eine Geschichte' },
                'parƒÅre': { latObj: 'Cƒìnam', deObj: 'das Essen' },
                'sustinƒìre': { latObj: 'Lab≈çrem', deObj: 'die M√ºhe' },
                'prohibƒìre': { latObj: 'Servum', deObj: 'den Sklaven', deExplicit: {
                    sg1:'Ich halte den Sklaven ab.', sg2:'Du h√§ltst den Sklaven ab.',
                    sg3:'Er/Sie h√§lt den Sklaven ab.', pl1:'Wir halten den Sklaven ab.',
                    pl2:'Ihr haltet den Sklaven ab.', pl3:'Sie halten den Sklaven ab.',
                    imp_sg:'Halte den Sklaven ab!', imp_pl:'Haltet den Sklaven ab!'} },
                'respondƒìre': { latObj: 'Magistr≈ç', deObj: 'dem Lehrer' },
                'indicƒÅre': { latObj: 'Viam', deObj: 'den Weg' },
                'negƒÅre': { latObj: 'Culpam', deObj: 'die Schuld' },
                'probƒÅre': { latObj: 'C≈çnsilium', deObj: 'den Plan' },
                'pr≈çvidƒìre': { latObj: 'Pr≈ç familiƒÅ', deObj: 'f√ºr die Familie' },
                'vocƒÅre': { latObj: 'Amƒ´cum', deObj: 'den Freund' },
                'superƒÅre': { latObj: 'Hostƒìs', deObj: 'die Feinde' },
                'temptƒÅre': { latObj: 'Fort≈´nam', deObj: 'das Gl√ºck' },
                'cavƒìre': { latObj: 'Perƒ´culum', deObj: '', deExplicit: {
                    sg1:'Ich meide die Gefahr.', sg2:'Du meidest die Gefahr.',
                    sg3:'Er/Sie meidet die Gefahr.', pl1:'Wir meiden die Gefahr.',
                    pl2:'Ihr meidet die Gefahr.', pl3:'Sie meiden die Gefahr.',
                    imp_sg:'Meide die Gefahr!', imp_pl:'Meidet die Gefahr!'} },
                'placƒìre': { latObj: 'Domin≈ç', deObj: 'dem Herrn', deExplicit: {
                    sg1:'Ich gefalle dem Herrn.', sg2:'Du gef√§llst dem Herrn.',
                    sg3:'Er/Sie gef√§llt dem Herrn.', pl1:'Wir gefallen dem Herrn.',
                    pl2:'Ihr gefallt dem Herrn.', pl3:'Sie gefallen dem Herrn.',
                    imp_sg:'Gefalle dem Herrn!', imp_pl:'Gefallt dem Herrn!'} },
                'pƒÅrƒìre': { latObj: 'Magistr≈ç', deObj: 'dem Lehrer' },
                'mandƒÅre': { latObj: 'Epistulam', deObj: 'den Brief', deExplicit: {
                    sg1:'Ich √ºbergebe den Brief.', sg2:'Du √ºbergibst den Brief.',
                    sg3:'Er/Sie √ºbergibt den Brief.', pl1:'Wir √ºbergeben den Brief.',
                    pl2:'Ihr √ºbergebt den Brief.', pl3:'Sie √ºbergeben den Brief.',
                    imp_sg:'√úbergib den Brief!', imp_pl:'√úbergebt den Brief!'} },
                // Lektion 4
                'movƒìre': { latObj: 'Saxum', deObj: 'den Stein' },
                'nƒìscƒ´re': { latObj: 'Viam', deObj: '', deExplicit: {
                    sg1:'Ich wei√ü den Weg nicht.', sg2:'Du wei√üt den Weg nicht.',
                    sg3:'Er/Sie wei√ü den Weg nicht.', pl1:'Wir wissen den Weg nicht.',
                    pl2:'Ihr wisst den Weg nicht.', pl3:'Sie wissen den Weg nicht.',
                    imp_sg:'Wisse es nicht!', imp_pl:'Wisst es nicht!'} },
                'amƒÅre': { latObj: 'Patriam', deObj: 'die Heimat' },
                'timƒìre': { latObj: 'Perƒ´culum', deObj: 'die Gefahr' },
                'sentƒ´re': { latObj: 'Dol≈çrem', deObj: 'den Schmerz' },
                'ƒÅrdƒìre': { latObj: 'ƒ™rƒÅ', deObj: 'vor Wut' },
                'appellƒÅre': { latObj: 'Amƒ´cum', deObj: 'den Freund' },
                'agitƒÅre': { latObj: 'Equum', deObj: 'das Pferd' },
                'terrƒìre': { latObj: 'Hostƒìs', deObj: 'die Feinde' },
                'vƒ´tƒÅre': { latObj: 'Perƒ´culum', deObj: 'die Gefahr' },
                'm≈´tƒÅre': { latObj: 'C≈çnsilium', deObj: 'den Plan' },
                'circumvenƒ´re': { latObj: 'Hostƒìs', deObj: 'die Feinde' },
            };
            return contexts[infinitive] || { latObj: '', deObj: '' };
        }

        function conjugateGermanSimple(germanInf, key) {
            const clean = germanInf.replace(/\s*\(.*?\)/g, '').replace(/^sich\s+/, '').replace(/\s+f√ºr$/, '').trim();
            const stem = clean.replace(/en$/, '').replace(/n$/, '');
            const needsE = stem.endsWith('t') || stem.endsWith('d');
            const endings = {
                sg1: 'e', sg2: needsE ? 'est' : 'st', sg3: needsE ? 'et' : 't',
                pl1: 'en', pl2: needsE ? 'et' : 't', pl3: 'en',
                imp_sg: 'e', imp_pl: needsE ? 'et' : 't'
            };
            return stem + (endings[key] || 'en');
        }

        function makeSnakeSentence(verb, key, form, ctx) {
            // If explicit German provided, use it
            if (ctx.deExplicit && ctx.deExplicit[key]) {
                const latSentence = ctx.latObj ? (ctx.latObj + ' ' + form + (key.startsWith('imp') ? '!' : '.')) : (form + (key.startsWith('imp') ? '!' : '.'));
                return { lat: latSentence, de: ctx.deExplicit[key] };
            }

            const subjects = { sg1:'Ich', sg2:'Du', sg3:'Er/Sie', pl1:'Wir', pl2:'Ihr', pl3:'Sie' };
            const deVerb = conjugateGermanSimple(verb.german, key);
            const latSentence = ctx.latObj ? (ctx.latObj + ' ' + form + (key.startsWith('imp') ? '!' : '.')) : (form + (key.startsWith('imp') ? '!' : '.'));

            let deSentence;
            if (key === 'imp_sg' || key === 'imp_pl') {
                deSentence = deVerb.charAt(0).toUpperCase() + deVerb.slice(1) + (ctx.deObj ? ' ' + ctx.deObj : '') + '!';
            } else {
                deSentence = subjects[key] + ' ' + deVerb + (ctx.deObj ? ' ' + ctx.deObj : '') + '.';
            }
            return { lat: latSentence, de: deSentence };
        }

        function makeSnakeTarget(verb, key, stem, ctx) {
            const blankStem = stem + '___';
            const latBlank = ctx.latObj ? (ctx.latObj + ' ' + blankStem + (key.startsWith('imp') ? '!' : '.')) : (blankStem + (key.startsWith('imp') ? '!' : '.'));
            const form = getVerbForm(verb, key);
            const full = makeSnakeSentence(verb, key, form, ctx);
            return { lat: latBlank, de: full.de };
        }

        function getTableCellLabel(key) {
            const labels = {
                label: 'Latein', german: 'Deutsch',
                sg1: '1.Sg.', sg2: '2.Sg.', sg3: '3.Sg.',
                pl1: '1.Pl.', pl2: '2.Pl.', pl3: '3.Pl.',
                imp_sg: 'Imp.Sg.', imp_pl: 'Imp.Pl.',
                nom_sg: 'Nom.Sg.', gen_sg: 'Gen.Sg.', dat_sg: 'Dat.Sg.',
                akk_sg: 'Akk.Sg.', abl_sg: 'Abl.Sg.',
                nom_pl: 'Nom.Pl.', gen_pl: 'Gen.Pl.', dat_pl: 'Dat.Pl.',
                akk_pl: 'Akk.Pl.', abl_pl: 'Abl.Pl.',
            };
            return labels[key] || key;
        }

        function initLatinGame() {
            currentWordIndex = 0;
            score = 0;
            correctCount = 0;
            wordsToRepeat = [];
            isRepeatPhase = false;
            wordStats = {};
            currentWord = '';
            selectedLetters = [];

            const savedTalers = localStorage.getItem('vocabularyGameTalers');
            totalTalers = savedTalers ? parseInt(savedTalers) : 0;
            document.getElementById('totalTalers').textContent = totalTalers;
            document.getElementById('score').textContent = '0';
            document.getElementById('correct').textContent = '0';
            document.getElementById('repeats').textContent = '0';

            correctFirstTryCount = 0;
            talersEarned = 0;

            // Use latinRoundItems as our shuffledVocabulary equivalent
            shuffledVocabulary = latinRoundItems;

            shuffledVocabulary.forEach(item => {
                wordStats[item.id] = {
                    attempts: 0, mistakes: 0, totalTime: 0, correctOnFirstTry: false
                };
            });

            document.getElementById('total').textContent = shuffledVocabulary.length;
            loadLatinWord();
        }

        // ===================================================================
        // ENGLISH GAME INITIALIZATION
        // ===================================================================

        function initGame() {
            currentWordIndex = 0;
            score = 0;
            correctCount = 0;
            wordsToRepeat = [];
            isRepeatPhase = false;
            wordStats = {};

            const progress = loadProgress();
            shuffledVocabulary = weightedSample(vocabulary, 15, progress);

            // Assign random mode per word for this round
            roundModes = shuffledVocabulary.map(() => Math.random() < 0.5 ? 'spelling' : 'mc');

            const savedTalers = localStorage.getItem('vocabularyGameTalers');
            if (savedTalers) {
                totalTalers = parseInt(savedTalers);
            } else {
                totalTalers = 0;
            }

            document.getElementById('totalTalers').textContent = totalTalers;
            document.getElementById('score').textContent = '0';
            document.getElementById('correct').textContent = '0';
            document.getElementById('repeats').textContent = '0';

            correctFirstTryCount = 0;
            talersEarned = 0;

            shuffledVocabulary.forEach(word => {
                wordStats[word.english] = {
                    attempts: 0,
                    mistakes: 0,
                    totalTime: 0,
                    correctOnFirstTry: false
                };
            });

            document.getElementById('total').textContent = shuffledVocabulary.length;
            loadWord();
        }

        // ===================================================================
        // TALER MANAGEMENT
        // ===================================================================

        function resetTalersFromMenu() {
            if (confirm('M√∂chtest du wirklich alle Taler zur√ºcksetzen? Dies kann nicht r√ºckg√§ngig gemacht werden.')) {
                localStorage.setItem('vocabularyGameTalers', '0');
                totalTalers = 0;
                document.getElementById('displayTalersMain').textContent = '0';
                alert('Taler wurden zur√ºckgesetzt! Viel Erfolg beim n√§chsten Mal! ü™ô');
            }
        }

        function resetTalers() {
            if (confirm('M√∂chtest du wirklich alle Taler zur√ºcksetzen? Dies kann nicht r√ºckg√§ngig gemacht werden.')) {
                localStorage.setItem('vocabularyGameTalers', '0');
                totalTalers = 0;
                document.getElementById('totalTalers').textContent = '0';
                alert('Taler wurden zur√ºckgesetzt! Viel Erfolg beim n√§chsten Mal! ü™ô');
            }
        }

        window.addEventListener('DOMContentLoaded', () => {
            const savedTalers = localStorage.getItem('vocabularyGameTalers');
            if (savedTalers) {
                totalTalers = parseInt(savedTalers);
                document.getElementById('displayTalersMain').textContent = totalTalers;
            }
        });

        // ===================================================================
        // LATIN WORD LOADING
        // ===================================================================

        function loadLatinWord() {
            // Check if finished
            if (!isRepeatPhase && currentWordIndex >= shuffledVocabulary.length) {
                if (wordsToRepeat.length > 0) {
                    isRepeatPhase = true;
                    currentWordIndex = 0;
                    shuffledVocabulary = wordsToRepeat;
                    wordsToRepeat = [];
                    document.getElementById('total').textContent = shuffledVocabulary.length;
                    document.getElementById('feedback').textContent = 'üîÑ Jetzt wiederholen wir die schwierigen Vokabeln!';
                    document.getElementById('feedback').className = 'feedback';
                    document.getElementById('feedback').style.color = '';
                    document.getElementById('feedback').style.fontSize = '';
                    setTimeout(() => {
                        document.getElementById('feedback').textContent = '';
                        loadLatinWord();
                    }, 2000);
                    return;
                } else {
                    showCelebration();
                    return;
                }
            }
            if (isRepeatPhase && currentWordIndex >= shuffledVocabulary.length) {
                showCelebration();
                return;
            }

            if (hintTimeout) clearTimeout(hintTimeout);

            const item = shuffledVocabulary[currentWordIndex];
            currentLatinItem = item;
            attemptCount = 0;
            mcAnswered = false;
            currentWordStartTime = Date.now();

            document.getElementById('current').textContent = currentWordIndex + 1;
            document.getElementById('feedback').textContent = '';
            document.getElementById('feedback').className = 'feedback';
            document.getElementById('feedback').style.color = '';
            document.getElementById('feedback').style.fontSize = '';
            document.getElementById('autoHint').textContent = '';
            document.getElementById('autoHint').className = 'auto-hint';
            document.getElementById('mcContinueBtn').style.display = 'none';

            // Curtain logic: hide emoji if already answered correctly before (not in repeat phase)
            const curtain = document.getElementById('emojiCurtain');
            if (!isRepeatPhase) {
                const itemKey = getWordKey(item);
                const prog = loadProgress()[itemKey];
                if (prog && prog.correct >= 1) {
                    curtain.classList.add('active');
                    curtain.classList.remove('reveal');
                } else {
                    curtain.classList.remove('active', 'reveal');
                }
            } else {
                curtain.classList.remove('active', 'reveal');
            }

            // Hide all areas first
            document.getElementById('spellingArea').style.display = 'none';
            document.getElementById('mcArea').style.display = 'none';
            document.getElementById('sentenceArea').style.display = 'none';
            document.getElementById('tableArea').style.display = 'none';
            document.getElementById('snakeArea').style.display = 'none';
            document.getElementById('spellingButtons').style.display = 'none';
            document.getElementById('tipText').style.display = 'none';

            // Word card: hide for table/snake mode, show for others
            const wordCard = document.querySelector('.word-card');
            if (item.mode === 'table') {
                wordCard.style.display = 'none';
                loadLatinTable(item);
                return;
            }
            if (item.mode === 'snake_conjugate') {
                wordCard.style.display = 'none';
                loadLatinSnake(item);
                return;
            }
            wordCard.style.display = '';

            if (item.mode === 'mc') {
                loadLatinMC(item);
            } else if (item.mode === 'sentence') {
                loadLatinSentence(item);
            } else {
                // Spelling mode for vocab or verbs or nouns
                loadLatinSpelling(item);
            }

            // Hint timer (only for spelling/sentence)
            if (item.mode !== 'mc') {
                hintTimeout = setTimeout(() => {
                    const autoHintEl = document.getElementById('autoHint');
                    if (item.hint) {
                        autoHintEl.textContent = 'üí° ' + item.hint;
                        autoHintEl.className = 'auto-hint show';
                    }
                }, 15000);
            }
        }

        function loadLatinSpelling(item) {
            currentMode = 'spelling';
            currentWord = item.answer;

            document.getElementById('wordImage').textContent = item.image;
            document.getElementById('wordGerman').textContent = item.prompt;
            document.getElementById('wordHint').textContent = item.question;

            document.getElementById('spellingArea').style.display = 'block';
            document.getElementById('spellingButtons').style.display = 'flex';
            document.getElementById('tipText').style.display = 'block';

            document.getElementById('skipBtn').style.display = 'inline-block';
            document.getElementById('checkBtn').style.display = 'inline-block';
            document.getElementById('clearBtn').style.display = 'inline-block';
            document.getElementById('continueBtn').style.display = 'none';

            selectedLetters = [];
            createLatinAnswerSlots();
            createLatinLetterPool();
        }

        function createLatinAnswerSlots() {
            const answerArea = document.getElementById('answerArea');
            answerArea.innerHTML = '';
            for (let i = 0; i < currentWord.length; i++) {
                const slot = document.createElement('div');
                slot.className = 'letter-slot';
                slot.dataset.index = i;
                slot.addEventListener('click', () => removeLetterFromSlot(i));
                answerArea.appendChild(slot);
            }
        }

        function createLatinLetterPool() {
            const lettersPool = document.getElementById('lettersPool');
            lettersPool.innerHTML = '';

            // Use the display version of the answer to get macron chars for tiles
            const displayWord = currentLatinItem.displayAnswer || currentWord;
            const wordLetters = displayWord.toLowerCase().split('');

            // Add some extra distractor letters
            const latinLetters = 'abcdefghiklmnopqrstuvx';
            const numExtras = Math.min(5, Math.floor(currentWord.length / 2) + 2);
            for (let i = 0; i < numExtras; i++) {
                let randomLetter;
                do {
                    randomLetter = latinLetters[Math.floor(Math.random() * latinLetters.length)];
                } while (wordLetters.some(l => baseChar(l) === randomLetter));
                wordLetters.push(randomLetter);
            }

            const shuffledLetters = shuffleArray(wordLetters);

            shuffledLetters.forEach((letter, index) => {
                const tile = document.createElement('div');
                tile.className = 'letter-tile';
                tile.textContent = letter.toUpperCase();
                tile.dataset.letter = letter;
                tile.dataset.base = baseChar(letter);
                tile.dataset.id = index;
                tile.addEventListener('click', () => selectLatinLetter(letter, index));
                lettersPool.appendChild(tile);
            });
        }

        function selectLatinLetter(letter, id) {
            if (selectedLetters.length >= currentWord.length) return;
            const tile = document.querySelector(`[data-id="${id}"]`);
            if (tile.classList.contains('used')) return;
            selectedLetters.push({ letter, id });
            tile.classList.add('used');
            updateAnswerArea();
        }

        function checkLatinSpelling() {
            const answer = selectedLetters.map(l => baseChar(l.letter)).join('');
            const expected = stripMacrons(currentWord);
            const slots = document.querySelectorAll('#answerArea .letter-slot');
            const feedback = document.getElementById('feedback');

            if (hintTimeout) clearTimeout(hintTimeout);
            attemptCount++;

            let correctLetters = 0;
            slots.forEach((slot, index) => {
                if (selectedLetters[index]) {
                    if (baseChar(selectedLetters[index].letter) === baseChar(currentWord[index])) {
                        slot.classList.add('correct');
                        slot.classList.remove('wrong');
                        correctLetters++;
                    } else {
                        slot.classList.add('wrong');
                        slot.classList.remove('correct');
                    }
                }
            });

            const timeElapsed = (Date.now() - currentWordStartTime) / 1000;
            const stats = wordStats[currentLatinItem.id];
            stats.attempts++;

            if (answer === expected && correctLetters === currentWord.length) {
                stats.totalTime += timeElapsed;
                recordAnswer(getWordKey(currentLatinItem), true);
                document.getElementById('emojiCurtain').classList.add('reveal');
                handleCorrectAnswer(stats, timeElapsed);
                setTimeout(() => { currentWordIndex++; loadLatinWord(); }, 2000);
            } else {
                stats.mistakes++;
                recordAnswer(getWordKey(currentLatinItem), false);
                document.getElementById('emojiCurtain').classList.add('reveal');
                feedback.textContent = '‚ùå Das ist leider nicht richtig. Versuch es nochmal!';
                feedback.className = 'feedback wrong';
                playSound('wrong');
                setTimeout(() => {
                    slots.forEach(slot => { slot.classList.remove('wrong'); slot.classList.remove('correct'); });
                }, 1500);
            }
        }

        function loadLatinMC(item) {
            currentMode = 'mc';
            currentWord = item.id; // use id for stats tracking

            document.getElementById('wordImage').textContent = item.image || 'üèõÔ∏è';
            document.getElementById('wordGerman').textContent = item.mcPrompt;
            document.getElementById('wordHint').textContent = item.mcQuestion;

            document.getElementById('mcArea').style.display = 'block';

            // Build MC options
            const correctAnswer = item.mcCorrect;
            const distractors = item.distractors || [];
            let options = [{ text: correctAnswer, correct: true }];
            distractors.forEach(d => options.push({ text: d, correct: false }));
            options = shuffleArray(options);

            const mcContainer = document.getElementById('mcOptions');
            mcContainer.innerHTML = '';
            options.forEach((opt, idx) => {
                const optDiv = document.createElement('div');
                optDiv.className = 'mc-option';
                optDiv.dataset.index = idx;
                optDiv.dataset.correct = opt.correct;
                optDiv.innerHTML = `<span class="mc-key">${idx + 1}</span><span class="mc-text">${opt.text}</span>`;
                optDiv.addEventListener('click', () => selectLatinMC(idx));
                mcContainer.appendChild(optDiv);
            });
        }

        function selectLatinMC(index) {
            if (mcAnswered) return;
            mcAnswered = true;
            if (hintTimeout) clearTimeout(hintTimeout);
            attemptCount++;

            const options = document.querySelectorAll('.mc-option');
            const selectedOption = options[index];
            const isCorrect = selectedOption.dataset.correct === 'true';
            const feedback = document.getElementById('feedback');
            const timeElapsed = (Date.now() - currentWordStartTime) / 1000;
            const stats = wordStats[currentLatinItem.id];
            stats.attempts++;

            options.forEach(opt => opt.classList.add('mc-disabled'));
            options.forEach(opt => {
                if (opt.dataset.correct === 'true') opt.classList.add('mc-correct');
            });

            if (isCorrect) {
                stats.totalTime += timeElapsed;
                recordAnswer(getWordKey(currentLatinItem), true);
                document.getElementById('emojiCurtain').classList.add('reveal');
                handleCorrectAnswer(stats, timeElapsed);
                setTimeout(() => { currentWordIndex++; loadLatinWord(); }, 2000);
            } else {
                selectedOption.classList.add('mc-wrong');
                stats.mistakes++;
                recordAnswer(getWordKey(currentLatinItem), false);
                document.getElementById('emojiCurtain').classList.add('reveal');
                feedback.textContent = '';
                feedback.className = 'feedback';
                playSound('wrong');
                if (!isRepeatPhase) addLatinToRepeatList();
                document.getElementById('mcContinueBtn').style.display = 'inline-block';
            }
        }

        function loadLatinSentence(item) {
            currentMode = 'sentence';
            currentWord = item.answer;

            document.getElementById('wordImage').textContent = item.image;
            document.getElementById('wordGerman').textContent = '';
            document.getElementById('wordHint').textContent = item.question;

            // Show sentence area
            document.getElementById('sentenceArea').style.display = 'block';
            document.getElementById('sentenceLatin').textContent = item.latinSentence;
            document.getElementById('sentenceTemplate').textContent = item.germanTemplate;

            // Show spelling buttons for sentence
            document.getElementById('spellingButtons').style.display = 'flex';
            document.getElementById('tipText').style.display = 'block';
            document.getElementById('skipBtn').style.display = 'inline-block';
            document.getElementById('checkBtn').style.display = 'inline-block';
            document.getElementById('clearBtn').style.display = 'inline-block';
            document.getElementById('continueBtn').style.display = 'none';

            selectedLetters = [];

            // Build answer slots and letter pool inside sentenceSpellingArea
            const answerArea = document.getElementById('sentenceAnswerArea');
            answerArea.innerHTML = '';
            for (let i = 0; i < currentWord.length; i++) {
                const slot = document.createElement('div');
                slot.className = 'letter-slot';
                slot.dataset.index = i;
                slot.addEventListener('click', () => removeSentenceLetterFromSlot(i));
                answerArea.appendChild(slot);
            }

            const lettersPool = document.getElementById('sentenceLettersPool');
            lettersPool.innerHTML = '';

            const wordLetters = currentWord.split('');
            const extraLetters = 'abcdefghijklmnopqrstuvwxyz√§√∂√º';
            const numExtras = Math.min(4, Math.floor(currentWord.length / 2) + 2);
            for (let i = 0; i < numExtras; i++) {
                let rl;
                do { rl = extraLetters[Math.floor(Math.random() * extraLetters.length)]; }
                while (wordLetters.includes(rl));
                wordLetters.push(rl);
            }

            const shuffledLetters = shuffleArray(wordLetters);
            shuffledLetters.forEach((letter, index) => {
                const tile = document.createElement('div');
                tile.className = 'letter-tile';
                tile.textContent = letter.toUpperCase();
                tile.dataset.letter = letter;
                tile.dataset.id = index;
                tile.addEventListener('click', () => selectSentenceLetter(letter, index));
                lettersPool.appendChild(tile);
            });
        }

        function selectSentenceLetter(letter, id) {
            if (selectedLetters.length >= currentWord.length) return;
            const tile = document.querySelector(`#sentenceLettersPool [data-id="${id}"]`);
            if (!tile || tile.classList.contains('used')) return;
            selectedLetters.push({ letter, id });
            tile.classList.add('used');
            updateSentenceAnswerArea();
        }

        function updateSentenceAnswerArea() {
            const slots = document.querySelectorAll('#sentenceAnswerArea .letter-slot');
            slots.forEach((slot, index) => {
                if (selectedLetters[index]) {
                    slot.textContent = selectedLetters[index].letter.toUpperCase();
                    slot.classList.add('filled');
                } else {
                    slot.textContent = '';
                    slot.classList.remove('filled');
                }
            });
        }

        function removeSentenceLetterFromSlot(index) {
            if (index >= selectedLetters.length) return;
            const removed = selectedLetters[index];
            const tile = document.querySelector(`#sentenceLettersPool [data-id="${removed.id}"]`);
            if (tile) tile.classList.remove('used');
            selectedLetters.splice(index, 1);
            updateSentenceAnswerArea();
        }

        function checkLatinSentence() {
            const answer = selectedLetters.map(l => l.letter).join('');
            const slots = document.querySelectorAll('#sentenceAnswerArea .letter-slot');
            const feedback = document.getElementById('feedback');

            if (hintTimeout) clearTimeout(hintTimeout);
            attemptCount++;

            let correctLetters = 0;
            slots.forEach((slot, index) => {
                if (selectedLetters[index]) {
                    if (selectedLetters[index].letter === currentWord[index]) {
                        slot.classList.add('correct'); slot.classList.remove('wrong');
                        correctLetters++;
                    } else {
                        slot.classList.add('wrong'); slot.classList.remove('correct');
                    }
                }
            });

            const timeElapsed = (Date.now() - currentWordStartTime) / 1000;
            const stats = wordStats[currentLatinItem.id];
            stats.attempts++;

            if (answer === currentWord && correctLetters === currentWord.length) {
                stats.totalTime += timeElapsed;
                recordAnswer(getWordKey(currentLatinItem), true);
                document.getElementById('emojiCurtain').classList.add('reveal');
                handleCorrectAnswer(stats, timeElapsed);
                setTimeout(() => { currentWordIndex++; loadLatinWord(); }, 2000);
            } else {
                stats.mistakes++;
                recordAnswer(getWordKey(currentLatinItem), false);
                document.getElementById('emojiCurtain').classList.add('reveal');
                feedback.textContent = '‚ùå Das ist leider nicht richtig. Versuch es nochmal!';
                feedback.className = 'feedback wrong';
                playSound('wrong');
                setTimeout(() => {
                    slots.forEach(slot => { slot.classList.remove('wrong'); slot.classList.remove('correct'); });
                }, 1500);
            }
        }

        // ===================================================================
        // TABLE TRAINING (Terminal Mode)
        // ===================================================================

        let tableRetrying = false;

        function loadLatinTable(item) {
            currentMode = 'table';
            currentWord = item.answer;
            tableRetrying = false;

            document.getElementById('tableArea').style.display = 'block';

            // Instruction above table
            const instructionType = item.tableType === 'verb' ? 'Konjugation' : 'Deklination';
            document.getElementById('tableInstruction').textContent =
                'Wir trainieren ' + instructionType + '. F√ºlle das fehlende K√§stchen aus!';

            const container = document.getElementById('terminalContainer');
            container.innerHTML = renderFullTable(item);

            setTimeout(() => {
                const input = document.getElementById('tableInput');
                if (input) input.focus();
            }, 100);
        }

        function renderFullTable(item) {
            const isVerb = item.tableType === 'verb';
            const title = isVerb
                ? ('VERBA ‚Äî ' + (item.conjugation || ''))
                : ('NOMINA ‚Äî ' + (item.declension || ''));
            const columns = isVerb
                ? [{key:'sg1',label:'1.Sg.'},{key:'sg2',label:'2.Sg.'},{key:'sg3',label:'3.Sg.'},
                   {key:'pl1',label:'1.Pl.'},{key:'pl2',label:'2.Pl.'},{key:'pl3',label:'3.Pl.'},
                   {key:'imp_sg',label:'Imp.Sg.'},{key:'imp_pl',label:'Imp.Pl.'}]
                : [{key:'nom_sg',label:'Nom.Sg.'},{key:'gen_sg',label:'Gen.Sg.'},{key:'dat_sg',label:'Dat.Sg.'},
                   {key:'akk_sg',label:'Akk.Sg.'},{key:'abl_sg',label:'Abl.Sg.'},
                   {key:'nom_pl',label:'Nom.Pl.'},{key:'gen_pl',label:'Gen.Pl.'},{key:'dat_pl',label:'Dat.Pl.'},
                   {key:'akk_pl',label:'Akk.Pl.'},{key:'abl_pl',label:'Abl.Pl.'}];

            // Prepend label + german columns
            const allColumns = [{key:'label',label:isVerb ? 'Infinitiv' : 'Wort'}, {key:'german',label:'Deutsch'}, ...columns];

            let html = `<div class="terminal-header">
                <span class="terminal-dot red"></span>
                <span class="terminal-dot yellow"></span>
                <span class="terminal-dot green"></span>
                <span class="terminal-title">${title}</span>
            </div>
            <div class="terminal-body"><table class="terminal-tbl">
            <thead><tr>`;
            allColumns.forEach(c => { html += `<th>${c.label}</th>`; });
            html += `</tr></thead><tbody>`;

            item.tableRows.forEach((row, rowIdx) => {
                const isActiveRow = rowIdx === item.blankRowIdx;
                html += `<tr${isActiveRow ? ' style="background:rgba(57,255,20,0.05)"' : ''}>`;
                allColumns.forEach(col => {
                    const val = row[col.key];
                    const isBlank = rowIdx === item.blankRowIdx && col.key === item.blankKey;
                    const isLabel = col.key === 'label';
                    if (isBlank) {
                        html += `<td class="cell-blank${isLabel ? ' row-label' : ''}"><input type="text" id="tableInput" autocomplete="off" autocapitalize="off" spellcheck="false"></td>`;
                    } else if (val === undefined || val === null) {
                        html += `<td style="color:#484f58;">‚Äî</td>`;
                    } else {
                        html += `<td${isLabel ? ' class="row-label"' : ''}>${val}</td>`;
                    }
                });
                html += `</tr>`;
            });

            html += `</tbody></table></div>`;
            html += `<div class="terminal-prompt">
                <span class="prompt-symbol">‚ùØ</span>
                <span class="prompt-hint" id="tablePromptHint">${item.question}</span>
            </div>`;
            return html;
        }

        function checkTableAnswer() {
            const input = document.getElementById('tableInput');
            if (!input || !input.value.trim()) return;
            const userAnswer = stripMacrons(input.value.trim().toLowerCase());
            const expected = stripMacrons(currentLatinItem.answer);
            const blankCell = document.querySelector('.cell-blank');
            const stats = wordStats[currentLatinItem.id];
            const timeElapsed = (Date.now() - currentWordStartTime) / 1000;

            if (tableRetrying) {
                if (userAnswer === expected) {
                    blankCell.classList.remove('cell-blank', 'cell-wrong-flash');
                    blankCell.classList.add('cell-correct-flash');
                    blankCell.innerHTML = currentLatinItem.displayAnswer;
                    setTimeout(() => { currentWordIndex++; loadLatinWord(); }, 1200);
                } else {
                    input.value = '';
                    input.focus();
                }
                return;
            }

            attemptCount++;
            stats.attempts++;

            if (userAnswer === expected) {
                stats.totalTime += timeElapsed;
                recordAnswer(getWordKey(currentLatinItem), true);
                blankCell.classList.remove('cell-blank');
                blankCell.classList.add('cell-correct-flash');
                blankCell.innerHTML = currentLatinItem.displayAnswer;
                handleCorrectAnswer(stats, timeElapsed);
                playSound('correct');
                setTimeout(() => { currentWordIndex++; loadLatinWord(); }, 1500);
            } else {
                stats.mistakes++;
                recordAnswer(getWordKey(currentLatinItem), false);
                blankCell.classList.add('cell-wrong-flash');
                input.value = '';

                const promptHint = document.getElementById('tablePromptHint');
                promptHint.className = 'prompt-error';
                promptHint.textContent = 'Falsch! Tippe: ' + currentLatinItem.displayAnswer;

                tableRetrying = true;
                playSound('wrong');
                if (!isRepeatPhase) addToRepeatList();
                input.focus();
            }
        }

        function skipTableAnswer() {
            const stats = wordStats[currentLatinItem.id];
            stats.attempts++;
            stats.mistakes++;
            recordAnswer(getWordKey(currentLatinItem), false);
            if (!isRepeatPhase) addToRepeatList();
            const blankCell = document.querySelector('.cell-blank');
            if (blankCell) {
                blankCell.classList.remove('cell-blank');
                blankCell.classList.add('cell-wrong-flash');
                blankCell.innerHTML = currentLatinItem.displayAnswer;
            }
            playSound('wrong');
            setTimeout(() => { currentWordIndex++; loadLatinWord(); }, 1500);
        }

        // ===================================================================
        // KONJUGATIONSSCHLANGE ‚Äì RENDERING & GAME LOGIC
        // ===================================================================

        let snakeRetrying = false;

        function loadLatinSnake(item) {
            currentMode = 'snake';
            document.getElementById('snakeArea').style.display = 'block';
            document.getElementById('snakeContinueBtn').style.display = 'none';
            snakeRetrying = false;

            renderSnakeChain(item);
            renderSnakeGrid(item);

            // Green box: previous state (or infinitive for first step)
            const ex = document.getElementById('snakeExample');
            if (item.prevDe) {
                ex.innerHTML = '<div class="snake-example-lat">' + item.prevLat + '</div>' +
                    '<div class="snake-example-de">' + item.prevDe + '</div>';
            } else {
                ex.innerHTML = '<div class="snake-example-lat">' + item.prevLat + '</div>';
            }
            ex.style.display = 'block';

            // Instruction
            document.getElementById('snakeInstruction').textContent = item.instruction;
            document.getElementById('snakeInstruction').style.color = '';

            // Target with inline input
            const target = document.getElementById('snakeTarget');
            const stemMarker = item.stem + '___';
            const stemIdx = item.targetLat.indexOf(stemMarker);
            const prefix = stemIdx >= 0 ? item.targetLat.substring(0, stemIdx) : '';
            const suffix = stemIdx >= 0 ? item.targetLat.substring(stemIdx + stemMarker.length) : '.';

            target.innerHTML = '<div class="snake-target-lat">' +
                prefix + '<span class="snake-stem">' + item.stem + '</span>' +
                '<input type="text" class="snake-ending-input" id="snakeEndingInput" ' +
                'autocomplete="off" autocapitalize="off" spellcheck="false">' +
                suffix + '</div>' +
                '<div class="snake-target-de">' + item.targetDe + '</div>';
            target.style.display = 'block';

            // Show check button, hide praise
            document.getElementById('snakeCheckBtn').style.display = 'inline-block';
            document.getElementById('snakePraise').style.display = 'none';
            const chain = document.getElementById('snakeChain');
            chain.classList.remove('snake-celebrate');
            chain.style.opacity = '';
            chain.style.transform = '';

            setTimeout(() => document.getElementById('snakeEndingInput').focus(), 100);
        }

        function getSnakeYOffset(key) {
            if (key.includes('sg')) return -8;
            if (key.includes('pl')) return 8;
            return 0;
        }

        function renderSnakeChain(item) {
            const chain = document.getElementById('snakeChain');
            chain.innerHTML = '';

            const head = document.createElement('div');
            head.className = 'snake-head';
            head.innerHTML = '<div class="snake-eye"></div>' +
                '<div class="snake-tongue idle"></div>' +
                '<span class="snake-head-text">' +
                '<span class="snake-head-inf">' + item.headLabel + '</span>' +
                '<span class="snake-head-de">' + item.headDe + '</span></span>';
            chain.appendChild(head);

            let prevY = 0;
            item.previousSteps.forEach(ps => {
                const y = getSnakeYOffset(ps.key);
                const conn = document.createElement('div');
                conn.className = 'snake-connector';
                conn.style.transform = 'translateY(' + ((prevY + y) / 2) + 'px)';
                chain.appendChild(conn);
                const seg = document.createElement('div');
                seg.className = 'snake-segment completed';
                seg.style.transform = 'translateY(' + y + 'px)';
                seg.innerHTML = '<div class="snake-segment-label">' + getSnakeKeyShort(ps.key) + '</div>' +
                    '<div class="snake-segment-form">' + ps.form + '</div>';
                chain.appendChild(seg);
                prevY = y;
            });

            const curY = getSnakeYOffset(item.currentKey);
            const conn = document.createElement('div');
            conn.className = 'snake-connector';
            conn.style.transform = 'translateY(' + ((prevY + curY) / 2) + 'px)';
            chain.appendChild(conn);
            const cur = document.createElement('div');
            cur.className = 'snake-segment current';
            cur.id = 'snakeCurrentSegment';
            cur.style.transform = 'translateY(' + curY + 'px)';
            cur.innerHTML = '<div class="snake-segment-label">' + getSnakeKeyShort(item.currentKey) + '</div>' +
                '<div class="snake-segment-form">???</div>';
            chain.appendChild(cur);

            setTimeout(() => chain.scrollLeft = chain.scrollWidth, 50);
        }

        function renderSnakeGrid(item) {
            const grid = document.getElementById('snakeGrid');
            grid.innerHTML = '';

            grid.innerHTML += '<div class="snake-grid-header"></div>';
            grid.innerHTML += '<div class="snake-grid-header">Singular</div>';
            grid.innerHTML += '<div class="snake-grid-header">Plural</div>';

            let rows;
            if (item.snakeType === 'noun') {
                rows = [
                    { label: 'Nom.', sg: 'nom_sg', pl: 'nom_pl' },
                    { label: 'Gen.', sg: 'gen_sg', pl: 'gen_pl' },
                    { label: 'Dat.', sg: 'dat_sg', pl: 'dat_pl' },
                    { label: 'Akk.', sg: 'akk_sg', pl: 'akk_pl' },
                    { label: 'Abl.', sg: 'abl_sg', pl: 'abl_pl' }
                ];
            } else {
                rows = [
                    { label: '1. Pers.', sg: 'sg1', pl: 'pl1' },
                    { label: '2. Pers.', sg: 'sg2', pl: 'pl2' },
                    { label: '3. Pers.', sg: 'sg3', pl: 'pl3' },
                    { label: 'Imperativ', sg: 'imp_sg', pl: 'imp_pl' }
                ];
            }

            const visitedKeys = item.previousSteps.map(ps => ps.key);

            rows.forEach(row => {
                const lbl = document.createElement('div');
                lbl.className = 'snake-grid-label';
                lbl.textContent = row.label;
                grid.appendChild(lbl);

                [row.sg, row.pl].forEach(key => {
                    const cell = document.createElement('div');
                    let cls = 'snake-grid-cell';
                    if (key.startsWith('imp')) cls += ' imp-row';
                    if (visitedKeys.includes(key)) cls += ' visited';
                    if (key === item.currentKey) cls += ' current';
                    cell.className = cls;

                    if (visitedKeys.includes(key)) {
                        const ps = item.previousSteps.find(p => p.key === key);
                        cell.textContent = ps ? ps.form : '‚úì';
                    } else if (key === item.currentKey) {
                        cell.textContent = '?';
                    } else {
                        cell.textContent = '¬∑';
                    }
                    grid.appendChild(cell);
                });
            });
        }

        function celebrateSnake() {
            const praiseTexts = ['Super!', 'Klasse!', 'Toll gemacht!', 'Perfekt!', 'Stark!', 'Bravo!'];
            const praise = praiseTexts[Math.floor(Math.random() * praiseTexts.length)];
            const praiseDom = document.getElementById('snakePraise');
            praiseDom.textContent = 'üêç ' + praise + ' Schlange komplett! üéâ';
            praiseDom.style.display = 'block';

            // Tongue flick celebration
            const tongue = document.querySelector('.snake-tongue');
            if (tongue) {
                tongue.classList.remove('idle');
                tongue.classList.add('flick');
            }

            // Hissing sounds
            playSnakeHiss();
            setTimeout(() => playSnakeHiss(), 700);
            setTimeout(() => playSnakeHiss(), 1400);

            // Wave animation: staggered on each child element
            const chain = document.getElementById('snakeChain');
            chain.classList.add('snake-celebrate');
            Array.from(chain.children).forEach((child, i) => {
                child.style.animation = 'snake-wave 0.8s ease-in-out infinite';
                child.style.animationDelay = (i * 0.1) + 's';
            });

            setTimeout(() => { currentWordIndex++; loadLatinWord(); }, 5000);
        }

        function checkSnakeAnswer() {
            const input = document.getElementById('snakeEndingInput');
            if (!input || !input.value.trim()) return;
            const item = currentLatinItem;
            const userAnswer = stripMacrons(input.value.trim().toLowerCase());
            const expected = stripMacrons(item.answer);
            const stats = wordStats[item.id];
            const timeElapsed = (Date.now() - currentWordStartTime) / 1000;

            if (snakeRetrying) {
                if (userAnswer === expected) {
                    input.className = 'snake-ending-input correct';
                    input.disabled = true;
                    document.getElementById('snakeCheckBtn').style.display = 'none';
                    const seg = document.getElementById('snakeCurrentSegment');
                    seg.className = 'snake-segment completed';
                    seg.querySelector('.snake-segment-form').textContent = item.fullForm;
                    document.getElementById('snakeInstruction').textContent = '‚úì Richtig!';
                    document.getElementById('snakeInstruction').style.color = '#4caf50';
                    // Celebration on last step
                    const isLast = item.stepIndex === item.totalSteps - 1;
                    if (isLast) {
                        celebrateSnake();
                    } else {
                        setTimeout(() => { currentWordIndex++; loadLatinWord(); }, 1200);
                    }
                } else {
                    input.className = 'snake-ending-input wrong';
                    document.getElementById('snakeCheckBtn').style.display = 'none';
                    document.getElementById('snakeInstruction').textContent =
                        'Falsch! Die richtige Endung ist: ' + item.displayAnswer.slice(item.stem.length);
                    document.getElementById('snakeInstruction').style.color = '#f44336';
                    playSound('wrong');
                    setTimeout(() => {
                        input.className = 'snake-ending-input';
                        input.value = '';
                        input.focus();
                        document.getElementById('snakeCheckBtn').style.display = 'inline-block';
                        document.getElementById('snakeInstruction').textContent = 'Tippe die richtige Endung:';
                        document.getElementById('snakeInstruction').style.color = '';
                    }, 2000);
                }
                return;
            }

            attemptCount++;
            stats.attempts++;

            if (userAnswer === expected) {
                stats.totalTime += timeElapsed;
                recordAnswer(getWordKey(item), true);
                input.className = 'snake-ending-input correct';
                input.disabled = true;

                // Reveal segment
                const seg = document.getElementById('snakeCurrentSegment');
                seg.className = 'snake-segment completed';
                seg.querySelector('.snake-segment-form').textContent = item.fullForm;

                // Show correct ending in target
                input.value = item.answer;
                document.getElementById('snakeCheckBtn').style.display = 'none';

                handleCorrectAnswer(stats, timeElapsed);
                playSound('correct');

                // Celebration on last step of a snake
                if (item.stepIndex === item.totalSteps - 1) {
                    celebrateSnake();
                } else {
                    setTimeout(() => { currentWordIndex++; loadLatinWord(); }, 1500);
                }
            } else {
                stats.mistakes++;
                recordAnswer(getWordKey(item), false);
                input.className = 'snake-ending-input wrong';

                // Show correct answer
                const seg = document.getElementById('snakeCurrentSegment');
                seg.className = 'snake-segment wrong';

                document.getElementById('snakeCheckBtn').style.display = 'none';
                document.getElementById('snakeInstruction').textContent =
                    'Falsch! Die richtige Endung ist: ' + item.displayAnswer.slice(item.stem.length);
                document.getElementById('snakeInstruction').style.color = '#f44336';

                snakeRetrying = true;
                playSound('wrong');
                if (!isRepeatPhase) addToRepeatList();

                setTimeout(() => {
                    input.className = 'snake-ending-input';
                    input.value = '';
                    input.disabled = false;
                    input.focus();
                    document.getElementById('snakeCheckBtn').style.display = 'inline-block';
                    document.getElementById('snakeInstruction').textContent = 'Tippe die richtige Endung:';
                    document.getElementById('snakeInstruction').style.color = '';
                    seg.className = 'snake-segment current';
                }, 2000);
            }
        }

        function snakeContinue() {
            document.getElementById('snakeContinueBtn').style.display = 'none';
            currentWordIndex++;
            loadLatinWord();
        }

        function handleCorrectAnswer(stats, timeElapsed) {
            const feedback = document.getElementById('feedback');

            if (attemptCount === 1) {
                stats.correctOnFirstTry = true;
                correctFirstTryCount++;
                if (correctFirstTryCount % 2 === 0) {
                    talersEarned++;
                    totalTalers++;
                    localStorage.setItem('vocabularyGameTalers', totalTalers.toString());
                    const talerDisplay = document.getElementById('totalTalers');
                    talerDisplay.textContent = totalTalers;
                    talerDisplay.parentElement.parentElement.style.animation = 'none';
                    setTimeout(() => { talerDisplay.parentElement.parentElement.style.animation = 'celebrate 0.5s'; }, 10);
                }
            }

            feedback.textContent = 'üéâ Richtig! Super gemacht!';
            feedback.className = 'feedback correct';
            score += 10;
            correctCount++;
            document.getElementById('score').textContent = score;
            document.getElementById('correct').textContent = correctCount;
            playSound('correct');

            if (!isRepeatPhase) {
                if (attemptCount > 1 || timeElapsed > 30) {
                    addLatinToRepeatList();
                }
            }
        }

        function addLatinToRepeatList() {
            const item = shuffledVocabulary[currentWordIndex];
            if (!wordsToRepeat.some(w => w.id === item.id)) {
                wordsToRepeat.push(item);
                document.getElementById('repeats').textContent = wordsToRepeat.length;
            }
        }

        function latinMcContinue() {
            document.getElementById('mcContinueBtn').style.display = 'none';
            currentWordIndex++;
            loadLatinWord();
        }

        function latinSkipWord() {
            const feedback = document.getElementById('feedback');
            const displayAns = currentLatinItem.displayAnswer || currentWord;
            feedback.textContent = 'Die richtige Antwort war: ' + displayAns.toUpperCase();
            feedback.className = 'feedback';
            feedback.style.color = '#667eea';
            feedback.style.fontSize = '1.8em';

            if (hintTimeout) clearTimeout(hintTimeout);

            const stats = wordStats[currentLatinItem.id];
            stats.mistakes++;
            stats.attempts++;
            recordAnswer(getWordKey(currentLatinItem), false);
            document.getElementById('emojiCurtain').classList.add('reveal');

            if (!isRepeatPhase) addLatinToRepeatList();

            document.getElementById('skipBtn').style.display = 'none';
            document.getElementById('checkBtn').style.display = 'none';
            document.getElementById('clearBtn').style.display = 'none';
            document.getElementById('continueBtn').style.display = 'inline-block';
        }

        function latinContinueToNextWord() {
            document.getElementById('skipBtn').style.display = 'inline-block';
            document.getElementById('checkBtn').style.display = 'inline-block';
            document.getElementById('clearBtn').style.display = 'inline-block';
            document.getElementById('continueBtn').style.display = 'none';
            currentWordIndex++;
            loadLatinWord();
        }

        // ===================================================================
        // ENGLISH WORD LOADING (dispatches to spelling or MC)
        // ===================================================================

        function loadWord() {
            // Check if we finished all main words
            if (!isRepeatPhase && currentWordIndex >= shuffledVocabulary.length) {
                if (wordsToRepeat.length > 0) {
                    isRepeatPhase = true;
                    currentWordIndex = 0;
                    shuffledVocabulary = wordsToRepeat;
                    // Assign fresh random modes for repeat round
                    roundModes = shuffledVocabulary.map(() => Math.random() < 0.5 ? 'spelling' : 'mc');
                    wordsToRepeat = [];
                    document.getElementById('total').textContent = shuffledVocabulary.length;
                    document.getElementById('feedback').textContent = 'üîÑ Jetzt wiederholen wir die schwierigen Vokabeln!';
                    document.getElementById('feedback').className = 'feedback';
                    document.getElementById('feedback').style.color = '';
                    document.getElementById('feedback').style.fontSize = '';
                    setTimeout(() => {
                        document.getElementById('feedback').textContent = '';
                        loadWord();
                    }, 2000);
                    return;
                } else {
                    showCelebration();
                    return;
                }
            }

            if (isRepeatPhase && currentWordIndex >= shuffledVocabulary.length) {
                showCelebration();
                return;
            }

            if (hintTimeout) {
                clearTimeout(hintTimeout);
            }

            const word = shuffledVocabulary[currentWordIndex];
            currentWord = word.english.toLowerCase();
            selectedLetters = [];
            attemptCount = 0;
            mcAnswered = false;
            currentWordStartTime = Date.now();

            // Determine mode for this word
            currentMode = roundModes[currentWordIndex] || 'spelling';

            document.getElementById('wordImage').textContent = word.image;
            document.getElementById('current').textContent = currentWordIndex + 1;
            document.getElementById('feedback').textContent = '';
            document.getElementById('feedback').className = 'feedback';
            document.getElementById('feedback').style.color = '';
            document.getElementById('feedback').style.fontSize = '';
            document.getElementById('autoHint').textContent = '';
            document.getElementById('autoHint').className = 'auto-hint';
            document.getElementById('mcContinueBtn').style.display = 'none';
            document.getElementById('sentenceArea').style.display = 'none';

            // Curtain logic: hide emoji if already answered correctly before (not in repeat phase)
            const curtain = document.getElementById('emojiCurtain');
            if (!isRepeatPhase) {
                const wordKey = getWordKey(word, currentMode);
                const prog = loadProgress()[wordKey];
                if (prog && prog.correct >= 1) {
                    curtain.classList.add('active');
                    curtain.classList.remove('reveal');
                } else {
                    curtain.classList.remove('active', 'reveal');
                }
            } else {
                curtain.classList.remove('active', 'reveal');
            }

            if (currentMode === 'spelling') {
                loadSpellingMode(word);
            } else {
                loadMCMode(word);
            }

            // Start 15-second timer for automatic hint (both modes)
            hintTimeout = setTimeout(() => {
                showAutoHint();
            }, 15000);
        }

        // ===================================================================
        // SPELLING MODE (DE‚ÜíEN, original)
        // ===================================================================

        function loadSpellingMode(word) {
            // Show german word and hint (DE‚ÜíEN)
            document.getElementById('wordGerman').textContent = word.german;
            document.getElementById('wordHint').textContent = word.hint;

            // Show spelling UI, hide MC UI
            document.getElementById('spellingArea').style.display = 'block';
            document.getElementById('mcArea').style.display = 'none';
            document.getElementById('spellingButtons').style.display = 'flex';
            document.getElementById('tipText').style.display = 'block';

            // Reset buttons
            document.getElementById('skipBtn').style.display = 'inline-block';
            document.getElementById('checkBtn').style.display = 'inline-block';
            document.getElementById('clearBtn').style.display = 'inline-block';
            document.getElementById('continueBtn').style.display = 'none';

            createAnswerSlots();
            createLetterPool();
        }

        function showAutoHint() {
            const autoHintElement = document.getElementById('autoHint');
            if (currentMode === 'spelling') {
                const firstLetter = currentWord[0].toUpperCase();
                autoHintElement.textContent = `üí° Tipp: Das Wort beginnt mit "${firstLetter}"`;
                autoHintElement.className = 'auto-hint show';
            }
            // Kein Hint bei MC ‚Äì w√ºrde die L√∂sung verraten
        }

        function createAnswerSlots() {
            const answerArea = document.getElementById('answerArea');
            answerArea.innerHTML = '';

            for (let i = 0; i < currentWord.length; i++) {
                const slot = document.createElement('div');
                slot.className = 'letter-slot';
                slot.dataset.index = i;
                slot.addEventListener('click', () => removeLetterFromSlot(i));
                answerArea.appendChild(slot);
            }
        }

        function createLetterPool() {
            const lettersPool = document.getElementById('lettersPool');
            lettersPool.innerHTML = '';

            const wordLetters = currentWord.split('');
            const extraLetters = 'abcdefghijklmnopqrstuvwxyz';
            const numExtras = Math.min(5, Math.floor(currentWord.length / 2) + 2);

            for (let i = 0; i < numExtras; i++) {
                let randomLetter;
                do {
                    randomLetter = extraLetters[Math.floor(Math.random() * extraLetters.length)];
                } while (wordLetters.includes(randomLetter));
                wordLetters.push(randomLetter);
            }

            const shuffledLetters = shuffleArray(wordLetters);

            shuffledLetters.forEach((letter, index) => {
                const tile = document.createElement('div');
                tile.className = 'letter-tile';
                tile.textContent = letter.toUpperCase();
                tile.dataset.letter = letter;
                tile.dataset.id = index;
                tile.addEventListener('click', () => selectLetter(letter, index));
                lettersPool.appendChild(tile);
            });
        }

        function selectLetter(letter, id) {
            if (selectedLetters.length >= currentWord.length) return;

            const tile = document.querySelector(`[data-id="${id}"]`);
            if (tile.classList.contains('used')) return;

            selectedLetters.push({ letter, id });
            tile.classList.add('used');

            updateAnswerArea();
        }

        function removeLetterFromSlot(index) {
            if (index >= selectedLetters.length) return;

            const removed = selectedLetters[index];
            // For Latin spelling, look in lettersPool specifically
            const poolSelector = (currentLanguage === 'latin' && currentMode === 'spelling') ? '#lettersPool ' : '';
            const tile = document.querySelector(`${poolSelector}[data-id="${removed.id}"]`);
            if (tile) tile.classList.remove('used');

            selectedLetters.splice(index, 1);
            updateAnswerArea();
        }

        function updateAnswerArea() {
            const slots = document.querySelectorAll('#answerArea .letter-slot');
            slots.forEach((slot, index) => {
                if (selectedLetters[index]) {
                    slot.textContent = selectedLetters[index].letter.toUpperCase();
                    slot.classList.add('filled');
                } else {
                    slot.textContent = '';
                    slot.classList.remove('filled');
                }
            });
        }

        function checkAnswer() {
            if (currentLanguage === 'latin') {
                if (currentMode === 'sentence') { checkLatinSentence(); return; }
                if (currentMode === 'spelling') { checkLatinSpelling(); return; }
                return;
            }
            if (currentMode !== 'spelling') return;

            const answer = selectedLetters.map(l => l.letter).join('');
            const slots = document.querySelectorAll('#answerArea .letter-slot');
            const feedback = document.getElementById('feedback');

            if (hintTimeout) {
                clearTimeout(hintTimeout);
            }

            attemptCount++;

            let correctLetters = 0;
            slots.forEach((slot, index) => {
                if (selectedLetters[index]) {
                    if (selectedLetters[index].letter === currentWord[index]) {
                        slot.classList.add('correct');
                        slot.classList.remove('wrong');
                        correctLetters++;
                    } else {
                        slot.classList.add('wrong');
                        slot.classList.remove('correct');
                    }
                }
            });

            const timeElapsed = (Date.now() - currentWordStartTime) / 1000;
            const stats = wordStats[currentWord];
            stats.attempts++;

            if (answer === currentWord && correctLetters === currentWord.length) {
                stats.totalTime += timeElapsed;
                recordAnswer(getWordKey(shuffledVocabulary[currentWordIndex], currentMode), true);
                document.getElementById('emojiCurtain').classList.add('reveal');

                if (attemptCount === 1) {
                    stats.correctOnFirstTry = true;
                    correctFirstTryCount++;

                    if (correctFirstTryCount % 2 === 0) {
                        talersEarned++;
                        totalTalers++;
                        localStorage.setItem('vocabularyGameTalers', totalTalers.toString());

                        const talerDisplay = document.getElementById('totalTalers');
                        talerDisplay.textContent = totalTalers;
                        talerDisplay.parentElement.parentElement.style.animation = 'none';
                        setTimeout(() => {
                            talerDisplay.parentElement.parentElement.style.animation = 'celebrate 0.5s';
                        }, 10);
                    }
                }

                feedback.textContent = 'üéâ Richtig! Super gemacht!';
                feedback.className = 'feedback correct';

                score += 10;
                correctCount++;
                document.getElementById('score').textContent = score;
                document.getElementById('correct').textContent = correctCount;

                playSound('correct');

                if (!isRepeatPhase) {
                    if (attemptCount > 1 || timeElapsed > 30) {
                        addToRepeatList();
                    }
                }

                setTimeout(() => {
                    currentWordIndex++;
                    loadWord();
                }, 2000);
            } else {
                stats.mistakes++;
                recordAnswer(getWordKey(shuffledVocabulary[currentWordIndex], currentMode), false);
                document.getElementById('emojiCurtain').classList.add('reveal');

                feedback.textContent = '‚ùå Das ist leider nicht richtig. Versuch es nochmal!';
                feedback.className = 'feedback wrong';

                playSound('wrong');

                setTimeout(() => {
                    slots.forEach(slot => {
                        slot.classList.remove('wrong');
                        slot.classList.remove('correct');
                    });
                }, 1500);
            }
        }

        function skipWord() {
            if (currentLanguage === 'latin') { latinSkipWord(); return; }
            const feedback = document.getElementById('feedback');
            feedback.textContent = `Die richtige Antwort war: ${currentWord.toUpperCase()}`;
            feedback.className = 'feedback';
            feedback.style.color = '#667eea';
            feedback.style.fontSize = '1.8em';

            if (hintTimeout) {
                clearTimeout(hintTimeout);
            }

            const stats = wordStats[currentWord];
            stats.mistakes++;
            stats.attempts++;
            recordAnswer(getWordKey(shuffledVocabulary[currentWordIndex], currentMode), false);
            document.getElementById('emojiCurtain').classList.add('reveal');

            if (!isRepeatPhase) {
                addToRepeatList();
            }

            document.getElementById('skipBtn').style.display = 'none';
            document.getElementById('checkBtn').style.display = 'none';
            document.getElementById('clearBtn').style.display = 'none';
            document.getElementById('continueBtn').style.display = 'inline-block';
        }

        function continueToNextWord() {
            if (currentLanguage === 'latin') { latinContinueToNextWord(); return; }
            document.getElementById('skipBtn').style.display = 'inline-block';
            document.getElementById('checkBtn').style.display = 'inline-block';
            document.getElementById('clearBtn').style.display = 'inline-block';
            document.getElementById('continueBtn').style.display = 'none';

            currentWordIndex++;
            loadWord();
        }

        function clearAnswer() {
            if (currentLanguage === 'latin' && currentMode === 'sentence') {
                selectedLetters.forEach(item => {
                    const tile = document.querySelector(`#sentenceLettersPool [data-id="${item.id}"]`);
                    if (tile) tile.classList.remove('used');
                });
                selectedLetters = [];
                updateSentenceAnswerArea();
                return;
            }
            selectedLetters.forEach(item => {
                const tile = document.querySelector(`[data-id="${item.id}"]`);
                if (tile) tile.classList.remove('used');
            });
            selectedLetters = [];
            updateAnswerArea();
        }

        // ===================================================================
        // MULTIPLE CHOICE MODE (EN‚ÜíDE)
        // ===================================================================

        function loadMCMode(word) {
            // Show english word (EN‚ÜíDE direction)
            document.getElementById('wordGerman').textContent = word.english.toUpperCase();
            document.getElementById('wordHint').textContent = 'Was bedeutet dieses Wort auf Deutsch?';

            // Show MC UI, hide spelling UI
            document.getElementById('spellingArea').style.display = 'none';
            document.getElementById('mcArea').style.display = 'block';
            document.getElementById('spellingButtons').style.display = 'none';
            document.getElementById('tipText').style.display = 'none';

            // Build 5 options: 1 correct + 4 distractors
            const correctAnswer = word.german;
            const distractors = word.distractors || [];

            // Build options array
            let options = [
                { text: correctAnswer, correct: true }
            ];
            distractors.forEach(d => {
                options.push({ text: d, correct: false });
            });

            // Shuffle options
            options = shuffleArray(options);

            // Render MC options
            const mcContainer = document.getElementById('mcOptions');
            mcContainer.innerHTML = '';

            options.forEach((opt, idx) => {
                const optDiv = document.createElement('div');
                optDiv.className = 'mc-option';
                optDiv.dataset.index = idx;
                optDiv.dataset.correct = opt.correct;
                optDiv.innerHTML = `<span class="mc-key">${idx + 1}</span><span class="mc-text">${opt.text}</span>`;
                optDiv.addEventListener('click', () => selectMCOption(idx));
                mcContainer.appendChild(optDiv);
            });
        }

        function selectMCOption(index) {
            if (mcAnswered) return;
            mcAnswered = true;

            if (hintTimeout) {
                clearTimeout(hintTimeout);
            }

            attemptCount++;

            const options = document.querySelectorAll('.mc-option');
            const selectedOption = options[index];
            const isCorrect = selectedOption.dataset.correct === 'true';
            const feedback = document.getElementById('feedback');
            const timeElapsed = (Date.now() - currentWordStartTime) / 1000;
            const stats = wordStats[currentWord];
            stats.attempts++;

            // Disable all options
            options.forEach(opt => opt.classList.add('mc-disabled'));

            // Highlight correct answer
            options.forEach(opt => {
                if (opt.dataset.correct === 'true') {
                    opt.classList.add('mc-correct');
                }
            });

            if (isCorrect) {
                stats.totalTime += timeElapsed;
                recordAnswer(getWordKey(shuffledVocabulary[currentWordIndex], currentMode), true);
                document.getElementById('emojiCurtain').classList.add('reveal');

                if (attemptCount === 1) {
                    stats.correctOnFirstTry = true;
                    correctFirstTryCount++;

                    if (correctFirstTryCount % 2 === 0) {
                        talersEarned++;
                        totalTalers++;
                        localStorage.setItem('vocabularyGameTalers', totalTalers.toString());

                        const talerDisplay = document.getElementById('totalTalers');
                        talerDisplay.textContent = totalTalers;
                        talerDisplay.parentElement.parentElement.style.animation = 'none';
                        setTimeout(() => {
                            talerDisplay.parentElement.parentElement.style.animation = 'celebrate 0.5s';
                        }, 10);
                    }
                }

                feedback.textContent = 'üéâ Richtig! Super gemacht!';
                feedback.className = 'feedback correct';

                score += 10;
                correctCount++;
                document.getElementById('score').textContent = score;
                document.getElementById('correct').textContent = correctCount;

                playSound('correct');

                if (!isRepeatPhase) {
                    if (attemptCount > 1 || timeElapsed > 30) {
                        addToRepeatList();
                    }
                }

                setTimeout(() => {
                    currentWordIndex++;
                    loadWord();
                }, 2000);
            } else {
                selectedOption.classList.add('mc-wrong');
                stats.mistakes++;
                recordAnswer(getWordKey(shuffledVocabulary[currentWordIndex], currentMode), false);
                document.getElementById('emojiCurtain').classList.add('reveal');

                feedback.textContent = '';
                feedback.className = 'feedback';

                playSound('wrong');

                if (!isRepeatPhase) {
                    addToRepeatList();
                }

                // Show "Weiter" button so the user can study the correct answer
                document.getElementById('mcContinueBtn').style.display = 'inline-block';
            }
        }

        // ===================================================================
        // SHARED HELPERS
        // ===================================================================

        function mcContinue() {
            if (currentLanguage === 'latin') { latinMcContinue(); return; }
            document.getElementById('mcContinueBtn').style.display = 'none';
            currentWordIndex++;
            loadWord();
        }

        function addToRepeatList() {
            const currentWordObj = shuffledVocabulary[currentWordIndex];
            const matchKey = currentWordObj.english || currentWordObj.id;
            const alreadyInRepeat = wordsToRepeat.some(w => (w.english || w.id) === matchKey);
            if (!alreadyInRepeat) {
                wordsToRepeat.push(currentWordObj);
                document.getElementById('repeats').textContent = wordsToRepeat.length;
            }
        }

        function showCelebration() {
            const celebration = document.getElementById('celebration');
            const finalScore = document.getElementById('finalScore');

            const totalWords = Object.keys(wordStats).length;
            const totalAttempts = Object.values(wordStats).reduce((sum, s) => sum + s.attempts, 0);
            const correctOnFirstTry = Object.values(wordStats).filter(s => s.correctOnFirstTry).length;
            const avgTime = Object.values(wordStats).reduce((sum, s) => sum + (s.totalTime / s.attempts || 0), 0) / totalWords;

            const successRate = Math.round((correctCount / totalAttempts) * 100);

            let celebrationHTML = `
                <strong>üéØ Statistik:</strong><br><br>
                <strong>${correctOnFirstTry}</strong> von <strong>${totalWords}</strong> Vokabeln beim ersten Mal richtig!<br>
                Erfolgsquote: ${successRate}%<br>
                Gesamtversuche: ${totalAttempts}<br>
                Durchschnittliche Zeit: ${avgTime.toFixed(1)}s<br><br>
            `;

            if (talersEarned > 0) {
                celebrationHTML += `<div style="background: linear-gradient(135deg, #f9d423 0%, #ff4e50 100%); padding: 15px; border-radius: 15px; margin: 15px 0;">
                    ü™ô <strong>Du hast ${talersEarned} Taler verdient!</strong><br>
                    Gesamt: ${totalTalers} / 50 Taler
                </div>`;
            }

            if (totalTalers >= 50) {
                celebrationHTML += `
                    <div style="background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%); padding: 20px; border-radius: 15px; margin: 15px 0; animation: celebrate 1s infinite;">
                        <div style="font-size: 3em;">üèÜ</div>
                        <strong style="font-size: 1.5em;">GEWONNEN!</strong><br>
                        Du hast 50 Taler erreicht!<br>
                        Zeig das deinen Eltern! üéâ
                    </div>
                `;
            }

            // Show learning progress for current chapter/set
            const allProgress = loadProgress();
            let chapterKeys = new Set();
            let chapterLabel = '';
            if (currentLanguage === 'english') {
                vocabulary.forEach(w => {
                    chapterKeys.add('en:' + w.english.toLowerCase());
                });
                chapterLabel = currentVocabularySet;
            } else if (currentLatinChapter) {
                const ch = currentLatinChapter;
                ch.vocabulary.forEach(v => chapterKeys.add('la:v_' + v.latin));
                if (ch.multiWord) ch.multiWord.forEach(mw => chapterKeys.add('la:mw_lg_' + mw.latin));
                if (ch.verbForms) ch.verbForms.forEach(vf => {
                    chapterKeys.add('la:vf_i2f_' + vf.infinitive);
                    if (vf.present) chapterKeys.add('la:vf_pres_' + vf.infinitive);
                    if (vf.imperative) chapterKeys.add('la:vf_imp_' + vf.infinitive);
                });
                if (ch.nouns) ch.nouns.forEach(n => chapterKeys.add('la:noun_' + n.nom_sg));
                if (ch.verbForms) ch.verbForms.forEach(vf => chapterKeys.add('la:tbl_v_' + vf.infinitive));
                if (ch.nouns) ch.nouns.forEach(n => chapterKeys.add('la:tbl_n_' + n.nom_sg));
                if (ch.sentences) ch.sentences.forEach(s => chapterKeys.add('la:sent_' + s.answer));
                chapterLabel = ch.name;
            }
            const chapterTotal = chapterKeys.size;
            // Count words with correct >= 3 in any direction
            const learnedBaseWords = new Set();
            Object.entries(allProgress).forEach(([key, p]) => {
                if (p.correct >= 3) {
                    let baseKey = key.replace(/:(de>en|en>de|de>la|la>de):/, ':');
                    // Strip person/case specifics from verb and noun keys
                    baseKey = baseKey.replace(/vf_pres_(sg2|sg3|pl1|pl2|pl3)_/, 'vf_pres_');
                    baseKey = baseKey.replace(/vf_imp_(sg|pl)_/, 'vf_imp_');
                    baseKey = baseKey.replace(/noun_(gen|dat|akk|abl|nom)_(sg|pl)_/, 'noun_');
                    baseKey = baseKey.replace(/tbl_v_(sg1|sg2|sg3|pl1|pl2|pl3|imp_sg|imp_pl)_/, 'tbl_v_');
                    baseKey = baseKey.replace(/tbl_n_(nom|gen|dat|akk|abl)_(sg|pl)_/, 'tbl_n_');
                    learnedBaseWords.add(baseKey);
                }
            });
            const learnedCount = [...learnedBaseWords].filter(bk => chapterKeys.has(bk)).length;
            celebrationHTML += `<div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px; border-radius: 12px; margin: 15px 0;">
                üìä ${chapterLabel}: <strong>${learnedCount}</strong> / ${chapterTotal} Vokabeln gelernt <span style="font-size: 0.8em; opacity: 0.85;">(3√ó richtig)</span>
            </div>`;

            celebrationHTML += `<strong>Gesamtpunkte: ${score}</strong>`;

            finalScore.innerHTML = celebrationHTML;
            celebration.classList.add('show');
        }

        function playSound(type) {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            if (type === 'correct') {
                oscillator.frequency.value = 523.25;
                oscillator.type = 'sine';
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
            } else {
                oscillator.frequency.value = 200;
                oscillator.type = 'sawtooth';
                gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.3);
            }
        }

        function playSnakeHiss() {
            try {
                const ctx = new (window.AudioContext || window.webkitAudioContext)();
                const duration = 0.35;
                const bufferSize = ctx.sampleRate * duration;
                const buffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
                const data = buffer.getChannelData(0);
                for (let i = 0; i < bufferSize; i++) {
                    data[i] = Math.random() * 2 - 1;
                }
                const source = ctx.createBufferSource();
                source.buffer = buffer;
                const filter = ctx.createBiquadFilter();
                filter.type = 'bandpass';
                filter.frequency.value = 6000;
                filter.Q.value = 3;
                const gain = ctx.createGain();
                gain.gain.setValueAtTime(0.12, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + duration);
                source.connect(filter);
                filter.connect(gain);
                gain.connect(ctx.destination);
                source.start();
                source.stop(ctx.currentTime + duration);
            } catch(e) {}
        }

        // ===================================================================
        // KEYBOARD INPUT HANDLER
        // ===================================================================

        document.addEventListener('keydown', (event) => {
            // Table mode: only intercept Enter, let browser handle rest
            if (currentMode === 'table') {
                if (event.key === 'Enter') {
                    event.preventDefault();
                    checkTableAnswer();
                }
                return;
            }

            // Snake mode: Enter to check
            if (currentMode === 'snake') {
                if (event.key === 'Enter') {
                    event.preventDefault();
                    checkSnakeAnswer();
                }
                return;
            }

            const key = event.key.toLowerCase();

            // Space or Enter to continue after skip
            if ((key === ' ' || key === 'enter') && document.getElementById('continueBtn').style.display !== 'none') {
                event.preventDefault();
                continueToNextWord();
                return;
            }

            // Space or Enter to continue after wrong MC answer
            if ((key === ' ' || key === 'enter') && document.getElementById('mcContinueBtn').style.display !== 'none') {
                event.preventDefault();
                mcContinue();
                return;
            }

            // Multiple Choice: keys 1-5 (both English and Latin MC)
            if (currentMode === 'mc' && !mcAnswered && key >= '1' && key <= '5') {
                const index = parseInt(key) - 1;
                const options = document.querySelectorAll('.mc-option');
                if (index < options.length) {
                    event.preventDefault();
                    if (currentLanguage === 'latin') {
                        selectLatinMC(index);
                    } else {
                        selectMCOption(index);
                    }
                }
                return;
            }

            // Latin sentence mode keyboard
            if (currentLanguage === 'latin' && currentMode === 'sentence') {
                if (key.length === 1 && ((key >= 'a' && key <= 'z') || '√§√∂√º'.includes(key))) {
                    const tiles = document.querySelectorAll('#sentenceLettersPool .letter-tile');
                    for (let tile of tiles) {
                        if (tile.dataset.letter === key && !tile.classList.contains('used')) {
                            const id = parseInt(tile.dataset.id);
                            selectSentenceLetter(key, id);
                            break;
                        }
                    }
                }
                if (key === 'backspace' && selectedLetters.length > 0) {
                    removeSentenceLetterFromSlot(selectedLetters.length - 1);
                }
                if (key === 'enter' && selectedLetters.length === currentWord.length) {
                    checkAnswer();
                }
                if (key === 'escape') { clearAnswer(); }
                return;
            }

            // Latin spelling mode keyboard (macron-aware)
            if (currentLanguage === 'latin' && currentMode === 'spelling') {
                if (key.length === 1 && key >= 'a' && key <= 'z') {
                    const tiles = document.querySelectorAll('#lettersPool .letter-tile');
                    for (let tile of tiles) {
                        if (baseChar(tile.dataset.letter) === key && !tile.classList.contains('used')) {
                            const id = parseInt(tile.dataset.id);
                            selectLatinLetter(tile.dataset.letter, id);
                            break;
                        }
                    }
                }
                if (key === 'backspace' && selectedLetters.length > 0) {
                    removeLetterFromSlot(selectedLetters.length - 1);
                }
                if (key === 'enter' && selectedLetters.length === currentWord.length) {
                    checkAnswer();
                }
                if (key === 'escape') { clearAnswer(); }
                return;
            }

            // English spelling mode keyboard controls
            if (currentMode === 'spelling') {
                if (key.length === 1 && key >= 'a' && key <= 'z') {
                    const tiles = document.querySelectorAll('.letter-tile');
                    for (let tile of tiles) {
                        if (tile.dataset.letter === key && !tile.classList.contains('used')) {
                            const id = parseInt(tile.dataset.id);
                            selectLetter(key, id);
                            break;
                        }
                    }
                }

                if (key === 'backspace' && selectedLetters.length > 0) {
                    const lastIndex = selectedLetters.length - 1;
                    removeLetterFromSlot(lastIndex);
                }

                if (key === 'enter' && selectedLetters.length === currentWord.length) {
                    checkAnswer();
                }

                if (key === 'escape') {
                    clearAnswer();
                }
            }
        });

        // ===================================================================
        // EVENT LISTENERS
        // ===================================================================

        document.getElementById('checkBtn').addEventListener('click', checkAnswer);
        document.getElementById('skipBtn').addEventListener('click', skipWord);
        document.getElementById('clearBtn').addEventListener('click', clearAnswer);
        document.getElementById('continueBtn').addEventListener('click', continueToNextWord);
    </script>
</body>
</html>
