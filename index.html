<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ® Vokabel-Abenteuer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', 'Chalkboard SE', 'Arial Rounded MT Bold', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
        }

        .game-container {
            background: white;
            border-radius: 30px;
            padding: 20px;
            max-width: 800px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        @media (min-width: 768px) {
            .game-container {
                padding: 40px;
            }

            body {
                padding: 20px;
            }
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #667eea;
            font-size: 1.8em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        @media (min-width: 768px) {
            .header h1 {
                font-size: 2.5em;
            }
        }

        .current-set {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 6px 15px;
            border-radius: 15px;
            font-size: 0.75em;
            margin-top: 10px;
            display: inline-block;
        }

        @media (min-width: 768px) {
            .current-set {
                padding: 8px 20px;
                border-radius: 20px;
                font-size: 0.9em;
            }
        }

        .set-selection {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin: 20px 0;
        }

        @media (min-width: 768px) {
            .set-selection {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 20px;
                margin: 30px 0;
            }
        }

        .set-card {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border-radius: 20px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            border: 3px solid transparent;
        }

        @media (min-width: 768px) {
            .set-card {
                padding: 30px;
            }
        }

        .set-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            border-color: #667eea;
        }

        .set-card-all {
            background: linear-gradient(135deg, #f9d423 0%, #ff4e50 100%);
        }

        @media (min-width: 768px) {
            .set-card-all {
                grid-column: 1 / -1;
            }
        }

        .set-icon {
            font-size: 3em;
            margin-bottom: 10px;
        }

        @media (min-width: 768px) {
            .set-icon {
                font-size: 4em;
                margin-bottom: 15px;
            }
        }

        .set-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
        }

        @media (min-width: 768px) {
            .set-title {
                font-size: 1.5em;
                margin-bottom: 10px;
            }
        }

        .set-info {
            font-size: 1em;
            color: #666;
            margin-bottom: 8px;
        }

        @media (min-width: 768px) {
            .set-info {
                font-size: 1.2em;
                margin-bottom: 10px;
            }
        }

        .set-topics {
            font-size: 0.8em;
            color: #888;
            font-style: italic;
        }

        @media (min-width: 768px) {
            .set-topics {
                font-size: 0.9em;
            }
        }

        .taler-display {
            background: linear-gradient(135deg, #f9d423 0%, #ff4e50 100%);
            padding: 15px;
            border-radius: 15px;
            text-align: center;
            color: white;
            font-size: 1em;
            margin-top: 20px;
        }

        @media (min-width: 768px) {
            .taler-display {
                padding: 20px;
                font-size: 1.2em;
                margin-top: 30px;
            }
        }

        .score-board {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            margin-bottom: 20px;
            padding: 10px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border-radius: 15px;
            color: white;
            gap: 10px;
        }

        @media (min-width: 768px) {
            .score-board {
                margin-bottom: 30px;
                padding: 15px;
            }
        }

        .score-item {
            text-align: center;
            flex: 1;
            min-width: 80px;
        }

        .score-item .label {
            font-size: 0.75em;
            opacity: 0.9;
        }

        @media (min-width: 768px) {
            .score-item .label {
                font-size: 0.9em;
            }
        }

        .score-item .value {
            font-size: 1.5em;
            font-weight: bold;
        }

        @media (min-width: 768px) {
            .score-item .value {
                font-size: 2em;
            }
        }

        .taler-item {
            background: linear-gradient(135deg, #f9d423 0%, #ff4e50 100%);
            padding: 8px 12px;
            border-radius: 10px;
            animation: shine 2s infinite;
            flex-basis: 100%;
            margin-top: 5px;
        }

        @media (min-width: 768px) {
            .taler-item {
                padding: 10px 15px;
                flex-basis: auto;
                margin-top: 0;
            }
        }

        @keyframes shine {
            0%, 100% { box-shadow: 0 0 10px rgba(249, 212, 35, 0.5); }
            50% { box-shadow: 0 0 20px rgba(249, 212, 35, 0.8); }
        }

        .taler-item .value {
            font-size: 1.5em;
        }

        @media (min-width: 768px) {
            .taler-item .value {
                font-size: 1.8em;
            }
        }

        .word-card {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }

        @media (min-width: 768px) {
            .word-card {
                padding: 30px;
                margin-bottom: 30px;
            }
        }

        .word-image {
            font-size: 60px;
            margin-bottom: 10px;
            animation: bounce 2s infinite;
        }

        @media (min-width: 768px) {
            .word-image {
                font-size: 100px;
                margin-bottom: 15px;
            }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .word-german {
            font-size: 1.3em;
            color: #333;
            margin-bottom: 8px;
            font-weight: bold;
        }

        @media (min-width: 768px) {
            .word-german {
                font-size: 1.8em;
                margin-bottom: 10px;
            }
        }

        .word-hint {
            font-size: 0.9em;
            color: #666;
            font-style: italic;
        }

        @media (min-width: 768px) {
            .word-hint {
                font-size: 1em;
            }
        }

        .auto-hint {
            margin-top: 10px;
            font-size: 1em;
            color: #667eea;
            font-weight: bold;
            min-height: 25px;
            animation: fadeIn 0.5s;
        }

        @media (min-width: 768px) {
            .auto-hint {
                margin-top: 15px;
                font-size: 1.3em;
                min-height: 30px;
            }
        }

        .auto-hint.show {
            color: #f5576c;
        }

        .answer-area {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin-bottom: 20px;
            min-height: 60px;
            flex-wrap: wrap;
        }

        @media (min-width: 768px) {
            .answer-area {
                gap: 8px;
                margin-bottom: 30px;
                min-height: 80px;
            }
        }

        .letter-slot {
            width: 45px;
            height: 55px;
            border: 3px dashed #667eea;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
            background: #f0f4ff;
            transition: all 0.3s;
        }

        @media (min-width: 768px) {
            .letter-slot {
                width: 60px;
                height: 70px;
                font-size: 2em;
            }
        }

        .letter-slot.filled {
            background: #667eea;
            color: white;
            border-style: solid;
            transform: scale(1.05);
        }

        .letter-slot.correct {
            background: #10b981;
            border-color: #10b981;
            animation: celebrate 0.5s;
        }

        .letter-slot.wrong {
            background: #ef4444;
            border-color: #ef4444;
            animation: shake 0.5s;
        }

        @keyframes celebrate {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2) rotate(10deg); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .letters-pool {
            display: flex;
            justify-content: center;
            gap: 6px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        @media (min-width: 768px) {
            .letters-pool {
                gap: 10px;
                margin-bottom: 30px;
            }
        }

        .letter-tile {
            width: 45px;
            height: 55px;
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            font-weight: bold;
            color: white;
            cursor: grab;
            user-select: none;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        @media (min-width: 768px) {
            .letter-tile {
                width: 60px;
                height: 70px;
                font-size: 2em;
            }
        }

        .letter-tile:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.2);
        }

        .letter-tile:active {
            cursor: grabbing;
        }

        .letter-tile.used {
            opacity: 0.3;
            pointer-events: none;
        }

        .buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        @media (min-width: 768px) {
            .buttons {
                gap: 15px;
            }
        }

        .btn {
            padding: 12px 20px;
            font-size: 1em;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            color: white;
        }

        @media (min-width: 768px) {
            .btn {
                padding: 15px 30px;
                font-size: 1.2em;
            }
        }

        .btn small {
            font-size: 0.7em;
            opacity: 0.8;
            font-weight: normal;
            display: none;
        }

        @media (min-width: 768px) {
            .btn small {
                display: inline;
            }
        }

        .btn-check {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .btn-skip {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .btn-continue {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .btn-clear {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .feedback {
            text-align: center;
            margin-top: 15px;
            font-size: 1.2em;
            font-weight: bold;
            min-height: 35px;
        }

        @media (min-width: 768px) {
            .feedback {
                margin-top: 20px;
                font-size: 1.5em;
                min-height: 40px;
            }
        }

        .feedback.correct {
            color: #10b981;
            animation: fadeIn 0.5s;
        }

        .feedback.wrong {
            color: #ef4444;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .celebration {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 30px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            z-index: 1000;
            max-width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        @media (min-width: 768px) {
            .celebration {
                padding: 50px;
                max-width: 600px;
            }
        }

        .celebration.show {
            display: block;
            animation: popIn 0.5s;
        }

        @keyframes popIn {
            from { transform: translate(-50%, -50%) scale(0); }
            to { transform: translate(-50%, -50%) scale(1); }
        }

        .celebration h2 {
            font-size: 2em;
            color: #667eea;
            margin-bottom: 15px;
        }

        @media (min-width: 768px) {
            .celebration h2 {
                font-size: 3em;
                margin-bottom: 20px;
            }
        }

        .celebration .final-score {
            font-size: 1em;
            color: #333;
            margin-bottom: 20px;
        }

        @media (min-width: 768px) {
            .celebration .final-score {
                font-size: 1.2em;
                margin-bottom: 30px;
            }
        }

        /* Multiple Choice Styles */
        .mc-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        @media (min-width: 768px) {
            .mc-options {
                gap: 12px;
                margin-bottom: 30px;
            }
        }

        .mc-option {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            border: 3px solid #e0e0e0;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            background: #f8f9ff;
            font-size: 1em;
            text-align: left;
            user-select: none;
        }

        @media (min-width: 768px) {
            .mc-option {
                padding: 15px 20px;
                font-size: 1.15em;
            }
        }

        .mc-option:hover {
            border-color: #667eea;
            background: #eef0ff;
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .mc-option .mc-key {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 8px;
            font-weight: bold;
            font-size: 0.9em;
            margin-right: 12px;
            flex-shrink: 0;
        }

        .mc-option .mc-text {
            flex: 1;
        }

        .mc-option.selected {
            border-color: #667eea;
            background: #dde1ff;
            transform: translateX(5px);
        }

        .mc-option.mc-correct {
            border-color: #10b981;
            background: #d1fae5;
            animation: celebrate 0.5s;
        }

        .mc-option.mc-correct .mc-key {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .mc-option.mc-wrong {
            border-color: #ef4444;
            background: #fee2e2;
            animation: shake 0.5s;
        }

        .mc-option.mc-wrong .mc-key {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        .mc-option.mc-disabled {
            pointer-events: none;
            opacity: 0.7;
        }

        .mc-option.mc-disabled.mc-correct {
            opacity: 1;
        }

        .mode-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.7em;
            font-weight: bold;
            color: white;
            margin-top: 8px;
        }

        .mode-badge.spelling {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }

        .mode-badge.multiple-choice {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        /* Language Selection */
        .lang-card {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border-radius: 20px;
            padding: 30px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            border: 3px solid transparent;
        }
        .lang-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            border-color: #667eea;
        }
        .lang-card.latin {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
        }
        .lang-icon { font-size: 3em; margin-bottom: 10px; }
        .lang-title { font-size: 1.3em; font-weight: bold; color: #333; margin-bottom: 8px; }
        .lang-info { font-size: 1em; color: #666; }

        .back-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 15px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.95em;
            margin-bottom: 15px;
            transition: all 0.3s;
        }
        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .module-card {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            border-radius: 20px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            border: 3px solid transparent;
        }
        .module-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            border-color: #667eea;
        }
        .module-card.mixed {
            background: linear-gradient(135deg, #f9d423 0%, #ff4e50 100%);
        }
        .module-icon { font-size: 2.5em; margin-bottom: 8px; }
        .module-title { font-size: 1.1em; font-weight: bold; color: #333; margin-bottom: 5px; }
        .module-info { font-size: 0.9em; color: #666; }

        /* Sentence fill-in */
        .sentence-card {
            background: linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }
        .sentence-latin {
            font-size: 1.2em; font-style: italic; color: #444; margin-bottom: 12px;
        }
        .sentence-template {
            font-size: 1.3em; font-weight: bold; color: #333;
        }
        @media (min-width: 768px) {
            .sentence-latin { font-size: 1.4em; }
            .sentence-template { font-size: 1.5em; }
        }

        /* Emoji Curtain */
        .word-image-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }
        .curtain {
            display: none;
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            z-index: 2;
        }
        .curtain.active {
            display: flex;
        }
        .curtain-left, .curtain-right {
            width: 50%;
            height: 100%;
            background: repeating-linear-gradient(
                90deg,
                #8b1a1a 0px, #a52a2a 6px, #8b1a1a 12px, #701414 18px
            );
            box-shadow: inset 0 0 20px rgba(0,0,0,0.3);
        }
        .curtain-left {
            border-right: 2px solid #5a0e0e;
        }
        .curtain-right {
            border-left: 2px solid #5a0e0e;
        }
        .curtain-left::after, .curtain-right::after {
            content: '';
            display: block;
            width: 8px;
            height: 20px;
            background: #d4a017;
            border-radius: 0 0 4px 4px;
            margin-top: 4px;
        }
        .curtain-left::after {
            margin-left: auto;
            margin-right: 4px;
        }
        .curtain-right::after {
            margin-left: 4px;
        }
        .curtain.reveal .curtain-left {
            transform: translateX(-100%);
            transition: transform 0.6s ease-in-out;
        }
        .curtain.reveal .curtain-right {
            transform: translateX(100%);
            transition: transform 0.6s ease-in-out;
        }
        /* Terminal Table Training */
        .terminal-container {
            background: #0d1117;
            border-radius: 12px;
            overflow: hidden;
            font-family: 'Courier New', Monaco, monospace;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            margin: 0 auto 15px;
        }
        .terminal-header {
            background: #161b22;
            padding: 10px 14px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .terminal-dot { width: 12px; height: 12px; border-radius: 50%; display: inline-block; }
        .terminal-dot.red { background: #ff5f56; }
        .terminal-dot.yellow { background: #ffbd2e; }
        .terminal-dot.green { background: #27c93f; }
        .terminal-title { color: #8b949e; font-size: 0.85em; margin-left: 10px; }
        .terminal-body { padding: 12px; overflow-x: auto; }
        .terminal-tbl { border-collapse: collapse; color: #c9d1d9; font-size: 0.82em; white-space: nowrap; }
        .terminal-tbl th {
            color: #58a6ff; border-bottom: 2px solid #30363d;
            padding: 5px 8px; text-align: left; position: sticky; top: 0; background: #0d1117;
        }
        .terminal-tbl td { padding: 5px 8px; border-bottom: 1px solid #21262d; }
        .terminal-tbl .row-label { color: #d2a8ff; font-weight: bold; }
        .terminal-tbl .cell-blank {
            background: #161b22; border: 1px solid #39ff14; border-radius: 3px;
        }
        .terminal-tbl .cell-blank input {
            background: transparent; color: #39ff14; border: none;
            font-family: inherit; font-size: inherit; width: 100%; min-width: 80px;
            outline: none; caret-color: #39ff14; padding: 2px;
        }
        .terminal-tbl .cell-correct-flash { color: #39ff14; background: rgba(57,255,20,0.15); }
        .terminal-tbl .cell-wrong-flash { color: #ff4444; background: rgba(255,68,68,0.15); }
        .terminal-prompt {
            padding: 10px 14px; border-top: 1px solid #21262d;
            display: flex; align-items: center; gap: 8px; flex-wrap: wrap;
        }
        .terminal-prompt .prompt-symbol { color: #39ff14; font-weight: bold; }
        .terminal-prompt .prompt-hint { color: #8b949e; font-size: 0.9em; }
        .terminal-prompt .prompt-error { color: #ff4444; font-size: 0.9em; }
        #tableArea { display: none; }
        #tableCheckBtn {
            background: #161b22; color: #39ff14; border: 2px solid #39ff14;
            padding: 10px 25px; border-radius: 8px; font-family: 'Courier New', monospace;
            font-size: 1em; cursor: pointer; margin-top: 10px;
        }
        #tableCheckBtn:hover { background: #39ff14; color: #0d1117; }
        #tableSkipBtn { margin-left: 10px; margin-top: 10px; }
    </style>
</head>
<body>
    <!-- CHANGELOG SPLASH (shown once per version) -->
    <div class="game-container" id="changelogSplash" style="display: none;">
        <div class="header">
            <h1>ğŸ® Was ist neu?</h1>
            <p style="color: #666; margin-top: 10px;">Vokabel-Abenteuer â€“ Updates</p>
        </div>
        <div id="changelogContent" style="text-align: left; padding: 10px 20px; max-height: 55vh; overflow-y: auto;">
        </div>
        <button class="btn btn-check" onclick="dismissChangelog()" style="margin-top: 18px; font-size: 1.15em;">Los geht's! âœ</button>
    </div>

    <!-- LANGUAGE SELECTION (Top Level) -->
    <div class="game-container" id="languageSelection">
        <div class="header">
            <h1>ğŸ® Vokabel-Abenteuer</h1>
            <p style="color: #666; margin-top: 10px;">WÃ¤hle deine Sprache:</p>
        </div>
        <div class="set-selection">
            <div class="lang-card" onclick="selectLanguage('english')">
                <div class="lang-icon">ğŸ‡¬ğŸ‡§</div>
                <div class="lang-title">English</div>
                <div class="lang-info">Spelling &amp; Multiple Choice</div>
            </div>
            <div class="lang-card latin" onclick="selectLanguage('latin')">
                <div class="lang-icon">ğŸ›ï¸</div>
                <div class="lang-title">Latein</div>
                <div class="lang-info">Vokabeln, Verben &amp; SÃ¤tze</div>
            </div>
        </div>
        <div class="taler-display">
            <div style="font-size: 2em;">ğŸª™</div>
            <div>Deine Taler: <strong><span id="displayTalersMain">0</span>/50</strong></div>
            <button class="btn btn-clear" onclick="resetTalersFromMenu()" style="margin-top: 10px; font-size: 0.9em;">Taler zurÃ¼cksetzen</button>
            <button class="btn btn-skip" onclick="resetProgress()" style="margin-top: 10px; font-size: 0.9em;">Lernfortschritt zurÃ¼cksetzen</button>
        </div>
    </div>

    <!-- ENGLISH SET SELECTION -->
    <div class="game-container" id="setSelection" style="display: none;">
        <button class="back-btn" onclick="backToLanguage()">â† ZurÃ¼ck</button>
        <div class="header">
            <h1>ğŸ® English Spelling Adventure</h1>
            <p style="color: #666; margin-top: 10px;">WÃ¤hle dein Vokabel-Set:</p>
        </div>

        <div class="set-selection">
            <div class="set-card" onclick="startGame('theme2')">
                <div class="set-icon">ğŸ«</div>
                <div class="set-title">Theme 2: At School</div>
                <div class="set-info">77 Vokabeln</div>
                <div class="set-topics">SchulfÃ¤cher â€¢ Essen â€¢ Wochentage â€¢ Schule</div>
            </div>

            <div class="set-card" onclick="startGame('theme3')">
                <div class="set-icon">ğŸ­</div>
                <div class="set-title">Theme 3: Hobbies and Activities</div>
                <div class="set-info">98 Vokabeln</div>
                <div class="set-topics">Hobbys â€¢ GefÃ¼hle â€¢ AktivitÃ¤ten â€¢ Zeit</div>
            </div>

            <div class="set-card set-card-all" onclick="startGame('all')">
                <div class="set-icon">ğŸŒŸ</div>
                <div class="set-title">Alle Vokabeln</div>
                <div class="set-info">175 Vokabeln</div>
                <div class="set-topics">Theme 2 + Theme 3 gemischt</div>
            </div>
        </div>

    </div>

    <!-- LATIN CHAPTER SELECTION -->
    <div class="game-container" id="latinChapterSelection" style="display: none;">
        <button class="back-btn" onclick="backToLanguage()">â† ZurÃ¼ck</button>
        <div class="header">
            <h1>ğŸ›ï¸ Latein-Abenteuer</h1>
            <p style="color: #666; margin-top: 10px;">WÃ¤hle deine Lektion:</p>
        </div>
        <div class="set-selection">
            <div class="set-card latin" onclick="selectLatinChapter('chapter3')">
                <div class="set-icon">ğŸ“œ</div>
                <div class="set-title">Lektion 3</div>
                <div class="set-info">42 Vokabeln</div>
                <div class="set-topics">Circus Maximus â€¢ Vokabeln â€¢ Verben â€¢ SÃ¤tze</div>
            </div>
            <div class="set-card latin" onclick="selectLatinChapter('chapter4')">
                <div class="set-icon">ğŸ›ï¸</div>
                <div class="set-title">Lektion 4</div>
                <div class="set-info">43 Vokabeln</div>
                <div class="set-topics">Diana â€¢ Verwandlung â€¢ Vokabeln â€¢ Verben â€¢ SÃ¤tze</div>
            </div>
        </div>
    </div>

    <!-- LATIN MODULE SELECTION -->
    <div class="game-container" id="latinModuleSelection" style="display: none;">
        <button class="back-btn" onclick="backToLatinChapters()">â† ZurÃ¼ck</button>
        <div class="header">
            <h1>ğŸ›ï¸ Latein-Abenteuer</h1>
            <div class="current-set" id="latinChapterName"></div>
            <p style="color: #666; margin-top: 10px;">WÃ¤hle dein Modul:</p>
        </div>
        <div class="set-selection">
            <div class="module-card" onclick="startLatinModule('vocab')">
                <div class="module-icon">ğŸ“–</div>
                <div class="module-title">Vokabeln</div>
                <div class="module-info">Spelling &amp; Multiple Choice</div>
            </div>
            <div class="module-card" onclick="startLatinModule('verbs')">
                <div class="module-icon">âœï¸</div>
                <div class="module-title">Verb-Formen</div>
                <div class="module-info">Infinitiv, PrÃ¤sens &amp; Imperativ</div>
            </div>
            <div class="module-card" onclick="startLatinModule('nouns')">
                <div class="module-icon">ğŸ“</div>
                <div class="module-title">Substantive</div>
                <div class="module-info">Deklinieren: Nom/Gen/Dat/Akk/Abl</div>
            </div>
            <div class="module-card" onclick="startLatinModule('tables')" style="background: linear-gradient(135deg, #0d1117 0%, #161b22 100%);">
                <div class="module-icon">ğŸ’»</div>
                <div class="module-title" style="color: #39ff14;">Tabellentraining</div>
                <div class="module-info" style="color: #8b949e;">Konjugieren &amp; Deklinieren<br><small>âš ï¸ Nur Desktop / Tablet</small></div>
            </div>
            <div class="module-card" onclick="startLatinModule('sentences')">
                <div class="module-icon">ğŸ“</div>
                <div class="module-title">BeispielsÃ¤tze</div>
                <div class="module-info">LÃ¼ckentext Latein â†’ Deutsch</div>
            </div>
            <div class="module-card mixed" onclick="startLatinModule('mixed')">
                <div class="module-icon">ğŸŒŸ</div>
                <div class="module-title">Alles gemischt</div>
                <div class="module-info">Vokabeln + Verben + Substantive + SÃ¤tze</div>
            </div>
        </div>
    </div>

    <div class="game-container" id="gameContainer" style="display: none;">
        <button class="back-btn" id="gameBackBtn" onclick="backFromGame()">â† ZurÃ¼ck</button>
        <div class="header">
            <h1 id="gameTitle">ğŸ® English Spelling Adventure</h1>
            <div class="current-set" id="currentSetName"></div>
        </div>

        <div class="score-board">
            <div class="score-item">
                <div class="label">Punkte</div>
                <div class="value" id="score">0</div>
            </div>
            <div class="score-item">
                <div class="label">Wort</div>
                <div class="value"><span id="current">1</span>/<span id="total">10</span></div>
            </div>
            <div class="score-item">
                <div class="label">Richtig</div>
                <div class="value" id="correct">0</div>
            </div>
            <div class="score-item">
                <div class="label">ğŸ”„ Wiederh.</div>
                <div class="value" id="repeats">0</div>
            </div>
            <div class="score-item taler-item">
                <div class="label">ğŸª™ Taler</div>
                <div class="value"><span id="totalTalers">0</span>/50</div>
            </div>
        </div>

        <div class="word-card">
            <div class="word-image-wrapper" id="wordImageWrapper">
                <div class="word-image" id="wordImage">ğŸ±</div>
                <div class="curtain" id="emojiCurtain">
                    <div class="curtain-left"></div>
                    <div class="curtain-right"></div>
                </div>
            </div>
            <div class="word-german" id="wordGerman">Katze</div>
            <div class="word-hint" id="wordHint">Ein Haustier mit vier Beinen</div>
            <div class="auto-hint" id="autoHint"></div>
        </div>

        <div id="spellingArea">
            <div class="answer-area" id="answerArea"></div>
            <div class="letters-pool" id="lettersPool"></div>
        </div>

        <div id="mcArea" style="display: none;">
            <div class="mc-options" id="mcOptions"></div>
            <div style="text-align: center;">
                <button class="btn btn-continue" id="mcContinueBtn" style="display: none;" onclick="mcContinue()">â–¶ï¸ Weiter</button>
            </div>
        </div>

        <!-- Sentence fill-in area (Latin) -->
        <div id="sentenceArea" style="display: none;">
            <div class="sentence-card">
                <div class="sentence-latin" id="sentenceLatin"></div>
                <div class="sentence-template" id="sentenceTemplate"></div>
            </div>
            <div id="sentenceSpellingArea">
                <div class="answer-area" id="sentenceAnswerArea"></div>
                <div class="letters-pool" id="sentenceLettersPool"></div>
            </div>
        </div>

        <!-- MODE 4: TABLE TRAINING (Desktop only) -->
        <div id="tableArea" style="display: none;">
            <div id="terminalContainer" class="terminal-container"></div>
            <div style="text-align: center;">
                <button id="tableCheckBtn" onclick="checkTableAnswer()">âœ“ PrÃ¼fen (Enter)</button>
                <button class="btn btn-skip" id="tableSkipBtn" onclick="skipTableAnswer()">â†’ Ãœberspringen</button>
            </div>
        </div>

        <div class="buttons" id="spellingButtons">
            <button class="btn btn-clear" id="clearBtn">ğŸ”„ LÃ¶schen <small>(ESC)</small></button>
            <button class="btn btn-check" id="checkBtn">âœ“ PrÃ¼fen <small>(ENTER)</small></button>
            <button class="btn btn-skip" id="skipBtn">â†’ Ãœberspringen</button>
            <button class="btn btn-continue" id="continueBtn" style="display: none;">â–¶ï¸ Weiter</button>
        </div>

        <div class="feedback" id="feedback"></div>

        <div id="tipText" style="text-align: center; margin-top: 20px; color: #666; font-size: 0.9em;">
            ğŸ’¡ <strong>Tipp:</strong> Du kannst die Buchstaben auch mit der Tastatur eingeben!
            <br>Backspace = letzten Buchstaben lÃ¶schen | ESC = alles lÃ¶schen | Enter = prÃ¼fen
        </div>
    </div>

    <div class="celebration" id="celebration">
        <h2>ğŸ‰ Super gemacht! ğŸ‰</h2>
        <div class="final-score" id="finalScore"></div>
        <button class="btn btn-check" onclick="location.reload()">Nochmal spielen</button>
        <button class="btn btn-clear" onclick="resetTalers()" style="margin-top: 10px;">ğŸ”„ Taler zurÃ¼cksetzen</button>
    </div>

    <script>
        // ===================================================================
        // LATIN VOCABULARY DATA â€“ Lektion 3
        // ===================================================================

        const latinData = {
            chapter3: {
                name: 'Lektion 3',
                vocabulary: [
                    // Section 1
                    { latin: 'narrÄre', german: 'erzÃ¤hlen', image: 'ğŸ“–', hint: 'Eine Geschichte ...',
                      distractors: ['antworten', 'rufen', 'melden', 'prÃ¼fen'] },
                    { latin: 'puella', german: 'das MÃ¤dchen', image: 'ğŸ‘§', hint: 'Ein junges Kind (weiblich)',
                      distractors: ['der Junge', 'die Frau', 'die Schwester', 'die Freundin'] },
                    { latin: 'statim', german: 'sofort', image: 'âš¡', hint: 'Ohne zu warten',
                      distractors: ['spÃ¤ter', 'langsam', 'manchmal', 'gestern'] },
                    { latin: 'parÄre', german: '(vor)bereiten, vorhaben, erwerben', image: 'ğŸ”§', hint: 'Etwas vorbereiten',
                      distractors: ['zerstÃ¶ren', 'verlieren', 'vergessen', 'verbieten'] },
                    { latin: 'iniÅ«ria', german: 'das Unrecht, die Beleidigung', image: 'âš–ï¸', hint: 'Etwas Unfaires',
                      distractors: ['das Recht', 'die Hilfe', 'der Frieden', 'die Freude'] },
                    { latin: 'sustinÄ“re', german: 'ertragen, standhalten', image: 'ğŸ’ª', hint: 'Etwas aushalten',
                      distractors: ['aufgeben', 'weglaufen', 'vergessen', 'zerstÃ¶ren'] },
                    // Section 2
                    { latin: 'prohibÄ“re', german: 'abhalten, hindern, verhindern', image: 'ğŸš«', hint: 'Jemanden stoppen',
                      distractors: ['erlauben', 'helfen', 'einladen', 'loben'] },
                    { latin: 'paulum', german: 'ein wenig', image: 'ğŸ¤', hint: 'Nur ein bisschen',
                      distractors: ['sehr viel', 'immer', 'nichts', 'alles'] },
                    { latin: 'respondÄ“re', german: 'antworten', image: 'ğŸ’¬', hint: 'Auf eine Frage reagieren',
                      distractors: ['fragen', 'schweigen', 'rufen', 'erzÃ¤hlen'] },
                    { latin: 'certÄ“', german: 'gewiss, sicherlich', image: 'âœ…', hint: 'Ganz bestimmt',
                      distractors: ['vielleicht', 'niemals', 'selten', 'kaum'] },
                    { latin: 'indicÄre', german: 'anzeigen, melden', image: 'ğŸ‘†', hint: 'Auf etwas hinweisen',
                      distractors: ['verstecken', 'leugnen', 'vergessen', 'schweigen'] },
                    { latin: 'negÄre', german: 'leugnen, verneinen, verweigern', image: 'ğŸ™…', hint: 'Nein sagen',
                      distractors: ['zustimmen', 'bestÃ¤tigen', 'erlauben', 'loben'] },
                    { latin: 'culpa', german: 'die Schuld', image: 'ğŸ˜”', hint: 'Wer hat es getan?',
                      distractors: ['die Strafe', 'der Dank', 'die Hilfe', 'die Freude'] },
                    { latin: 'probÄre', german: 'prÃ¼fen, beweisen, fÃ¼r gut befinden', image: 'ğŸ”', hint: 'Etwas Ã¼berprÃ¼fen',
                      distractors: ['zerstÃ¶ren', 'verstecken', 'vergessen', 'verbieten'] },
                    // Section 3
                    { latin: 'bene', german: 'gut', image: 'ğŸ‘', hint: 'Das Gegenteil von schlecht',
                      distractors: ['schlecht', 'schnell', 'schÃ¶n', 'groÃŸ'] },
                    { latin: 'Å«nÄ', german: 'zusammen, zugleich', image: 'ğŸ¤', hint: 'Gemeinsam',
                      distractors: ['allein', 'getrennt', 'nachher', 'niemals'] },
                    { latin: 'prÅvidÄ“re', german: 'sorgen fÃ¼r', image: 'ğŸ›¡ï¸', hint: 'Sich um jemanden kÃ¼mmern',
                      distractors: ['vergessen', 'zerstÃ¶ren', 'verlieren', 'verbieten'] },
                    { latin: 'socius', german: 'der GefÃ¤hrte, der VerbÃ¼ndete', image: 'ğŸ¤œ', hint: 'Ein Freund und Helfer',
                      distractors: ['der Feind', 'der Fremde', 'der Richter', 'der Herr'] },
                    { latin: 'vocÄre', german: 'rufen, nennen', image: 'ğŸ“£', hint: 'Jemanden herbeirufen',
                      distractors: ['schweigen', 'hÃ¶ren', 'sehen', 'schreiben'] },
                    { latin: 'iterum', german: 'wieder(um), zum zweiten Mal', image: 'ğŸ”„', hint: 'Noch einmal',
                      distractors: ['niemals', 'einmal', 'sofort', 'gestern'] },
                    { latin: 'superÄre', german: 'besiegen, Ã¼berwinden, Ã¼bertreffen', image: 'ğŸ†', hint: 'StÃ¤rker sein als andere',
                      distractors: ['verlieren', 'aufgeben', 'fliehen', 'gehorchen'] },
                    { latin: 'dum', german: 'wÃ¤hrend, solange, bis', image: 'â³', hint: 'In der gleichen Zeit',
                      distractors: ['nachdem', 'bevor', 'weil', 'obwohl'] },
                    // Section 4
                    { latin: 'temptÄre', german: 'versuchen, prÃ¼fen, angreifen', image: 'ğŸ¯', hint: 'Etwas probieren',
                      distractors: ['aufgeben', 'vergessen', 'schlafen', 'warten'] },
                    { latin: 'cavÄ“re', german: 'vorsichtig sein, sich hÃ¼ten (vor)', image: 'âš ï¸', hint: 'Aufpassen!',
                      distractors: ['mutig sein', 'angreifen', 'vergessen', 'schlafen'] },
                    { latin: 'sententia', german: 'die Meinung, der Satz, der Sinn', image: 'ğŸ’­', hint: 'Was man denkt',
                      distractors: ['die Frage', 'die Antwort', 'der Streit', 'das Wort'] },
                    { latin: 'placÄ“re', german: 'gefallen', image: 'ğŸ˜Š', hint: 'Wenn etwas schÃ¶n ist',
                      distractors: ['missfallen', 'hassen', 'fÃ¼rchten', 'vergessen'] },
                    { latin: 'pÄrÄ“re', german: 'gehorchen', image: 'ğŸ«¡', hint: 'Tun, was man soll',
                      distractors: ['widersprechen', 'fliehen', 'kÃ¤mpfen', 'lÃ¼gen'] },
                    { latin: 'paulÅ', german: '(um) ein wenig', image: 'ğŸ¤', hint: 'Nur ein kleines bisschen',
                      distractors: ['sehr viel', 'immer', 'nichts', 'alles'] },
                    { latin: 'gladius', german: 'das Schwert', image: 'âš”ï¸', hint: 'Eine Waffe der RÃ¶mer',
                      distractors: ['der Schild', 'der Helm', 'der Speer', 'der Bogen'] },
                    // Section 5
                    { latin: 'animus', german: 'der Geist, der Mut, die Gesinnung', image: 'ğŸ§ ', hint: 'Was im Kopf steckt',
                      distractors: ['der KÃ¶rper', 'die Hand', 'das Herz', 'der FuÃŸ'] },
                    { latin: 'deesse', german: 'fehlen, abwesend sein, nicht da sein', image: 'âŒ', hint: 'Nicht vorhanden',
                      distractors: ['da sein', 'kommen', 'bleiben', 'helfen'] },
                    { latin: 'mandÄre', german: 'Ã¼bergeben, einen Auftrag geben', image: 'ğŸ“‹', hint: 'Jemandem etwas auftragen',
                      distractors: ['wegnehmen', 'verstecken', 'vergessen', 'zerstÃ¶ren'] },
                    { latin: 'poena', german: 'die Strafe', image: 'âš–ï¸', hint: 'Wenn man etwas Falsches getan hat',
                      distractors: ['die Belohnung', 'der Dank', 'das Lob', 'die Freude'] },
                    { latin: 'Ä«nstÄre', german: 'bevorstehen, bedrÃ¤ngen, drohen', image: 'â°', hint: 'Etwas kommt bald',
                      distractors: ['verschwinden', 'vergessen', 'weglaufen', 'aufhÃ¶ren'] },
                    { latin: 'grÄtia', german: 'der Dank', image: 'ğŸ™', hint: 'Wenn man dankbar ist',
                      distractors: ['der Zorn', 'die Schuld', 'die Strafe', 'der Hass'] },
                ],
                multiWord: [
                    { latin: 'SalvÄ“! SalvÄ“te!', german: 'Sei gegrÃ¼ÃŸt! Seid gegrÃ¼ÃŸt!',
                      germanDistractors: ['Auf Wiedersehen!', 'Guten Morgen!', 'Gute Nacht!', 'TschÃ¼ss!'],
                      latinDistractors: ['ValÄ“!', 'AvÄ“!', 'AbÄ«!', 'VenÄ«!'] },
                    { latin: 'quemadmodum', german: 'wie, auf welche Weise',
                      germanDistractors: ['warum', 'wann', 'wohin', 'wer'],
                      latinDistractors: ['cÅ«r', 'quandÅ', 'ubi', 'quis'] },
                    { latin: 'Circus Maximus', german: 'der Circus Maximus (Rennbahn fÃ¼r Wagenrennen in Rom)',
                      germanDistractors: ['das Kolosseum', 'das Forum Romanum', 'die Thermen', 'der Senat'],
                      latinDistractors: ['Colosseum', 'Forum RÅmÄnum', 'Thermae', 'SenÄtus'] },
                    { latin: 'nÅn dÄ“bÄ“re', german: 'nicht dÃ¼rfen, nicht mÃ¼ssen',
                      germanDistractors: ['mÃ¼ssen', 'kÃ¶nnen', 'wollen', 'sollen'],
                      latinDistractors: ['dÄ“bÄ“re', 'posse', 'velle', 'audÄ“re'] },
                    { latin: 'et ... et', german: 'sowohl ... als auch',
                      germanDistractors: ['weder ... noch', 'entweder ... oder', 'nicht nur ... sondern', 'zwar ... aber'],
                      latinDistractors: ['neque ... neque', 'aut ... aut', 'nÅn sÅlum ... sed', 'cum ... tum'] },
                    { latin: 'paulÅ post', german: 'wenig spÃ¤ter, kurz darauf',
                      germanDistractors: ['viel frÃ¼her', 'gleichzeitig', 'am nÃ¤chsten Tag', 'lange vorher'],
                      latinDistractors: ['multÅ ante', 'simul', 'postrÄ«diÄ“', 'Ålim'] },
                    { latin: 'grÄtiam dÄ“bÄ“re', german: 'Dank schulden',
                      germanDistractors: ['Strafe verdienen', 'Schuld haben', 'Hilfe brauchen', 'Lob verdienen'],
                      latinDistractors: ['poenam dare', 'culpam habÄ“re', 'auxilium petere', 'laudem merÄ“re'] },
                ],
                verbForms: [
                    { infinitive: 'narrÄre', firstPerson: 'narrÅ', german: 'erzÃ¤hlen',
                      present: { sg2: 'narrÄs', sg3: 'narrat', pl1: 'narrÄmus', pl2: 'narrÄtis', pl3: 'narrant' },
                      imperative: { sg: 'narrÄ', pl: 'narrÄte' } },
                    { infinitive: 'parÄre', firstPerson: 'parÅ', german: '(vor)bereiten',
                      present: { sg2: 'parÄs', sg3: 'parat', pl1: 'parÄmus', pl2: 'parÄtis', pl3: 'parant' },
                      imperative: { sg: 'parÄ', pl: 'parÄte' } },
                    { infinitive: 'sustinÄ“re', firstPerson: 'sustineÅ', german: 'ertragen',
                      present: { sg2: 'sustinÄ“s', sg3: 'sustinet', pl1: 'sustinÄ“mus', pl2: 'sustinÄ“tis', pl3: 'sustinent' },
                      imperative: { sg: 'sustinÄ“', pl: 'sustinÄ“te' } },
                    { infinitive: 'prohibÄ“re', firstPerson: 'prohibeÅ', german: 'abhalten',
                      present: { sg2: 'prohibÄ“s', sg3: 'prohibet', pl1: 'prohibÄ“mus', pl2: 'prohibÄ“tis', pl3: 'prohibent' },
                      imperative: { sg: 'prohibÄ“', pl: 'prohibÄ“te' } },
                    { infinitive: 'respondÄ“re', firstPerson: 'respondeÅ', german: 'antworten',
                      present: { sg2: 'respondÄ“s', sg3: 'respondet', pl1: 'respondÄ“mus', pl2: 'respondÄ“tis', pl3: 'respondent' },
                      imperative: { sg: 'respondÄ“', pl: 'respondÄ“te' } },
                    { infinitive: 'indicÄre', firstPerson: 'indicÅ', german: 'anzeigen',
                      present: { sg2: 'indicÄs', sg3: 'indicat', pl1: 'indicÄmus', pl2: 'indicÄtis', pl3: 'indicant' },
                      imperative: { sg: 'indicÄ', pl: 'indicÄte' } },
                    { infinitive: 'negÄre', firstPerson: 'negÅ', german: 'leugnen',
                      present: { sg2: 'negÄs', sg3: 'negat', pl1: 'negÄmus', pl2: 'negÄtis', pl3: 'negant' },
                      imperative: { sg: 'negÄ', pl: 'negÄte' } },
                    { infinitive: 'probÄre', firstPerson: 'probÅ', german: 'prÃ¼fen',
                      present: { sg2: 'probÄs', sg3: 'probat', pl1: 'probÄmus', pl2: 'probÄtis', pl3: 'probant' },
                      imperative: { sg: 'probÄ', pl: 'probÄte' } },
                    { infinitive: 'prÅvidÄ“re', firstPerson: 'prÅvideÅ', german: 'sorgen fÃ¼r',
                      present: { sg2: 'prÅvidÄ“s', sg3: 'prÅvidet', pl1: 'prÅvidÄ“mus', pl2: 'prÅvidÄ“tis', pl3: 'prÅvident' },
                      imperative: { sg: 'prÅvidÄ“', pl: 'prÅvidÄ“te' } },
                    { infinitive: 'vocÄre', firstPerson: 'vocÅ', german: 'rufen',
                      present: { sg2: 'vocÄs', sg3: 'vocat', pl1: 'vocÄmus', pl2: 'vocÄtis', pl3: 'vocant' },
                      imperative: { sg: 'vocÄ', pl: 'vocÄte' } },
                    { infinitive: 'superÄre', firstPerson: 'superÅ', german: 'besiegen',
                      present: { sg2: 'superÄs', sg3: 'superat', pl1: 'superÄmus', pl2: 'superÄtis', pl3: 'superant' },
                      imperative: { sg: 'superÄ', pl: 'superÄte' } },
                    { infinitive: 'temptÄre', firstPerson: 'temptÅ', german: 'versuchen',
                      present: { sg2: 'temptÄs', sg3: 'temptat', pl1: 'temptÄmus', pl2: 'temptÄtis', pl3: 'temptant' },
                      imperative: { sg: 'temptÄ', pl: 'temptÄte' } },
                    { infinitive: 'cavÄ“re', firstPerson: 'caveÅ', german: 'sich hÃ¼ten',
                      present: { sg2: 'cavÄ“s', sg3: 'cavet', pl1: 'cavÄ“mus', pl2: 'cavÄ“tis', pl3: 'cavent' },
                      imperative: { sg: 'cavÄ“', pl: 'cavÄ“te' } },
                    { infinitive: 'placÄ“re', firstPerson: 'placeÅ', german: 'gefallen',
                      present: { sg2: 'placÄ“s', sg3: 'placet', pl1: 'placÄ“mus', pl2: 'placÄ“tis', pl3: 'placent' },
                      imperative: { sg: 'placÄ“', pl: 'placÄ“te' } },
                    { infinitive: 'pÄrÄ“re', firstPerson: 'pÄreÅ', german: 'gehorchen',
                      present: { sg2: 'pÄrÄ“s', sg3: 'pÄret', pl1: 'pÄrÄ“mus', pl2: 'pÄrÄ“tis', pl3: 'pÄrent' },
                      imperative: { sg: 'pÄrÄ“', pl: 'pÄrÄ“te' } },
                    { infinitive: 'deesse', firstPerson: 'dÄ“sum', german: 'fehlen',
                      present: { sg2: 'dÄ“es', sg3: 'dÄ“est', pl1: 'dÄ“sumus', pl2: 'dÄ“estis', pl3: 'dÄ“sunt' },
                      imperative: null },
                    { infinitive: 'mandÄre', firstPerson: 'mandÅ', german: 'Ã¼bergeben',
                      present: { sg2: 'mandÄs', sg3: 'mandat', pl1: 'mandÄmus', pl2: 'mandÄtis', pl3: 'mandant' },
                      imperative: { sg: 'mandÄ', pl: 'mandÄte' } },
                    { infinitive: 'Ä«nstÄre', firstPerson: 'Ä«nstÅ', german: 'bevorstehen',
                      present: { sg2: 'Ä«nstÄs', sg3: 'Ä«nstat', pl1: 'Ä«nstÄmus', pl2: 'Ä«nstÄtis', pl3: 'Ä«nstant' },
                      imperative: null },
                ],
                sentences: [
                    { latin: 'Crassus equum parat.', germanTemplate: 'Crassus ___ ein Pferd.', answer: 'erwirbt', image: 'ğŸ´',
                      hint: 'parÄre = (vor)bereiten, erwerben' },
                    { latin: 'VictÅriam parat.', germanTemplate: 'Er ___ den Sieg vor.', answer: 'bereitet', image: 'ğŸ†',
                      hint: 'parÄre = vorbereiten' },
                    { latin: 'DÄvus equum servÄre parat.', germanTemplate: 'Davus ___ vor, das Pferd zu retten.', answer: 'hat', image: 'ğŸ',
                      hint: 'parÄre = vorhaben' },
                    { latin: 'IniÅ«riam nÅn sustineÅ.', germanTemplate: 'Ich ___ das Unrecht nicht.', answer: 'ertrage', image: 'ğŸ˜¤',
                      hint: 'sustinÄ“re = ertragen' },
                    { latin: 'Scorpus equum probat.', germanTemplate: 'Scorpus ___ das Pferd.', answer: 'prÃ¼ft', image: 'ğŸ”',
                      hint: 'probÄre = prÃ¼fen' },
                    { latin: 'DÄvus iniÅ«riam probat.', germanTemplate: 'Davus ___ das Unrecht.', answer: 'beweist', image: 'âš–ï¸',
                      hint: 'probÄre = beweisen' },
                    { latin: 'DÄvus IncitÄtÅ prÅvidet.', germanTemplate: 'Davus ___ fÃ¼r Incitatus.', answer: 'sorgt', image: 'ğŸ›¡ï¸',
                      hint: 'prÅvidÄ“re = sorgen fÃ¼r' },
                    { latin: 'DÄvus IncitÄtum servÄre temptat.', germanTemplate: 'Davus ___ Incitatus zu retten.', answer: 'versucht', image: 'ğŸ¯',
                      hint: 'temptÄre = versuchen' },
                    { latin: 'Symmachus IncitÄtum temptat.', germanTemplate: 'Symmachus ___ Incitatus an.', answer: 'greift', image: 'âš”ï¸',
                      hint: 'temptÄre = angreifen' },
                    { latin: 'Symmachum cavÄ“!', germanTemplate: '___ dich vor Symmachus!', answer: 'HÃ¼te', image: 'âš ï¸',
                      hint: 'cavÄ“re = sich hÃ¼ten (vor)' },
                    { latin: 'SymmachÅ animus deest.', germanTemplate: 'Symmachus ___ der Mut.', answer: 'fehlt', image: 'ğŸ˜°',
                      hint: 'deesse = fehlen' },
                    { latin: 'SymmachÅ poena Ä«nstat.', germanTemplate: 'Symmachus ___ eine Strafe.', answer: 'droht', image: 'âš–ï¸',
                      hint: 'Ä«nstÄre = drohen, bevorstehen' },
                ],
                nouns: [
                    // a-Deklination
                    { nom_sg: 'puella', gen_sg: 'puellae', dat_sg: 'puellae', akk_sg: 'puellam', abl_sg: 'puellÄ',
                      nom_pl: 'puellae', gen_pl: 'puellÄrum', dat_pl: 'puellÄ«s', akk_pl: 'puellÄs', abl_pl: 'puellÄ«s',
                      german: 'das MÃ¤dchen', image: 'ğŸ‘§', declension: 'a-Deklination' },
                    { nom_sg: 'iniÅ«ria', gen_sg: 'iniÅ«riae', dat_sg: 'iniÅ«riae', akk_sg: 'iniÅ«riam', abl_sg: 'iniÅ«riÄ',
                      nom_pl: 'iniÅ«riae', gen_pl: 'iniÅ«riÄrum', dat_pl: 'iniÅ«riÄ«s', akk_pl: 'iniÅ«riÄs', abl_pl: 'iniÅ«riÄ«s',
                      german: 'das Unrecht', image: 'âš–ï¸', declension: 'a-Deklination' },
                    { nom_sg: 'culpa', gen_sg: 'culpae', dat_sg: 'culpae', akk_sg: 'culpam', abl_sg: 'culpÄ',
                      nom_pl: 'culpae', gen_pl: 'culpÄrum', dat_pl: 'culpÄ«s', akk_pl: 'culpÄs', abl_pl: 'culpÄ«s',
                      german: 'die Schuld', image: 'ğŸ˜”', declension: 'a-Deklination' },
                    { nom_sg: 'sententia', gen_sg: 'sententiae', dat_sg: 'sententiae', akk_sg: 'sententiam', abl_sg: 'sententiÄ',
                      nom_pl: 'sententiae', gen_pl: 'sententiÄrum', dat_pl: 'sententiÄ«s', akk_pl: 'sententiÄs', abl_pl: 'sententiÄ«s',
                      german: 'die Meinung', image: 'ğŸ’­', declension: 'a-Deklination' },
                    { nom_sg: 'poena', gen_sg: 'poenae', dat_sg: 'poenae', akk_sg: 'poenam', abl_sg: 'poenÄ',
                      nom_pl: 'poenae', gen_pl: 'poenÄrum', dat_pl: 'poenÄ«s', akk_pl: 'poenÄs', abl_pl: 'poenÄ«s',
                      german: 'die Strafe', image: 'âš–ï¸', declension: 'a-Deklination' },
                    { nom_sg: 'grÄtia', gen_sg: 'grÄtiae', dat_sg: 'grÄtiae', akk_sg: 'grÄtiam', abl_sg: 'grÄtiÄ',
                      nom_pl: 'grÄtiae', gen_pl: 'grÄtiÄrum', dat_pl: 'grÄtiÄ«s', akk_pl: 'grÄtiÄs', abl_pl: 'grÄtiÄ«s',
                      german: 'der Dank', image: 'ğŸ™', declension: 'a-Deklination' },
                    // o-Deklination
                    { nom_sg: 'socius', gen_sg: 'sociÄ«', dat_sg: 'sociÅ', akk_sg: 'socium', abl_sg: 'sociÅ',
                      nom_pl: 'sociÄ«', gen_pl: 'sociÅrum', dat_pl: 'sociÄ«s', akk_pl: 'sociÅs', abl_pl: 'sociÄ«s',
                      german: 'der GefÃ¤hrte', image: 'ğŸ¤œ', declension: 'o-Deklination' },
                    { nom_sg: 'gladius', gen_sg: 'gladiÄ«', dat_sg: 'gladiÅ', akk_sg: 'gladium', abl_sg: 'gladiÅ',
                      nom_pl: 'gladiÄ«', gen_pl: 'gladiÅrum', dat_pl: 'gladiÄ«s', akk_pl: 'gladiÅs', abl_pl: 'gladiÄ«s',
                      german: 'das Schwert', image: 'âš”ï¸', declension: 'o-Deklination' },
                    { nom_sg: 'animus', gen_sg: 'animÄ«', dat_sg: 'animÅ', akk_sg: 'animum', abl_sg: 'animÅ',
                      nom_pl: 'animÄ«', gen_pl: 'animÅrum', dat_pl: 'animÄ«s', akk_pl: 'animÅs', abl_pl: 'animÄ«s',
                      german: 'der Geist', image: 'ğŸ§ ', declension: 'o-Deklination' },
                ]
            },

            chapter4: {
                name: 'Lektion 4',
                vocabulary: [
                    // Section 1
                    { latin: 'dÄ“', german: 'Ã¼ber; von, von ... her', image: 'â¬‡ï¸', hint: 'PrÃ¤position mit Ablativ â€“ Richtung weg',
                      distractors: ['unter', 'neben', 'mit', 'ohne'] },
                    { latin: 'atque', german: 'und, und auch', image: 'â•', hint: 'Verbindet zwei Dinge',
                      distractors: ['oder', 'aber', 'weder', 'sondern'] },
                    { latin: 'movÄ“re', german: 'bewegen, beeindrucken', image: 'ğŸ’«', hint: 'Etwas in Bewegung bringen',
                      distractors: ['stoppen', 'zerstÃ¶ren', 'vergessen', 'schlafen'] },
                    { latin: 'memoria', german: 'die Erinnerung, das GedÃ¤chtnis', image: 'ğŸ§ ', hint: 'Was man sich merkt',
                      distractors: ['der Traum', 'die Meinung', 'die Hoffnung', 'die Angst'] },
                    { latin: 'nÅlle', german: 'nicht wollen', image: 'ğŸ™…', hint: 'Das Gegenteil von wollen',
                      distractors: ['wollen', 'kÃ¶nnen', 'mÃ¼ssen', 'dÃ¼rfen'] },
                    { latin: 'procul', german: 'von fern, weit weg', image: 'ğŸŒ„', hint: 'Nicht in der NÃ¤he',
                      distractors: ['nahe', 'hier', 'sofort', 'innen'] },
                    { latin: 'DiÄna', german: 'Diana (GÃ¶ttin der Jagd)', image: 'ğŸ¹', hint: 'RÃ¶mische GÃ¶ttin mit Bogen',
                      distractors: ['Venus', 'Minerva', 'Juno', 'Ceres'] },
                    { latin: 'dea', german: 'die GÃ¶ttin', image: 'ğŸ‘‘', hint: 'Weibliche Gottheit',
                      distractors: ['der Gott', 'die KÃ¶nigin', 'die Priesterin', 'die Heldin'] },
                    // Section 2
                    { latin: 'cum', german: 'mit, zusammen mit', image: 'ğŸ¤', hint: 'PrÃ¤position â€“ gemeinsam',
                      distractors: ['ohne', 'gegen', 'neben', 'vor'] },
                    { latin: 'amÄ«ca', german: 'die Freundin', image: 'ğŸ‘©', hint: 'Eine weibliche Vertraute',
                      distractors: ['der Freund', 'die Feindin', 'die Schwester', 'die Herrin'] },
                    { latin: 'nÄ“scÄ«re', german: 'nicht wissen, nicht kennen', image: 'â“', hint: 'Keine Ahnung haben',
                      distractors: ['wissen', 'kennen', 'verstehen', 'erkennen'] },
                    { latin: 'amÄre', german: 'lieben', image: 'â¤ï¸', hint: 'Ein starkes GefÃ¼hl',
                      distractors: ['hassen', 'fÃ¼rchten', 'vergessen', 'verlieren'] },
                    { latin: 'timÄ“re', german: 'fÃ¼rchten, Angst haben (vor)', image: 'ğŸ˜¨', hint: 'Wenn man Angst hat',
                      distractors: ['lieben', 'hoffen', 'wollen', 'freuen'] },
                    { latin: 'in', german: 'in, an, auf, bei (wo?)', image: 'ğŸ“', hint: 'PrÃ¤p. m. Abl. â€“ Wo? Ortsangabe',
                      distractors: ['wohin?', 'woher?', 'wann?', 'warum?'] },
                    // Section 3
                    { latin: 'campus', german: 'das Feld, der freie Platz', image: 'ğŸŸï¸', hint: 'Eine offene FlÃ¤che',
                      distractors: ['der Wald', 'die Stadt', 'das Haus', 'der Berg'] },
                    { latin: 'Ä«ra', german: 'der Zorn, die Wut', image: 'ğŸ˜¡', hint: 'Starke VerÃ¤rgerung',
                      distractors: ['die Freude', 'die Trauer', 'die Liebe', 'die Angst'] },
                    { latin: 'sentÄ«re', german: 'fÃ¼hlen, meinen, wahrnehmen', image: 'ğŸ–ï¸', hint: 'Etwas spÃ¼ren',
                      distractors: ['sehen', 'hÃ¶ren', 'sprechen', 'schlafen'] },
                    { latin: 'ÄrdÄ“re', german: 'brennen', image: 'ğŸ”¥', hint: 'Feuer und Flamme',
                      distractors: ['lÃ¶schen', 'frieren', 'regnen', 'scheinen'] },
                    { latin: 'appellÄre', german: 'rufen, anrufen, nennen', image: 'ğŸ“£', hint: 'Jemanden beim Namen rufen',
                      distractors: ['schweigen', 'flÃ¼stern', 'hÃ¶ren', 'vergessen'] },
                    { latin: 'velle', german: 'wollen', image: 'ğŸ’ª', hint: 'Einen Wunsch haben',
                      distractors: ['nicht wollen', 'mÃ¼ssen', 'kÃ¶nnen', 'dÃ¼rfen'] },
                    { latin: 'propter', german: 'wegen', image: 'ğŸ”—', hint: 'Aus welchem Grund?',
                      distractors: ['trotz', 'ohne', 'gegen', 'neben'] },
                    { latin: 'tibi', german: 'dir, fÃ¼r dich', image: 'ğŸ‘‰', hint: 'Dativ von â€du"',
                      distractors: ['mir', 'ihm', 'uns', 'euch'] },
                    // Section 4
                    { latin: 'agitÄre', german: 'treiben, betreiben, Ã¼berlegen', image: 'ğŸƒ', hint: 'In Bewegung bringen',
                      distractors: ['stoppen', 'schlafen', 'warten', 'ruhen'] },
                    { latin: 'nÅnne?', german: '(etwa) nicht?', image: 'ğŸ¤¨', hint: 'Fragepartikel â€“ erwartet â€ja"',
                      distractors: ['warum?', 'wann?', 'wo?', 'wer?'] },
                    { latin: 'terrÄ“re', german: 'erschrecken', image: 'ğŸ‘»', hint: 'Jemandem Angst machen',
                      distractors: ['beruhigen', 'trÃ¶sten', 'helfen', 'loben'] },
                    { latin: 'fuga', german: 'die Flucht', image: 'ğŸƒâ€â™‚ï¸', hint: 'Schnell weglaufen',
                      distractors: ['der Kampf', 'der Sieg', 'die Ankunft', 'die Ruhe'] },
                    { latin: 'in', german: 'in (... hinein), nach (wohin?); gegen', image: 'â¡ï¸', hint: 'PrÃ¤p. m. Akk. â€“ Wohin? Richtungsangabe',
                      distractors: ['wo?', 'woher?', 'wann?', 'warum?'] },
                    { latin: 'silva', german: 'der Wald', image: 'ğŸŒ²', hint: 'Viele BÃ¤ume',
                      distractors: ['das Feld', 'der Fluss', 'der Berg', 'die Wiese'] },
                    { latin: 'oculus', german: 'das Auge', image: 'ğŸ‘ï¸', hint: 'Damit sieht man',
                      distractors: ['das Ohr', 'die Nase', 'der Mund', 'die Hand'] },
                    { latin: 'tamen', german: 'dennoch, jedoch', image: 'â†©ï¸', hint: 'Trotzdem',
                      distractors: ['deshalb', 'also', 'denn', 'weil'] },
                    // Section 5
                    { latin: 'enim', german: 'denn, nÃ¤mlich', image: 'ğŸ’¡', hint: 'BegrÃ¼ndung (nachgestellt)',
                      distractors: ['aber', 'oder', 'trotzdem', 'also'] },
                    { latin: 'vÄ«tÄre', german: 'meiden, vermeiden', image: 'ğŸš«', hint: 'Etwas umgehen',
                      distractors: ['suchen', 'finden', 'treffen', 'einladen'] },
                    { latin: 'profectÅ', german: 'sicherlich, tatsÃ¤chlich', image: 'âœ…', hint: 'Ganz bestimmt',
                      distractors: ['vielleicht', 'niemals', 'selten', 'kaum'] },
                    { latin: 'mÅ«tÄre', german: 'Ã¤ndern, verÃ¤ndern, verwandeln', image: 'ğŸ”„', hint: 'Etwas anders machen',
                      distractors: ['behalten', 'bewahren', 'schÃ¼tzen', 'festhalten'] },
                    { latin: 'Ä“/ex', german: 'aus, von ... her', image: 'ğŸšª', hint: 'Heraus aus etwas',
                      distractors: ['in', 'auf', 'neben', 'unter'] },
                    { latin: 'at', german: 'aber, jedoch', image: 'âš¡', hint: 'Gegensatz',
                      distractors: ['und', 'auch', 'denn', 'also'] },
                    { latin: 'circumvenÄ«re', german: 'umringen, umzingeln', image: 'â­•', hint: 'Von allen Seiten einschlieÃŸen',
                      distractors: ['befreien', 'fliehen', 'verlassen', 'Ã¶ffnen'] },
                    { latin: 'prope', german: 'nahe, in der NÃ¤he; beinahe', image: 'ğŸ“Œ', hint: 'Nicht weit entfernt',
                      distractors: ['fern', 'weit weg', 'niemals', 'selten'] },
                    { latin: '-que', german: 'und (angehÃ¤ngt)', image: 'ğŸ”—', hint: 'Wird ans Wort angehÃ¤ngt',
                      distractors: ['oder', 'aber', 'nicht', 'auch'] },
                ],
                multiWord: [
                    { latin: 'cÅgitÄre dÄ“', german: 'denken an, nachdenken Ã¼ber',
                      germanDistractors: ['vergessen', 'weglaufen von', 'kÃ¤mpfen gegen', 'warten auf'],
                      latinDistractors: ['fugere ab', 'pugnÄre contrÄ', 'exspectÄre', 'vidÄ“re'] },
                    { latin: 'nÅn nÄ“scÄ«re', german: 'genau wissen, genau kennen',
                      germanDistractors: ['nicht wissen', 'vergessen', 'nicht verstehen', 'bezweifeln'],
                      latinDistractors: ['nÄ“scÄ«re', 'oblÄ«vÄ«scÄ«', 'dubitÄre', 'ignÅrÄre'] },
                    { latin: 'memoriÄ tenÄ“re', german: 'im GedÃ¤chtnis behalten',
                      germanDistractors: ['vergessen', 'aufschreiben', 'erzÃ¤hlen', 'verlieren'],
                      latinDistractors: ['oblÄ«vÄ«scÄ«', 'scrÄ«bere', 'narrÄre', 'Ämittere'] },
                    { latin: 'DÄvus Syrusque', german: 'Davus und Syrus (-que = und)',
                      germanDistractors: ['Davus oder Syrus', 'Davus ohne Syrus', 'Davus gegen Syrus', 'Davus vor Syrus'],
                      latinDistractors: ['DÄvus aut Syrus', 'DÄvus sine SyrÅ', 'DÄvus contrÄ Syrum', 'DÄvus ante Syrum'] },
                ],
                verbForms: [
                    { infinitive: 'movÄ“re', firstPerson: 'moveÅ', german: 'bewegen',
                      present: { sg2: 'movÄ“s', sg3: 'movet', pl1: 'movÄ“mus', pl2: 'movÄ“tis', pl3: 'movent' },
                      imperative: { sg: 'movÄ“', pl: 'movÄ“te' } },
                    { infinitive: 'nÅlle', firstPerson: 'nÅlÅ', german: 'nicht wollen',
                      present: { sg2: 'nÅn vÄ«s', sg3: 'nÅn vult', pl1: 'nÅlumus', pl2: 'nÅn vultis', pl3: 'nÅlunt' },
                      imperative: { sg: 'nÅlÄ«', pl: 'nÅlÄ«te' } },
                    { infinitive: 'nÄ“scÄ«re', firstPerson: 'nÄ“sciÅ', german: 'nicht wissen',
                      present: { sg2: 'nÄ“scÄ«s', sg3: 'nÄ“scit', pl1: 'nÄ“scÄ«mus', pl2: 'nÄ“scÄ«tis', pl3: 'nÄ“sciunt' },
                      imperative: { sg: 'nÄ“scÄ«', pl: 'nÄ“scÄ«te' } },
                    { infinitive: 'amÄre', firstPerson: 'amÅ', german: 'lieben',
                      present: { sg2: 'amÄs', sg3: 'amat', pl1: 'amÄmus', pl2: 'amÄtis', pl3: 'amant' },
                      imperative: { sg: 'amÄ', pl: 'amÄte' } },
                    { infinitive: 'timÄ“re', firstPerson: 'timeÅ', german: 'fÃ¼rchten',
                      present: { sg2: 'timÄ“s', sg3: 'timet', pl1: 'timÄ“mus', pl2: 'timÄ“tis', pl3: 'timent' },
                      imperative: { sg: 'timÄ“', pl: 'timÄ“te' } },
                    { infinitive: 'sentÄ«re', firstPerson: 'sentiÅ', german: 'fÃ¼hlen',
                      present: { sg2: 'sentÄ«s', sg3: 'sentit', pl1: 'sentÄ«mus', pl2: 'sentÄ«tis', pl3: 'sentiunt' },
                      imperative: { sg: 'sentÄ«', pl: 'sentÄ«te' } },
                    { infinitive: 'ÄrdÄ“re', firstPerson: 'ÄrdeÅ', german: 'brennen',
                      present: { sg2: 'ÄrdÄ“s', sg3: 'Ärdet', pl1: 'ÄrdÄ“mus', pl2: 'ÄrdÄ“tis', pl3: 'Ärdent' },
                      imperative: { sg: 'ÄrdÄ“', pl: 'ÄrdÄ“te' } },
                    { infinitive: 'appellÄre', firstPerson: 'appellÅ', german: 'rufen',
                      present: { sg2: 'appellÄs', sg3: 'appellat', pl1: 'appellÄmus', pl2: 'appellÄtis', pl3: 'appellant' },
                      imperative: { sg: 'appellÄ', pl: 'appellÄte' } },
                    { infinitive: 'velle', firstPerson: 'volÅ', german: 'wollen',
                      present: { sg2: 'vÄ«s', sg3: 'vult', pl1: 'volumus', pl2: 'vultis', pl3: 'volunt' },
                      imperative: null },
                    { infinitive: 'agitÄre', firstPerson: 'agitÅ', german: 'treiben',
                      present: { sg2: 'agitÄs', sg3: 'agitat', pl1: 'agitÄmus', pl2: 'agitÄtis', pl3: 'agitant' },
                      imperative: { sg: 'agitÄ', pl: 'agitÄte' } },
                    { infinitive: 'terrÄ“re', firstPerson: 'terreÅ', german: 'erschrecken',
                      present: { sg2: 'terrÄ“s', sg3: 'terret', pl1: 'terrÄ“mus', pl2: 'terrÄ“tis', pl3: 'terrent' },
                      imperative: { sg: 'terrÄ“', pl: 'terrÄ“te' } },
                    { infinitive: 'vÄ«tÄre', firstPerson: 'vÄ«tÅ', german: 'meiden',
                      present: { sg2: 'vÄ«tÄs', sg3: 'vÄ«tat', pl1: 'vÄ«tÄmus', pl2: 'vÄ«tÄtis', pl3: 'vÄ«tant' },
                      imperative: { sg: 'vÄ«tÄ', pl: 'vÄ«tÄte' } },
                    { infinitive: 'mÅ«tÄre', firstPerson: 'mÅ«tÅ', german: 'Ã¤ndern',
                      present: { sg2: 'mÅ«tÄs', sg3: 'mÅ«tat', pl1: 'mÅ«tÄmus', pl2: 'mÅ«tÄtis', pl3: 'mÅ«tant' },
                      imperative: { sg: 'mÅ«tÄ', pl: 'mÅ«tÄte' } },
                    { infinitive: 'circumvenÄ«re', firstPerson: 'circumveniÅ', german: 'umringen',
                      present: { sg2: 'circumvenÄ«s', sg3: 'circumvenit', pl1: 'circumvenÄ«mus', pl2: 'circumvenÄ«tis', pl3: 'circumveniunt' },
                      imperative: { sg: 'circumvenÄ«', pl: 'circumvenÄ«te' } },
                ],
                sentences: [
                    { latin: 'Dea Symmachum in equum mÅ«tat.', germanTemplate: 'Die GÃ¶ttin ___ Symmachus in ein Pferd.', answer: 'verwandelt', image: 'ğŸ´',
                      hint: 'mÅ«tÄre = Ã¤ndern, verwandeln' },
                    { latin: 'Symmachus Ä“ tabernÄ venit.', germanTemplate: 'Symmachus kommt ___ dem Gasthaus.', answer: 'aus', image: 'ğŸšª',
                      hint: 'Ä“/ex = aus, von ... her' },
                    { latin: 'DÄvus cum Ä€frÄ venit.', germanTemplate: 'Davus kommt zusammen ___ Afra.', answer: 'mit', image: 'ğŸ¤',
                      hint: 'cum = mit, zusammen mit' },
                    { latin: 'DiÄna Ä«rÄ Ärdet.', germanTemplate: 'Diana ___ vor Wut.', answer: 'brennt', image: 'ğŸ”¥',
                      hint: 'ÄrdÄ“re = brennen' },
                    { latin: 'DiÄna propter iniÅ«riam dÄ“ poenÄ cÅgitat.', germanTemplate: 'Diana denkt ___ des Unrechts Ã¼ber eine Strafe nach.', answer: 'wegen', image: 'âš–ï¸',
                      hint: 'propter = wegen' },
                    { latin: 'Symmachus in tabernÄ sedet.', germanTemplate: 'Symmachus sitzt ___ Gasthaus.', answer: 'im', image: 'ğŸ ',
                      hint: 'in m. Abl. = in (wo?)' },
                    { latin: 'DÄvus in viÄ stat.', germanTemplate: 'Davus steht ___ der StraÃŸe.', answer: 'auf', image: 'ğŸ›¤ï¸',
                      hint: 'in m. Abl. = auf (wo?)' },
                    { latin: 'Symmachus in tabernam properat.', germanTemplate: 'Symmachus eilt ___ das Gasthaus.', answer: 'in', image: 'ğŸƒ',
                      hint: 'in m. Akk. = in ... hinein (wohin?)' },
                    { latin: 'DÄvus Syrusque adsunt.', germanTemplate: 'Davus ___ Syrus sind da.', answer: 'und', image: 'ğŸ‘¥',
                      hint: '-que = und (angehÃ¤ngt)' },
                ],
                nouns: [
                    // a-Deklination
                    { nom_sg: 'memoria', gen_sg: 'memoriae', dat_sg: 'memoriae', akk_sg: 'memoriam', abl_sg: 'memoriÄ',
                      nom_pl: 'memoriae', gen_pl: 'memoriÄrum', dat_pl: 'memoriÄ«s', akk_pl: 'memoriÄs', abl_pl: 'memoriÄ«s',
                      german: 'die Erinnerung', image: 'ğŸ§ ', declension: 'a-Deklination' },
                    { nom_sg: 'dea', gen_sg: 'deae', dat_sg: 'deae', akk_sg: 'deam', abl_sg: 'deÄ',
                      nom_pl: 'deae', gen_pl: 'deÄrum', dat_pl: 'deÄbus', akk_pl: 'deÄs', abl_pl: 'deÄbus',
                      german: 'die GÃ¶ttin', image: 'ğŸ‘‘', declension: 'a-Deklination' },
                    { nom_sg: 'amÄ«ca', gen_sg: 'amÄ«cae', dat_sg: 'amÄ«cae', akk_sg: 'amÄ«cam', abl_sg: 'amÄ«cÄ',
                      nom_pl: 'amÄ«cae', gen_pl: 'amÄ«cÄrum', dat_pl: 'amÄ«cÄ«s', akk_pl: 'amÄ«cÄs', abl_pl: 'amÄ«cÄ«s',
                      german: 'die Freundin', image: 'ğŸ‘©', declension: 'a-Deklination' },
                    { nom_sg: 'Ä«ra', gen_sg: 'Ä«rae', dat_sg: 'Ä«rae', akk_sg: 'Ä«ram', abl_sg: 'Ä«rÄ',
                      nom_pl: 'Ä«rae', gen_pl: 'Ä«rÄrum', dat_pl: 'Ä«rÄ«s', akk_pl: 'Ä«rÄs', abl_pl: 'Ä«rÄ«s',
                      german: 'der Zorn', image: 'ğŸ˜¡', declension: 'a-Deklination' },
                    { nom_sg: 'fuga', gen_sg: 'fugae', dat_sg: 'fugae', akk_sg: 'fugam', abl_sg: 'fugÄ',
                      nom_pl: 'fugae', gen_pl: 'fugÄrum', dat_pl: 'fugÄ«s', akk_pl: 'fugÄs', abl_pl: 'fugÄ«s',
                      german: 'die Flucht', image: 'ğŸƒâ€â™‚ï¸', declension: 'a-Deklination' },
                    { nom_sg: 'silva', gen_sg: 'silvae', dat_sg: 'silvae', akk_sg: 'silvam', abl_sg: 'silvÄ',
                      nom_pl: 'silvae', gen_pl: 'silvÄrum', dat_pl: 'silvÄ«s', akk_pl: 'silvÄs', abl_pl: 'silvÄ«s',
                      german: 'der Wald', image: 'ğŸŒ²', declension: 'a-Deklination' },
                    // o-Deklination
                    { nom_sg: 'campus', gen_sg: 'campÄ«', dat_sg: 'campÅ', akk_sg: 'campum', abl_sg: 'campÅ',
                      nom_pl: 'campÄ«', gen_pl: 'campÅrum', dat_pl: 'campÄ«s', akk_pl: 'campÅs', abl_pl: 'campÄ«s',
                      german: 'das Feld', image: 'ğŸŸï¸', declension: 'o-Deklination' },
                    { nom_sg: 'oculus', gen_sg: 'oculÄ«', dat_sg: 'oculÅ', akk_sg: 'oculum', abl_sg: 'oculÅ',
                      nom_pl: 'oculÄ«', gen_pl: 'oculÅrum', dat_pl: 'oculÄ«s', akk_pl: 'oculÅs', abl_pl: 'oculÄ«s',
                      german: 'das Auge', image: 'ğŸ‘ï¸', declension: 'o-Deklination' },
                    // Eigenname (nur Singular)
                    { nom_sg: 'DiÄna', gen_sg: 'DiÄnae', dat_sg: 'DiÄnae', akk_sg: 'DiÄnam', abl_sg: 'DiÄnÄ',
                      nom_pl: null, gen_pl: null, dat_pl: null, akk_pl: null, abl_pl: null,
                      german: 'Diana', image: 'ğŸ¹', declension: 'a-Deklination (Eigenname)' },
                ]
            }
        };

        // ===================================================================
        // ENGLISH VOCABULARY DATA
        // Each word has: english, german, image, hint, distractors (4 pitfall wrong DE translations)
        // Distractors are curated near-misses for 5th grade level
        // ===================================================================

        const vocabularyTheme2 = [
            // Theme 2: At school - Page 1
            { english: 'idea', german: 'Idee, Einfall', image: 'ğŸ’¡', hint: 'Ein guter Gedanke',
              distractors: ['Ideal', 'Meinung', 'Traum', 'Wunsch'] },
            { english: 'next', german: 'nÃ¤chste(r, s)', image: 'â¡ï¸', hint: 'Was kommt danach?',
              distractors: ['letzte(r, s)', 'neue(r, s)', 'beste(r, s)', 'andere(r, s)'] },
            { english: 'outside', german: 'drauÃŸen', image: 'ğŸŒ³', hint: 'Nicht drinnen',
              distractors: ['drinnen', 'daneben', 'oben', 'hinten'] },
            { english: 'quite', german: 'ziemlich, ganz', image: 'âœ¨', hint: 'Sehr, aber nicht ganz',
              distractors: ['ruhig', 'leise', 'schnell', 'still'] },
            { english: 'sure', german: 'sicher', image: 'âœ“', hint: 'Ohne Zweifel',
              distractors: ['unsicher', 'streng', 'vielleicht', 'Ã¼berrascht'] },
            { english: 'thanks', german: 'Danke', image: 'ğŸ™', hint: 'HÃ¶flich sein',
              distractors: ['Bitte', 'Entschuldigung', 'Hallo', 'TschÃ¼ss'] },
            { english: 'diary', german: 'Tagebuch', image: 'ğŸ“”', hint: 'PersÃ¶nliche Notizen',
              distractors: ['WÃ¶rterbuch', 'Kalender', 'Notizbuch', 'Molkerei'] },
            { english: 'music', german: 'Musik', image: 'ğŸµ', hint: 'Klingt gut',
              distractors: ['Museum', 'Musical', 'Muskel', 'Muster'] },
            { english: 'lunch', german: 'Mittagessen', image: 'ğŸ½ï¸', hint: 'Mahlzeit am Mittag',
              distractors: ['FrÃ¼hstÃ¼ck', 'Abendessen', 'Snack', 'Pause'] },
            { english: 'meet', german: 'treffen', image: 'ğŸ‘¥', hint: 'Jemanden sehen',
              distractors: ['Fleisch', 'essen', 'grÃ¼ÃŸen', 'kennen'] },
            { english: 'after', german: 'nach', image: 'â°', hint: 'Danach',
              distractors: ['vor', 'wÃ¤hrend', 'Nachmittag', 'spÃ¤ter'] },
            { english: 'real', german: 'wirklich, echt', image: 'ğŸ’¯', hint: 'Nicht falsch',
              distractors: ['falsch', 'lesen', 'kÃ¶niglich', 'selten'] },
            { english: 'both', german: 'beide(s)', image: 'ğŸ‘¥', hint: 'Zwei zusammen',
              distractors: ['alle', 'jeder', 'einige', 'keiner'] },
            { english: 'french', german: 'FranzÃ¶sisch', image: 'ğŸ‡«ğŸ‡·', hint: 'Sprache aus Frankreich',
              distractors: ['Englisch', 'Spanisch', 'Frankreich', 'frisch'] },
            { english: 'make', german: 'machen, erstellen', image: 'ğŸ”¨', hint: 'Etwas herstellen',
              distractors: ['nehmen', 'backen', 'mÃ¶gen', 'Marke'] },
            { english: 'think', german: 'denken, glauben, meinen', image: 'ğŸ¤”', hint: 'Im Kopf Ã¼berlegen',
              distractors: ['trinken', 'danken', 'Ding', 'dÃ¼nn'] },
            { english: 'stupid', german: 'dumm, blÃ¶d', image: 'ğŸ˜µ', hint: 'Nicht schlau',
              distractors: ['schlau', 'langsam', 'Student', 'seltsam'] },
            { english: 'pet', german: 'Haustier', image: 'ğŸ•', hint: 'Tier zu Hause',
              distractors: ['Pfanne', 'Stift', 'Topf', 'Wildtier'] },
            { english: 'art', german: 'Kunst(unterricht)', image: 'ğŸ¨', hint: 'Kreatives Fach',
              distractors: ['Musik', 'Sport', 'Art und Weise', 'Herz'] },
            { english: 'library', german: 'Bibliothek, BÃ¼cherei', image: 'ğŸ“š', hint: 'Viele BÃ¼cher zum Ausleihen',
              distractors: ['Buchhandlung', 'Labor', 'Freiheit', 'BÃ¼ro'] },
            { english: 'science', german: 'Naturwissenschaft', image: 'ğŸ”¬', hint: 'Biologie, Chemie, Physik',
              distractors: ['Stille', 'Kunst', 'Sozialkunde', 'Informatik'] },
            { english: 'number', german: 'Zahl, Ziffer, Nummer', image: 'ğŸ”¢', hint: '1, 2, 3...',
              distractors: ['Buchstabe', 'Name', 'taub', 'Menge'] },
            { english: 'drama', german: 'Drama, Theater', image: 'ğŸ­', hint: 'Schauspiel',
              distractors: ['Traum', 'Musik', 'Film', 'Kino'] },
            { english: 'english', german: 'Englisch', image: 'ğŸ‡¬ğŸ‡§', hint: 'Diese Sprache!',
              distractors: ['England', 'FranzÃ¶sisch', 'Deutsch', 'Spanisch'] },
            { english: 'geography', german: 'Erdkunde, Geografie', image: 'ğŸ—ºï¸', hint: 'LÃ¤nder und StÃ¤dte',
              distractors: ['Geschichte', 'Geometrie', 'Geologie', 'Biologie'] },
            { english: 'history', german: 'Geschichte', image: 'ğŸ“œ', hint: 'Die Vergangenheit',
              distractors: ['ErzÃ¤hlung', 'Erdkunde', 'Geheimnis', 'Wissenschaft'] },
            { english: 'maths', german: 'Mathe', image: 'â—', hint: 'Rechnen',
              distractors: ['Physik', 'StreichhÃ¶lzer', 'Karten', 'Kunst'] },
            { english: 'face', german: 'Gesicht', image: 'ğŸ˜Š', hint: 'Augen, Nase, Mund',
              distractors: ['Fest', 'Tatsache', 'Platz', 'Kopf'] },
            { english: 'seat', german: 'Sitzplatz', image: 'ğŸ’º', hint: 'Zum Hinsetzen',
              distractors: ['Meer', 'Hitze', 'StraÃŸe', 'SchweiÃŸ'] },
            { english: 'lunchbox', german: 'Lunchbox, Brotdose', image: 'ğŸ¥ª', hint: 'Essen fÃ¼r die Pause',
              distractors: ['Schultasche', 'Mittagessen', 'Brotkorb', 'KÃ¼hlschrank'] },
            { english: 'grumpy', german: 'mÃ¼rrisch, schlecht gelaunt', image: 'ğŸ˜ ', hint: 'Schlechte Laune',
              distractors: ['lustig', 'hungrig', 'mÃ¼de', 'traurig'] },
            { english: 'first', german: 'zuerst, als Erstes', image: 'ğŸ¥‡', hint: 'Nummer eins',
              distractors: ['letzte(r)', 'schnell', 'Faust', 'beste(r)'] },

            // Theme 2: At school - Page 2
            { english: 'timetable', german: 'Stundenplan', image: 'ğŸ“…', hint: 'Wann welches Fach?',
              distractors: ['Zeugnis', 'Zeitzone', 'Kalender', 'Tabelle'] },
            { english: 'today', german: 'heute', image: 'ğŸ“†', hint: 'Dieser Tag',
              distractors: ['morgen', 'gestern', 'jetzt', 'immer'] },
            { english: 'before', german: 'vor', image: 'âª', hint: 'Vorher',
              distractors: ['nach', 'wÃ¤hrend', 'hinter', 'neben'] },
            { english: 'morning', german: 'Morgen, Vormittag', image: 'ğŸŒ…', hint: 'FrÃ¼h am Tag',
              distractors: ['Abend', 'Nachmittag', 'Nacht', 'Mittag'] },
            { english: 'break', german: 'Pause', image: 'â¸ï¸', hint: 'Kurze Unterbrechung',
              distractors: ['BrÃ¼cke', 'FrÃ¼hstÃ¼ck', 'kaputt', 'Bremse'] },
            { english: 'sir', german: 'Herr', image: 'ğŸ‘¨â€ğŸ«', hint: 'HÃ¶fliche Anrede mÃ¤nnlich',
              distractors: ['Frau', 'Schwester', 'KÃ¶nig', 'Ritter'] },
            { english: 'afternoon', german: 'Nachmittag', image: 'ğŸŒ¤ï¸', hint: 'Nach dem Mittag',
              distractors: ['Vormittag', 'Abend', 'Mittag', 'Morgen'] },
            { english: 'when', german: 'wann', image: 'â°', hint: 'Zu welcher Zeit?',
              distractors: ['wo', 'wer', 'was', 'wie'] },
            { english: 'what', german: 'welche(r, s)', image: 'â“', hint: 'Welches?',
              distractors: ['wann', 'wo', 'wer', 'wie'] },
            { english: 'puzzle', german: 'RÃ¤tsel, Fragespiel', image: 'ğŸ§©', hint: 'Knifflige Aufgabe',
              distractors: ['Pudding', 'Spiel', 'Problem', 'Muskel'] },
            { english: 'understand', german: 'verstehen', image: 'ğŸ’­', hint: 'Begreifen',
              distractors: ['unter stehen', 'missverstehen', 'erklÃ¤ren', 'wissen'] },
            { english: 'weird', german: 'merkwÃ¼rdig, seltsam, komisch', image: 'ğŸ¤¨', hint: 'Nicht normal',
              distractors: ['mÃ¼de', 'wild', 'weit', 'breit'] },
            { english: 'crown', german: 'Krone', image: 'ğŸ‘‘', hint: 'KÃ¶nig trÃ¤gt das',
              distractors: ['Clown', 'braun', 'KrÃ¤he', 'Menge'] },
            { english: 'flag', german: 'Fahne, Flagge', image: 'ğŸš©', hint: 'Symbol eines Landes',
              distractors: ['flach', 'Fliege', 'Flamme', 'Wohnung'] },
            { english: 'try', german: 'versuchen, probieren', image: 'ğŸ’ª', hint: 'Es versuchen',
              distractors: ['weinen', 'trocknen', 'Tablett', 'trainieren'] },
            { english: 'monday', german: 'Montag', image: 'ğŸ“…', hint: 'Erster Wochentag',
              distractors: ['Dienstag', 'Sonntag', 'Geld', 'Mond'] },
            { english: 'tuesday', german: 'Dienstag', image: 'ğŸ“…', hint: 'Zweiter Wochentag',
              distractors: ['Donnerstag', 'Montag', 'Mittwoch', 'zwei'] },
            { english: 'wednesday', german: 'Mittwoch', image: 'ğŸ“…', hint: 'Mitte der Woche',
              distractors: ['Montag', 'Donnerstag', 'Freitag', 'Wochenende'] },
            { english: 'thursday', german: 'Donnerstag', image: 'ğŸ“…', hint: 'Vierter Wochentag',
              distractors: ['Dienstag', 'Freitag', 'Durst', 'dreiÃŸig'] },
            { english: 'friday', german: 'Freitag', image: 'ğŸ“…', hint: 'Letzter Schultag',
              distractors: ['Samstag', 'Donnerstag', 'Freund', 'frei'] },
            { english: 'saturday', german: 'Samstag', image: 'ğŸ“…', hint: 'Wochenende beginnt',
              distractors: ['Sonntag', 'Freitag', 'Saturn', 'traurig'] },
            { english: 'sunday', german: 'Sonntag', image: 'ğŸ“…', hint: 'Letzter Tag der Woche',
              distractors: ['Samstag', 'Montag', 'Sonne', 'sonnig'] },
            { english: 'sit', german: 'sitzen', image: 'ğŸª‘', hint: 'Auf einem Stuhl',
              distractors: ['stehen', 'setzen', 'sechs', 'passen'] },
            { english: 'pupil', german: 'SchÃ¼ler/in', image: 'ğŸ‘¨â€ğŸ“', hint: 'Lernt in der Schule',
              distractors: ['Lehrer/in', 'Welpe', 'Puppe', 'Schule'] },
            { english: 'menu', german: 'Speisekarte', image: 'ğŸ“‹', hint: 'Liste mit Essen',
              distractors: ['Messer', 'Liste', 'Karte', 'Rechnung'] },
            { english: 'meal', german: 'Mahlzeit, Essen', image: 'ğŸ½ï¸', hint: 'FrÃ¼hstÃ¼ck, Mittag, Abend',
              distractors: ['Mehl', 'Fleisch', 'Rezept', 'Gericht'] },
            { english: 'salad', german: 'Salat', image: 'ğŸ¥—', hint: 'Gesund und grÃ¼n',
              distractors: ['Suppe', 'SoÃŸe', 'Salz', 'GemÃ¼se'] },
            { english: 'other', german: 'andere(r, s)', image: 'â†”ï¸', hint: 'Nicht dieser',
              distractors: ['oder', 'Ã¤uÃŸere(r)', 'Ã¼ber', 'jede(r)'] },
            { english: 'language', german: 'Sprache', image: 'ğŸ’¬', hint: 'Deutsch, Englisch...',
              distractors: ['Land', 'Buchstabe', 'Rede', 'Lied'] },
            { english: 'vegetarian', german: 'Vegetarier/in, vegetarisch', image: 'ğŸ¥•', hint: 'Ohne Fleisch',
              distractors: ['vegan', 'GemÃ¼se', 'Tierarzt', 'gesund'] },
            { english: 'dessert', german: 'Nachtisch', image: 'ğŸ°', hint: 'SÃ¼ÃŸes nach dem Essen',
              distractors: ['WÃ¼ste', 'Kuchen', 'Vorspeise', 'SÃ¼ÃŸigkeit'] },
            { english: 'fresh', german: 'neu, ungebraucht, frisch', image: 'âœ¨', hint: 'Nicht alt',
              distractors: ['FranzÃ¶sisch', 'frei', 'Fleisch', 'kÃ¼hl'] },
            { english: 'fruit', german: 'Frucht, Obst', image: 'ğŸ', hint: 'Apfel, Banane...',
              distractors: ['GemÃ¼se', 'Essen', 'Wurzel', 'FrÃ¼hstÃ¼ck'] },
            { english: 'chicken', german: 'Huhn, HÃ¤hnchen', image: 'ğŸ—', hint: 'GeflÃ¼gel',
              distractors: ['KÃ¼che', 'KÃ¼ken', 'Schinken', 'Truthahn'] },
            { english: 'rice', german: 'Reis', image: 'ğŸš', hint: 'WeiÃŸes Korn aus Asien',
              distractors: ['Nudeln', 'Preis', 'Eis', 'nett'] },
            { english: 'cheese', german: 'KÃ¤se', image: 'ğŸ§€', hint: 'Aus Milch gemacht',
              distractors: ['Kuchen', 'Kirsche', 'Kiste', 'Brust'] },
            { english: 'tomato', german: 'Tomate', image: 'ğŸ…', hint: 'Rot und rund',
              distractors: ['Kartoffel', 'Karotte', 'Paprika', 'Tornado'] },
            { english: 'apple', german: 'Apfel', image: 'ğŸ', hint: 'Rote Frucht',
              distractors: ['Birne', 'Orange', 'Ananas', 'Ahorn'] },
            { english: 'sauce', german: 'SoÃŸe, Sauce', image: 'ğŸ¥«', hint: 'FlÃ¼ssige Beilage',
              distractors: ['Wurst', 'Suppe', 'Saft', 'Salz'] },
            { english: 'banana', german: 'Banane', image: 'ğŸŒ', hint: 'Gelb und krumm',
              distractors: ['Ananas', 'Bohne', 'Birne', 'Beere'] },
            { english: 'lamb', german: 'Lamm(fleisch)', image: 'ğŸ‘', hint: 'Fleisch vom Schaf',
              distractors: ['Lampe', 'Schinken', 'Rindfleisch', 'Land'] },
            { english: 'potato', german: 'Kartoffel', image: 'ğŸ¥”', hint: 'Pommes frites daraus',
              distractors: ['Tomate', 'Papaya', 'Foto', 'Karotte'] },
            { english: 'chips', german: 'Pommes frites', image: 'ğŸŸ', hint: 'Frittiert und salzig',
              distractors: ['Kartoffelchips', 'Kekse', 'Schokolade', 'NÃ¼sse'] },
            { english: 'food', german: 'Essen, Nahrung, Futter', image: 'ğŸ”', hint: 'Was man isst',
              distractors: ['FuÃŸ', 'Stimmung', 'Flut', 'GetrÃ¤nk'] },
            { english: 'nice', german: 'schÃ¶n, angenehm, nett, freundlich', image: 'ğŸ˜Š', hint: 'Gut und freundlich',
              distractors: ['Nichte', 'neu', 'nah', 'Nacht'] }
        ];

        const vocabularyTheme3 = [
            // Theme 3: Hobbies and activities - Page 218 (p. 54)
            { english: 'hour', german: 'Stunde', image: 'â°', hint: 'Zeiteinheit',
              distractors: ['unser', 'Haus', 'Minute', 'Uhr'] },
            { english: 'later', german: 'SpÃ¤ter', image: 'â±ï¸', hint: 'Nicht jetzt',
              distractors: ['frÃ¼her', 'letzter', 'Brief', 'seitlich'] },
            { english: 'dance', german: 'Tanz', image: 'ğŸ’ƒ', hint: 'Bewegung zur Musik',
              distractors: ['Chance', 'Lied', 'Musik', 'Sprung'] },
            { english: 'class', german: 'Schulklasse, Kurs', image: 'ğŸ‘¨â€ğŸ«', hint: 'Unterricht',
              distractors: ['Glas', 'Klasse (toll)', 'Klassiker', 'Gruppe'] },
            { english: 'charity', german: 'Barmherzigkeit, WohltÃ¤tigkeit', image: 'â¤ï¸', hint: 'Gutes tun',
              distractors: ['Kirsche', 'Freiheit', 'FrÃ¶hlichkeit', 'Spende'] },
            { english: 'gym', german: 'Turnen', image: 'ğŸ¤¸', hint: 'Sport in der Halle',
              distractors: ['Spielplatz', 'Edelstein', 'Kaugummi', 'Spiel'] },
            { english: 'minute', german: 'Minute', image: 'â±ï¸', hint: '60 Sekunden',
              distractors: ['winzig', 'Stunde', 'Sekunde', 'Moment'] },
            { english: 'biscuit', german: 'Keks, Biskuit', image: 'ğŸª', hint: 'SÃ¼ÃŸes GebÃ¤ck',
              distractors: ['BrÃ¶tchen', 'Kuchen', 'Brot', 'Toast'] },
            { english: 'prize', german: 'Preis, Gewinn', image: 'ğŸ†', hint: 'Wenn man gewinnt',
              distractors: ['Stolz', 'Ãœberraschung', 'Lob', 'Medaille'] },
            { english: 'money', german: 'Geld', image: 'ğŸ’°', hint: 'Zum Kaufen',
              distractors: ['Honig', 'Affe', 'Monat', 'MÃ¼nze'] },
            { english: 'german', german: 'Deutsche/r, deutsch', image: 'ğŸ‡©ğŸ‡ª', hint: 'Unsere Sprache',
              distractors: ['Deutschland', 'FranzÃ¶sisch', 'Keim', 'Bruder'] },
            { english: 'example', german: 'Beispiel', image: 'ğŸ“Œ', hint: 'Zum ErklÃ¤ren',
              distractors: ['PrÃ¼fung', 'Ausnahme', 'Ãœbung', 'ErklÃ¤rung'] },
            { english: 'win', german: 'gewinnen', image: 'ğŸ†', hint: 'Erster sein',
              distractors: ['verlieren', 'Wind', 'FlÃ¼gel', 'wÃ¼nschen'] },
            { english: 'cake', german: 'Kuchen', image: 'ğŸ‚', hint: 'SÃ¼ÃŸ und lecker',
              distractors: ['Keks', 'Kiste', 'Pflege', 'kochen'] },
            { english: 'special', german: 'besondere(r, s)', image: 'â­', hint: 'Nicht normal',
              distractors: ['sportlich', 'normal', 'Brille', 'schnell'] },
            { english: 'recipe', german: 'Rezept', image: 'ğŸ“', hint: 'Zum Kochen',
              distractors: ['Quittung', 'Empfang', 'Beleg', 'Rechnung'] },
            { english: 'into', german: 'in', image: 'â¡ï¸', hint: 'Hinein',
              distractors: ['aus', 'auf', 'auch', 'unter'] },
            { english: 'want', german: 'wÃ¼nschen, wollen', image: 'ğŸ™', hint: 'Etwas mÃ¶chten',
              distractors: ['brauchen', 'warten', 'wandern', 'warnen'] },
            { english: 'difficult', german: 'schwierig, schwer', image: 'ğŸ˜°', hint: 'Nicht leicht',
              distractors: ['verschieden', 'anders', 'leicht', 'unmÃ¶glich'] },
            { english: 'tomorrow', german: 'morgen', image: 'ğŸ“…', hint: 'Der nÃ¤chste Tag',
              distractors: ['heute', 'gestern', 'Morgen (frÃ¼h)', 'Ã¼bermorgen'] },
            { english: 'horrible', german: 'schrecklich', image: 'ğŸ˜±', hint: 'Sehr schlecht',
              distractors: ['wunderbar', 'Krankenhaus', 'ehrlich', 'hungrig'] },
            { english: 'bad', german: 'schlecht, schlimm, bÃ¶se', image: 'ğŸ‘', hint: 'Nicht gut',
              distractors: ['Bett', 'Tasche', 'traurig', 'gut'] },
            { english: 'must', german: 'mÃ¼ssen', image: 'â—', hint: 'Ich muss das tun',
              distractors: ['sollen', 'dÃ¼rfen', 'mÃ¶gen', 'Senf'] },
            { english: 'give', german: 'geben', image: 'ğŸ', hint: 'Schenken',
              distractors: ['leben', 'nehmen', 'fÃ¼nf', 'bekommen'] },
            { english: 'baker', german: 'BÃ¤cker/in', image: 'ğŸ‘¨â€ğŸ³', hint: 'Macht Brot',
              distractors: ['Koch/KÃ¶chin', 'Metzger/in', 'Korb', 'RÃ¼cken'] },
            { english: 'sound', german: 'klingen', image: 'ğŸ”Š', hint: 'Wie etwas klingt',
              distractors: ['gesund', 'finden', 'rund', 'Boden'] },
            { english: 'this', german: 'diese(r, s), das', image: 'ğŸ‘‰', hint: 'Dieses hier',
              distractors: ['jene(r, s)', 'dÃ¼nn', 'Ding', 'Gedanke'] },
            { english: 'everyone', german: 'alle(s)', image: 'ğŸ‘¥', hint: 'Jede Person',
              distractors: ['jemand', 'niemand', 'Ã¼berall', 'irgendwo'] },
            { english: 'all', german: 'alle(s)', image: 'ğŸ’¯', hint: 'Alles zusammen',
              distractors: ['alt', 'auch', 'schon', 'nichts'] },

            // Theme 3: Hobbies and activities - Page 219 (p. 56-58)
            { english: 'competition', german: 'Wettbewerb', image: 'ğŸ', hint: 'Wer ist der Beste?',
              distractors: ['Zusammenarbeit', 'Sammlung', 'Mannschaft', 'AuffÃ¼hrung'] },
            { english: 'describe', german: 'beschreiben', image: 'âœï¸', hint: 'Mit Worten erklÃ¤ren',
              distractors: ['entdecken', 'zerstÃ¶ren', 'verdienen', 'entscheiden'] },
            { english: 'much', german: 'viel', image: 'ğŸ“Š', hint: 'Eine groÃŸe Menge',
              distractors: ['solch', 'berÃ¼hren', 'sehr', 'Matsch'] },
            { english: 'anything', german: 'etwas, irgendwas', image: 'â“', hint: 'Irgendetwas',
              distractors: ['alles', 'nichts', 'jemand', 'Ã¼berall'] },
            { english: 'reading', german: 'Lesen', image: 'ğŸ“–', hint: 'Ein Buch lesen',
              distractors: ['Schreiben', 'bereit', 'rot', 'Grund'] },
            { english: 'dancing', german: 'Tanzen', image: 'ğŸ’ƒ', hint: 'Zur Musik bewegen',
              distractors: ['Singen', 'Gefahr', 'Springen', 'Laufen'] },
            { english: 'wear', german: 'tragen, anhaben', image: 'ğŸ‘•', hint: 'Kleidung tragen',
              distractors: ['wo', 'waren', 'Wetter', 'Birne'] },
            { english: 'beautiful', german: 'schÃ¶n', image: 'ğŸ˜', hint: 'Sehr hÃ¼bsch',
              distractors: ['hÃ¤sslich', 'wunderbar', 'dankbar', 'vorsichtig'] },
            { english: 'costume', german: 'KostÃ¼m', image: 'ğŸ­', hint: 'Verkleidung',
              distractors: ['Kunde', 'Brauch', 'Kleid', 'Uniform'] },
            { english: 'than', german: 'als', image: 'â†”ï¸', hint: 'Beim Vergleichen',
              distractors: ['dann', 'dÃ¼nn', 'danke', 'Gedanke'] },
            { english: 'circus', german: 'Zirkus', image: 'ğŸª', hint: 'Mit Clowns und Akrobaten',
              distractors: ['Kreis', 'Kirche', 'Kino', 'Theater'] },
            { english: 'just', german: 'nur, bloÃŸ, einfach', image: '1ï¸âƒ£', hint: 'Nur das',
              distractors: ['Saft', 'Scherz', 'Sprung', 'Jacke'] },
            { english: 'pretty', german: 'hÃ¼bsch, nett', image: 'ğŸŒ¸', hint: 'SchÃ¶n anzusehen',
              distractors: ['fertig', 'vorgeben', 'putzig', 'drucken'] },
            { english: 'nervous', german: 'nervÃ¶s', image: 'ğŸ˜°', hint: 'Aufgeregt und Ã¤ngstlich',
              distractors: ['mutig', 'Nerv', 'neugierig', 'verÃ¤rgert'] },
            { english: 'stage', german: 'BÃ¼hne', image: 'ğŸ¬', hint: 'Wo man auftritt',
              distractors: ['Stall', 'Seite', 'Stern', 'Szene'] },
            { english: 'angry', german: 'verÃ¤rgert, zornig, wÃ¼tend', image: 'ğŸ˜ ', hint: 'Sehr bÃ¶se',
              distractors: ['hungrig', 'Ã¤ngstlich', 'traurig', 'Engel'] },
            { english: 'agree', german: 'zustimmen', image: 'ğŸ‘', hint: 'Derselben Meinung sein',
              distractors: ['ablehnen', 'begrÃ¼ÃŸen', 'Alter', 'streiten'] },
            { english: 'disagree', german: 'nicht Ã¼bereinstimmen', image: 'ğŸ‘', hint: 'Anderer Meinung',
              distractors: ['zustimmen', 'verschwinden', 'entdecken', 'mÃ¶gen'] },
            { english: 'suggestion', german: 'Vorschlag', image: 'ğŸ’¡', hint: 'Eine Idee vorschlagen',
              distractors: ['Frage', 'Zucker', 'Vermutung', 'Ãœberraschung'] },
            { english: 'act', german: 'Show, Akt', image: 'ğŸ­', hint: 'Teil einer Show',
              distractors: ['Kunst', 'Aktion', 'Tatsache', 'Szene'] },
            { english: 'imagine', german: 'sich vorstellen', image: 'ğŸ’­', hint: 'In Gedanken sehen',
              distractors: ['Bild', 'Magie', 'nachahmen', 'verbessern'] },
            { english: 'disappointed', german: 'enttÃ¤uscht', image: 'ğŸ˜', hint: 'Traurig, weil es anders kam',
              distractors: ['begeistert', 'verschwunden', 'Ã¼berrascht', 'gelangweilt'] },
            { english: 'glad', german: 'glÃ¼cklich, dankbar, froh', image: 'ğŸ˜Š', hint: 'Sehr zufrieden',
              distractors: ['traurig', 'Glas', 'Freude', 'Blick'] },
            { english: 'reason', german: 'Grund', image: 'ğŸ¤”', hint: 'Warum etwas so ist',
              distractors: ['Jahreszeit', 'lesen', 'Ergebnis', 'Rosine'] },
            { english: 'exciting', german: 'aufregend, spannend', image: 'ğŸ¢', hint: 'Sehr interessant',
              distractors: ['langweilig', 'ausgezeichnet', 'bestehend', 'anstrengend'] },
            { english: 'evening', german: 'Abend', image: 'ğŸŒ†', hint: 'Nach dem Tag',
              distractors: ['Morgen', 'gleichmÃ¤ÃŸig', 'Veranstaltung', 'Nacht'] },
            { english: 'surprise', german: 'Ã¼berraschen', image: 'ğŸ', hint: 'Unerwartet',
              distractors: ['Sonnenaufgang', 'Ã¼berleben', 'vermuten', 'umgeben'] },
            { english: 'brilliant', german: 'brilliant, strahlend, klasse', image: 'âœ¨', hint: 'Fantastisch',
              distractors: ['langweilig', 'hell', 'bringen', 'kurz'] },
            { english: 'clap', german: 'klatschen', image: 'ğŸ‘', hint: 'Mit den HÃ¤nden',
              distractors: ['Klappe', 'fangen', 'Klasse', 'klopfen'] },
            { english: 'support', german: 'unterstÃ¼tzen', image: 'ğŸ¤', hint: 'Jemandem helfen',
              distractors: ['Abendessen', 'vermuten', 'versorgen', 'liefern'] },
            { english: 'laugh', german: 'lachen', image: 'ğŸ˜‚', hint: 'Wenn etwas lustig ist',
              distractors: ['Blatt', 'lernen', 'laut', 'Lamm'] },
            { english: 'hear', german: 'hÃ¶ren', image: 'ğŸ‘‚', hint: 'Mit den Ohren',
              distractors: ['hier', 'Herz', 'Haar', 'Hitze'] },

            // Theme 3: Hobbies and activities - Page 220 (p. 58-59)
            { english: 'job', german: 'Stelle, Job, Arbeit', image: 'ğŸ’¼', hint: 'Was man arbeitet',
              distractors: ['Hobby', 'joggen', 'Witz', 'Freude'] },
            { english: 'true', german: 'wahr', image: 'âœ…', hint: 'Nicht falsch',
              distractors: ['falsch', 'Baum', 'blau', 'versuchen'] },
            { english: 'empty', german: 'entleeren, ausrÃ¤umen', image: 'ğŸ“­', hint: 'Leer machen',
              distractors: ['voll', 'Eimer', 'fÃ¼llen', 'eingeben'] },
            { english: 'load', german: 'aufladen, einrÃ¤umen', image: 'ğŸ“¥', hint: 'Voll machen',
              distractors: ['Brot', 'StraÃŸe', 'Laub', 'laut'] },
            { english: 'always', german: 'immer', image: 'ğŸ”„', hint: 'Jedes Mal',
              distractors: ['nie', 'manchmal', 'fast', 'auch'] },
            { english: 'never', german: 'nie(mals)', image: 'ğŸš«', hint: 'Kein einziges Mal',
              distractors: ['immer', 'selten', 'manchmal', 'oft'] },
            { english: 'often', german: 'oft', image: 'ğŸ“Š', hint: 'Viele Male',
              distractors: ['selten', 'manchmal', 'offen', 'immer'] },
            { english: 'sometimes', german: 'manchmal', image: 'ğŸ²', hint: 'Ab und zu',
              distractors: ['immer', 'nie', 'oft', 'etwas'] },
            { english: 'usually', german: 'gewÃ¶hnlich, normalerweise', image: 'ğŸ“…', hint: 'Meistens',
              distractors: ['ungewÃ¶hnlich', 'nÃ¼tzlich', 'selten', 'benutzen'] },
            { english: 'supermarket', german: 'Supermarkt', image: 'ğŸ›’', hint: 'Zum Einkaufen',
              distractors: ['Markt', 'Kaufhaus', 'Marktplatz', 'GeschÃ¤ft'] },
            { english: 'when', german: 'als, wenn', image: 'â°', hint: 'Zu welcher Zeit',
              distractors: ['wo', 'wer', 'was', 'wie'] },
            { english: 'buy', german: 'kaufen', image: 'ğŸ’³', hint: 'Mit Geld bekommen',
              distractors: ['bei', 'verkaufen', 'Junge', 'tschÃ¼ss'] },
            { english: 'delicious', german: 'kÃ¶stlich, lecker', image: 'ğŸ˜‹', hint: 'Sehr gut schmeckend',
              distractors: ['eklig', 'zart', 'empfindlich', 'frÃ¶hlich'] },
            { english: 'decoration', german: 'Dekoration, Verzierung', image: 'ğŸ¨', hint: 'Zum SchmÃ¼cken',
              distractors: ['ErklÃ¤rung', 'Entscheidung', 'Richtung', 'Sammlung'] },
            { english: 'decorate', german: 'dekorieren, verzieren', image: 'ğŸ„', hint: 'SchÃ¶n machen',
              distractors: ['zerstÃ¶ren', 'entdecken', 'entscheiden', 'erklÃ¤ren'] },
            { english: 'need', german: 'mÃ¼ssen, brauchen', image: 'â—', hint: 'Etwas ist nÃ¶tig',
              distractors: ['Nadel', 'wollen', 'knien', 'stricken'] },
            { english: 'bake', german: 'backen', image: 'ğŸ§', hint: 'Im Ofen machen',
              distractors: ['RÃ¼cken', 'kochen', 'zurÃ¼ck', 'See'] },
            { english: 'every', german: 'jede(r, s)', image: 'ğŸ’¯', hint: 'Alle ohne Ausnahme',
              distractors: ['nie', 'sogar', 'Abend', 'einige'] },
            { english: 'eat', german: 'essen, fressen', image: 'ğŸ½ï¸', hint: 'Nahrung zu sich nehmen',
              distractors: ['trinken', 'Osten', 'Ohr', 'Auge'] },
            { english: 'night', german: 'Nacht, Abend', image: 'ğŸŒ™', hint: 'Wenn es dunkel ist',
              distractors: ['Ritter', 'nett', 'Licht', 'richtig'] },
            { english: 'perfect', german: 'perfekt', image: 'ğŸ’¯', hint: 'Ohne Fehler',
              distractors: ['vielleicht', 'Person', 'erlauben', 'Ã¼ben'] },
            { english: 'story', german: 'Geschichte, ErzÃ¤hlung', image: 'ğŸ“š', hint: 'Eine Geschichte erzÃ¤hlen',
              distractors: ['Storch', 'Sturm', 'Laden', 'Studie'] },
            { english: 'back', german: 'zurÃ¼ck', image: 'â†©ï¸', hint: 'Wieder da',
              distractors: ['backen', 'Tasche', 'schlecht', 'schwarz'] },
            { english: 'message', german: 'Nachricht, Botschaft', image: 'ğŸ’¬', hint: 'Mitteilung',
              distractors: ['Massage', 'Chaos', 'Unordnung', 'Bote'] },
            { english: 'help', german: 'Hilfe', image: 'ğŸ†˜', hint: 'UnterstÃ¼tzung',
              distractors: ['Helm', 'halten', 'HÃ¤lfte', 'Held'] },
            { english: 'smile', german: 'lÃ¤cheln', image: 'ğŸ˜Š', hint: 'Freundlich schauen',
              distractors: ['riechen', 'Meile', 'Schleim', 'still'] },
            { english: 'taste', german: 'schmecken', image: 'ğŸ‘…', hint: 'Mit der Zunge probieren',
              distractors: ['Verschwendung', 'Test', 'berÃ¼hren', 'riechen'] },
            { english: 'nothing', german: 'nichts', image: 'â­•', hint: 'Gar nichts',
              distractors: ['etwas', 'alles', 'Norden', 'bemerken'] },
            { english: 'begin', german: 'anfangen, beginnen', image: 'â–¶ï¸', hint: 'Starten',
              distractors: ['beenden', 'betteln', 'hinter', 'gewinnen'] },
            { english: 'suddenly', german: 'plÃ¶tzlich', image: 'âš¡', hint: 'Unerwartet schnell',
              distractors: ['langsam', 'traurig', 'sonnig', 'Sonntag'] },
            { english: 'doorbell', german: 'TÃ¼rklingel', image: 'ğŸ””', hint: 'An der TÃ¼r',
              distractors: ['TÃ¼rgriff', 'Glocke', 'TÃ¼rklopfer', 'Klingel'] },
            { english: 'shout', german: 'anschreien', image: 'ğŸ“¢', hint: 'Laut rufen',
              distractors: ['flÃ¼stern', 'kurz', 'zeigen', 'Dusche'] },
            { english: 'hide', german: 'sich verstecken', image: 'ğŸ™ˆ', hint: 'Nicht gefunden werden',
              distractors: ['hoch', 'reiten', 'breit', 'suchen'] },
            { english: 'explain', german: 'erklÃ¤ren', image: 'ğŸ‘¨â€ğŸ«', hint: 'VerstÃ¤ndlich machen',
              distractors: ['beschweren', 'Flugzeug', 'erforschen', 'Beispiel'] },
            { english: 'surprised', german: 'Ã¼berrascht, erstaunt', image: 'ğŸ˜²', hint: 'Nicht erwartet',
              distractors: ['enttÃ¤uscht', 'umgeben', 'Ã¼berleben', 'gelangweilt'] },
            { english: 'happen', german: 'geschehen, passieren', image: 'â“', hint: 'Sich ereignen',
              distractors: ['glÃ¼cklich', 'fangen', 'vielleicht', 'helfen'] },
            { english: 'winner', german: 'Gewinner/in, Sieger/in', image: 'ğŸ¥‡', hint: 'Wer gewinnt',
              distractors: ['Verlierer/in', 'Winter', 'Abendessen', 'AnfÃ¤nger/in'] }
        ];

        // ===================================================================
        // GAME STATE
        // ===================================================================

        let currentWordIndex = 0;
        let score = 0;
        let correctCount = 0;
        let currentWord = '';
        let selectedLetters = [];
        let shuffledVocabulary = [];
        let wordStats = {};
        let currentWordStartTime = 0;
        let attemptCount = 0;
        let wordsToRepeat = [];
        let isRepeatPhase = false;
        let hintTimeout = null;
        let correctFirstTryCount = 0;
        let talersEarned = 0;
        let totalTalers = 0;
        let currentVocabularySet = '';
        let vocabulary = [];
        let currentMode = 'spelling'; // 'spelling' or 'mc' or 'sentence'
        let mcAnswered = false; // Prevent double-clicks in MC mode
        let roundModes = []; // Pre-assigned mode per word in the round

        // Latin-specific state
        let currentLanguage = ''; // 'english' or 'latin'
        let currentLatinChapter = null;
        let currentLatinModule = ''; // 'vocab', 'verbs', 'sentences', 'mixed'
        let latinRoundItems = []; // Pre-built round items for Latin
        let currentLatinItem = null; // Current round item being played

        // ===================================================================
        // MACRON / SPECIAL CHAR UTILITIES
        // ===================================================================

        const macronMap = { 'Ä':'a', 'Ä“':'e', 'Ä«':'i', 'Å':'o', 'Å«':'u' };
        const reverseMacronMap = { 'a':'Ä', 'e':'Ä“', 'i':'Ä«', 'o':'Å', 'u':'Å«' };

        function baseChar(ch) {
            return macronMap[ch.toLowerCase()] || ch.toLowerCase();
        }

        function stripMacrons(str) {
            return str.split('').map(ch => macronMap[ch.toLowerCase()] || ch).join('');
        }

        // ===================================================================
        // UTILITY FUNCTIONS
        // ===================================================================

        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        // ===================================================================
        // LEARNING PROGRESS (localStorage)
        // ===================================================================

        function loadProgress() {
            try {
                const data = localStorage.getItem('vocabProgress');
                return data ? JSON.parse(data) : {};
            } catch (e) {
                return {};
            }
        }

        function saveProgress(progress) {
            localStorage.setItem('vocabProgress', JSON.stringify(progress));
        }

        function getWordKey(item, mode) {
            // English vocabulary: direction-specific key
            if (item.english) {
                const dir = mode === 'mc' ? 'en>de' : 'de>en';
                return 'en:' + dir + ':' + item.english.toLowerCase();
            }
            // Latin vocab items: direction depends on mode (spelling=DEâ†’LA, mc=LAâ†’DE)
            if (item.id && item.type === 'vocab') {
                const m = mode !== undefined ? mode : item.mode;
                const dir = m === 'mc' ? 'la>de' : 'de>la';
                return 'la:' + dir + ':' + item.id;
            }
            // Latin verbs/sentences/multiword: direction already encoded in item.id
            if (item.id) {
                return 'la:' + item.id;
            }
            return null;
        }

        // Returns all possible direction keys for weighted sampling
        function getAllWordKeys(item) {
            if (item.english) {
                return [
                    'en:de>en:' + item.english.toLowerCase(),
                    'en:en>de:' + item.english.toLowerCase()
                ];
            }
            if (item.id && item.type === 'vocab') {
                return [
                    'la:de>la:' + item.id,
                    'la:la>de:' + item.id
                ];
            }
            if (item.id) {
                return ['la:' + item.id];
            }
            return [];
        }

        function recordAnswer(key, isCorrect) {
            if (!key) return;
            const progress = loadProgress();
            if (!progress[key]) {
                progress[key] = { correct: 0, wrong: 0, lastSeen: Date.now() };
            }
            if (isCorrect) {
                progress[key].correct++;
            } else {
                progress[key].wrong++;
            }
            progress[key].lastSeen = Date.now();
            saveProgress(progress);
        }

        function weightedSample(pool, n, progressData) {
            if (pool.length <= n) return shuffleArray(pool);

            const weights = pool.map(item => {
                const keys = getAllWordKeys(item);
                let totalCorrect = 0, totalWrong = 0, seen = false;
                keys.forEach(key => {
                    const prog = progressData[key];
                    if (prog) {
                        totalCorrect += prog.correct;
                        totalWrong += prog.wrong;
                        seen = true;
                    }
                });
                if (!seen) return 2.0; // Never seen â†’ slightly elevated
                let w = 1.0 + (totalWrong * 2.0) - (totalCorrect * 0.3);
                return Math.max(0.2, w); // Minimum 0.2
            });

            const selected = [];
            const used = new Set();

            for (let i = 0; i < n; i++) {
                // Recalculate total weight excluding used indices
                let totalWeight = 0;
                for (let j = 0; j < pool.length; j++) {
                    if (!used.has(j)) totalWeight += weights[j];
                }

                let r = Math.random() * totalWeight;
                for (let j = 0; j < pool.length; j++) {
                    if (used.has(j)) continue;
                    r -= weights[j];
                    if (r <= 0) {
                        selected.push(pool[j]);
                        used.add(j);
                        break;
                    }
                }
            }

            return shuffleArray(selected);
        }

        function resetProgress() {
            if (confirm('Lernfortschritt zurÃ¼cksetzen? Alle Vokabel-Statistiken werden gelÃ¶scht.')) {
                localStorage.removeItem('vocabProgress');
                alert('Lernfortschritt zurÃ¼ckgesetzt!');
            }
        }

        // ===================================================================
        // NAVIGATION FUNCTIONS
        // ===================================================================

        // ===================================================================
        // CHANGELOG SPLASH â€“ shown once per version
        // ===================================================================

        const APP_VERSION = '2.5.0';

        const changelogEntries = [
            {
                version: '2.5.0',
                date: '27.02.2026',
                items: [
                    'ğŸ“– <b>Deutsche Spalte</b> im Tabellentraining â€“ auch Infinitiv & Deutsch als LÃ¼cke',
                    'ğŸ“ <b>Getrennte Tabellen</b> nach Konjugation (Ä/Ä“/Ä«/unregelm.) & Deklination (a/o)',
                    'ğŸ“ˆ <b>Progression</b>: Erst einzelne Typen Ã¼ben, bei 60% Trefferquote â†’ kombinierte Tabelle',
                ]
            },
            {
                version: '2.4.0',
                date: '27.02.2026',
                items: [
                    'ğŸ’» <b>Tabellentraining</b> â€“ Konjugations- & Deklinationstabellen im Terminal-Stil',
                    'ğŸ“Š Komplette Kapitel-Ãœbersichtstabellen mit zufÃ¤lligen LÃ¼cken',
                    'ğŸ¯ Abwechselnd Verben- und Nomen-Tabellen (3-5 Felder pro Tabelle)',
                ]
            },
            {
                version: '2.3.0',
                date: '27.02.2026',
                items: [
                    'âœï¸ <b>Verb-Formen erweitert</b> â€“ PrÃ¤sens Indikativ Aktiv (alle 6 Personen) + Imperativ (Sg/Pl)',
                    'ğŸ“ <b>Neues Modul: Substantive</b> â€“ Nomen deklinieren (Nom/Gen/Dat/Akk/Abl Ã— Sg/Pl)',
                    'ğŸ“Š 18 Nomen + 32 Verben mit vollstÃ¤ndigen Formen',
                ]
            },
            {
                version: '2.2.0',
                date: '25.02.2026',
                items: [
                    'ğŸ§  <b>Lernhorizont</b> â€“ schwÃ¤chere Vokabeln kommen hÃ¤ufiger dran',
                    'ğŸ­ <b>Emoji-Vorhang</b> â€“ bereits gekonnte WÃ¶rter werden verhÃ¼llt, Vorhang Ã¶ffnet sich bei Antwort',
                    'ğŸ“Š Fortschritt pro Ãœbersetzungsrichtung (DEâ†’EN separat von ENâ†’DE)',
                    'ğŸ“ˆ Lernstatistik pro Kapitel auf der Ergebnis-Seite (3Ã— richtig = gelernt)',
                ]
            },
            {
                version: '2.1.0',
                date: '25.02.2026',
                items: [
                    'ğŸ›ï¸ <b>Latein Lektion 4</b> â€“ 42 neue Vokabeln (Diana & Verwandlung)',
                    'âœï¸ 14 Verb-Formen + 9 BeispielsÃ¤tze fÃ¼r Lektion 4',
                    'ğŸ“‹ Changelog-Vorschaltseite (wird einmalig pro Version angezeigt)',
                ]
            },
            {
                version: '2.0.0',
                date: '25.02.2026',
                items: [
                    'ğŸ›ï¸ <b>Latein</b> als zweite Sprache (Lektion 3)',
                    'ğŸ”¤ Makron-Support (Ä, Ä“, Ä«, Å, Å«)',
                    'ğŸ“ Vier Module: Vokabeln, Verb-Formen, BeispielsÃ¤tze, Gemischt',
                ]
            },
        ];

        function showChangelogIfNew() {
            const seen = localStorage.getItem('changelog_seen_version');
            if (seen === APP_VERSION) return;
            document.getElementById('languageSelection').style.display = 'none';
            const container = document.getElementById('changelogContent');
            container.innerHTML = changelogEntries.map(e =>
                `<div style="margin-bottom: 16px;">
                    <div style="font-weight: bold; font-size: 1.05em; color: #4a90d9;">v${e.version} <span style="font-weight: normal; color: #999; font-size: 0.9em;">(${e.date})</span></div>
                    <ul style="margin: 6px 0 0 0; padding-left: 20px;">${e.items.map(i => `<li style="margin: 4px 0; line-height: 1.4;">${i}</li>`).join('')}</ul>
                </div>`
            ).join('');
            document.getElementById('changelogSplash').style.display = 'block';
        }

        function dismissChangelog() {
            localStorage.setItem('changelog_seen_version', APP_VERSION);
            document.getElementById('changelogSplash').style.display = 'none';
            document.getElementById('languageSelection').style.display = 'block';
        }

        // Show changelog on page load
        document.addEventListener('DOMContentLoaded', showChangelogIfNew);

        function hideAllScreens() {
            ['changelogSplash','languageSelection','setSelection','latinChapterSelection','latinModuleSelection','gameContainer'].forEach(id => {
                document.getElementById(id).style.display = 'none';
            });
        }

        function selectLanguage(lang) {
            currentLanguage = lang;
            hideAllScreens();
            if (lang === 'english') {
                document.getElementById('setSelection').style.display = 'block';
            } else if (lang === 'latin') {
                document.getElementById('latinChapterSelection').style.display = 'block';
            }
        }

        function backToLanguage() {
            hideAllScreens();
            document.getElementById('languageSelection').style.display = 'block';
        }

        function backToLatinChapters() {
            hideAllScreens();
            document.getElementById('latinChapterSelection').style.display = 'block';
        }

        function backToLatinModules() {
            hideAllScreens();
            document.getElementById('latinModuleSelection').style.display = 'block';
        }

        function backFromGame() {
            // Reset game state
            if (hintTimeout) clearTimeout(hintTimeout);
            document.getElementById('celebration').classList.remove('show');
            currentWordIndex = 0;
            score = 0;
            correctCount = 0;
            wordsToRepeat = [];
            isRepeatPhase = false;

            hideAllScreens();
            if (currentLanguage === 'english') {
                document.getElementById('setSelection').style.display = 'block';
            } else {
                document.getElementById('latinModuleSelection').style.display = 'block';
            }
        }

        function selectLatinChapter(chapter) {
            currentLatinChapter = latinData[chapter];
            hideAllScreens();
            document.getElementById('latinChapterName').textContent = currentLatinChapter.name;
            document.getElementById('latinModuleSelection').style.display = 'block';
        }

        // ===================================================================
        // GAME INITIALIZATION
        // ===================================================================

        function startGame(setChoice) {
            currentLanguage = 'english';
            if (setChoice === 'theme2') {
                vocabulary = vocabularyTheme2;
                currentVocabularySet = 'Theme 2: At School';
            } else if (setChoice === 'theme3') {
                vocabulary = vocabularyTheme3;
                currentVocabularySet = 'Theme 3: Hobbies and Activities';
            } else if (setChoice === 'all') {
                vocabulary = [...vocabularyTheme2, ...vocabularyTheme3];
                currentVocabularySet = 'Alle Vokabeln (Theme 2 + 3)';
            }

            hideAllScreens();
            document.getElementById('gameContainer').style.display = 'block';
            document.getElementById('gameTitle').textContent = 'ğŸ® English Spelling Adventure';
            document.getElementById('currentSetName').textContent = currentVocabularySet;

            initGame();
        }

        // ===================================================================
        // LATIN MODULE START
        // ===================================================================

        function startLatinModule(module) {
            currentLanguage = 'latin';
            currentLatinModule = module;

            hideAllScreens();
            document.getElementById('gameContainer').style.display = 'block';
            document.getElementById('gameTitle').textContent = 'ğŸ›ï¸ Latein-Abenteuer';

            const ch = currentLatinChapter;
            let moduleName = '';
            if (module === 'vocab') moduleName = 'Vokabeln';
            else if (module === 'verbs') moduleName = 'Verb-Formen';
            else if (module === 'nouns') moduleName = 'Substantive';
            else if (module === 'tables') moduleName = 'Tabellentraining';
            else if (module === 'sentences') moduleName = 'BeispielsÃ¤tze';
            else moduleName = 'Alles gemischt';
            document.getElementById('currentSetName').textContent = ch.name + ' â€“ ' + moduleName;

            // Build round items for Latin
            latinRoundItems = buildLatinRoundItems(ch, module);
            if (module !== 'tables') {
                const progress = loadProgress();
                latinRoundItems = weightedSample(latinRoundItems, Math.min(15, latinRoundItems.length), progress);
            }

            initLatinGame();
        }

        function buildLatinRoundItems(ch, module) {
            let items = [];

            if (module === 'vocab' || module === 'mixed') {
                // Single-word vocab: random spelling or MC, Latinâ†’DE direction
                ch.vocabulary.forEach(v => {
                    const mode = Math.random() < 0.5 ? 'spelling' : 'mc';
                    items.push({
                        type: 'vocab', mode: mode,
                        prompt: v.german, answer: v.latin.toLowerCase(),
                        displayAnswer: v.latin,
                        image: v.image, hint: v.hint,
                        question: 'Wie heiÃŸt das auf Latein?',
                        distractors: v.distractors,
                        mcCorrect: v.german,
                        mcPrompt: v.latin,
                        mcQuestion: 'Was bedeutet dieses Wort auf Deutsch?',
                        id: 'v_' + v.latin
                    });
                });

                // Multi-word: MC only, both directions
                ch.multiWord.forEach(mw => {
                    // Latin â†’ German
                    items.push({
                        type: 'multiword', mode: 'mc',
                        mcPrompt: mw.latin,
                        mcCorrect: mw.german,
                        mcQuestion: 'Was bedeutet das auf Deutsch?',
                        image: 'ğŸ›ï¸', hint: '',
                        distractors: mw.germanDistractors,
                        id: 'mw_lg_' + mw.latin
                    });
                    // German â†’ Latin
                    items.push({
                        type: 'multiword', mode: 'mc',
                        mcPrompt: mw.german,
                        mcCorrect: mw.latin,
                        mcQuestion: 'Wie heiÃŸt das auf Latein?',
                        image: 'ğŸ›ï¸', hint: '',
                        distractors: mw.latinDistractors,
                        id: 'mw_gl_' + mw.latin
                    });
                });
            }

            if (module === 'verbs' || module === 'mixed') {
                ch.verbForms.forEach(vf => {
                    // Random direction: infinitiveâ†’1st person or vice versa
                    const dir = Math.random() < 0.5;
                    if (dir) {
                        // Given infinitive, spell 1st person
                        items.push({
                            type: 'verb', mode: 'spelling',
                            prompt: vf.infinitive + ' (' + vf.german + ')',
                            answer: vf.firstPerson.toLowerCase(),
                            displayAnswer: vf.firstPerson,
                            image: 'âœï¸', hint: 'Bilde die 1. Person Singular',
                            question: '1. Person Singular?',
                            id: 'vf_i2f_' + vf.infinitive
                        });
                    } else {
                        // Given 1st person, spell infinitive
                        items.push({
                            type: 'verb', mode: 'spelling',
                            prompt: vf.firstPerson + ' (' + vf.german + ')',
                            answer: vf.infinitive.toLowerCase(),
                            displayAnswer: vf.infinitive,
                            image: 'âœï¸', hint: 'Bilde den Infinitiv',
                            question: 'Infinitiv?',
                            id: 'vf_f2i_' + vf.infinitive
                        });
                    }

                    // PrÃ¤sens Indikativ Aktiv: random person (sg2-pl3)
                    if (vf.present) {
                        const persons = [
                            { key: 'sg2', label: '2. Pers. Sg.' },
                            { key: 'sg3', label: '3. Pers. Sg.' },
                            { key: 'pl1', label: '1. Pers. Pl.' },
                            { key: 'pl2', label: '2. Pers. Pl.' },
                            { key: 'pl3', label: '3. Pers. Pl.' }
                        ];
                        const p = persons[Math.floor(Math.random() * persons.length)];
                        items.push({
                            type: 'verb', mode: 'spelling',
                            prompt: vf.infinitive + ' (' + vf.german + ')',
                            answer: vf.present[p.key].toLowerCase(),
                            displayAnswer: vf.present[p.key],
                            image: 'ğŸ“', hint: 'Bilde die ' + p.label,
                            question: p.label + '?',
                            id: 'vf_pres_' + p.key + '_' + vf.infinitive
                        });
                    }

                    // Imperativ: random Sg/Pl
                    if (vf.imperative) {
                        const isPlural = Math.random() < 0.5;
                        const form = isPlural ? vf.imperative.pl : vf.imperative.sg;
                        const label = isPlural ? 'Imperativ Plural' : 'Imperativ Singular';
                        items.push({
                            type: 'verb', mode: 'spelling',
                            prompt: vf.infinitive + ' (' + vf.german + ')',
                            answer: form.toLowerCase(),
                            displayAnswer: form,
                            image: 'ğŸ“¢', hint: 'Bilde den ' + label,
                            question: label + '?',
                            id: 'vf_imp_' + (isPlural ? 'pl' : 'sg') + '_' + vf.infinitive
                        });
                    }
                });
            }

            if (module === 'nouns' || module === 'mixed') {
                if (ch.nouns) {
                    ch.nouns.forEach(n => {
                        const cases = [
                            { key: 'gen_sg', label: 'Genitiv Singular' },
                            { key: 'dat_sg', label: 'Dativ Singular' },
                            { key: 'akk_sg', label: 'Akkusativ Singular' },
                            { key: 'abl_sg', label: 'Ablativ Singular' },
                            { key: 'nom_pl', label: 'Nominativ Plural' },
                            { key: 'gen_pl', label: 'Genitiv Plural' },
                            { key: 'dat_pl', label: 'Dativ Plural' },
                            { key: 'akk_pl', label: 'Akkusativ Plural' },
                            { key: 'abl_pl', label: 'Ablativ Plural' }
                        ];
                        // Filter out null values (e.g. DiÄna has no plural)
                        const available = cases.filter(c => n[c.key]);
                        const c = available[Math.floor(Math.random() * available.length)];
                        items.push({
                            type: 'noun', mode: 'spelling',
                            prompt: n.nom_sg + ' (' + n.german + ')',
                            answer: n[c.key].toLowerCase(),
                            displayAnswer: n[c.key],
                            image: n.image, hint: 'Bilde den ' + c.label,
                            question: c.label + '?',
                            id: 'noun_' + c.key + '_' + n.nom_sg
                        });
                    });
                }
            }

            if (module === 'sentences' || module === 'mixed') {
                ch.sentences.forEach(s => {
                    items.push({
                        type: 'sentence', mode: 'sentence',
                        latinSentence: s.latin,
                        germanTemplate: s.germanTemplate,
                        answer: s.answer.toLowerCase(),
                        displayAnswer: s.answer,
                        image: s.image, hint: s.hint,
                        question: 'FÃ¼lle die LÃ¼cke aus!',
                        id: 'sent_' + s.answer
                    });
                });
            }

            if (module === 'tables') {
                const progress = loadProgress();

                // Helper: Konjugationsklasse aus Infinitiv ableiten
                function getConjugation(inf) {
                    if (inf.endsWith('Äre')) return 'Ä-Konjugation';
                    if (inf.endsWith('Ä“re')) return 'Ä“-Konjugation';
                    if (inf.endsWith('Ä«re')) return 'Ä«-Konjugation';
                    return 'unregelmÃ¤ÃŸig';
                }

                // Helper: PrÃ¼ft ob eine Sub-Tabelle gemeistert ist (>=60% Zellen mit correct>=2)
                function isTableGroupMastered(rows, tblType) {
                    let total = 0, mastered = 0;
                    rows.forEach(row => {
                        Object.keys(row).forEach(key => {
                            if (!row[key]) return;
                            total++;
                            const progKey = 'la:tbl_' + tblType.charAt(0) + '_' + key + '_' + row.label;
                            const p = progress[progKey];
                            if (p && p.correct >= 2) mastered++;
                        });
                    });
                    return total > 0 && (mastered / total) >= 0.6;
                }

                // --- Verben nach Konjugation gruppieren ---
                const conjGroups = {};
                ch.verbForms.forEach(vf => {
                    if (!vf.present) return;
                    const conj = getConjugation(vf.infinitive);
                    if (!conjGroups[conj]) conjGroups[conj] = [];
                    const row = {
                        label: vf.infinitive, german: vf.german,
                        sg1: vf.firstPerson,
                        sg2: vf.present.sg2, sg3: vf.present.sg3,
                        pl1: vf.present.pl1, pl2: vf.present.pl2, pl3: vf.present.pl3
                    };
                    if (vf.imperative) {
                        row.imp_sg = vf.imperative.sg;
                        row.imp_pl = vf.imperative.pl;
                    }
                    conjGroups[conj].push(row);
                });
                const verbSubTables = Object.keys(conjGroups).map(conj => ({
                    tableType: 'verb', conjugation: conj, rows: conjGroups[conj]
                }));

                // --- Nomen nach Deklination gruppieren ---
                const nounSubTables = [];
                if (ch.nouns) {
                    const declGroups = {};
                    ch.nouns.forEach(n => {
                        const decl = n.declension.replace(/\s*\(.*\)/, '');
                        if (!declGroups[decl]) declGroups[decl] = [];
                        const row = { label: n.nom_sg, german: n.german };
                        ['nom_sg','gen_sg','dat_sg','akk_sg','abl_sg',
                         'nom_pl','gen_pl','dat_pl','akk_pl','abl_pl'].forEach(k => {
                            row[k] = n[k] || null;
                        });
                        declGroups[decl].push(row);
                    });
                    Object.keys(declGroups).forEach(decl => {
                        if (declGroups[decl].length > 0) {
                            nounSubTables.push({ tableType: 'noun', declension: decl, rows: declGroups[decl] });
                        }
                    });
                }

                // --- Progression: einzelne oder kombinierte Tabellen ---
                const tableTypes = [];

                const allVerbsMastered = verbSubTables.length > 0 && verbSubTables.every(t => isTableGroupMastered(t.rows, 'verb'));
                if (allVerbsMastered) {
                    const allVerbRows = verbSubTables.flatMap(t => t.rows);
                    tableTypes.push({ tableType: 'verb', conjugation: 'alle Konjugationen', rows: allVerbRows });
                } else {
                    verbSubTables.filter(t => !isTableGroupMastered(t.rows, 'verb')).forEach(t => tableTypes.push(t));
                }

                const allNounsMastered = nounSubTables.length > 0 && nounSubTables.every(t => isTableGroupMastered(t.rows, 'noun'));
                if (allNounsMastered) {
                    const allNounRows = nounSubTables.flatMap(t => t.rows);
                    tableTypes.push({ tableType: 'noun', declension: 'alle Deklinationen', rows: allNounRows });
                } else {
                    nounSubTables.filter(t => !isTableGroupMastered(t.rows, 'noun')).forEach(t => tableTypes.push(t));
                }

                // --- Abwechselnd Verben/Nomen, 3-5 Felder pro Tabelle, max 15 ---
                const verbTables = shuffleArray(tableTypes.filter(t => t.tableType === 'verb'));
                const nounTables = shuffleArray(tableTypes.filter(t => t.tableType === 'noun'));
                let vIdx = 0, nIdx = 0;
                let pickVerb = Math.random() < 0.5;

                while (items.length < 15 && (verbTables.length > 0 || nounTables.length > 0)) {
                    let tbl;
                    if (pickVerb && verbTables.length > 0) {
                        tbl = verbTables[vIdx % verbTables.length]; vIdx++;
                    } else if (nounTables.length > 0) {
                        tbl = nounTables[nIdx % nounTables.length]; nIdx++;
                    } else {
                        tbl = verbTables[vIdx % verbTables.length]; vIdx++;
                    }
                    pickVerb = !pickVerb;
                    const blanksCount = 3 + Math.floor(Math.random() * 3);

                    const allCells = [];
                    tbl.rows.forEach((row, rowIdx) => {
                        Object.keys(row).forEach(key => {
                            if (!row[key]) return;
                            allCells.push({ rowIdx, key, value: row[key], rowLabel: row.label });
                        });
                    });

                    const selected = shuffleArray([...allCells]).slice(0, blanksCount);
                    selected.forEach(cell => {
                        if (items.length >= 15) return;
                        let question;
                        if (cell.key === 'label') {
                            question = tbl.rows[cell.rowIdx].german + ': ' + getTableCellLabel(cell.key) + '?';
                        } else {
                            question = cell.rowLabel + ': ' + getTableCellLabel(cell.key) + '?';
                        }
                        items.push({
                            type: 'table', mode: 'table',
                            tableType: tbl.tableType,
                            conjugation: tbl.conjugation || null,
                            declension: tbl.declension || null,
                            tableRows: tbl.rows,
                            blankRowIdx: cell.rowIdx,
                            blankKey: cell.key,
                            answer: cell.value.toLowerCase(),
                            displayAnswer: cell.value,
                            image: tbl.tableType === 'verb' ? 'âœï¸' : 'ğŸ“',
                            hint: getTableCellLabel(cell.key),
                            question: question,
                            id: 'tbl_' + tbl.tableType.charAt(0) + '_' + cell.key + '_' + cell.rowLabel
                        });
                    });
                }
            }

            return items;
        }

        function getTableCellLabel(key) {
            const labels = {
                label: 'Latein', german: 'Deutsch',
                sg1: '1.Sg.', sg2: '2.Sg.', sg3: '3.Sg.',
                pl1: '1.Pl.', pl2: '2.Pl.', pl3: '3.Pl.',
                imp_sg: 'Imp.Sg.', imp_pl: 'Imp.Pl.',
                nom_sg: 'Nom.Sg.', gen_sg: 'Gen.Sg.', dat_sg: 'Dat.Sg.',
                akk_sg: 'Akk.Sg.', abl_sg: 'Abl.Sg.',
                nom_pl: 'Nom.Pl.', gen_pl: 'Gen.Pl.', dat_pl: 'Dat.Pl.',
                akk_pl: 'Akk.Pl.', abl_pl: 'Abl.Pl.',
            };
            return labels[key] || key;
        }

        function initLatinGame() {
            currentWordIndex = 0;
            score = 0;
            correctCount = 0;
            wordsToRepeat = [];
            isRepeatPhase = false;
            wordStats = {};
            currentWord = '';
            selectedLetters = [];

            const savedTalers = localStorage.getItem('vocabularyGameTalers');
            totalTalers = savedTalers ? parseInt(savedTalers) : 0;
            document.getElementById('totalTalers').textContent = totalTalers;
            document.getElementById('score').textContent = '0';
            document.getElementById('correct').textContent = '0';
            document.getElementById('repeats').textContent = '0';

            correctFirstTryCount = 0;
            talersEarned = 0;

            // Use latinRoundItems as our shuffledVocabulary equivalent
            shuffledVocabulary = latinRoundItems;

            shuffledVocabulary.forEach(item => {
                wordStats[item.id] = {
                    attempts: 0, mistakes: 0, totalTime: 0, correctOnFirstTry: false
                };
            });

            document.getElementById('total').textContent = shuffledVocabulary.length;
            loadLatinWord();
        }

        // ===================================================================
        // ENGLISH GAME INITIALIZATION
        // ===================================================================

        function initGame() {
            currentWordIndex = 0;
            score = 0;
            correctCount = 0;
            wordsToRepeat = [];
            isRepeatPhase = false;
            wordStats = {};

            const progress = loadProgress();
            shuffledVocabulary = weightedSample(vocabulary, 15, progress);

            // Assign random mode per word for this round
            roundModes = shuffledVocabulary.map(() => Math.random() < 0.5 ? 'spelling' : 'mc');

            const savedTalers = localStorage.getItem('vocabularyGameTalers');
            if (savedTalers) {
                totalTalers = parseInt(savedTalers);
            } else {
                totalTalers = 0;
            }

            document.getElementById('totalTalers').textContent = totalTalers;
            document.getElementById('score').textContent = '0';
            document.getElementById('correct').textContent = '0';
            document.getElementById('repeats').textContent = '0';

            correctFirstTryCount = 0;
            talersEarned = 0;

            shuffledVocabulary.forEach(word => {
                wordStats[word.english] = {
                    attempts: 0,
                    mistakes: 0,
                    totalTime: 0,
                    correctOnFirstTry: false
                };
            });

            document.getElementById('total').textContent = shuffledVocabulary.length;
            loadWord();
        }

        // ===================================================================
        // TALER MANAGEMENT
        // ===================================================================

        function resetTalersFromMenu() {
            if (confirm('MÃ¶chtest du wirklich alle Taler zurÃ¼cksetzen? Dies kann nicht rÃ¼ckgÃ¤ngig gemacht werden.')) {
                localStorage.setItem('vocabularyGameTalers', '0');
                totalTalers = 0;
                document.getElementById('displayTalersMain').textContent = '0';
                alert('Taler wurden zurÃ¼ckgesetzt! Viel Erfolg beim nÃ¤chsten Mal! ğŸª™');
            }
        }

        function resetTalers() {
            if (confirm('MÃ¶chtest du wirklich alle Taler zurÃ¼cksetzen? Dies kann nicht rÃ¼ckgÃ¤ngig gemacht werden.')) {
                localStorage.setItem('vocabularyGameTalers', '0');
                totalTalers = 0;
                document.getElementById('totalTalers').textContent = '0';
                alert('Taler wurden zurÃ¼ckgesetzt! Viel Erfolg beim nÃ¤chsten Mal! ğŸª™');
            }
        }

        window.addEventListener('DOMContentLoaded', () => {
            const savedTalers = localStorage.getItem('vocabularyGameTalers');
            if (savedTalers) {
                totalTalers = parseInt(savedTalers);
                document.getElementById('displayTalersMain').textContent = totalTalers;
            }
        });

        // ===================================================================
        // LATIN WORD LOADING
        // ===================================================================

        function loadLatinWord() {
            // Check if finished
            if (!isRepeatPhase && currentWordIndex >= shuffledVocabulary.length) {
                if (wordsToRepeat.length > 0) {
                    isRepeatPhase = true;
                    currentWordIndex = 0;
                    shuffledVocabulary = wordsToRepeat;
                    wordsToRepeat = [];
                    document.getElementById('total').textContent = shuffledVocabulary.length;
                    document.getElementById('feedback').textContent = 'ğŸ”„ Jetzt wiederholen wir die schwierigen Vokabeln!';
                    document.getElementById('feedback').className = 'feedback';
                    document.getElementById('feedback').style.color = '';
                    document.getElementById('feedback').style.fontSize = '';
                    setTimeout(() => {
                        document.getElementById('feedback').textContent = '';
                        loadLatinWord();
                    }, 2000);
                    return;
                } else {
                    showCelebration();
                    return;
                }
            }
            if (isRepeatPhase && currentWordIndex >= shuffledVocabulary.length) {
                showCelebration();
                return;
            }

            if (hintTimeout) clearTimeout(hintTimeout);

            const item = shuffledVocabulary[currentWordIndex];
            currentLatinItem = item;
            attemptCount = 0;
            mcAnswered = false;
            currentWordStartTime = Date.now();

            document.getElementById('current').textContent = currentWordIndex + 1;
            document.getElementById('feedback').textContent = '';
            document.getElementById('feedback').className = 'feedback';
            document.getElementById('feedback').style.color = '';
            document.getElementById('feedback').style.fontSize = '';
            document.getElementById('autoHint').textContent = '';
            document.getElementById('autoHint').className = 'auto-hint';
            document.getElementById('mcContinueBtn').style.display = 'none';

            // Curtain logic: hide emoji if already answered correctly before (not in repeat phase)
            const curtain = document.getElementById('emojiCurtain');
            if (!isRepeatPhase) {
                const itemKey = getWordKey(item);
                const prog = loadProgress()[itemKey];
                if (prog && prog.correct >= 1) {
                    curtain.classList.add('active');
                    curtain.classList.remove('reveal');
                } else {
                    curtain.classList.remove('active', 'reveal');
                }
            } else {
                curtain.classList.remove('active', 'reveal');
            }

            // Hide all areas first
            document.getElementById('spellingArea').style.display = 'none';
            document.getElementById('mcArea').style.display = 'none';
            document.getElementById('sentenceArea').style.display = 'none';
            document.getElementById('tableArea').style.display = 'none';
            document.getElementById('spellingButtons').style.display = 'none';
            document.getElementById('tipText').style.display = 'none';

            // Word card: hide for table mode, show for others
            const wordCard = document.querySelector('.word-card');
            if (item.mode === 'table') {
                wordCard.style.display = 'none';
                loadLatinTable(item);
                return; // No hint timer or curtain needed for tables
            }
            wordCard.style.display = '';

            if (item.mode === 'mc') {
                loadLatinMC(item);
            } else if (item.mode === 'sentence') {
                loadLatinSentence(item);
            } else {
                // Spelling mode for vocab or verbs or nouns
                loadLatinSpelling(item);
            }

            // Hint timer (only for spelling/sentence)
            if (item.mode !== 'mc') {
                hintTimeout = setTimeout(() => {
                    const autoHintEl = document.getElementById('autoHint');
                    if (item.hint) {
                        autoHintEl.textContent = 'ğŸ’¡ ' + item.hint;
                        autoHintEl.className = 'auto-hint show';
                    }
                }, 15000);
            }
        }

        function loadLatinSpelling(item) {
            currentMode = 'spelling';
            currentWord = item.answer;

            document.getElementById('wordImage').textContent = item.image;
            document.getElementById('wordGerman').textContent = item.prompt;
            document.getElementById('wordHint').textContent = item.question;

            document.getElementById('spellingArea').style.display = 'block';
            document.getElementById('spellingButtons').style.display = 'flex';
            document.getElementById('tipText').style.display = 'block';

            document.getElementById('skipBtn').style.display = 'inline-block';
            document.getElementById('checkBtn').style.display = 'inline-block';
            document.getElementById('clearBtn').style.display = 'inline-block';
            document.getElementById('continueBtn').style.display = 'none';

            selectedLetters = [];
            createLatinAnswerSlots();
            createLatinLetterPool();
        }

        function createLatinAnswerSlots() {
            const answerArea = document.getElementById('answerArea');
            answerArea.innerHTML = '';
            for (let i = 0; i < currentWord.length; i++) {
                const slot = document.createElement('div');
                slot.className = 'letter-slot';
                slot.dataset.index = i;
                slot.addEventListener('click', () => removeLetterFromSlot(i));
                answerArea.appendChild(slot);
            }
        }

        function createLatinLetterPool() {
            const lettersPool = document.getElementById('lettersPool');
            lettersPool.innerHTML = '';

            // Use the display version of the answer to get macron chars for tiles
            const displayWord = currentLatinItem.displayAnswer || currentWord;
            const wordLetters = displayWord.toLowerCase().split('');

            // Add some extra distractor letters
            const latinLetters = 'abcdefghiklmnopqrstuvx';
            const numExtras = Math.min(5, Math.floor(currentWord.length / 2) + 2);
            for (let i = 0; i < numExtras; i++) {
                let randomLetter;
                do {
                    randomLetter = latinLetters[Math.floor(Math.random() * latinLetters.length)];
                } while (wordLetters.some(l => baseChar(l) === randomLetter));
                wordLetters.push(randomLetter);
            }

            const shuffledLetters = shuffleArray(wordLetters);

            shuffledLetters.forEach((letter, index) => {
                const tile = document.createElement('div');
                tile.className = 'letter-tile';
                tile.textContent = letter.toUpperCase();
                tile.dataset.letter = letter;
                tile.dataset.base = baseChar(letter);
                tile.dataset.id = index;
                tile.addEventListener('click', () => selectLatinLetter(letter, index));
                lettersPool.appendChild(tile);
            });
        }

        function selectLatinLetter(letter, id) {
            if (selectedLetters.length >= currentWord.length) return;
            const tile = document.querySelector(`[data-id="${id}"]`);
            if (tile.classList.contains('used')) return;
            selectedLetters.push({ letter, id });
            tile.classList.add('used');
            updateAnswerArea();
        }

        function checkLatinSpelling() {
            const answer = selectedLetters.map(l => baseChar(l.letter)).join('');
            const expected = stripMacrons(currentWord);
            const slots = document.querySelectorAll('#answerArea .letter-slot');
            const feedback = document.getElementById('feedback');

            if (hintTimeout) clearTimeout(hintTimeout);
            attemptCount++;

            let correctLetters = 0;
            slots.forEach((slot, index) => {
                if (selectedLetters[index]) {
                    if (baseChar(selectedLetters[index].letter) === baseChar(currentWord[index])) {
                        slot.classList.add('correct');
                        slot.classList.remove('wrong');
                        correctLetters++;
                    } else {
                        slot.classList.add('wrong');
                        slot.classList.remove('correct');
                    }
                }
            });

            const timeElapsed = (Date.now() - currentWordStartTime) / 1000;
            const stats = wordStats[currentLatinItem.id];
            stats.attempts++;

            if (answer === expected && correctLetters === currentWord.length) {
                stats.totalTime += timeElapsed;
                recordAnswer(getWordKey(currentLatinItem), true);
                document.getElementById('emojiCurtain').classList.add('reveal');
                handleCorrectAnswer(stats, timeElapsed);
                setTimeout(() => { currentWordIndex++; loadLatinWord(); }, 2000);
            } else {
                stats.mistakes++;
                recordAnswer(getWordKey(currentLatinItem), false);
                document.getElementById('emojiCurtain').classList.add('reveal');
                feedback.textContent = 'âŒ Das ist leider nicht richtig. Versuch es nochmal!';
                feedback.className = 'feedback wrong';
                playSound('wrong');
                setTimeout(() => {
                    slots.forEach(slot => { slot.classList.remove('wrong'); slot.classList.remove('correct'); });
                }, 1500);
            }
        }

        function loadLatinMC(item) {
            currentMode = 'mc';
            currentWord = item.id; // use id for stats tracking

            document.getElementById('wordImage').textContent = item.image || 'ğŸ›ï¸';
            document.getElementById('wordGerman').textContent = item.mcPrompt;
            document.getElementById('wordHint').textContent = item.mcQuestion;

            document.getElementById('mcArea').style.display = 'block';

            // Build MC options
            const correctAnswer = item.mcCorrect;
            const distractors = item.distractors || [];
            let options = [{ text: correctAnswer, correct: true }];
            distractors.forEach(d => options.push({ text: d, correct: false }));
            options = shuffleArray(options);

            const mcContainer = document.getElementById('mcOptions');
            mcContainer.innerHTML = '';
            options.forEach((opt, idx) => {
                const optDiv = document.createElement('div');
                optDiv.className = 'mc-option';
                optDiv.dataset.index = idx;
                optDiv.dataset.correct = opt.correct;
                optDiv.innerHTML = `<span class="mc-key">${idx + 1}</span><span class="mc-text">${opt.text}</span>`;
                optDiv.addEventListener('click', () => selectLatinMC(idx));
                mcContainer.appendChild(optDiv);
            });
        }

        function selectLatinMC(index) {
            if (mcAnswered) return;
            mcAnswered = true;
            if (hintTimeout) clearTimeout(hintTimeout);
            attemptCount++;

            const options = document.querySelectorAll('.mc-option');
            const selectedOption = options[index];
            const isCorrect = selectedOption.dataset.correct === 'true';
            const feedback = document.getElementById('feedback');
            const timeElapsed = (Date.now() - currentWordStartTime) / 1000;
            const stats = wordStats[currentLatinItem.id];
            stats.attempts++;

            options.forEach(opt => opt.classList.add('mc-disabled'));
            options.forEach(opt => {
                if (opt.dataset.correct === 'true') opt.classList.add('mc-correct');
            });

            if (isCorrect) {
                stats.totalTime += timeElapsed;
                recordAnswer(getWordKey(currentLatinItem), true);
                document.getElementById('emojiCurtain').classList.add('reveal');
                handleCorrectAnswer(stats, timeElapsed);
                setTimeout(() => { currentWordIndex++; loadLatinWord(); }, 2000);
            } else {
                selectedOption.classList.add('mc-wrong');
                stats.mistakes++;
                recordAnswer(getWordKey(currentLatinItem), false);
                document.getElementById('emojiCurtain').classList.add('reveal');
                feedback.textContent = '';
                feedback.className = 'feedback';
                playSound('wrong');
                if (!isRepeatPhase) addLatinToRepeatList();
                document.getElementById('mcContinueBtn').style.display = 'inline-block';
            }
        }

        function loadLatinSentence(item) {
            currentMode = 'sentence';
            currentWord = item.answer;

            document.getElementById('wordImage').textContent = item.image;
            document.getElementById('wordGerman').textContent = '';
            document.getElementById('wordHint').textContent = item.question;

            // Show sentence area
            document.getElementById('sentenceArea').style.display = 'block';
            document.getElementById('sentenceLatin').textContent = item.latinSentence;
            document.getElementById('sentenceTemplate').textContent = item.germanTemplate;

            // Show spelling buttons for sentence
            document.getElementById('spellingButtons').style.display = 'flex';
            document.getElementById('tipText').style.display = 'block';
            document.getElementById('skipBtn').style.display = 'inline-block';
            document.getElementById('checkBtn').style.display = 'inline-block';
            document.getElementById('clearBtn').style.display = 'inline-block';
            document.getElementById('continueBtn').style.display = 'none';

            selectedLetters = [];

            // Build answer slots and letter pool inside sentenceSpellingArea
            const answerArea = document.getElementById('sentenceAnswerArea');
            answerArea.innerHTML = '';
            for (let i = 0; i < currentWord.length; i++) {
                const slot = document.createElement('div');
                slot.className = 'letter-slot';
                slot.dataset.index = i;
                slot.addEventListener('click', () => removeSentenceLetterFromSlot(i));
                answerArea.appendChild(slot);
            }

            const lettersPool = document.getElementById('sentenceLettersPool');
            lettersPool.innerHTML = '';

            const wordLetters = currentWord.split('');
            const extraLetters = 'abcdefghijklmnopqrstuvwxyzÃ¤Ã¶Ã¼';
            const numExtras = Math.min(4, Math.floor(currentWord.length / 2) + 2);
            for (let i = 0; i < numExtras; i++) {
                let rl;
                do { rl = extraLetters[Math.floor(Math.random() * extraLetters.length)]; }
                while (wordLetters.includes(rl));
                wordLetters.push(rl);
            }

            const shuffledLetters = shuffleArray(wordLetters);
            shuffledLetters.forEach((letter, index) => {
                const tile = document.createElement('div');
                tile.className = 'letter-tile';
                tile.textContent = letter.toUpperCase();
                tile.dataset.letter = letter;
                tile.dataset.id = index;
                tile.addEventListener('click', () => selectSentenceLetter(letter, index));
                lettersPool.appendChild(tile);
            });
        }

        function selectSentenceLetter(letter, id) {
            if (selectedLetters.length >= currentWord.length) return;
            const tile = document.querySelector(`#sentenceLettersPool [data-id="${id}"]`);
            if (!tile || tile.classList.contains('used')) return;
            selectedLetters.push({ letter, id });
            tile.classList.add('used');
            updateSentenceAnswerArea();
        }

        function updateSentenceAnswerArea() {
            const slots = document.querySelectorAll('#sentenceAnswerArea .letter-slot');
            slots.forEach((slot, index) => {
                if (selectedLetters[index]) {
                    slot.textContent = selectedLetters[index].letter.toUpperCase();
                    slot.classList.add('filled');
                } else {
                    slot.textContent = '';
                    slot.classList.remove('filled');
                }
            });
        }

        function removeSentenceLetterFromSlot(index) {
            if (index >= selectedLetters.length) return;
            const removed = selectedLetters[index];
            const tile = document.querySelector(`#sentenceLettersPool [data-id="${removed.id}"]`);
            if (tile) tile.classList.remove('used');
            selectedLetters.splice(index, 1);
            updateSentenceAnswerArea();
        }

        function checkLatinSentence() {
            const answer = selectedLetters.map(l => l.letter).join('');
            const slots = document.querySelectorAll('#sentenceAnswerArea .letter-slot');
            const feedback = document.getElementById('feedback');

            if (hintTimeout) clearTimeout(hintTimeout);
            attemptCount++;

            let correctLetters = 0;
            slots.forEach((slot, index) => {
                if (selectedLetters[index]) {
                    if (selectedLetters[index].letter === currentWord[index]) {
                        slot.classList.add('correct'); slot.classList.remove('wrong');
                        correctLetters++;
                    } else {
                        slot.classList.add('wrong'); slot.classList.remove('correct');
                    }
                }
            });

            const timeElapsed = (Date.now() - currentWordStartTime) / 1000;
            const stats = wordStats[currentLatinItem.id];
            stats.attempts++;

            if (answer === currentWord && correctLetters === currentWord.length) {
                stats.totalTime += timeElapsed;
                recordAnswer(getWordKey(currentLatinItem), true);
                document.getElementById('emojiCurtain').classList.add('reveal');
                handleCorrectAnswer(stats, timeElapsed);
                setTimeout(() => { currentWordIndex++; loadLatinWord(); }, 2000);
            } else {
                stats.mistakes++;
                recordAnswer(getWordKey(currentLatinItem), false);
                document.getElementById('emojiCurtain').classList.add('reveal');
                feedback.textContent = 'âŒ Das ist leider nicht richtig. Versuch es nochmal!';
                feedback.className = 'feedback wrong';
                playSound('wrong');
                setTimeout(() => {
                    slots.forEach(slot => { slot.classList.remove('wrong'); slot.classList.remove('correct'); });
                }, 1500);
            }
        }

        // ===================================================================
        // TABLE TRAINING (Terminal Mode)
        // ===================================================================

        let tableRetrying = false;

        function loadLatinTable(item) {
            currentMode = 'table';
            currentWord = item.answer;
            tableRetrying = false;

            document.getElementById('tableArea').style.display = 'block';

            const container = document.getElementById('terminalContainer');
            container.innerHTML = renderFullTable(item);

            setTimeout(() => {
                const input = document.getElementById('tableInput');
                if (input) input.focus();
            }, 100);
        }

        function renderFullTable(item) {
            const isVerb = item.tableType === 'verb';
            const title = isVerb
                ? ('VERBA â€” ' + (item.conjugation || ''))
                : ('NOMINA â€” ' + (item.declension || ''));
            const columns = isVerb
                ? [{key:'sg1',label:'1.Sg.'},{key:'sg2',label:'2.Sg.'},{key:'sg3',label:'3.Sg.'},
                   {key:'pl1',label:'1.Pl.'},{key:'pl2',label:'2.Pl.'},{key:'pl3',label:'3.Pl.'},
                   {key:'imp_sg',label:'Imp.Sg.'},{key:'imp_pl',label:'Imp.Pl.'}]
                : [{key:'nom_sg',label:'Nom.Sg.'},{key:'gen_sg',label:'Gen.Sg.'},{key:'dat_sg',label:'Dat.Sg.'},
                   {key:'akk_sg',label:'Akk.Sg.'},{key:'abl_sg',label:'Abl.Sg.'},
                   {key:'nom_pl',label:'Nom.Pl.'},{key:'gen_pl',label:'Gen.Pl.'},{key:'dat_pl',label:'Dat.Pl.'},
                   {key:'akk_pl',label:'Akk.Pl.'},{key:'abl_pl',label:'Abl.Pl.'}];

            // Prepend label + german columns
            const allColumns = [{key:'label',label:isVerb ? 'Infinitiv' : 'Wort'}, {key:'german',label:'Deutsch'}, ...columns];

            let html = `<div class="terminal-header">
                <span class="terminal-dot red"></span>
                <span class="terminal-dot yellow"></span>
                <span class="terminal-dot green"></span>
                <span class="terminal-title">${title}</span>
            </div>
            <div class="terminal-body"><table class="terminal-tbl">
            <thead><tr>`;
            allColumns.forEach(c => { html += `<th>${c.label}</th>`; });
            html += `</tr></thead><tbody>`;

            item.tableRows.forEach((row, rowIdx) => {
                const isActiveRow = rowIdx === item.blankRowIdx;
                html += `<tr${isActiveRow ? ' style="background:rgba(57,255,20,0.05)"' : ''}>`;
                allColumns.forEach(col => {
                    const val = row[col.key];
                    const isBlank = rowIdx === item.blankRowIdx && col.key === item.blankKey;
                    const isLabel = col.key === 'label';
                    if (isBlank) {
                        html += `<td class="cell-blank${isLabel ? ' row-label' : ''}"><input type="text" id="tableInput" autocomplete="off" autocapitalize="off" spellcheck="false"></td>`;
                    } else if (val === undefined || val === null) {
                        html += `<td style="color:#484f58;">â€”</td>`;
                    } else {
                        html += `<td${isLabel ? ' class="row-label"' : ''}>${val}</td>`;
                    }
                });
                html += `</tr>`;
            });

            html += `</tbody></table></div>`;
            html += `<div class="terminal-prompt">
                <span class="prompt-symbol">â¯</span>
                <span class="prompt-hint" id="tablePromptHint">${item.question}</span>
            </div>`;
            return html;
        }

        function checkTableAnswer() {
            const input = document.getElementById('tableInput');
            if (!input || !input.value.trim()) return;
            const userAnswer = stripMacrons(input.value.trim().toLowerCase());
            const expected = stripMacrons(currentLatinItem.answer);
            const blankCell = document.querySelector('.cell-blank');
            const stats = wordStats[currentLatinItem.id];
            const timeElapsed = (Date.now() - currentWordStartTime) / 1000;

            if (tableRetrying) {
                if (userAnswer === expected) {
                    blankCell.classList.remove('cell-blank', 'cell-wrong-flash');
                    blankCell.classList.add('cell-correct-flash');
                    blankCell.innerHTML = currentLatinItem.displayAnswer;
                    setTimeout(() => { currentWordIndex++; loadLatinWord(); }, 1200);
                } else {
                    input.value = '';
                    input.focus();
                }
                return;
            }

            attemptCount++;
            stats.attempts++;

            if (userAnswer === expected) {
                stats.totalTime += timeElapsed;
                recordAnswer(getWordKey(currentLatinItem), true);
                blankCell.classList.remove('cell-blank');
                blankCell.classList.add('cell-correct-flash');
                blankCell.innerHTML = currentLatinItem.displayAnswer;
                handleCorrectAnswer(stats, timeElapsed);
                playSound('correct');
                setTimeout(() => { currentWordIndex++; loadLatinWord(); }, 1500);
            } else {
                stats.mistakes++;
                recordAnswer(getWordKey(currentLatinItem), false);
                blankCell.classList.add('cell-wrong-flash');
                input.value = '';

                const promptHint = document.getElementById('tablePromptHint');
                promptHint.className = 'prompt-error';
                promptHint.textContent = 'Falsch! Tippe: ' + currentLatinItem.displayAnswer;

                tableRetrying = true;
                playSound('wrong');
                if (!isRepeatPhase) addToRepeatList();
                input.focus();
            }
        }

        function skipTableAnswer() {
            const stats = wordStats[currentLatinItem.id];
            stats.attempts++;
            stats.mistakes++;
            recordAnswer(getWordKey(currentLatinItem), false);
            if (!isRepeatPhase) addToRepeatList();
            const blankCell = document.querySelector('.cell-blank');
            if (blankCell) {
                blankCell.classList.remove('cell-blank');
                blankCell.classList.add('cell-wrong-flash');
                blankCell.innerHTML = currentLatinItem.displayAnswer;
            }
            playSound('wrong');
            setTimeout(() => { currentWordIndex++; loadLatinWord(); }, 1500);
        }

        function handleCorrectAnswer(stats, timeElapsed) {
            const feedback = document.getElementById('feedback');

            if (attemptCount === 1) {
                stats.correctOnFirstTry = true;
                correctFirstTryCount++;
                if (correctFirstTryCount % 2 === 0) {
                    talersEarned++;
                    totalTalers++;
                    localStorage.setItem('vocabularyGameTalers', totalTalers.toString());
                    const talerDisplay = document.getElementById('totalTalers');
                    talerDisplay.textContent = totalTalers;
                    talerDisplay.parentElement.parentElement.style.animation = 'none';
                    setTimeout(() => { talerDisplay.parentElement.parentElement.style.animation = 'celebrate 0.5s'; }, 10);
                }
            }

            feedback.textContent = 'ğŸ‰ Richtig! Super gemacht!';
            feedback.className = 'feedback correct';
            score += 10;
            correctCount++;
            document.getElementById('score').textContent = score;
            document.getElementById('correct').textContent = correctCount;
            playSound('correct');

            if (!isRepeatPhase) {
                if (attemptCount > 1 || timeElapsed > 30) {
                    addLatinToRepeatList();
                }
            }
        }

        function addLatinToRepeatList() {
            const item = shuffledVocabulary[currentWordIndex];
            if (!wordsToRepeat.some(w => w.id === item.id)) {
                wordsToRepeat.push(item);
                document.getElementById('repeats').textContent = wordsToRepeat.length;
            }
        }

        function latinMcContinue() {
            document.getElementById('mcContinueBtn').style.display = 'none';
            currentWordIndex++;
            loadLatinWord();
        }

        function latinSkipWord() {
            const feedback = document.getElementById('feedback');
            const displayAns = currentLatinItem.displayAnswer || currentWord;
            feedback.textContent = 'Die richtige Antwort war: ' + displayAns.toUpperCase();
            feedback.className = 'feedback';
            feedback.style.color = '#667eea';
            feedback.style.fontSize = '1.8em';

            if (hintTimeout) clearTimeout(hintTimeout);

            const stats = wordStats[currentLatinItem.id];
            stats.mistakes++;
            stats.attempts++;
            recordAnswer(getWordKey(currentLatinItem), false);
            document.getElementById('emojiCurtain').classList.add('reveal');

            if (!isRepeatPhase) addLatinToRepeatList();

            document.getElementById('skipBtn').style.display = 'none';
            document.getElementById('checkBtn').style.display = 'none';
            document.getElementById('clearBtn').style.display = 'none';
            document.getElementById('continueBtn').style.display = 'inline-block';
        }

        function latinContinueToNextWord() {
            document.getElementById('skipBtn').style.display = 'inline-block';
            document.getElementById('checkBtn').style.display = 'inline-block';
            document.getElementById('clearBtn').style.display = 'inline-block';
            document.getElementById('continueBtn').style.display = 'none';
            currentWordIndex++;
            loadLatinWord();
        }

        // ===================================================================
        // ENGLISH WORD LOADING (dispatches to spelling or MC)
        // ===================================================================

        function loadWord() {
            // Check if we finished all main words
            if (!isRepeatPhase && currentWordIndex >= shuffledVocabulary.length) {
                if (wordsToRepeat.length > 0) {
                    isRepeatPhase = true;
                    currentWordIndex = 0;
                    shuffledVocabulary = wordsToRepeat;
                    // Assign fresh random modes for repeat round
                    roundModes = shuffledVocabulary.map(() => Math.random() < 0.5 ? 'spelling' : 'mc');
                    wordsToRepeat = [];
                    document.getElementById('total').textContent = shuffledVocabulary.length;
                    document.getElementById('feedback').textContent = 'ğŸ”„ Jetzt wiederholen wir die schwierigen Vokabeln!';
                    document.getElementById('feedback').className = 'feedback';
                    document.getElementById('feedback').style.color = '';
                    document.getElementById('feedback').style.fontSize = '';
                    setTimeout(() => {
                        document.getElementById('feedback').textContent = '';
                        loadWord();
                    }, 2000);
                    return;
                } else {
                    showCelebration();
                    return;
                }
            }

            if (isRepeatPhase && currentWordIndex >= shuffledVocabulary.length) {
                showCelebration();
                return;
            }

            if (hintTimeout) {
                clearTimeout(hintTimeout);
            }

            const word = shuffledVocabulary[currentWordIndex];
            currentWord = word.english.toLowerCase();
            selectedLetters = [];
            attemptCount = 0;
            mcAnswered = false;
            currentWordStartTime = Date.now();

            // Determine mode for this word
            currentMode = roundModes[currentWordIndex] || 'spelling';

            document.getElementById('wordImage').textContent = word.image;
            document.getElementById('current').textContent = currentWordIndex + 1;
            document.getElementById('feedback').textContent = '';
            document.getElementById('feedback').className = 'feedback';
            document.getElementById('feedback').style.color = '';
            document.getElementById('feedback').style.fontSize = '';
            document.getElementById('autoHint').textContent = '';
            document.getElementById('autoHint').className = 'auto-hint';
            document.getElementById('mcContinueBtn').style.display = 'none';
            document.getElementById('sentenceArea').style.display = 'none';

            // Curtain logic: hide emoji if already answered correctly before (not in repeat phase)
            const curtain = document.getElementById('emojiCurtain');
            if (!isRepeatPhase) {
                const wordKey = getWordKey(word, currentMode);
                const prog = loadProgress()[wordKey];
                if (prog && prog.correct >= 1) {
                    curtain.classList.add('active');
                    curtain.classList.remove('reveal');
                } else {
                    curtain.classList.remove('active', 'reveal');
                }
            } else {
                curtain.classList.remove('active', 'reveal');
            }

            if (currentMode === 'spelling') {
                loadSpellingMode(word);
            } else {
                loadMCMode(word);
            }

            // Start 15-second timer for automatic hint (both modes)
            hintTimeout = setTimeout(() => {
                showAutoHint();
            }, 15000);
        }

        // ===================================================================
        // SPELLING MODE (DEâ†’EN, original)
        // ===================================================================

        function loadSpellingMode(word) {
            // Show german word and hint (DEâ†’EN)
            document.getElementById('wordGerman').textContent = word.german;
            document.getElementById('wordHint').textContent = word.hint;

            // Show spelling UI, hide MC UI
            document.getElementById('spellingArea').style.display = 'block';
            document.getElementById('mcArea').style.display = 'none';
            document.getElementById('spellingButtons').style.display = 'flex';
            document.getElementById('tipText').style.display = 'block';

            // Reset buttons
            document.getElementById('skipBtn').style.display = 'inline-block';
            document.getElementById('checkBtn').style.display = 'inline-block';
            document.getElementById('clearBtn').style.display = 'inline-block';
            document.getElementById('continueBtn').style.display = 'none';

            createAnswerSlots();
            createLetterPool();
        }

        function showAutoHint() {
            const autoHintElement = document.getElementById('autoHint');
            if (currentMode === 'spelling') {
                const firstLetter = currentWord[0].toUpperCase();
                autoHintElement.textContent = `ğŸ’¡ Tipp: Das Wort beginnt mit "${firstLetter}"`;
                autoHintElement.className = 'auto-hint show';
            }
            // Kein Hint bei MC â€“ wÃ¼rde die LÃ¶sung verraten
        }

        function createAnswerSlots() {
            const answerArea = document.getElementById('answerArea');
            answerArea.innerHTML = '';

            for (let i = 0; i < currentWord.length; i++) {
                const slot = document.createElement('div');
                slot.className = 'letter-slot';
                slot.dataset.index = i;
                slot.addEventListener('click', () => removeLetterFromSlot(i));
                answerArea.appendChild(slot);
            }
        }

        function createLetterPool() {
            const lettersPool = document.getElementById('lettersPool');
            lettersPool.innerHTML = '';

            const wordLetters = currentWord.split('');
            const extraLetters = 'abcdefghijklmnopqrstuvwxyz';
            const numExtras = Math.min(5, Math.floor(currentWord.length / 2) + 2);

            for (let i = 0; i < numExtras; i++) {
                let randomLetter;
                do {
                    randomLetter = extraLetters[Math.floor(Math.random() * extraLetters.length)];
                } while (wordLetters.includes(randomLetter));
                wordLetters.push(randomLetter);
            }

            const shuffledLetters = shuffleArray(wordLetters);

            shuffledLetters.forEach((letter, index) => {
                const tile = document.createElement('div');
                tile.className = 'letter-tile';
                tile.textContent = letter.toUpperCase();
                tile.dataset.letter = letter;
                tile.dataset.id = index;
                tile.addEventListener('click', () => selectLetter(letter, index));
                lettersPool.appendChild(tile);
            });
        }

        function selectLetter(letter, id) {
            if (selectedLetters.length >= currentWord.length) return;

            const tile = document.querySelector(`[data-id="${id}"]`);
            if (tile.classList.contains('used')) return;

            selectedLetters.push({ letter, id });
            tile.classList.add('used');

            updateAnswerArea();
        }

        function removeLetterFromSlot(index) {
            if (index >= selectedLetters.length) return;

            const removed = selectedLetters[index];
            // For Latin spelling, look in lettersPool specifically
            const poolSelector = (currentLanguage === 'latin' && currentMode === 'spelling') ? '#lettersPool ' : '';
            const tile = document.querySelector(`${poolSelector}[data-id="${removed.id}"]`);
            if (tile) tile.classList.remove('used');

            selectedLetters.splice(index, 1);
            updateAnswerArea();
        }

        function updateAnswerArea() {
            const slots = document.querySelectorAll('#answerArea .letter-slot');
            slots.forEach((slot, index) => {
                if (selectedLetters[index]) {
                    slot.textContent = selectedLetters[index].letter.toUpperCase();
                    slot.classList.add('filled');
                } else {
                    slot.textContent = '';
                    slot.classList.remove('filled');
                }
            });
        }

        function checkAnswer() {
            if (currentLanguage === 'latin') {
                if (currentMode === 'sentence') { checkLatinSentence(); return; }
                if (currentMode === 'spelling') { checkLatinSpelling(); return; }
                return;
            }
            if (currentMode !== 'spelling') return;

            const answer = selectedLetters.map(l => l.letter).join('');
            const slots = document.querySelectorAll('#answerArea .letter-slot');
            const feedback = document.getElementById('feedback');

            if (hintTimeout) {
                clearTimeout(hintTimeout);
            }

            attemptCount++;

            let correctLetters = 0;
            slots.forEach((slot, index) => {
                if (selectedLetters[index]) {
                    if (selectedLetters[index].letter === currentWord[index]) {
                        slot.classList.add('correct');
                        slot.classList.remove('wrong');
                        correctLetters++;
                    } else {
                        slot.classList.add('wrong');
                        slot.classList.remove('correct');
                    }
                }
            });

            const timeElapsed = (Date.now() - currentWordStartTime) / 1000;
            const stats = wordStats[currentWord];
            stats.attempts++;

            if (answer === currentWord && correctLetters === currentWord.length) {
                stats.totalTime += timeElapsed;
                recordAnswer(getWordKey(shuffledVocabulary[currentWordIndex], currentMode), true);
                document.getElementById('emojiCurtain').classList.add('reveal');

                if (attemptCount === 1) {
                    stats.correctOnFirstTry = true;
                    correctFirstTryCount++;

                    if (correctFirstTryCount % 2 === 0) {
                        talersEarned++;
                        totalTalers++;
                        localStorage.setItem('vocabularyGameTalers', totalTalers.toString());

                        const talerDisplay = document.getElementById('totalTalers');
                        talerDisplay.textContent = totalTalers;
                        talerDisplay.parentElement.parentElement.style.animation = 'none';
                        setTimeout(() => {
                            talerDisplay.parentElement.parentElement.style.animation = 'celebrate 0.5s';
                        }, 10);
                    }
                }

                feedback.textContent = 'ğŸ‰ Richtig! Super gemacht!';
                feedback.className = 'feedback correct';

                score += 10;
                correctCount++;
                document.getElementById('score').textContent = score;
                document.getElementById('correct').textContent = correctCount;

                playSound('correct');

                if (!isRepeatPhase) {
                    if (attemptCount > 1 || timeElapsed > 30) {
                        addToRepeatList();
                    }
                }

                setTimeout(() => {
                    currentWordIndex++;
                    loadWord();
                }, 2000);
            } else {
                stats.mistakes++;
                recordAnswer(getWordKey(shuffledVocabulary[currentWordIndex], currentMode), false);
                document.getElementById('emojiCurtain').classList.add('reveal');

                feedback.textContent = 'âŒ Das ist leider nicht richtig. Versuch es nochmal!';
                feedback.className = 'feedback wrong';

                playSound('wrong');

                setTimeout(() => {
                    slots.forEach(slot => {
                        slot.classList.remove('wrong');
                        slot.classList.remove('correct');
                    });
                }, 1500);
            }
        }

        function skipWord() {
            if (currentLanguage === 'latin') { latinSkipWord(); return; }
            const feedback = document.getElementById('feedback');
            feedback.textContent = `Die richtige Antwort war: ${currentWord.toUpperCase()}`;
            feedback.className = 'feedback';
            feedback.style.color = '#667eea';
            feedback.style.fontSize = '1.8em';

            if (hintTimeout) {
                clearTimeout(hintTimeout);
            }

            const stats = wordStats[currentWord];
            stats.mistakes++;
            stats.attempts++;
            recordAnswer(getWordKey(shuffledVocabulary[currentWordIndex], currentMode), false);
            document.getElementById('emojiCurtain').classList.add('reveal');

            if (!isRepeatPhase) {
                addToRepeatList();
            }

            document.getElementById('skipBtn').style.display = 'none';
            document.getElementById('checkBtn').style.display = 'none';
            document.getElementById('clearBtn').style.display = 'none';
            document.getElementById('continueBtn').style.display = 'inline-block';
        }

        function continueToNextWord() {
            if (currentLanguage === 'latin') { latinContinueToNextWord(); return; }
            document.getElementById('skipBtn').style.display = 'inline-block';
            document.getElementById('checkBtn').style.display = 'inline-block';
            document.getElementById('clearBtn').style.display = 'inline-block';
            document.getElementById('continueBtn').style.display = 'none';

            currentWordIndex++;
            loadWord();
        }

        function clearAnswer() {
            if (currentLanguage === 'latin' && currentMode === 'sentence') {
                selectedLetters.forEach(item => {
                    const tile = document.querySelector(`#sentenceLettersPool [data-id="${item.id}"]`);
                    if (tile) tile.classList.remove('used');
                });
                selectedLetters = [];
                updateSentenceAnswerArea();
                return;
            }
            selectedLetters.forEach(item => {
                const tile = document.querySelector(`[data-id="${item.id}"]`);
                if (tile) tile.classList.remove('used');
            });
            selectedLetters = [];
            updateAnswerArea();
        }

        // ===================================================================
        // MULTIPLE CHOICE MODE (ENâ†’DE)
        // ===================================================================

        function loadMCMode(word) {
            // Show english word (ENâ†’DE direction)
            document.getElementById('wordGerman').textContent = word.english.toUpperCase();
            document.getElementById('wordHint').textContent = 'Was bedeutet dieses Wort auf Deutsch?';

            // Show MC UI, hide spelling UI
            document.getElementById('spellingArea').style.display = 'none';
            document.getElementById('mcArea').style.display = 'block';
            document.getElementById('spellingButtons').style.display = 'none';
            document.getElementById('tipText').style.display = 'none';

            // Build 5 options: 1 correct + 4 distractors
            const correctAnswer = word.german;
            const distractors = word.distractors || [];

            // Build options array
            let options = [
                { text: correctAnswer, correct: true }
            ];
            distractors.forEach(d => {
                options.push({ text: d, correct: false });
            });

            // Shuffle options
            options = shuffleArray(options);

            // Render MC options
            const mcContainer = document.getElementById('mcOptions');
            mcContainer.innerHTML = '';

            options.forEach((opt, idx) => {
                const optDiv = document.createElement('div');
                optDiv.className = 'mc-option';
                optDiv.dataset.index = idx;
                optDiv.dataset.correct = opt.correct;
                optDiv.innerHTML = `<span class="mc-key">${idx + 1}</span><span class="mc-text">${opt.text}</span>`;
                optDiv.addEventListener('click', () => selectMCOption(idx));
                mcContainer.appendChild(optDiv);
            });
        }

        function selectMCOption(index) {
            if (mcAnswered) return;
            mcAnswered = true;

            if (hintTimeout) {
                clearTimeout(hintTimeout);
            }

            attemptCount++;

            const options = document.querySelectorAll('.mc-option');
            const selectedOption = options[index];
            const isCorrect = selectedOption.dataset.correct === 'true';
            const feedback = document.getElementById('feedback');
            const timeElapsed = (Date.now() - currentWordStartTime) / 1000;
            const stats = wordStats[currentWord];
            stats.attempts++;

            // Disable all options
            options.forEach(opt => opt.classList.add('mc-disabled'));

            // Highlight correct answer
            options.forEach(opt => {
                if (opt.dataset.correct === 'true') {
                    opt.classList.add('mc-correct');
                }
            });

            if (isCorrect) {
                stats.totalTime += timeElapsed;
                recordAnswer(getWordKey(shuffledVocabulary[currentWordIndex], currentMode), true);
                document.getElementById('emojiCurtain').classList.add('reveal');

                if (attemptCount === 1) {
                    stats.correctOnFirstTry = true;
                    correctFirstTryCount++;

                    if (correctFirstTryCount % 2 === 0) {
                        talersEarned++;
                        totalTalers++;
                        localStorage.setItem('vocabularyGameTalers', totalTalers.toString());

                        const talerDisplay = document.getElementById('totalTalers');
                        talerDisplay.textContent = totalTalers;
                        talerDisplay.parentElement.parentElement.style.animation = 'none';
                        setTimeout(() => {
                            talerDisplay.parentElement.parentElement.style.animation = 'celebrate 0.5s';
                        }, 10);
                    }
                }

                feedback.textContent = 'ğŸ‰ Richtig! Super gemacht!';
                feedback.className = 'feedback correct';

                score += 10;
                correctCount++;
                document.getElementById('score').textContent = score;
                document.getElementById('correct').textContent = correctCount;

                playSound('correct');

                if (!isRepeatPhase) {
                    if (attemptCount > 1 || timeElapsed > 30) {
                        addToRepeatList();
                    }
                }

                setTimeout(() => {
                    currentWordIndex++;
                    loadWord();
                }, 2000);
            } else {
                selectedOption.classList.add('mc-wrong');
                stats.mistakes++;
                recordAnswer(getWordKey(shuffledVocabulary[currentWordIndex], currentMode), false);
                document.getElementById('emojiCurtain').classList.add('reveal');

                feedback.textContent = '';
                feedback.className = 'feedback';

                playSound('wrong');

                if (!isRepeatPhase) {
                    addToRepeatList();
                }

                // Show "Weiter" button so the user can study the correct answer
                document.getElementById('mcContinueBtn').style.display = 'inline-block';
            }
        }

        // ===================================================================
        // SHARED HELPERS
        // ===================================================================

        function mcContinue() {
            if (currentLanguage === 'latin') { latinMcContinue(); return; }
            document.getElementById('mcContinueBtn').style.display = 'none';
            currentWordIndex++;
            loadWord();
        }

        function addToRepeatList() {
            const currentWordObj = shuffledVocabulary[currentWordIndex];
            const matchKey = currentWordObj.english || currentWordObj.id;
            const alreadyInRepeat = wordsToRepeat.some(w => (w.english || w.id) === matchKey);
            if (!alreadyInRepeat) {
                wordsToRepeat.push(currentWordObj);
                document.getElementById('repeats').textContent = wordsToRepeat.length;
            }
        }

        function showCelebration() {
            const celebration = document.getElementById('celebration');
            const finalScore = document.getElementById('finalScore');

            const totalWords = Object.keys(wordStats).length;
            const totalAttempts = Object.values(wordStats).reduce((sum, s) => sum + s.attempts, 0);
            const correctOnFirstTry = Object.values(wordStats).filter(s => s.correctOnFirstTry).length;
            const avgTime = Object.values(wordStats).reduce((sum, s) => sum + (s.totalTime / s.attempts || 0), 0) / totalWords;

            const successRate = Math.round((correctCount / totalAttempts) * 100);

            let celebrationHTML = `
                <strong>ğŸ¯ Statistik:</strong><br><br>
                <strong>${correctOnFirstTry}</strong> von <strong>${totalWords}</strong> Vokabeln beim ersten Mal richtig!<br>
                Erfolgsquote: ${successRate}%<br>
                Gesamtversuche: ${totalAttempts}<br>
                Durchschnittliche Zeit: ${avgTime.toFixed(1)}s<br><br>
            `;

            if (talersEarned > 0) {
                celebrationHTML += `<div style="background: linear-gradient(135deg, #f9d423 0%, #ff4e50 100%); padding: 15px; border-radius: 15px; margin: 15px 0;">
                    ğŸª™ <strong>Du hast ${talersEarned} Taler verdient!</strong><br>
                    Gesamt: ${totalTalers} / 50 Taler
                </div>`;
            }

            if (totalTalers >= 50) {
                celebrationHTML += `
                    <div style="background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%); padding: 20px; border-radius: 15px; margin: 15px 0; animation: celebrate 1s infinite;">
                        <div style="font-size: 3em;">ğŸ†</div>
                        <strong style="font-size: 1.5em;">GEWONNEN!</strong><br>
                        Du hast 50 Taler erreicht!<br>
                        Zeig das deinen Eltern! ğŸ‰
                    </div>
                `;
            }

            // Show learning progress for current chapter/set
            const allProgress = loadProgress();
            let chapterKeys = new Set();
            let chapterLabel = '';
            if (currentLanguage === 'english') {
                vocabulary.forEach(w => {
                    chapterKeys.add('en:' + w.english.toLowerCase());
                });
                chapterLabel = currentVocabularySet;
            } else if (currentLatinChapter) {
                const ch = currentLatinChapter;
                ch.vocabulary.forEach(v => chapterKeys.add('la:v_' + v.latin));
                if (ch.multiWord) ch.multiWord.forEach(mw => chapterKeys.add('la:mw_lg_' + mw.latin));
                if (ch.verbForms) ch.verbForms.forEach(vf => {
                    chapterKeys.add('la:vf_i2f_' + vf.infinitive);
                    if (vf.present) chapterKeys.add('la:vf_pres_' + vf.infinitive);
                    if (vf.imperative) chapterKeys.add('la:vf_imp_' + vf.infinitive);
                });
                if (ch.nouns) ch.nouns.forEach(n => chapterKeys.add('la:noun_' + n.nom_sg));
                if (ch.verbForms) ch.verbForms.forEach(vf => chapterKeys.add('la:tbl_v_' + vf.infinitive));
                if (ch.nouns) ch.nouns.forEach(n => chapterKeys.add('la:tbl_n_' + n.nom_sg));
                if (ch.sentences) ch.sentences.forEach(s => chapterKeys.add('la:sent_' + s.answer));
                chapterLabel = ch.name;
            }
            const chapterTotal = chapterKeys.size;
            // Count words with correct >= 3 in any direction
            const learnedBaseWords = new Set();
            Object.entries(allProgress).forEach(([key, p]) => {
                if (p.correct >= 3) {
                    let baseKey = key.replace(/:(de>en|en>de|de>la|la>de):/, ':');
                    // Strip person/case specifics from verb and noun keys
                    baseKey = baseKey.replace(/vf_pres_(sg2|sg3|pl1|pl2|pl3)_/, 'vf_pres_');
                    baseKey = baseKey.replace(/vf_imp_(sg|pl)_/, 'vf_imp_');
                    baseKey = baseKey.replace(/noun_(gen|dat|akk|abl|nom)_(sg|pl)_/, 'noun_');
                    baseKey = baseKey.replace(/tbl_v_(sg1|sg2|sg3|pl1|pl2|pl3|imp_sg|imp_pl)_/, 'tbl_v_');
                    baseKey = baseKey.replace(/tbl_n_(nom|gen|dat|akk|abl)_(sg|pl)_/, 'tbl_n_');
                    learnedBaseWords.add(baseKey);
                }
            });
            const learnedCount = [...learnedBaseWords].filter(bk => chapterKeys.has(bk)).length;
            celebrationHTML += `<div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px; border-radius: 12px; margin: 15px 0;">
                ğŸ“Š ${chapterLabel}: <strong>${learnedCount}</strong> / ${chapterTotal} Vokabeln gelernt <span style="font-size: 0.8em; opacity: 0.85;">(3Ã— richtig)</span>
            </div>`;

            celebrationHTML += `<strong>Gesamtpunkte: ${score}</strong>`;

            finalScore.innerHTML = celebrationHTML;
            celebration.classList.add('show');
        }

        function playSound(type) {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            if (type === 'correct') {
                oscillator.frequency.value = 523.25;
                oscillator.type = 'sine';
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
            } else {
                oscillator.frequency.value = 200;
                oscillator.type = 'sawtooth';
                gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.3);
            }
        }

        // ===================================================================
        // KEYBOARD INPUT HANDLER
        // ===================================================================

        document.addEventListener('keydown', (event) => {
            // Table mode: only intercept Enter, let browser handle rest
            if (currentMode === 'table') {
                if (event.key === 'Enter') {
                    event.preventDefault();
                    checkTableAnswer();
                }
                return;
            }

            const key = event.key.toLowerCase();

            // Space or Enter to continue after skip
            if ((key === ' ' || key === 'enter') && document.getElementById('continueBtn').style.display !== 'none') {
                event.preventDefault();
                continueToNextWord();
                return;
            }

            // Space or Enter to continue after wrong MC answer
            if ((key === ' ' || key === 'enter') && document.getElementById('mcContinueBtn').style.display !== 'none') {
                event.preventDefault();
                mcContinue();
                return;
            }

            // Multiple Choice: keys 1-5 (both English and Latin MC)
            if (currentMode === 'mc' && !mcAnswered && key >= '1' && key <= '5') {
                const index = parseInt(key) - 1;
                const options = document.querySelectorAll('.mc-option');
                if (index < options.length) {
                    event.preventDefault();
                    if (currentLanguage === 'latin') {
                        selectLatinMC(index);
                    } else {
                        selectMCOption(index);
                    }
                }
                return;
            }

            // Latin sentence mode keyboard
            if (currentLanguage === 'latin' && currentMode === 'sentence') {
                if (key.length === 1 && ((key >= 'a' && key <= 'z') || 'Ã¤Ã¶Ã¼'.includes(key))) {
                    const tiles = document.querySelectorAll('#sentenceLettersPool .letter-tile');
                    for (let tile of tiles) {
                        if (tile.dataset.letter === key && !tile.classList.contains('used')) {
                            const id = parseInt(tile.dataset.id);
                            selectSentenceLetter(key, id);
                            break;
                        }
                    }
                }
                if (key === 'backspace' && selectedLetters.length > 0) {
                    removeSentenceLetterFromSlot(selectedLetters.length - 1);
                }
                if (key === 'enter' && selectedLetters.length === currentWord.length) {
                    checkAnswer();
                }
                if (key === 'escape') { clearAnswer(); }
                return;
            }

            // Latin spelling mode keyboard (macron-aware)
            if (currentLanguage === 'latin' && currentMode === 'spelling') {
                if (key.length === 1 && key >= 'a' && key <= 'z') {
                    const tiles = document.querySelectorAll('#lettersPool .letter-tile');
                    for (let tile of tiles) {
                        if (baseChar(tile.dataset.letter) === key && !tile.classList.contains('used')) {
                            const id = parseInt(tile.dataset.id);
                            selectLatinLetter(tile.dataset.letter, id);
                            break;
                        }
                    }
                }
                if (key === 'backspace' && selectedLetters.length > 0) {
                    removeLetterFromSlot(selectedLetters.length - 1);
                }
                if (key === 'enter' && selectedLetters.length === currentWord.length) {
                    checkAnswer();
                }
                if (key === 'escape') { clearAnswer(); }
                return;
            }

            // English spelling mode keyboard controls
            if (currentMode === 'spelling') {
                if (key.length === 1 && key >= 'a' && key <= 'z') {
                    const tiles = document.querySelectorAll('.letter-tile');
                    for (let tile of tiles) {
                        if (tile.dataset.letter === key && !tile.classList.contains('used')) {
                            const id = parseInt(tile.dataset.id);
                            selectLetter(key, id);
                            break;
                        }
                    }
                }

                if (key === 'backspace' && selectedLetters.length > 0) {
                    const lastIndex = selectedLetters.length - 1;
                    removeLetterFromSlot(lastIndex);
                }

                if (key === 'enter' && selectedLetters.length === currentWord.length) {
                    checkAnswer();
                }

                if (key === 'escape') {
                    clearAnswer();
                }
            }
        });

        // ===================================================================
        // EVENT LISTENERS
        // ===================================================================

        document.getElementById('checkBtn').addEventListener('click', checkAnswer);
        document.getElementById('skipBtn').addEventListener('click', skipWord);
        document.getElementById('clearBtn').addEventListener('click', clearAnswer);
        document.getElementById('continueBtn').addEventListener('click', continueToNextWord);
    </script>
</body>
</html>
